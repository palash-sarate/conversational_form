{"ast":null,"code":"(function (root) {\n  // Store setTimeout reference so promise-polyfill will be unaffected by\n  // other code modifying setTimeout (like sinon.useFakeTimers())\n  var setTimeoutFunc = setTimeout;\n\n  function noop() {} // Polyfill for Function.prototype.bind\n\n\n  function bind(fn, thisArg) {\n    return function () {\n      fn.apply(thisArg, arguments);\n    };\n  }\n\n  function Promise(fn) {\n    if (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n    if (typeof fn !== 'function') throw new TypeError('not a function');\n    this._state = 0;\n    this._handled = false;\n    this._value = undefined;\n    this._deferreds = [];\n    doResolve(fn, this);\n  }\n\n  function handle(self, deferred) {\n    while (self._state === 3) {\n      self = self._value;\n    }\n\n    if (self._state === 0) {\n      self._deferreds.push(deferred);\n\n      return;\n    }\n\n    self._handled = true;\n\n    Promise._immediateFn(function () {\n      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n\n      if (cb === null) {\n        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n        return;\n      }\n\n      var ret;\n\n      try {\n        ret = cb(self._value);\n      } catch (e) {\n        reject(deferred.promise, e);\n        return;\n      }\n\n      resolve(deferred.promise, ret);\n    });\n  }\n\n  function resolve(self, newValue) {\n    try {\n      // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n      if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n\n      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n        var then = newValue.then;\n\n        if (newValue instanceof Promise) {\n          self._state = 3;\n          self._value = newValue;\n          finale(self);\n          return;\n        } else if (typeof then === 'function') {\n          doResolve(bind(then, newValue), self);\n          return;\n        }\n      }\n\n      self._state = 1;\n      self._value = newValue;\n      finale(self);\n    } catch (e) {\n      reject(self, e);\n    }\n  }\n\n  function reject(self, newValue) {\n    self._state = 2;\n    self._value = newValue;\n    finale(self);\n  }\n\n  function finale(self) {\n    if (self._state === 2 && self._deferreds.length === 0) {\n      Promise._immediateFn(function () {\n        if (!self._handled) {\n          Promise._unhandledRejectionFn(self._value);\n        }\n      });\n    }\n\n    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n      handle(self, self._deferreds[i]);\n    }\n\n    self._deferreds = null;\n  }\n\n  function Handler(onFulfilled, onRejected, promise) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.promise = promise;\n  }\n  /**\n   * Take a potentially misbehaving resolver function and make sure\n   * onFulfilled and onRejected are only called once.\n   *\n   * Makes no guarantees about asynchrony.\n   */\n\n\n  function doResolve(fn, self) {\n    var done = false;\n\n    try {\n      fn(function (value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      }, function (reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      });\n    } catch (ex) {\n      if (done) return;\n      done = true;\n      reject(self, ex);\n    }\n  }\n\n  Promise.prototype['catch'] = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n\n  Promise.prototype.then = function (onFulfilled, onRejected) {\n    var prom = new this.constructor(noop);\n    handle(this, new Handler(onFulfilled, onRejected, prom));\n    return prom;\n  };\n\n  Promise.all = function (arr) {\n    var args = Array.prototype.slice.call(arr);\n    return new Promise(function (resolve, reject) {\n      if (args.length === 0) return resolve([]);\n      var remaining = args.length;\n\n      function res(i, val) {\n        try {\n          if (val && (typeof val === 'object' || typeof val === 'function')) {\n            var then = val.then;\n\n            if (typeof then === 'function') {\n              then.call(val, function (val) {\n                res(i, val);\n              }, reject);\n              return;\n            }\n          }\n\n          args[i] = val;\n\n          if (--remaining === 0) {\n            resolve(args);\n          }\n        } catch (ex) {\n          reject(ex);\n        }\n      }\n\n      for (var i = 0; i < args.length; i++) {\n        res(i, args[i]);\n      }\n    });\n  };\n\n  Promise.resolve = function (value) {\n    if (value && typeof value === 'object' && value.constructor === Promise) {\n      return value;\n    }\n\n    return new Promise(function (resolve) {\n      resolve(value);\n    });\n  };\n\n  Promise.reject = function (value) {\n    return new Promise(function (resolve, reject) {\n      reject(value);\n    });\n  };\n\n  Promise.race = function (values) {\n    return new Promise(function (resolve, reject) {\n      for (var i = 0, len = values.length; i < len; i++) {\n        values[i].then(resolve, reject);\n      }\n    });\n  }; // Use polyfill for setImmediate for performance gains\n\n\n  Promise._immediateFn = typeof setImmediate === 'function' && function (fn) {\n    setImmediate(fn);\n  } || function (fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\n  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n    if (typeof console !== 'undefined' && console) {\n      console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n    }\n  };\n  /**\n   * Set the immediate function to execute callbacks\n   * @param fn {function} Function to execute\n   * @deprecated\n   */\n\n\n  Promise._setImmediateFn = function _setImmediateFn(fn) {\n    Promise._immediateFn = fn;\n  };\n  /**\n   * Change the function to execute on unhandled rejection\n   * @param {function} fn Function to execute on unhandled rejection\n   * @deprecated\n   */\n\n\n  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n    Promise._unhandledRejectionFn = fn;\n  };\n\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = Promise;\n  } else if (!root.Promise) {\n    root.Promise = Promise;\n  }\n})(this); // Polyfill for creating CustomEvents on IE9/10/11\n// code pulled from:\n// https://github.com/d4tocchini/customevent-polyfill\n// https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent#Polyfill\n\n\ntry {\n  var ce = new window.CustomEvent('test');\n  ce.preventDefault();\n\n  if (ce.defaultPrevented !== true) {\n    // IE has problems with .preventDefault() on custom events\n    // http://stackoverflow.com/questions/23349191\n    throw new Error('Could not prevent default');\n  }\n} catch (e) {\n  var CustomEvent = function CustomEvent(event, params) {\n    var evt, origPrevent;\n    params = params || {\n      bubbles: false,\n      cancelable: false,\n      detail: undefined\n    };\n    evt = document.createEvent(\"CustomEvent\");\n    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n    origPrevent = evt.preventDefault;\n\n    evt.preventDefault = function () {\n      origPrevent.call(this);\n\n      try {\n        Object.defineProperty(this, 'defaultPrevented', {\n          get: function get() {\n            return true;\n          }\n        });\n      } catch (e) {\n        this.defaultPrevented = true;\n      }\n    };\n\n    return evt;\n  };\n\n  CustomEvent.prototype = window.Event.prototype;\n  window.CustomEvent = CustomEvent; // expose definition to window\n} // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var Helpers =\n  /** @class */\n  function () {\n    function Helpers() {}\n\n    Helpers.lerp = function (norm, min, max) {\n      return (max - min) * norm + min;\n    };\n\n    Helpers.norm = function (value, min, max) {\n      return (value - min) / (max - min);\n    };\n\n    Helpers.getXYFromMouseTouchEvent = function (event) {\n      var touches = null;\n      if (event.originalEvent) touches = event.originalEvent.touches || event.originalEvent.changedTouches;else if (event.changedTouches) touches = event.changedTouches;\n\n      if (touches) {\n        return {\n          x: touches[0].pageX,\n          y: touches[0].pageY,\n          touches: touches[0]\n        };\n      } else {\n        return {\n          x: event.pageX,\n          y: event.pageY,\n          touches: null\n        };\n      }\n    };\n\n    Helpers.getInnerTextOfElement = function (element) {\n      var tmp = document.createElement(\"DIV\");\n      tmp.innerHTML = element.innerHTML; // return \n\n      var text = tmp.textContent || tmp.innerText || \"\"; // text = String(text).replace('\\t','');\n\n      text = String(text).replace(/^\\s+|\\s+$/g, '');\n      return text;\n    };\n\n    Helpers.getMouseEvent = function (eventString) {\n      var mappings = [];\n      mappings[\"click\"] = \"ontouchstart\" in window ? \"touchstart\" : \"click\";\n      mappings[\"mousedown\"] = \"ontouchstart\" in window ? \"touchstart\" : \"mousedown\";\n      mappings[\"mouseup\"] = \"ontouchstart\" in window ? \"touchend\" : \"mouseup\";\n      mappings[\"mousemove\"] = \"ontouchstart\" in window ? \"touchmove\" : \"mousemove\";\n      return mappings[eventString];\n    };\n\n    Helpers.isInternetExlorer = function () {\n      var ua = window.navigator.userAgent;\n      var msie = ua.indexOf(\"MSIE \");\n      return msie > 0 || !!navigator.userAgent.match(/Trident.*rv\\:11\\./);\n    };\n\n    Helpers.getValuesOfBars = function (str) {\n      var strs = str.split(\"||\"); // TODO: remove single |\n      // fallback to the standard\n\n      if (strs.length <= 1) strs = str.split(\"|\");\n      return strs;\n    };\n\n    Helpers.setTransform = function (el, transformString) {\n      el.style[\"-webkit-transform\"] = transformString;\n      el.style[\"-moz-transform\"] = transformString;\n      el.style[\"-ms-transform\"] = transformString;\n      el.style[\"transform\"] = transformString;\n    }; // deep extends and object, from: https://andrewdupont.net/2009/08/28/deep-extending-objects-in-javascript/\n\n\n    Helpers.extendObject = function (destination, source) {\n      for (var property in source) {\n        if (source[property] && source[property].constructor && source[property].constructor === Object) {\n          destination[property] = destination[property] || {};\n          arguments.callee(destination[property], source[property]);\n        } else {\n          destination[property] = source[property];\n        }\n      }\n\n      return destination;\n    };\n\n    ;\n    Helpers.caniuse = {\n      fileReader: function fileReader() {\n        if (window.File && window.FileReader && window.FileList && window.Blob) return true;\n        return false;\n      }\n    };\n    return Helpers;\n  }();\n\n  cf.Helpers = Helpers;\n})(cf || (cf = {})); /// <reference path=\"../ConversationalForm.ts\"/>\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  var EventDispatcher =\n  /** @class */\n  function () {\n    function EventDispatcher(cfRef) {\n      if (cfRef === void 0) {\n        cfRef = null;\n      }\n\n      this._cf = cfRef;\n      this.target = document.createDocumentFragment();\n    }\n\n    Object.defineProperty(EventDispatcher.prototype, \"cf\", {\n      get: function get() {\n        return this._cf;\n      },\n      set: function set(value) {\n        this._cf = value;\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    EventDispatcher.prototype.addEventListener = function (type, listener, useCapture) {\n      return this.target.addEventListener(type, listener, useCapture);\n    };\n\n    EventDispatcher.prototype.dispatchEvent = function (event) {\n      return this.target.dispatchEvent(event);\n    };\n\n    EventDispatcher.prototype.removeEventListener = function (type, listener, useCapture) {\n      this.target.removeEventListener(type, listener, useCapture);\n    };\n\n    return EventDispatcher;\n  }();\n\n  cf.EventDispatcher = EventDispatcher;\n})(cf || (cf = {})); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  var TagsParser =\n  /** @class */\n  function () {\n    function TagsParser() {}\n\n    TagsParser.parseTag = function (element) {\n      var tag = document.createElement(element.tag);\n      tag.setAttribute(\"cf-formless\", \"\"); // TODO: ES6 mapping??\n\n      for (var k in element) {\n        if (k !== \"tag\" && k !== \"children\") {\n          tag.setAttribute(k, element[k]);\n        }\n      }\n\n      return tag;\n    };\n\n    TagsParser.parseGroupTag = function (groupTag) {\n      var groupEl = TagsParser.parseTag(groupTag);\n      var groupChildren = groupTag.children;\n\n      for (var j = 0; j < groupChildren.length; j++) {\n        var fieldSetTagData = groupChildren[j];\n        var tag = TagsParser.parseTag(fieldSetTagData);\n        groupEl.appendChild(tag);\n      }\n\n      return groupEl;\n    };\n\n    TagsParser.parseJSONIntoElements = function (data) {\n      var formEl = document.createElement(\"form\");\n\n      for (var i = 0; i < data.length; i++) {\n        var element = data[i];\n        var tag = TagsParser.parseTag(element); // add sub children to tag, ex. option, checkbox, etc.\n\n        if (element.children && element.children.length > 0) {\n          for (var j = 0; j < element.children.length; j++) {\n            var subElement = TagsParser.parseTag(element.children[j]);\n            tag.appendChild(subElement);\n          }\n        }\n\n        formEl.appendChild(tag);\n      }\n\n      return formEl;\n    };\n\n    TagsParser.isElementFormless = function (element) {\n      if (element.hasAttribute(\"cf-formless\")) return true;\n      return false;\n    };\n\n    return TagsParser;\n  }();\n\n  cf.TagsParser = TagsParser;\n})(cf || (cf = {})); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // default options interface for optional parameters for the UI of Conversational Form\n  cf.UserInterfaceDefaultOptions = {\n    controlElementsInAnimationDelay: 250,\n    robot: {\n      robotResponseTime: 0,\n      chainedResponseTime: 500\n    },\n    user: {\n      showThinking: false,\n      showThumb: false\n    }\n  };\n})(cf || (cf = {})); /// <reference path=\"../logic/EventDispatcher.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // class\n  var BasicElement =\n  /** @class */\n  function () {\n    function BasicElement(options) {\n      this.eventTarget = options.eventTarget;\n      this.cfReference = options.cfReference;\n      if (options.customTemplate) this.customTemplate = options.customTemplate; // TODO: remove\n\n      if (!this.eventTarget) throw new Error(\"this.eventTarget not set!! : \" + this.constructor.name);\n      this.setData(options);\n      this.createElement();\n      this.onElementCreated();\n    }\n\n    BasicElement.prototype.setData = function (options) {};\n\n    BasicElement.prototype.onElementCreated = function () {};\n\n    BasicElement.prototype.createElement = function () {\n      var template = document.createElement('template');\n      template.innerHTML = this.getTemplate();\n      this.el = template.firstChild || template.content.firstChild;\n      return this.el;\n    }; // template, should be overwritten ...\n\n\n    BasicElement.prototype.getTemplate = function () {\n      return this.customTemplate || \"should be overwritten...\";\n    };\n\n    ;\n\n    BasicElement.prototype.dealloc = function () {\n      this.el.parentNode.removeChild(this.el);\n    };\n\n    return BasicElement;\n  }();\n\n  cf.BasicElement = BasicElement;\n})(cf || (cf = {})); /// <reference path=\"../../ConversationalForm.ts\"/>\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../../form-tags/Tag.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  cf.ControlElementEvents = {\n    SUBMIT_VALUE: \"cf-basic-element-submit\",\n    PROGRESS_CHANGE: \"cf-basic-element-progress\",\n    ON_FOCUS: \"cf-basic-element-on-focus\",\n    ON_LOADED: \"cf-basic-element-on-loaded\"\n  };\n  cf.ControlElementProgressStates = {\n    BUSY: \"cf-control-element-progress-BUSY\",\n    READY: \"cf-control-element-progress-READY\"\n  }; // class\n\n  var ControlElement =\n  /** @class */\n  function (_super) {\n    __extends(ControlElement, _super);\n\n    function ControlElement(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this.animateInTimer = 0;\n      _this._partOfSeveralChoices = false;\n      _this._focus = false;\n      _this.onFocusCallback = _this.onFocus.bind(_this);\n\n      _this.el.addEventListener('focus', _this.onFocusCallback, false);\n\n      _this.onBlurCallback = _this.onBlur.bind(_this);\n\n      _this.el.addEventListener('blur', _this.onBlurCallback, false);\n\n      if (_this.referenceTag.disabled) {\n        _this.el.setAttribute(\"disabled\", \"disabled\");\n      }\n\n      return _this;\n    }\n\n    Object.defineProperty(ControlElement.prototype, \"type\", {\n      get: function get() {\n        return \"ControlElement\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElement.prototype, \"partOfSeveralChoices\", {\n      get: function get() {\n        return this._partOfSeveralChoices;\n      },\n      set: function set(value) {\n        this._partOfSeveralChoices = value;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElement.prototype, \"value\", {\n      get: function get() {\n        // value is for the chat response -->\n        var hasTagImage = this.referenceTag.hasImage;\n        var str;\n\n        if (hasTagImage && !this.partOfSeveralChoices) {\n          // const image: string = hasTagImage ? \"<img src='\" + this.referenceTag.domElement.getAttribute(\"cf-image\") + \"'/>\" : \"\";\n          var image = hasTagImage ? \"<img src=\\\"\" + this.referenceTag.domElement.getAttribute(\"cf-image\") + \"\\\"/>\" : \"\"; // str = \"<div class='contains-image'>\"\n          // str += image;\n          // str += \"<span>\" + Helpers.getInnerTextOfElement(this.el) + \"</span>\";\n          // str += \"</div>\";\n\n          str = image + cf.Helpers.getInnerTextOfElement(this.el);\n        } else {\n          // str = \"<div><span>\" + Helpers.getInnerTextOfElement(this.el) + \"</span></div>\";\n          str = cf.Helpers.getInnerTextOfElement(this.el);\n        }\n\n        return str;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElement.prototype, \"positionVector\", {\n      get: function get() {\n        return this._positionVector;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElement.prototype, \"tabIndex\", {\n      set: function set(value) {\n        this.el.tabIndex = value;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElement.prototype, \"highlight\", {\n      get: function get() {\n        return this.el.classList.contains(\"highlight\");\n      },\n      set: function set(value) {\n        if (value) this.el.classList.add(\"highlight\");else this.el.classList.remove(\"highlight\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElement.prototype, \"focus\", {\n      get: function get() {\n        return this._focus;\n      },\n      set: function set(value) {\n        this._focus = value;\n        if (this._focus) this.el.focus();else this.el.blur();\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElement.prototype, \"visible\", {\n      get: function get() {\n        return !this.el.classList.contains(\"hide\");\n      },\n      set: function set(value) {\n        if (value) {\n          this.el.classList.remove(\"hide\");\n        } else {\n          this.el.classList.add(\"hide\");\n          this.tabIndex = -1;\n          this.highlight = false;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    ControlElement.prototype.onBlur = function (event) {\n      this._focus = false;\n    };\n\n    ControlElement.prototype.onFocus = function (event) {\n      this._focus = true;\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ControlElementEvents.ON_FOCUS, this.referenceTag);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.ON_FOCUS, {\n        detail: this.positionVector\n      }));\n    };\n    /**\n    * @name hasImage\n    * if control element contains an image element\n    */\n\n\n    ControlElement.prototype.hasImage = function () {\n      return false;\n    };\n\n    ControlElement.prototype.calcPosition = function () {\n      var mr = parseInt(window.getComputedStyle(this.el).getPropertyValue(\"margin-right\"), 10); // try not to do this to often, re-paint whammy!\n\n      this._positionVector = {\n        height: this.el.offsetHeight,\n        width: this.el.offsetWidth + mr,\n        x: this.el.offsetLeft,\n        y: this.el.offsetTop,\n        el: this\n      };\n      this._positionVector.centerX = this._positionVector.x + this._positionVector.width * 0.5;\n      this._positionVector.centerY = this._positionVector.y + this._positionVector.height * 0.5;\n    };\n\n    ControlElement.prototype.setData = function (options) {\n      this.referenceTag = options.referenceTag;\n\n      _super.prototype.setData.call(this, options);\n    };\n\n    ControlElement.prototype.animateIn = function () {\n      clearTimeout(this.animateInTimer);\n      this.el.classList.add(\"animate-in\");\n    };\n\n    ControlElement.prototype.animateOut = function () {\n      this.el.classList.add(\"animate-out\");\n    };\n\n    ControlElement.prototype.onChoose = function () {\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ControlElementEvents.SUBMIT_VALUE, this.referenceTag);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.SUBMIT_VALUE, {\n        detail: this\n      }));\n    };\n\n    ControlElement.prototype.dealloc = function () {\n      this.el.removeEventListener('blur', this.onBlurCallback, false);\n      this.onBlurCallback = null;\n      this.el.removeEventListener('focus', this.onFocusCallback, false);\n      this.onFocusCallback = null;\n\n      _super.prototype.dealloc.call(this);\n    };\n\n    return ControlElement;\n  }(cf.BasicElement);\n\n  cf.ControlElement = ControlElement;\n})(cf || (cf = {})); /// <reference path=\"Button.ts\"/>\n/// <reference path=\"ControlElement.ts\"/>\n/// <reference path=\"RadioButton.ts\"/>\n/// <reference path=\"CheckboxButton.ts\"/>\n/// <reference path=\"OptionsList.ts\"/>\n/// <reference path=\"UploadFileUI.ts\"/>\n/// <reference path=\"../../logic/EventDispatcher.ts\"/>\n/// <reference path=\"../ScrollController.ts\"/>\n/// <reference path=\"../chat/ChatResponse.ts\"/>\n/// <reference path=\"../../../typings/globals/es6-promise/index.d.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  cf.ControlElementsEvents = {\n    ON_RESIZE: \"cf-on-control-elements-resize\",\n    CHANGED: \"cf-on-control-elements-changed\"\n  };\n\n  var ControlElements =\n  /** @class */\n  function () {\n    function ControlElements(options) {\n      this.ignoreKeyboardInput = false;\n      this.rowIndex = -1;\n      this.columnIndex = 0;\n      this.elementWidth = 0;\n      this.filterListNumberOfVisible = 0;\n      this.listWidth = 0;\n      this.el = options.el;\n      this.eventTarget = options.eventTarget;\n      this.cfReference = options.cfReference;\n      this.list = this.el.getElementsByTagName(\"cf-list\")[0];\n      this.infoElement = options.infoEl;\n      this.onScrollCallback = this.onScroll.bind(this);\n      this.el.addEventListener('scroll', this.onScrollCallback, false);\n      this.onResizeCallback = this.onResize.bind(this);\n      window.addEventListener('resize', this.onResizeCallback, false);\n      this.onElementFocusCallback = this.onElementFocus.bind(this);\n      this.eventTarget.addEventListener(cf.ControlElementEvents.ON_FOCUS, this.onElementFocusCallback, false);\n      this.onElementLoadedCallback = this.onElementLoaded.bind(this);\n      this.eventTarget.addEventListener(cf.ControlElementEvents.ON_LOADED, this.onElementLoadedCallback, false);\n      this.onChatReponsesUpdatedCallback = this.onChatReponsesUpdated.bind(this);\n      this.eventTarget.addEventListener(cf.ChatListEvents.CHATLIST_UPDATED, this.onChatReponsesUpdatedCallback, false);\n      this.onUserInputKeyChangeCallback = this.onUserInputKeyChange.bind(this);\n      this.eventTarget.addEventListener(cf.UserInputEvents.KEY_CHANGE, this.onUserInputKeyChangeCallback, false); // user input update\n\n      this.userInputUpdateCallback = this.onUserInputUpdate.bind(this);\n      this.eventTarget.addEventListener(cf.FlowEvents.USER_INPUT_UPDATE, this.userInputUpdateCallback, false);\n      this.listScrollController = new cf.ScrollController({\n        interactionListener: this.el,\n        listToScroll: this.list,\n        eventTarget: this.eventTarget,\n        listNavButtons: this.el.getElementsByTagName(\"cf-list-button\")\n      });\n    }\n\n    Object.defineProperty(ControlElements.prototype, \"active\", {\n      get: function get() {\n        return this.elements && this.elements.length > 0;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElements.prototype, \"focus\", {\n      get: function get() {\n        if (!this.elements) return false;\n        var elements = this.getElements();\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element.focus) {\n            return true;\n          }\n        }\n\n        return false;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElements.prototype, \"highlighted\", {\n      get: function get() {\n        if (!this.elements) return false;\n        var elements = this.getElements();\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element.highlight) {\n            return true;\n          }\n        }\n\n        return false;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElements.prototype, \"disabled\", {\n      set: function set(value) {\n        if (value) this.list.classList.add(\"disabled\");else this.list.classList.remove(\"disabled\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ControlElements.prototype, \"length\", {\n      get: function get() {\n        var elements = this.getElements();\n        return elements.length;\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    ControlElements.prototype.onScroll = function (event) {\n      // some times the tabbing will result in el scroll, reset this.\n      this.el.scrollLeft = 0;\n    };\n    /**\n    * @name onElementLoaded\n    * when element is loaded, usally image loaded.\n    */\n\n\n    ControlElements.prototype.onElementLoaded = function (event) {\n      this.onResize(null);\n    };\n\n    ControlElements.prototype.onElementFocus = function (event) {\n      var vector = event.detail;\n      var x = vector.x + vector.width < this.elementWidth ? 0 : vector.x - vector.width;\n      x *= -1;\n      this.updateRowColIndexFromVector(vector);\n      this.listScrollController.setScroll(x, 0);\n    };\n\n    ControlElements.prototype.updateRowColIndexFromVector = function (vector) {\n      for (var i = 0; i < this.tableableRows.length; i++) {\n        var items = this.tableableRows[i];\n\n        for (var j = 0; j < items.length; j++) {\n          var item = items[j];\n\n          if (item == vector.el) {\n            this.rowIndex = i;\n            this.columnIndex = j;\n            break;\n          }\n        }\n      }\n    };\n\n    ControlElements.prototype.onChatReponsesUpdated = function (event) {\n      var _this = this;\n\n      clearTimeout(this.animateInFromResponseTimer); // only show when user response\n\n      if (!event.detail.currentResponse.isRobotResponse) {\n        this.animateInFromResponseTimer = setTimeout(function () {\n          _this.animateElementsIn();\n        }, this.cfReference.uiOptions.controlElementsInAnimationDelay);\n      }\n    };\n\n    ControlElements.prototype.onListChanged = function () {\n      var _this = this; // reflow\n\n\n      this.list.offsetHeight;\n      requestAnimationFrame(function () {\n        cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.ControlElementsEvents.CHANGED);\n\n        _this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementsEvents.CHANGED));\n      });\n    };\n\n    ControlElements.prototype.onUserInputKeyChange = function (event) {\n      if (this.ignoreKeyboardInput) {\n        this.ignoreKeyboardInput = false;\n        return;\n      }\n\n      var dto = event.detail;\n      var userInput = dto.dto.input;\n\n      if (this.active) {\n        var isNavKey = [cf.Dictionary.keyCodes[\"left\"], cf.Dictionary.keyCodes[\"right\"], cf.Dictionary.keyCodes[\"down\"], cf.Dictionary.keyCodes[\"up\"]].indexOf(dto.keyCode) != -1;\n        var shouldFilter = dto.inputFieldActive && !isNavKey;\n\n        if (shouldFilter) {\n          // input field is active, so we should filter..\n          var dto_1 = event.detail.dto;\n          var inputValue = dto_1.input.getInputValue();\n          this.filterElementsFrom(inputValue);\n        } else {\n          if (dto.keyCode == cf.Dictionary.keyCodes[\"left\"]) {\n            this.columnIndex--;\n          } else if (dto.keyCode == cf.Dictionary.keyCodes[\"right\"]) {\n            this.columnIndex++;\n          } else if (dto.keyCode == cf.Dictionary.keyCodes[\"down\"]) {\n            this.updateRowIndex(1);\n          } else if (dto.keyCode == cf.Dictionary.keyCodes[\"up\"]) {\n            this.updateRowIndex(-1);\n          } else if (dto.keyCode == cf.Dictionary.keyCodes[\"enter\"] || dto.keyCode == cf.Dictionary.keyCodes[\"space\"]) {\n            if (this.tableableRows[this.rowIndex] && this.tableableRows[this.rowIndex][this.columnIndex]) {\n              this.tableableRows[this.rowIndex][this.columnIndex].el.click();\n            } else if (this.tableableRows[0] && this.tableableRows[0].length == 1) {\n              // this is when only one element in a filter, then we click it!\n              this.tableableRows[0][0].el.click();\n            }\n          }\n\n          if (!this.validateRowColIndexes()) {\n            userInput.setFocusOnInput();\n          }\n        }\n      }\n\n      if (!userInput.active && this.validateRowColIndexes() && this.tableableRows && (this.rowIndex == 0 || this.rowIndex == 1)) {\n        this.tableableRows[this.rowIndex][this.columnIndex].focus = true;\n      } else if (!userInput.active) {\n        userInput.setFocusOnInput();\n      }\n    };\n\n    ControlElements.prototype.validateRowColIndexes = function () {\n      var maxRowIndex = this.el.classList.contains(\"two-row\") ? 1 : 0;\n\n      if (this.rowIndex != -1 && this.tableableRows[this.rowIndex]) {\n        // columnIndex is only valid if rowIndex is valid\n        if (this.columnIndex < 0) {\n          this.columnIndex = this.tableableRows[this.rowIndex].length - 1;\n        }\n\n        if (this.columnIndex > this.tableableRows[this.rowIndex].length - 1) {\n          this.columnIndex = 0;\n        }\n\n        return true;\n      } else {\n        this.resetTabList();\n        return false;\n      }\n    };\n\n    ControlElements.prototype.updateRowIndex = function (direction) {\n      var oldRowIndex = this.rowIndex;\n      this.rowIndex += direction;\n\n      if (this.tableableRows[this.rowIndex]) {\n        // when row index is changed we need to find the closest column element, we cannot expect them to be indexly aligned\n        var centerX = this.tableableRows[oldRowIndex] ? this.tableableRows[oldRowIndex][this.columnIndex].positionVector.centerX : 0;\n        var items = this.tableableRows[this.rowIndex];\n        var currentDistance = 10000000000000;\n\n        for (var i = 0; i < items.length; i++) {\n          var element = items[i];\n\n          if (currentDistance > Math.abs(centerX - element.positionVector.centerX)) {\n            currentDistance = Math.abs(centerX - element.positionVector.centerX);\n            this.columnIndex = i;\n          }\n        }\n      }\n    };\n\n    ControlElements.prototype.resetTabList = function () {\n      this.rowIndex = -1;\n      this.columnIndex = -1;\n    };\n\n    ControlElements.prototype.onUserInputUpdate = function (event) {\n      this.el.classList.remove(\"animate-in\");\n      this.infoElement.classList.remove(\"show\");\n\n      if (this.elements) {\n        var elements = this.getElements();\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n          element.animateOut();\n        }\n      }\n    };\n\n    ControlElements.prototype.filterElementsFrom = function (value) {\n      var inputValuesLowerCase = value.toLowerCase().split(\" \");\n      if (inputValuesLowerCase.indexOf(\"\") != -1) inputValuesLowerCase.splice(inputValuesLowerCase.indexOf(\"\"), 1);\n      var elements = this.getElements();\n\n      if (elements.length > 1) {\n        // the type is not strong with this one..\n        var itemsVisible = [];\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n          element.highlight = false;\n          var elementVisibility = true; // check for all words of input\n\n          for (var i_1 = 0; i_1 < inputValuesLowerCase.length; i_1++) {\n            var inputWord = inputValuesLowerCase[i_1];\n\n            if (elementVisibility) {\n              elementVisibility = element.value.toLowerCase().indexOf(inputWord) != -1;\n            }\n          } // set element visibility.\n\n\n          element.visible = elementVisibility;\n          if (elementVisibility && element.visible) itemsVisible.push(element);\n        } // set feedback text for filter..\n\n\n        this.infoElement.innerHTML = itemsVisible.length == 0 ? cf.Dictionary.get(\"input-no-filter\").split(\"{input-value}\").join(value) : \"\";\n\n        if (itemsVisible.length == 0) {\n          this.infoElement.classList.add(\"show\");\n        } else {\n          this.infoElement.classList.remove(\"show\");\n        } // crude way of checking if list has changed...\n\n\n        var hasListChanged = this.filterListNumberOfVisible != itemsVisible.length;\n\n        if (hasListChanged) {\n          this.animateElementsIn();\n        }\n\n        this.filterListNumberOfVisible = itemsVisible.length; // highlight first item\n\n        if (value != \"\" && this.filterListNumberOfVisible > 0) itemsVisible[0].highlight = true;\n      }\n    };\n\n    ControlElements.prototype.clickOnHighlighted = function () {\n      var elements = this.getElements();\n\n      for (var i = 0; i < elements.length; i++) {\n        var element = elements[i];\n\n        if (element.highlight) {\n          element.el.click();\n          break;\n        }\n      }\n    };\n\n    ControlElements.prototype.animateElementsIn = function () {\n      var _this = this;\n\n      if (this.elements.length > 0) {\n        this.resize(); // this.el.style.transition = 'height 0.35s ease-out 0.2s';\n\n        this.list.style.height = '0px';\n        setTimeout(function () {\n          _this.list.style.height = _this.list.scrollHeight + 'px';\n\n          var elements = _this.getElements();\n\n          setTimeout(function () {\n            if (elements.length > 0) {\n              if (!_this.el.classList.contains(\"animate-in\")) _this.el.classList.add(\"animate-in\");\n\n              for (var i = 0; i < elements.length; i++) {\n                var element = elements[i];\n                element.animateIn();\n              }\n            }\n\n            document.querySelector('.scrollableInner').classList.remove('scroll'); // Check if chatlist is scrolled to the bottom - if not we need to do it manually (pertains to Chrome)\n\n            var scrollContainer = document.querySelector('scrollable');\n\n            if (scrollContainer.scrollTop < scrollContainer.scrollHeight) {\n              scrollContainer.scrollTop = scrollContainer.scrollHeight;\n            }\n          }, 300);\n        }, 200);\n      }\n    };\n\n    ControlElements.prototype.getElements = function () {\n      if (this.elements && this.elements.length > 0 && this.elements[0].type == \"OptionsList\") return this.elements[0].elements;\n      return this.elements;\n    };\n    /**\n    * @name buildTabableRows\n    * build the tabable array index\n    */\n\n\n    ControlElements.prototype.buildTabableRows = function () {\n      this.tableableRows = [];\n      this.resetTabList();\n      var elements = this.getElements();\n\n      if (this.el.classList.contains(\"two-row\")) {\n        // two rows\n        this.tableableRows[0] = [];\n        this.tableableRows[1] = [];\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element.visible) {\n            // crude way of checking if element is top row or bottom row..\n            if (element.positionVector.y < 30) this.tableableRows[0].push(element);else this.tableableRows[1].push(element);\n          }\n        }\n      } else {\n        // single row\n        this.tableableRows[0] = [];\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n          if (element.visible) this.tableableRows[0].push(element);\n        }\n      }\n    };\n\n    ControlElements.prototype.resetAfterErrorMessage = function () {\n      this.currentControlElement = null;\n      this.disabled = false;\n    };\n\n    ControlElements.prototype.focusFrom = function (angle) {\n      if (!this.tableableRows) return;\n      this.columnIndex = 0;\n\n      if (angle == \"bottom\") {\n        this.rowIndex = this.el.classList.contains(\"two-row\") ? 1 : 0;\n      } else if (angle == \"top\") {\n        this.rowIndex = 0;\n      }\n\n      if (this.tableableRows[this.rowIndex] && this.tableableRows[this.rowIndex][this.columnIndex]) {\n        this.ignoreKeyboardInput = true;\n\n        if (!this.cfReference.options.preventAutoFocus) {\n          this.tableableRows[this.rowIndex][this.columnIndex].focus = true;\n        }\n      } else {\n        this.resetTabList();\n      }\n    };\n\n    ControlElements.prototype.updateStateOnElementsFromTag = function (tag) {\n      for (var index = 0; index < this.elements.length; index++) {\n        var element = this.elements[index];\n\n        if (element.referenceTag == tag) {\n          this.updateStateOnElements(element);\n          break;\n        }\n      }\n    };\n\n    ControlElements.prototype.updateStateOnElements = function (controlElement) {\n      this.currentControlElement = controlElement;\n\n      if (this.currentControlElement.type == \"RadioButton\") {\n        // uncheck other radio buttons...\n        var elements = this.getElements();\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element != controlElement) {\n            element.checked = false;\n          } else {\n            element.checked = true;\n          }\n        }\n      } else if (this.currentControlElement.type == \"CheckboxButton\") {\n        // change only the changed input\n        var elements = this.getElements();\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element == controlElement) {\n            var isChecked = element.referenceTag.domElement.checked;\n            element.checked = isChecked;\n          }\n        }\n      }\n    };\n\n    ControlElements.prototype.reset = function () {\n      this.infoElement.classList.remove(\"show\");\n      this.el.classList.remove(\"one-row\");\n      this.el.classList.remove(\"two-row\"); // this.el.style.transition = 'height 0.35s ease-out 0.2s';\n\n      this.list.style.height = '0px';\n    };\n\n    ControlElements.prototype.getElement = function (index) {\n      return this.elements[index];\n    };\n\n    ControlElements.prototype.getDTO = function () {\n      var dto = {\n        text: undefined,\n        controlElements: []\n      }; // generate text value for ChatReponse\n\n      if (this.elements && this.elements.length > 0) {\n        switch (this.elements[0].type) {\n          case \"CheckboxButton\":\n            var numChecked = 0; // check if more than 1 is checked.\n\n            var values = [];\n\n            for (var i = 0; i < this.elements.length; i++) {\n              var element_1 = this.elements[i];\n\n              if (element_1.checked) {\n                if (numChecked++ > 1) break;\n              }\n            }\n\n            for (var i = 0; i < this.elements.length; i++) {\n              var element_2 = this.elements[i];\n\n              if (element_2.checked) {\n                if (numChecked > 1) element_2.partOfSeveralChoices = true;\n                values.push(element_2.value);\n              }\n\n              dto.controlElements.push(element_2);\n            }\n\n            dto.text = cf.Dictionary.parseAndGetMultiValueString(values);\n            break;\n\n          case \"RadioButton\":\n            for (var i = 0; i < this.elements.length; i++) {\n              var element_3 = this.elements[i];\n\n              if (element_3.checked) {\n                dto.text = element_3.value;\n              }\n\n              dto.controlElements.push(element_3);\n            }\n\n            break;\n\n          case \"OptionsList\":\n            var element = this.elements[0];\n            dto.controlElements = element.getValue();\n            var values = [];\n\n            if (dto.controlElements && dto.controlElements[0]) {\n              for (var i_2 = 0; i_2 < dto.controlElements.length; i_2++) {\n                var element_4 = dto.controlElements[i_2];\n                values.push(dto.controlElements[i_2].value);\n              }\n            } // after value is created then set to all elements\n\n\n            dto.controlElements = element.elements;\n            dto.text = cf.Dictionary.parseAndGetMultiValueString(values);\n            break;\n\n          case \"UploadFileUI\":\n            dto.text = this.elements[0].getFilesAsString(); //Dictionary.parseAndGetMultiValueString(values);\n\n            dto.controlElements.push(this.elements[0]);\n            break;\n        }\n      }\n\n      return dto;\n    };\n\n    ControlElements.prototype.clearTagsAndReset = function () {\n      this.reset();\n\n      if (this.elements) {\n        while (this.elements.length > 0) {\n          this.elements.pop().dealloc();\n        }\n      }\n\n      this.list.innerHTML = \"\";\n      this.onListChanged();\n    };\n\n    ControlElements.prototype.buildTags = function (tags) {\n      var _this = this;\n\n      this.disabled = false;\n      var topList = this.el.parentNode.getElementsByTagName(\"ul\")[0];\n      var bottomList = this.el.parentNode.getElementsByTagName(\"ul\")[1]; // remove old elements\n\n      this.clearTagsAndReset();\n      this.elements = [];\n\n      for (var i = 0; i < tags.length; i++) {\n        var tag = tags[i];\n\n        switch (tag.type) {\n          case \"radio\":\n            this.elements.push(new cf.RadioButton({\n              referenceTag: tag,\n              eventTarget: this.eventTarget\n            }));\n            break;\n\n          case \"checkbox\":\n            this.elements.push(new cf.CheckboxButton({\n              referenceTag: tag,\n              eventTarget: this.eventTarget\n            }));\n            break;\n\n          case \"select\":\n            this.elements.push(new cf.OptionsList({\n              referenceTag: tag,\n              context: this.list,\n              eventTarget: this.eventTarget\n            }));\n            break;\n\n          case \"input\":\n          default:\n            if (tag.type == \"file\") {\n              this.elements.push(new cf.UploadFileUI({\n                referenceTag: tag,\n                eventTarget: this.eventTarget\n              }));\n            } // nothing to add.\n\n\n            break;\n        }\n\n        if (tag.type != \"select\" && this.elements.length > 0) {\n          var element = this.elements[this.elements.length - 1];\n          this.list.appendChild(element.el);\n        }\n      }\n\n      var isElementsOptionsList = this.elements[0] && this.elements[0].type == \"OptionsList\";\n\n      if (isElementsOptionsList) {\n        this.filterListNumberOfVisible = this.elements[0].elements.length;\n      } else {\n        this.filterListNumberOfVisible = tags.length;\n      }\n\n      new Promise(function (resolve, reject) {\n        return _this.resize(resolve, reject);\n      }).then(function () {\n        var h = _this.list.offsetHeight; //this.el.classList.contains(\"one-row\") ? 52 : this.el.classList.contains(\"two-row\") ? 102 : 0;\n\n        var controlElementsAddedDTO = {\n          height: h\n        };\n\n        _this.onListChanged();\n\n        cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.UserInputEvents.CONTROL_ELEMENTS_ADDED, controlElementsAddedDTO);\n\n        _this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.CONTROL_ELEMENTS_ADDED, {\n          detail: controlElementsAddedDTO\n        }));\n      });\n    };\n\n    ControlElements.prototype.onResize = function (event) {\n      this.resize();\n    };\n\n    ControlElements.prototype.resize = function (resolve, reject) {\n      // scrollbar things\n      // Element.offsetWidth - Element.clientWidth\n      this.list.style.width = \"100%\";\n      this.el.classList.remove(\"resized\");\n      this.el.classList.remove(\"one-row\");\n      this.el.classList.remove(\"two-row\");\n      this.elementWidth = 0;\n      this.listWidth = 0;\n      var elements = this.getElements();\n\n      if (elements && elements.length > 0) {\n        var listWidthValues = [];\n        var listWidthValues2 = [];\n        var containsElementWithImage = false;\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element.visible) {\n            element.calcPosition();\n            this.listWidth += element.positionVector.width;\n            listWidthValues.push(element.positionVector.x + element.positionVector.width);\n            listWidthValues2.push(element);\n          }\n\n          if (element.hasImage()) containsElementWithImage = true;\n        }\n\n        var elOffsetWidth = this.el.offsetWidth;\n        var isListWidthOverElementWidth = this.listWidth > elOffsetWidth;\n\n        if (isListWidthOverElementWidth && !containsElementWithImage) {\n          this.el.classList.add(\"two-row\");\n          this.listWidth = Math.max(elOffsetWidth, Math.round(listWidthValues[Math.floor(listWidthValues.length / 2)] + 50));\n          this.list.style.width = this.listWidth + \"px\";\n        } else {\n          this.el.classList.add(\"one-row\");\n        } // recalc after LIST classes has been added\n\n\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i];\n\n          if (element.visible) {\n            element.calcPosition();\n          }\n        } // check again after classes are set.\n\n\n        elOffsetWidth = this.el.offsetWidth;\n        isListWidthOverElementWidth = this.listWidth > elOffsetWidth; // sort the list so we can set tabIndex properly\n\n        var elementsCopyForSorting = elements.slice();\n        var tabIndexFilteredElements = elementsCopyForSorting.sort(function (a, b) {\n          var aOverB = a.positionVector.y > b.positionVector.y;\n          return a.positionVector.x == b.positionVector.x ? aOverB ? 1 : -1 : a.positionVector.x < b.positionVector.x ? -1 : 1;\n        });\n        var tabIndex = 0;\n\n        for (var i = 0; i < tabIndexFilteredElements.length; i++) {\n          var element = tabIndexFilteredElements[i];\n\n          if (element.visible) {\n            //tabindex 1 are the UserTextInput element\n            element.tabIndex = 2 + tabIndex++;\n          } else {\n            element.tabIndex = -1;\n          }\n        } // toggle nav button visiblity\n\n\n        if (isListWidthOverElementWidth) {\n          this.el.classList.remove(\"hide-nav-buttons\");\n        } else {\n          this.el.classList.add(\"hide-nav-buttons\");\n        }\n\n        this.elementWidth = elOffsetWidth; // resize scroll\n\n        this.listScrollController.resize(this.listWidth, this.elementWidth);\n        this.el.classList.add(\"resized\");\n        this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementsEvents.ON_RESIZE));\n\n        if (resolve) {\n          // only build when there is something to resolve\n          this.buildTabableRows();\n          resolve();\n        }\n      }\n    };\n\n    ControlElements.prototype.dealloc = function () {\n      this.currentControlElement = null;\n      this.tableableRows = null;\n      window.removeEventListener('resize', this.onResizeCallback, false);\n      this.onResizeCallback = null;\n      this.el.removeEventListener('scroll', this.onScrollCallback, false);\n      this.onScrollCallback = null;\n      this.eventTarget.removeEventListener(cf.ControlElementEvents.ON_FOCUS, this.onElementFocusCallback, false);\n      this.onElementFocusCallback = null;\n      this.eventTarget.removeEventListener(cf.ChatListEvents.CHATLIST_UPDATED, this.onChatReponsesUpdatedCallback, false);\n      this.onChatReponsesUpdatedCallback = null;\n      this.eventTarget.removeEventListener(cf.UserInputEvents.KEY_CHANGE, this.onUserInputKeyChangeCallback, false);\n      this.onUserInputKeyChangeCallback = null;\n      this.eventTarget.removeEventListener(cf.FlowEvents.USER_INPUT_UPDATE, this.userInputUpdateCallback, false);\n      this.userInputUpdateCallback = null;\n      this.eventTarget.removeEventListener(cf.ControlElementEvents.ON_LOADED, this.onElementLoadedCallback, false);\n      this.onElementLoadedCallback = null;\n      this.listScrollController.dealloc();\n    };\n\n    return ControlElements;\n  }();\n\n  cf.ControlElements = ControlElements;\n})(cf || (cf = {})); /// <reference path=\"../logic/Helpers.ts\"/>\n/// <reference path=\"../logic/EventDispatcher.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  var ScrollController =\n  /** @class */\n  function () {\n    function ScrollController(options) {\n      this.listWidth = 0;\n      this.visibleAreaWidth = 0;\n      this.max = 0;\n      this.interacting = false;\n      this.x = 0;\n      this.xTarget = 0;\n      this.startX = 0;\n      this.startXTarget = 0;\n      this.mouseSpeed = 0;\n      this.mouseSpeedTarget = 0;\n      this.direction = 0;\n      this.directionTarget = 0;\n      this.inputAccerlation = 0;\n      this.inputAccerlationTarget = 0;\n      this.interactionListener = options.interactionListener;\n      this.eventTarget = options.eventTarget;\n      this.listToScroll = options.listToScroll;\n      this.prevButton = options.listNavButtons[0];\n      this.nextButton = options.listNavButtons[1];\n      this.onListNavButtonsClickCallback = this.onListNavButtonsClick.bind(this);\n      this.prevButton.addEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n      this.nextButton.addEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n      this.documentLeaveCallback = this.documentLeave.bind(this);\n      this.onInteractStartCallback = this.onInteractStart.bind(this);\n      this.onInteractEndCallback = this.onInteractEnd.bind(this);\n      this.onInteractMoveCallback = this.onInteractMove.bind(this);\n      document.addEventListener(\"mouseleave\", this.documentLeaveCallback, false);\n      document.addEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.documentLeaveCallback, false);\n      this.interactionListener.addEventListener(cf.Helpers.getMouseEvent(\"mousedown\"), this.onInteractStartCallback, false);\n      this.interactionListener.addEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.onInteractEndCallback, false);\n      this.interactionListener.addEventListener(cf.Helpers.getMouseEvent(\"mousemove\"), this.onInteractMoveCallback, false);\n    }\n\n    ScrollController.prototype.onListNavButtonsClick = function (event) {\n      var dirClick = event.currentTarget.getAttribute(\"direction\");\n      this.pushDirection(dirClick == \"next\" ? -1 : 1);\n    };\n\n    ScrollController.prototype.documentLeave = function (event) {\n      this.onInteractEnd(event);\n    };\n\n    ScrollController.prototype.onInteractStart = function (event) {\n      var vector = cf.Helpers.getXYFromMouseTouchEvent(event);\n      this.interacting = true;\n      this.startX = vector.x;\n      this.startXTarget = this.startX;\n      this.inputAccerlation = 0;\n      this.render();\n    };\n\n    ScrollController.prototype.onInteractEnd = function (event) {\n      this.interacting = false;\n    };\n\n    ScrollController.prototype.onInteractMove = function (event) {\n      if (this.interacting) {\n        var vector = cf.Helpers.getXYFromMouseTouchEvent(event);\n        var newAcc = vector.x - this.startX;\n        var magnifier = 6.2;\n        this.inputAccerlationTarget = newAcc * magnifier;\n        this.directionTarget = this.inputAccerlationTarget < 0 ? -1 : 1;\n        this.startXTarget = vector.x;\n      }\n    };\n\n    ScrollController.prototype.render = function () {\n      var _this = this;\n\n      if (this.rAF) cancelAnimationFrame(this.rAF); // normalise startX\n\n      this.startX += (this.startXTarget - this.startX) * 0.2; // animate accerlaration\n\n      this.inputAccerlation += (this.inputAccerlationTarget - this.inputAccerlation) * (this.interacting ? Math.min(ScrollController.acceleration + 0.1, 1) : ScrollController.acceleration);\n      var accDamping = 0.25;\n      this.inputAccerlationTarget *= accDamping; // animate directions\n\n      this.direction += (this.directionTarget - this.direction) * 0.2; // extra extra\n\n      this.mouseSpeed += (this.mouseSpeedTarget - this.mouseSpeed) * 0.2;\n      this.direction += this.mouseSpeed; // animate x\n\n      this.xTarget += this.inputAccerlation * 0.05; // bounce back when over\n\n      if (this.xTarget > 0) this.xTarget += (0 - this.xTarget) * cf.Helpers.lerp(ScrollController.acceleration, 0.3, 0.8);\n      if (this.xTarget < this.max) this.xTarget += (this.max - this.xTarget) * cf.Helpers.lerp(ScrollController.acceleration, 0.3, 0.8);\n      this.x += (this.xTarget - this.x) * 0.4; // toggle visibility on nav arrows\n\n      var xRounded = Math.round(this.x);\n\n      if (xRounded < 0) {\n        if (!this.prevButton.classList.contains(\"active\")) this.prevButton.classList.add(\"active\");\n        if (!this.prevButton.classList.contains(\"cf-gradient\")) this.prevButton.classList.add(\"cf-gradient\");\n      }\n\n      if (xRounded == 0) {\n        if (this.prevButton.classList.contains(\"active\")) this.prevButton.classList.remove(\"active\");\n        if (this.prevButton.classList.contains(\"cf-gradient\")) this.prevButton.classList.remove(\"cf-gradient\");\n      }\n\n      if (xRounded > this.max) {\n        if (!this.nextButton.classList.contains(\"active\")) this.nextButton.classList.add(\"active\");\n        if (!this.nextButton.classList.contains(\"cf-gradient\")) this.nextButton.classList.add(\"cf-gradient\");\n      }\n\n      if (xRounded <= this.max) {\n        if (this.nextButton.classList.contains(\"active\")) this.nextButton.classList.remove(\"active\");\n        if (this.nextButton.classList.contains(\"cf-gradient\")) this.nextButton.classList.remove(\"cf-gradient\");\n      } // set css transforms\n\n\n      var xx = this.x;\n      cf.Helpers.setTransform(this.listToScroll, \"translateX(\" + xx + \"px)\"); // cycle render\n\n      if (this.interacting || Math.abs(this.x - this.xTarget) > 0.02 && !this.interacting) this.rAF = window.requestAnimationFrame(function () {\n        return _this.render();\n      });\n    };\n\n    ScrollController.prototype.setScroll = function (x, y) {\n      this.xTarget = this.visibleAreaWidth == this.listWidth ? 0 : x;\n      this.render();\n    };\n\n    ScrollController.prototype.pushDirection = function (dir) {\n      this.inputAccerlationTarget += 5000 * dir;\n      this.render();\n    };\n\n    ScrollController.prototype.dealloc = function () {\n      this.prevButton.removeEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n      this.nextButton.removeEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n      this.onListNavButtonsClickCallback = null;\n      this.prevButton = null;\n      this.nextButton = null;\n      document.removeEventListener(\"mouseleave\", this.documentLeaveCallback, false);\n      document.removeEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.documentLeaveCallback, false);\n      this.interactionListener.removeEventListener(cf.Helpers.getMouseEvent(\"mousedown\"), this.onInteractStartCallback, false);\n      this.interactionListener.removeEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.onInteractEndCallback, false);\n      this.interactionListener.removeEventListener(cf.Helpers.getMouseEvent(\"mousemove\"), this.onInteractMoveCallback, false);\n      this.documentLeaveCallback = null;\n      this.onInteractStartCallback = null;\n      this.onInteractEndCallback = null;\n      this.onInteractMoveCallback = null;\n    };\n\n    ScrollController.prototype.reset = function () {\n      this.interacting = false;\n      this.startX = 0;\n      this.startXTarget = this.startX;\n      this.inputAccerlation = 0;\n      this.x = 0;\n      this.xTarget = 0;\n      cf.Helpers.setTransform(this.listToScroll, \"translateX(0px)\");\n      this.render();\n      this.prevButton.classList.remove(\"active\");\n      this.nextButton.classList.remove(\"active\");\n    };\n\n    ScrollController.prototype.resize = function (listWidth, visibleAreaWidth) {\n      this.reset();\n      this.visibleAreaWidth = visibleAreaWidth;\n      this.listWidth = Math.max(visibleAreaWidth, listWidth);\n      this.max = (this.listWidth - this.visibleAreaWidth) * -1;\n      this.render();\n    };\n\n    ScrollController.acceleration = 0.1;\n    return ScrollController;\n  }();\n\n  cf.ScrollController = ScrollController;\n})(cf || (cf = {})); /// <reference path=\"../logic/FlowManager.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var ProgressBar =\n  /** @class */\n  function () {\n    function ProgressBar(options) {\n      var _this = this;\n\n      this.flowUpdateCallback = this.onFlowUpdate.bind(this);\n      this.eventTarget = options.eventTarget;\n      this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n      this.eventTarget.addEventListener(cf.FlowEvents.FORM_SUBMIT, function () {\n        return _this.setWidth(100);\n      }, false);\n      this.el = document.createElement(\"div\");\n      this.el.className = \"cf-progressBar\";\n      this.bar = document.createElement(\"div\");\n      this.bar.className = 'bar';\n      this.el.appendChild(this.bar);\n      setTimeout(function () {\n        return _this.init();\n      }, 800);\n    }\n\n    ProgressBar.prototype.init = function () {\n      this.el.classList.add('show');\n    };\n\n    ProgressBar.prototype.onFlowUpdate = function (event) {\n      this.setWidth(event.detail.step / event.detail.maxSteps * 100);\n    };\n\n    ProgressBar.prototype.setWidth = function (percentage) {\n      this.bar.style.width = percentage + \"%\";\n    };\n\n    ProgressBar.prototype.dealloc = function () {\n      this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n      this.flowUpdateCallback = null;\n    };\n\n    return ProgressBar;\n  }();\n\n  cf.ProgressBar = ProgressBar;\n})(cf || (cf = {})); /// <reference path=\"../logic/Helpers.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // class\n  var Dictionary =\n  /** @class */\n  function () {\n    function Dictionary(options) {\n      // can be overwrittenMicrophone error\n      this.data = {\n        \"user-image\": 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iMTAwIiBmaWxsPSIjMzAzMDMwIi8+CjxwYXRoIGQ9Ik0xMDAgNTVMMTM4Ljk3MSAxMjIuNUg2MS4wMjg5TDEwMCA1NVoiIGZpbGw9IiNFNUU2RUEiLz4KPC9zdmc+Cg==',\n        \"entry-not-found\": \"Dictionary item not found.\",\n        \"awaiting-mic-permission\": \"Awaiting mic permission\",\n        \"user-audio-reponse-invalid\": \"I didn't get that, try again.\",\n        \"microphone-terminal-error\": \"Audio input not supported\",\n        \"input-placeholder\": \"Type your answer here ...\",\n        \"group-placeholder\": \"Type to filter ...\",\n        \"input-placeholder-error\": \"Your input is not correct ...\",\n        \"input-placeholder-required\": \"Input is required ...\",\n        \"input-placeholder-file-error\": \"File upload failed ...\",\n        \"input-placeholder-file-size-error\": \"File size too big ...\",\n        \"input-no-filter\": \"No results found for {input-value}\",\n        \"user-reponse-and\": \" and \",\n        \"user-reponse-missing\": \"Missing input ...\",\n        \"user-reponse-missing-group\": \"Nothing selected ...\",\n        \"general\": \"General type1||General type2\",\n        \"icon-type-file\": \"<svg class='cf-icon-file' viewBox='0 0 10 14' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'><g transform='translate(-756.000000, -549.000000)' fill='#0D83FF'><g transform='translate(736.000000, 127.000000)'><g transform='translate(0.000000, 406.000000)'><polygon points='20 16 26.0030799 16 30 19.99994 30 30 20 30'></polygon></g></g></g></g></svg>\"\n      }; // can be overwriten\n\n      this.robotData = {\n        \"robot-image\": 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iMTAwIiBmaWxsPSIjRTVFNkVBIi8+CjxyZWN0IHg9IjY2IiB5PSI2NiIgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiBmaWxsPSIjMzAzMDMwIi8+Cjwvc3ZnPgo=',\n        \"input\": \"Please write some text.\",\n        \"text\": \"Please write some text.\",\n        \"textarea\": \"Please write some text.\",\n        \"checkbox\": \"Select as many as you want.\",\n        \"name\": \"What's your name?\",\n        \"email\": \"Need your e-mail.\",\n        \"password\": \"Please provide password\",\n        \"tel\": \"What's your phone number?\",\n        \"radio\": \"I need you to select one of these.\",\n        \"select\": \"Choose any of these options.\",\n        \"file\": \"Select a file to upload.\",\n        \"general\": \"General1||General2||General3..\"\n      };\n      Dictionary.instance = this;\n      this.version = options.version; // overwrite data if defined \n\n      if (options && options.data) this.data = this.validateAndSetNewData(options.data, this.data); // overwrite user image\n\n      if (options.userImage) {\n        this.data[\"user-image\"] = options.userImage;\n      } else {\n        this.data['user-image'] = this.data['user-image'];\n      } // overwrite robot image\n\n\n      if (options.robotImage) {\n        this.robotData[\"robot-image\"] = options.robotImage;\n      } else {\n        this.robotData['robot-image'] = this.robotData['robot-image'];\n      } // overwrite robot questions if defined\n\n\n      if (options && options.robotData) this.robotData = this.validateAndSetNewData(options.robotData, this.robotData);\n    }\n\n    Dictionary.get = function (id) {\n      var ins = Dictionary.instance;\n      var value = ins.data[id];\n\n      if (!value) {\n        value = ins.data[\"entry-not-found\"];\n      } else {\n        var values = cf.Helpers.getValuesOfBars(value);\n        value = values[Math.floor(Math.random() * values.length)];\n      }\n\n      return value;\n    };\n    /**\n    * @name set\n    * set a dictionary value\n    *\tid: string, id of the value to update\n    *\ttype: string, \"human\" || \"robot\"\n    *\tvalue: string, value to be inserted\n    */\n\n\n    Dictionary.set = function (id, type, value) {\n      var ins = Dictionary.instance;\n      var obj = type == \"robot\" ? ins.robotData : ins.data;\n      obj[id] = value;\n      return obj[id];\n    };\n\n    Dictionary.getRobotResponse = function (tagType) {\n      var ins = Dictionary.instance;\n      var value = ins.robotData[tagType];\n\n      if (!value) {\n        // value not found, so pick a general one\n        var generals = cf.Helpers.getValuesOfBars(ins.robotData[\"general\"]);\n        value = generals[Math.floor(Math.random() * generals.length)];\n      } else {\n        var values = cf.Helpers.getValuesOfBars(value);\n        value = values[Math.floor(Math.random() * values.length)];\n      }\n\n      return value;\n    };\n\n    Dictionary.parseAndGetMultiValueString = function (arr) {\n      // check ControlElement.ts for value(s)\n      var value = \"\";\n\n      for (var i = 0; i < arr.length; i++) {\n        var str = arr[i];\n        var sym = arr.length > 1 && i == arr.length - 2 ? Dictionary.get(\"user-reponse-and\") : \", \";\n        value += str + (i < arr.length - 1 ? sym : \"\");\n      }\n\n      return value;\n    };\n\n    Dictionary.prototype.validateAndSetNewData = function (newData, originalDataObject) {\n      for (var key in originalDataObject) {\n        if (!newData[key]) {\n          console.warn(\"Conversational Form Dictionary warning, '\" + key + \"' value is undefined, mapping '\" + key + \"' to default value. See Dictionary.ts for keys.\");\n          newData[key] = originalDataObject[key];\n        }\n      }\n\n      return newData;\n    };\n\n    Dictionary.keyCodes = {\n      \"left\": 37,\n      \"right\": 39,\n      \"down\": 40,\n      \"up\": 38,\n      \"backspace\": 8,\n      \"enter\": 13,\n      \"space\": 32,\n      \"shift\": 16,\n      \"tab\": 9\n    };\n    return Dictionary;\n  }();\n\n  cf.Dictionary = Dictionary;\n})(cf || (cf = {})); /// <reference path=\"../data/Dictionary.ts\"/>\n/// <reference path=\"InputTag.ts\"/>\n/// <reference path=\"ButtonTag.ts\"/>\n/// <reference path=\"SelectTag.ts\"/>\n/// <reference path=\"OptionTag.ts\"/>\n/// <reference path=\"CfRobotMessageTag.ts\"/>\n/// <reference path=\"../ConversationalForm.ts\"/>\n/// <reference path=\"../logic/EventDispatcher.ts\"/>\n/// <reference path=\"../parsing/TagsParser.ts\"/>\n// basic tag from form logic\n// types:\n// radio\n// text\n// email\n// tel\n// password\n// checkbox\n// radio\n// select\n// button\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  cf.TagEvents = {\n    ORIGINAL_ELEMENT_CHANGED: \"cf-tag-dom-element-changed\"\n  }; // class\n\n  var Tag =\n  /** @class */\n  function () {\n    function Tag(options) {\n      this.domElement = options.domElement;\n      this.initialDefaultValue = this.domElement.value || this.domElement.getAttribute(\"value\") || \"\";\n      this.changeCallback = this.onDomElementChange.bind(this);\n      this.domElement.addEventListener(\"change\", this.changeCallback, false); // remove tabIndex from the dom element.. danger zone... should we or should we not...\n\n      this.domElement.tabIndex = -1;\n      this.skipUserInput = false; // questions array\n\n      if (options.questions) this.questions = options.questions; // custom tag validation - must be a method on window to avoid unsafe eval() calls\n\n      if (this.domElement.getAttribute(\"cf-validation\")) {\n        var fn = window[this.domElement.getAttribute(\"cf-validation\")];\n        this.validationCallback = fn;\n      } // reg ex pattern is set on the Tag, so use it in our validation\n\n\n      if (this.domElement.getAttribute(\"pattern\")) this.pattern = new RegExp(this.domElement.getAttribute(\"pattern\"));\n\n      if (this.type != \"group\" && cf.ConversationalForm.illustrateAppFlow) {\n        if (!cf.ConversationalForm.suppressLog) console.log('Conversational Form > Tag registered:', this.type, this);\n      }\n\n      this.refresh();\n    }\n\n    Object.defineProperty(Tag.prototype, \"type\", {\n      get: function get() {\n        return this.domElement.getAttribute(\"type\") || this.domElement.tagName.toLowerCase();\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"name\", {\n      get: function get() {\n        return this.domElement.getAttribute(\"name\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"id\", {\n      get: function get() {\n        return this.domElement.getAttribute(\"id\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"inputPlaceholder\", {\n      get: function get() {\n        return this._inputPlaceholder;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"formless\", {\n      get: function get() {\n        return cf.TagsParser.isElementFormless(this.domElement);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"label\", {\n      get: function get() {\n        return this.getLabel();\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"value\", {\n      get: function get() {\n        return this.domElement.value || this.initialDefaultValue;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"hasImage\", {\n      get: function get() {\n        return this.domElement.hasAttribute(\"cf-image\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"rows\", {\n      get: function get() {\n        return this.domElement.hasAttribute(\"rows\") ? parseInt(this.domElement.getAttribute(\"rows\")) : 0;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"disabled\", {\n      get: function get() {\n        // a tag is disabled if its conditions are not meet, also if it contains the disabled attribute\n        return !this.checkConditionalAndIsValid() || this.domElement.getAttribute(\"disabled\") != undefined && this.domElement.getAttribute(\"disabled\") != null;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"required\", {\n      get: function get() {\n        return !!this.domElement.getAttribute(\"required\") || this.domElement.getAttribute(\"required\") == \"\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"question\", {\n      get: function get() {\n        // if questions are empty, then fall back to dictionary, every time\n        if (!this.questions || this.questions.length == 0) return cf.Dictionary.getRobotResponse(this.type);else return this.questions[Math.floor(Math.random() * this.questions.length)];\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"eventTarget\", {\n      set: function set(value) {\n        this._eventTarget = value;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(Tag.prototype, \"errorMessage\", {\n      get: function get() {\n        if (!this.errorMessages) {\n          // custom tag error messages\n          if (this.domElement.getAttribute(\"cf-error\")) {\n            this.errorMessages = cf.Helpers.getValuesOfBars(this.domElement.getAttribute(\"cf-error\"));\n          } else if (this.domElement.parentNode && this.domElement.parentNode.getAttribute(\"cf-error\")) {\n            this.errorMessages = cf.Helpers.getValuesOfBars(this.domElement.parentNode.getAttribute(\"cf-error\"));\n          } else if (this.required) {\n            this.errorMessages = [cf.Dictionary.get(\"input-placeholder-required\")];\n          } else {\n            if (this.type == \"file\") this.errorMessages = [cf.Dictionary.get(\"input-placeholder-file-error\")];else {\n              this.errorMessages = [cf.Dictionary.get(\"input-placeholder-error\")];\n            }\n          }\n        }\n\n        return this.errorMessages[Math.floor(Math.random() * this.errorMessages.length)];\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    Tag.prototype.dealloc = function () {\n      this.domElement.removeEventListener(\"change\", this.changeCallback, false);\n      this.changeCallback = null;\n      this.domElement = null;\n      this.defaultValue = null;\n      this.errorMessages = null;\n      this.pattern = null;\n      this._label = null;\n      this.validationCallback = null;\n      this.questions = null;\n    };\n\n    Tag.testConditions = function (tagValue, condition) {\n      var testValue = function testValue(value, conditional) {\n        if (typeof conditional === \"object\") {\n          // regex\n          return conditional.test(value);\n        } // string comparisson\n\n\n        return tagValue === conditional;\n      };\n\n      if (typeof tagValue === \"string\") {\n        // tag value is a string\n        var value = tagValue;\n        var isValid = false;\n\n        for (var i = 0; i < condition.conditionals.length; i++) {\n          var conditional = condition.conditionals[i];\n          isValid = testValue(value, conditional);\n          if (isValid) break;\n        }\n\n        return isValid;\n      } else {\n        if (!tagValue) {\n          return false;\n        } else {\n          // tag value is an array\n          var isValid = false;\n\n          for (var i = 0; i < condition.conditionals.length; i++) {\n            var conditional = condition.conditionals[i];\n\n            if (typeof tagValue !== \"string\") {\n              for (var j = 0; j < tagValue.length; j++) {\n                isValid = testValue(tagValue[j], conditional);\n                if (isValid) break;\n              }\n            } else {\n              // string comparisson\n              isValid = testValue(tagValue.toString(), conditional);\n            }\n\n            if (isValid) break;\n          }\n\n          return isValid;\n        } // arrays need to be the same\n\n      }\n    };\n\n    Tag.isTagValid = function (element) {\n      if (element.getAttribute(\"type\") === \"hidden\") return false;\n      if (element.getAttribute(\"type\") === \"submit\") return false; // ignore buttons, we submit the form automatially\n\n      if (element.getAttribute(\"type\") == \"button\") return false;\n\n      if (element.style) {\n        // element style can be null if markup is created from DOMParser\n        if (element.style.display === \"none\") return false;\n        if (element.style.visibility === \"hidden\") return false;\n      }\n\n      var isTagFormless = cf.TagsParser.isElementFormless(element);\n      var innerText = cf.Helpers.getInnerTextOfElement(element);\n\n      if (element.tagName.toLowerCase() == \"option\" && (!isTagFormless && innerText == \"\" || innerText == \" \")) {\n        return false;\n      }\n\n      if (element.tagName.toLowerCase() == \"select\" || element.tagName.toLowerCase() == \"option\") return true;else if (isTagFormless) {\n        return true;\n      } else {\n        return !!(element.offsetWidth || element.offsetHeight || element.getClientRects().length);\n      }\n    };\n\n    Tag.createTag = function (element) {\n      if (Tag.isTagValid(element)) {\n        // ignore hidden tags\n        var tag = void 0;\n\n        if (element.tagName.toLowerCase() == \"input\") {\n          tag = new cf.InputTag({\n            domElement: element\n          });\n        } else if (element.tagName.toLowerCase() == \"textarea\") {\n          tag = new cf.InputTag({\n            domElement: element\n          });\n        } else if (element.tagName.toLowerCase() == \"select\") {\n          tag = new cf.SelectTag({\n            domElement: element\n          });\n        } else if (element.tagName.toLowerCase() == \"button\") {\n          tag = new cf.ButtonTag({\n            domElement: element\n          });\n        } else if (element.tagName.toLowerCase() == \"option\") {\n          tag = new cf.OptionTag({\n            domElement: element\n          });\n        } else if (element.tagName.toLowerCase() == \"cf-robot-message\") {\n          tag = new cf.CfRobotMessageTag({\n            domElement: element\n          });\n        }\n\n        return tag;\n      } else {\n        // console.warn(\"Tag is not valid!: \"+ element);\n        return null;\n      }\n    };\n\n    Tag.prototype.reset = function () {\n      this.refresh(); // this.disabled = false;\n      // reset to initial value.\n\n      this.defaultValue = this.domElement.value = this.initialDefaultValue.toString();\n    };\n\n    Tag.prototype.refresh = function () {\n      // default value of Tag, check every refresh\n      this.defaultValue = this.domElement.value || this.domElement.getAttribute(\"value\") || \"\";\n      this.questions = null;\n      this.findAndSetQuestions();\n      this.findConditionalAttributes();\n    };\n\n    Tag.prototype.hasConditionsFor = function (tagName) {\n      if (!this.hasConditions()) {\n        return false;\n      }\n\n      for (var i = 0; i < this.conditionalTags.length; i++) {\n        var condition = this.conditionalTags[i];\n\n        if (\"cf-conditional-\" + tagName.toLowerCase() === condition.key.toLowerCase()) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    Tag.prototype.hasConditions = function () {\n      return this.conditionalTags && this.conditionalTags.length > 0;\n    };\n    /**\n    * @name checkConditionalAndIsValid\n    * checks for conditional logic, see documentaiton (wiki)\n    * here we check after cf-conditional{-name}, if we find an attribute we look through tags for value, and ignore the tag if\n    */\n\n\n    Tag.prototype.checkConditionalAndIsValid = function () {\n      // can we tap into disabled\n      // if contains attribute, cf-conditional{-name} then check for conditional value across tags\n      if (this.hasConditions()) {\n        return this.flowManager.areConditionsInFlowFullfilled(this, this.conditionalTags);\n      } // else return true, as no conditional means uncomplicated and happy tag\n\n\n      return true;\n    };\n\n    Tag.prototype.setTagValueAndIsValid = function (dto) {\n      // this sets the value of the tag in the DOM\n      // validation\n      var isValid = true;\n      var valueText = dto.text;\n\n      if (this.domElement.hasAttribute('type') && this.domElement.getAttribute('type') === 'email' && !this.pattern && valueText.length > 0) {\n        this.pattern = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n      } else if ( // When NOT required: Reset in the event user already typed something, and now they clear their input and want to submit nothing ==> remove pattern previously applied\n      this.domElement.hasAttribute('type') && this.domElement.getAttribute('type') === 'email' && this.pattern && valueText.length === 0 && !this.required) {\n        this.pattern = null;\n      }\n\n      if (this.pattern) {\n        isValid = this.pattern.test(valueText);\n      }\n\n      if (valueText == \"\" && this.required) {\n        isValid = false;\n      } // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-minlength\n\n\n      var min = parseInt(this.domElement.getAttribute(\"minlength\"), 10) || -1; // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-maxlength\n\n      var max = parseInt(this.domElement.getAttribute(\"maxlength\"), 10) || -1;\n\n      if (min != -1 && valueText.length < min) {\n        isValid = false;\n      }\n\n      if (max != -1 && valueText.length > max) {\n        isValid = false;\n      }\n\n      var isMaxMinValueValid = this.validateMaxMinValue(valueText);\n      if (!isMaxMinValueValid) isValid = false;\n\n      if (isValid) {\n        // we cannot set the dom element value when type is file\n        if (this.type != \"file\") this.domElement.value = valueText;\n      }\n\n      return isValid;\n    };\n    /**\n     * Validates value against tag max and min attributes\n     *\n     * @private\n     * @param {string} value\n     * @returns {boolean}\n     * @memberof Tag\n     */\n\n\n    Tag.prototype.validateMaxMinValue = function (value) {\n      if (!value) return true;\n      var parsedValue = parseInt(value, 10);\n      var minValue = parseInt(this.domElement.getAttribute(\"min\"), 10) || -1;\n      var maxValue = parseInt(this.domElement.getAttribute(\"max\"), 10) || -1;\n      if (minValue !== -1 && parsedValue < minValue) return false;\n      if (maxValue !== -1 && parsedValue > maxValue) return false;\n      return true;\n    };\n\n    Tag.prototype.getLabel = function () {\n      if (!this._label) this.findAndSetLabel();\n      if (this._label) return this._label;\n      return cf.Dictionary.getRobotResponse(this.type);\n    };\n    /**\n    * @name findConditionalAttributes\n    * look for conditional attributes and map them\n    */\n\n\n    Tag.prototype.findConditionalAttributes = function () {\n      var keys = this.domElement.attributes;\n\n      if (keys.length > 0) {\n        this.conditionalTags = [];\n\n        for (var key in keys) {\n          if (keys.hasOwnProperty(key)) {\n            var attr = keys[key];\n\n            if (attr && attr.name && attr.name.indexOf(\"cf-conditional\") !== -1) {\n              // conditional found\n              var _conditionals = []; // TODO: when && use to combine multiple values to complete condition.\n\n              var conditionalsFromAttribute = attr.value.indexOf(\"||\") !== -1 ? attr.value.split(\"||\") : attr.value.split(\"&&\");\n\n              for (var i = 0; i < conditionalsFromAttribute.length; i++) {\n                var _conditional = conditionalsFromAttribute[i];\n\n                try {\n                  _conditionals.push(new RegExp(_conditional));\n                } catch (e) {}\n\n                _conditionals.push(_conditional);\n              }\n\n              this.conditionalTags.push({\n                key: attr.name,\n                conditionals: _conditionals\n              });\n            }\n          }\n        }\n      }\n    };\n\n    Tag.prototype.findAndSetQuestions = function () {\n      if (this.questions) return; // <label tag with label:for attribute to el:id\n      // check for label tag, we only go 2 steps backwards..\n      // from standardize markup: http://www.w3schools.com/tags/tag_label.asp\n\n      if (this.domElement.getAttribute(\"cf-questions\")) {\n        this.questions = cf.Helpers.getValuesOfBars(this.domElement.getAttribute(\"cf-questions\"));\n        if (this.domElement.getAttribute(\"cf-input-placeholder\")) this._inputPlaceholder = this.domElement.getAttribute(\"cf-input-placeholder\");\n      } else if (this.domElement.parentNode && this.domElement.parentNode.getAttribute(\"cf-questions\")) {\n        // for groups the parentNode can have the cf-questions..\n        var parent_1 = this.domElement.parentNode;\n        this.questions = cf.Helpers.getValuesOfBars(parent_1.getAttribute(\"cf-questions\"));\n        if (parent_1.getAttribute(\"cf-input-placeholder\")) this._inputPlaceholder = parent_1.getAttribute(\"cf-input-placeholder\");\n      } else {\n        // questions not set, so find it in the DOM\n        // try a broader search using for and id attributes\n        var elId = this.domElement.getAttribute(\"id\");\n        var forLabel = document.querySelector(\"label[for='\" + elId + \"']\");\n\n        if (forLabel) {\n          this.questions = [cf.Helpers.getInnerTextOfElement(forLabel)];\n        }\n      }\n\n      if (!this.questions && this.domElement.getAttribute(\"placeholder\")) {\n        // check for placeholder attr if questions are still undefined\n        this.questions = [this.domElement.getAttribute(\"placeholder\")];\n      }\n    };\n\n    Tag.prototype.findAndSetLabel = function () {\n      // find label..\n      if (this.domElement.getAttribute(\"cf-label\")) {\n        this._label = this.domElement.getAttribute(\"cf-label\");\n      } else {\n        var parentDomNode = this.domElement.parentNode;\n\n        if (parentDomNode) {\n          // step backwards and check for label tag.\n          var labelTags = parentDomNode.tagName.toLowerCase() == \"label\" ? [parentDomNode] : parentDomNode.getElementsByTagName(\"label\");\n\n          if (labelTags.length == 0) {\n            // check for innerText\n            var innerText = cf.Helpers.getInnerTextOfElement(parentDomNode);\n            if (innerText && innerText.length > 0) labelTags = [parentDomNode];\n          } else if (labelTags.length > 0) {\n            // check for \"for\" attribute\n            for (var i = 0; i < labelTags.length; i++) {\n              var label = labelTags[i];\n\n              if (label.getAttribute(\"for\") == this.id) {\n                this._label = cf.Helpers.getInnerTextOfElement(label);\n              }\n            }\n          }\n\n          if (!this._label && labelTags[0]) {\n            this._label = cf.Helpers.getInnerTextOfElement(labelTags[0]);\n          }\n        }\n      }\n    };\n    /**\n    * @name onDomElementChange\n    * on dom element value change event, ex. w. browser autocomplete mode\n    */\n\n\n    Tag.prototype.onDomElementChange = function () {\n      this._eventTarget.dispatchEvent(new CustomEvent(cf.TagEvents.ORIGINAL_ELEMENT_CHANGED, {\n        detail: {\n          value: this.value,\n          tag: this\n        }\n      }));\n    };\n\n    return Tag;\n  }();\n\n  cf.Tag = Tag;\n})(cf || (cf = {})); /// <reference path=\"ButtonTag.ts\"/>\n/// <reference path=\"InputTag.ts\"/>\n/// <reference path=\"SelectTag.ts\"/>\n/// <reference path=\"../ui/inputs/UserTextInput.ts\"/>\n// group tags together, this is done automatically by looking through InputTags with type radio or checkbox and same name attribute.\n// single choice logic for Radio Button, <input type=\"radio\", where name is the same\n// multi choice logic for Checkboxes, <input type=\"checkbox\", where name is the same\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // class\n  var TagGroup =\n  /** @class */\n  function () {\n    function TagGroup(options) {\n      this.elements = options.elements; // set wrapping element\n\n      this._fieldset = options.fieldset;\n\n      if (this._fieldset && this._fieldset.getAttribute(\"cf-questions\")) {\n        this.questions = cf.Helpers.getValuesOfBars(this._fieldset.getAttribute(\"cf-questions\"));\n      }\n\n      if (this._fieldset && this._fieldset.getAttribute(\"cf-input-placeholder\")) {\n        this._inputPlaceholder = this._fieldset.getAttribute(\"cf-input-placeholder\");\n      }\n\n      if (cf.ConversationalForm.illustrateAppFlow) if (!cf.ConversationalForm.suppressLog) console.log('Conversational Form > TagGroup registered:', this.elements[0].type, this);\n      this.skipUserInput = false;\n    }\n\n    Object.defineProperty(TagGroup.prototype, \"required\", {\n      get: function get() {\n        for (var i = 0; i < this.elements.length; i++) {\n          var element = this.elements[i];\n\n          if (this.elements[i].required) {\n            return true;\n          }\n        }\n\n        return false;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"eventTarget\", {\n      set: function set(value) {\n        this._eventTarget = value;\n\n        for (var i = 0; i < this.elements.length; i++) {\n          var tag = this.elements[i];\n          tag.eventTarget = value;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"flowManager\", {\n      set: function set(value) {\n        for (var i = 0; i < this.elements.length; i++) {\n          var tag = this.elements[i];\n          tag.flowManager = value;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"type\", {\n      get: function get() {\n        return \"group\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"label\", {\n      get: function get() {\n        return \"\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"name\", {\n      get: function get() {\n        return this._fieldset && this._fieldset.hasAttribute(\"name\") ? this._fieldset.getAttribute(\"name\") : this.elements[0].name;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"id\", {\n      get: function get() {\n        return this._fieldset && this._fieldset.id ? this._fieldset.id : this.elements[0].id;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"question\", {\n      get: function get() {\n        // check if elements have the questions, else fallback\n        if (this.questions && this.questions.length > 0) {\n          return this.questions[Math.floor(Math.random() * this.questions.length)];\n        } else if (this.elements[0] && this.elements[0].question) {\n          var tagQuestion = this.elements[0].question;\n          return tagQuestion;\n        } else {\n          // fallback to robot response from dictionary\n          var robotReponse = cf.Dictionary.getRobotResponse(this.getGroupTagType());\n          return robotReponse;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"activeElements\", {\n      get: function get() {\n        return this._activeElements;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"value\", {\n      get: function get() {\n        // TODO: fix value???\n        return this._values ? this._values : [\"\"];\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"disabled\", {\n      get: function get() {\n        var disabled = false;\n        var allShouldBedisabled = 0;\n\n        for (var i = 0; i < this.elements.length; i++) {\n          var element = this.elements[i];\n          if (element.disabled) allShouldBedisabled++;\n        }\n\n        return allShouldBedisabled === this.elements.length;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"errorMessage\", {\n      get: function get() {\n        var errorMessage = cf.Dictionary.get(\"input-placeholder-error\");\n\n        for (var i = 0; i < this.elements.length; i++) {\n          var element = this.elements[i];\n          errorMessage = element.errorMessage;\n        }\n\n        return errorMessage;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(TagGroup.prototype, \"inputPlaceholder\", {\n      get: function get() {\n        return this._inputPlaceholder;\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    TagGroup.prototype.dealloc = function () {\n      for (var i = 0; i < this.elements.length; i++) {\n        var element = this.elements[i];\n        element.dealloc();\n      }\n\n      this.elements = null;\n    };\n\n    TagGroup.prototype.refresh = function () {\n      for (var i = 0; i < this.elements.length; i++) {\n        var element = this.elements[i];\n        element.refresh();\n      }\n    };\n\n    TagGroup.prototype.reset = function () {\n      this._values = [];\n\n      for (var i = 0; i < this.elements.length; i++) {\n        var element = this.elements[i];\n        element.reset();\n      }\n    };\n\n    TagGroup.prototype.getGroupTagType = function () {\n      return this.elements[0].type;\n    };\n\n    TagGroup.prototype.hasConditionsFor = function (tagName) {\n      for (var i = 0; i < this.elements.length; i++) {\n        var element = this.elements[i];\n\n        if (element.hasConditionsFor(tagName)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    TagGroup.prototype.hasConditions = function () {\n      for (var i = 0; i < this.elements.length; i++) {\n        var element = this.elements[i];\n\n        if (element.hasConditions()) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n    /**\n    * @name checkConditionalAndIsValid\n    * checks for conditional logic, see documentaiton (wiki)\n    * here we check after cf-conditional{-name} on group tags\n    */\n\n\n    TagGroup.prototype.checkConditionalAndIsValid = function () {\n      // can we tap into disabled\n      // if contains attribute, cf-conditional{-name} then check for conditional value across tags\n      for (var i = 0; i < this.elements.length; i++) {\n        var element = this.elements[i];\n        element.checkConditionalAndIsValid();\n      } // else return true, as no conditional means happy tag\n\n\n      return true;\n    };\n\n    TagGroup.prototype.setTagValueAndIsValid = function (dto) {\n      var isValid = false;\n      var groupType = this.elements[0].type;\n      this._values = [];\n      this._activeElements = [];\n\n      switch (groupType) {\n        case \"radio\":\n          var wasRadioButtonChecked = false;\n          var numberRadioButtonsVisible = [];\n\n          if (dto.controlElements) {\n            // TODO: Refactor this so it is less dependant on controlElements\n            for (var i = 0; i < dto.controlElements.length; i++) {\n              var element = dto.controlElements[i];\n              var tag = this.elements[this.elements.indexOf(element.referenceTag)];\n              numberRadioButtonsVisible.push(element);\n\n              if (tag == element.referenceTag) {\n                if (element.checked) {\n                  this._values.push(tag.value);\n\n                  this._activeElements.push(tag);\n                } // a radio button was checked\n\n\n                if (!wasRadioButtonChecked && element.checked) wasRadioButtonChecked = true;\n              }\n            }\n          } else {\n            // for when we don't have any control elements, then we just try and map values\n            for (var i = 0; i < this.elements.length; i++) {\n              var tag = this.elements[i];\n              var v1 = tag.value.toString().toLowerCase();\n              var v2 = dto.text.toString().toLowerCase(); //brute force checking...\n\n              if (v1.indexOf(v2) !== -1 || v2.indexOf(v1) !== -1) {\n                this._activeElements.push(tag); // check the original tag\n\n\n                this._values.push(tag.value);\n\n                tag.domElement.checked = true;\n                wasRadioButtonChecked = true;\n              }\n            }\n          }\n\n          isValid = wasRadioButtonChecked;\n          break;\n\n        case \"checkbox\":\n          // checkbox is always valid\n          isValid = true;\n\n          if (dto.controlElements) {\n            for (var i = 0; i < dto.controlElements.length; i++) {\n              var element = dto.controlElements[i];\n              var tag = this.elements[this.elements.indexOf(element.referenceTag)];\n              tag.domElement.checked = element.checked;\n\n              if (element.checked) {\n                this._values.push(tag.value);\n\n                this._activeElements.push(tag);\n              }\n            }\n          }\n\n          if (this.required && this._activeElements.length == 0) {\n            // checkbox can be required\n            isValid = false;\n          }\n\n          break;\n      }\n\n      return isValid;\n    };\n\n    return TagGroup;\n  }();\n\n  cf.TagGroup = TagGroup;\n})(cf || (cf = {})); /// <reference path=\"Tag.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics2 = function extendStatics(d, b) {\n    _extendStatics2 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics2(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics2(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var InputTag =\n  /** @class */\n  function (_super) {\n    __extends(InputTag, _super);\n\n    function InputTag(options) {\n      var _this = _super.call(this, options) || this;\n\n      if (_this.type == \"text\") {} else if (_this.type == \"email\") {} else if (_this.type == \"tel\") {} else if (_this.type == \"checkbox\") {} else if (_this.type == \"radio\") {} else if (_this.type == \"password\") {} else if (_this.type == \"file\") {// check InputFileTag.ts\n      }\n\n      return _this;\n    }\n\n    InputTag.prototype.findAndSetQuestions = function () {\n      _super.prototype.findAndSetQuestions.call(this); // special use cases for <input> tag add here...\n\n    };\n\n    InputTag.prototype.findAndSetLabel = function () {\n      _super.prototype.findAndSetLabel.call(this);\n\n      if (!this._label) {// special use cases for <input> tag add here...\n      }\n    };\n\n    InputTag.prototype.setTagValueAndIsValid = function (value) {\n      if (this.type == \"checkbox\") {\n        // checkbox is always true..\n        return true;\n      } else {\n        return _super.prototype.setTagValueAndIsValid.call(this, value);\n      }\n    };\n\n    InputTag.prototype.dealloc = function () {\n      _super.prototype.dealloc.call(this);\n    };\n\n    return InputTag;\n  }(cf.Tag);\n\n  cf.InputTag = InputTag;\n})(cf || (cf = {})); /// <reference path=\"Tag.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics3 = function extendStatics(d, b) {\n    _extendStatics3 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics3(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics3(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var SelectTag =\n  /** @class */\n  function (_super) {\n    __extends(SelectTag, _super);\n\n    function SelectTag(options) {\n      var _this = _super.call(this, options) || this; // build the option tags\n\n\n      _this.optionTags = [];\n\n      var domOptionTags = _this.domElement.getElementsByTagName(\"option\");\n\n      for (var i = 0; i < domOptionTags.length; i++) {\n        var element = domOptionTags[i];\n        var tag = cf.Tag.createTag(element);\n\n        if (tag) {\n          _this.optionTags.push(tag);\n        } else {\n          console.warn(_this.constructor.name, 'option tag invalid:', tag);\n        }\n      }\n\n      return _this;\n    }\n\n    Object.defineProperty(SelectTag.prototype, \"type\", {\n      get: function get() {\n        return \"select\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(SelectTag.prototype, \"name\", {\n      get: function get() {\n        return this.domElement && this.domElement.hasAttribute(\"name\") ? this.domElement.getAttribute(\"name\") : this.optionTags[0].name;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(SelectTag.prototype, \"value\", {\n      get: function get() {\n        return this._values;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(SelectTag.prototype, \"multipleChoice\", {\n      get: function get() {\n        return this.domElement.hasAttribute(\"multiple\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    SelectTag.prototype.setTagValueAndIsValid = function (dto) {\n      var isValid = false; // select tag values are set via selected attribute on option tag\n\n      var numberOptionButtonsVisible = [];\n      this._values = [];\n\n      if (dto.controlElements) {\n        // TODO: Refactor this so it is less dependant on controlElements\n        for (var i = 0; i < this.optionTags.length; i++) {\n          var tag = this.optionTags[i];\n\n          for (var j = 0; j < dto.controlElements.length; j++) {\n            var controllerElement = dto.controlElements[j];\n\n            if (controllerElement.referenceTag == tag) {\n              // tag match found, so set value\n              tag.selected = controllerElement.selected; // check for minimum one selected\n\n              if (!isValid && tag.selected) isValid = true;\n              if (tag.selected) this._values.push(tag.value);\n              if (controllerElement.visible) numberOptionButtonsVisible.push(controllerElement);\n            }\n          }\n        }\n      } else {\n        var wasSelected = false; // for when we don't have any control elements, then we just try and map values\n\n        for (var i = 0; i < this.optionTags.length; i++) {\n          var tag = this.optionTags[i];\n          var v1 = tag.value.toString().toLowerCase();\n          var v2 = dto.text.toString().toLowerCase(); //brute force checking...\n\n          if (v1.indexOf(v2) !== -1 || v2.indexOf(v1) !== -1) {\n            // check the original tag\n            this._values.push(tag.value);\n\n            tag.domElement.checked = true;\n            wasSelected = true;\n          }\n        }\n\n        isValid = wasSelected;\n      } // special case 1, only one optiontag visible from a filter\n\n\n      if (!isValid && numberOptionButtonsVisible.length == 1) {\n        var element = numberOptionButtonsVisible[0];\n        var tag = this.optionTags[this.optionTags.indexOf(element.referenceTag)];\n        element.selected = true;\n        tag.selected = true;\n        isValid = true;\n        if (tag.selected) this._values.push(tag.value);\n      }\n\n      return isValid;\n    };\n\n    return SelectTag;\n  }(cf.Tag);\n\n  cf.SelectTag = SelectTag;\n})(cf || (cf = {})); /// <reference path=\"Tag.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics4 = function extendStatics(d, b) {\n    _extendStatics4 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics4(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics4(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var ButtonTag =\n  /** @class */\n  function (_super) {\n    __extends(ButtonTag, _super);\n\n    function ButtonTag(options) {\n      var _this = _super.call(this, options) || this;\n\n      if (_this.domElement.getAttribute(\"type\") == \"submit\") {} else if (_this.domElement.getAttribute(\"type\") == \"button\") {// this.onClick = eval(this.domElement.onclick);\n      }\n\n      return _this;\n    }\n\n    return ButtonTag;\n  }(cf.Tag);\n\n  cf.ButtonTag = ButtonTag;\n})(cf || (cf = {})); /// <reference path=\"Tag.ts\"/>\n/// <reference path=\"../parsing/TagsParser.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics5 = function extendStatics(d, b) {\n    _extendStatics5 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics5(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics5(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var OptionTag =\n  /** @class */\n  function (_super) {\n    __extends(OptionTag, _super);\n\n    function OptionTag() {\n      return _super !== null && _super.apply(this, arguments) || this;\n    }\n\n    Object.defineProperty(OptionTag.prototype, \"type\", {\n      get: function get() {\n        return \"option\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(OptionTag.prototype, \"label\", {\n      get: function get() {\n        if (this.formless) {\n          return _super.prototype.getLabel.call(this);\n        } else {\n          return cf.Helpers.getInnerTextOfElement(this.domElement);\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(OptionTag.prototype, \"selected\", {\n      get: function get() {\n        return this.domElement.hasAttribute(\"selected\"); // return (<HTMLOptionElement> this.domElement).selected;\n      },\n      set: function set(value) {\n        this.domElement.selected = value;\n\n        if (value) {\n          this.domElement.setAttribute(\"selected\", \"selected\");\n        } else {\n          this.domElement.removeAttribute(\"selected\");\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    OptionTag.prototype.setTagValueAndIsValid = function (value) {\n      var isValid = true; // OBS: No need to set any validation og value for this tag type ..\n      // .. it is atm. only used to create pseudo elements in the OptionsList\n\n      return isValid;\n    };\n\n    return OptionTag;\n  }(cf.Tag);\n\n  cf.OptionTag = OptionTag;\n})(cf || (cf = {})); /// <reference path=\"Tag.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics6 = function extendStatics(d, b) {\n    _extendStatics6 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics6(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics6(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var CfRobotMessageTag =\n  /** @class */\n  function (_super) {\n    __extends(CfRobotMessageTag, _super);\n\n    function CfRobotMessageTag(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this.skipUserInput = true;\n      return _this;\n    }\n\n    CfRobotMessageTag.prototype.dealloc = function () {\n      _super.prototype.dealloc.call(this);\n    };\n\n    return CfRobotMessageTag;\n  }(cf.Tag);\n\n  cf.CfRobotMessageTag = CfRobotMessageTag;\n})(cf || (cf = {})); /// <reference path=\"ControlElement.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics7 = function extendStatics(d, b) {\n    _extendStatics7 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics7(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics7(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var Button =\n  /** @class */\n  function (_super) {\n    __extends(Button, _super);\n\n    function Button(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this.clickCallback = _this.onClick.bind(_this);\n\n      _this.el.addEventListener(\"click\", _this.clickCallback, false);\n\n      _this.mouseDownCallback = _this.onMouseDown.bind(_this);\n\n      _this.el.addEventListener(\"mousedown\", _this.mouseDownCallback, false); //image\n\n\n      _this.checkForImage();\n\n      return _this;\n    }\n\n    Object.defineProperty(Button.prototype, \"type\", {\n      get: function get() {\n        return \"Button\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    Button.prototype.hasImage = function () {\n      return this.referenceTag.hasImage;\n    };\n    /**\n    * @name checkForImage\n    * checks if element has cf-image, if it has then change UI\n    */\n\n\n    Button.prototype.checkForImage = function () {\n      var hasImage = this.hasImage();\n\n      if (hasImage) {\n        this.el.classList.add(\"has-image\");\n        this.imgEl = document.createElement(\"img\");\n        this.imageLoadedCallback = this.onImageLoaded.bind(this);\n        this.imgEl.classList.add(\"cf-image\");\n        this.imgEl.addEventListener(\"load\", this.imageLoadedCallback, false);\n        this.imgEl.src = this.referenceTag.domElement.getAttribute(\"cf-image\");\n        this.el.insertBefore(this.imgEl, this.el.children[0]);\n      }\n    };\n\n    Button.prototype.onImageLoaded = function () {\n      this.imgEl.classList.add(\"loaded\");\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.ON_LOADED, {}));\n    };\n\n    Button.prototype.onMouseDown = function (event) {\n      event.preventDefault();\n    };\n\n    Button.prototype.onClick = function (event) {\n      this.onChoose();\n    };\n\n    Button.prototype.dealloc = function () {\n      this.el.removeEventListener(\"click\", this.clickCallback, false);\n      this.clickCallback = null;\n\n      if (this.imageLoadedCallback) {\n        this.imgEl.removeEventListener(\"load\", this.imageLoadedCallback, false);\n        this.imageLoadedCallback = null;\n      }\n\n      this.el.removeEventListener(\"mousedown\", this.mouseDownCallback, false);\n      this.mouseDownCallback = null;\n\n      _super.prototype.dealloc.call(this);\n    }; // override\n\n\n    Button.prototype.getTemplate = function () {\n      return \"<cf-button class=\\\"cf-button\\\">\\n\\t\\t\\t\\t\" + this.referenceTag.label + \"\\n\\t\\t\\t</cf-button>\\n\\t\\t\\t\";\n    };\n\n    return Button;\n  }(cf.ControlElement);\n\n  cf.Button = Button;\n})(cf || (cf = {})); /// <reference path=\"Button.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics8 = function extendStatics(d, b) {\n    _extendStatics8 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics8(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics8(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var RadioButton =\n  /** @class */\n  function (_super) {\n    __extends(RadioButton, _super);\n\n    function RadioButton() {\n      return _super !== null && _super.apply(this, arguments) || this;\n    }\n\n    Object.defineProperty(RadioButton.prototype, \"type\", {\n      get: function get() {\n        return \"RadioButton\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(RadioButton.prototype, \"checked\", {\n      get: function get() {\n        var _checked = this.el.hasAttribute(\"checked\") && this.el.getAttribute(\"checked\") == \"checked\";\n\n        return _checked;\n      },\n      set: function set(value) {\n        if (!value) {\n          this.el.removeAttribute(\"checked\");\n          this.referenceTag.domElement.removeAttribute(\"checked\");\n          this.referenceTag.domElement.checked = false;\n        } else {\n          this.el.setAttribute(\"checked\", \"checked\");\n          this.referenceTag.domElement.setAttribute(\"checked\", \"checked\");\n          this.referenceTag.domElement.checked = true;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    RadioButton.prototype.onClick = function (event) {\n      this.checked = true; // checked always true like native radio buttons\n\n      _super.prototype.onClick.call(this, event);\n    }; // override\n\n\n    RadioButton.prototype.getTemplate = function () {\n      var isChecked = this.referenceTag.domElement.checked || this.referenceTag.domElement.hasAttribute(\"checked\");\n      return \"<cf-radio-button class=\\\"cf-button\\\" \" + (isChecked ? \"checked=checked\" : \"\") + \">\\n\\t\\t\\t\\t<div>\\n\\t\\t\\t\\t\\t<cf-radio></cf-radio>\\n\\t\\t\\t\\t\\t<span>\" + this.referenceTag.label + \"</span>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</cf-radio-button>\\n\\t\\t\\t\";\n    };\n\n    return RadioButton;\n  }(cf.Button);\n\n  cf.RadioButton = RadioButton;\n})(cf || (cf = {})); /// <reference path=\"Button.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics9 = function extendStatics(d, b) {\n    _extendStatics9 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics9(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics9(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var CheckboxButton =\n  /** @class */\n  function (_super) {\n    __extends(CheckboxButton, _super);\n\n    function CheckboxButton() {\n      return _super !== null && _super.apply(this, arguments) || this;\n    }\n\n    Object.defineProperty(CheckboxButton.prototype, \"type\", {\n      get: function get() {\n        return \"CheckboxButton\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(CheckboxButton.prototype, \"checked\", {\n      get: function get() {\n        return this.el.getAttribute(\"checked\") == \"checked\";\n      },\n      set: function set(value) {\n        if (!value) {\n          this.el.removeAttribute(\"checked\");\n          this.referenceTag.domElement.removeAttribute(\"checked\");\n          this.referenceTag.domElement.checked = false;\n        } else {\n          this.el.setAttribute(\"checked\", \"checked\");\n          this.referenceTag.domElement.setAttribute(\"checked\", \"checked\");\n          this.referenceTag.domElement.checked = true;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    CheckboxButton.prototype.onClick = function (event) {\n      this.checked = !this.checked;\n    }; // override\n\n\n    CheckboxButton.prototype.getTemplate = function () {\n      var isChecked = this.referenceTag.domElement.checked && this.referenceTag.domElement.hasAttribute(\"checked\");\n      return \"<cf-button class=\\\"cf-button cf-checkbox-button \" + (this.referenceTag.label.trim().length == 0 ? \"no-text\" : \"\") + \"\\\" checked=\" + (isChecked ? \"checked\" : \"\") + \">\\n\\t\\t\\t\\t<div>\\n\\t\\t\\t\\t\\t<cf-checkbox></cf-checkbox>\\n\\t\\t\\t\\t\\t<span>\" + this.referenceTag.label + \"</span>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</cf-button>\\n\\t\\t\\t\";\n    };\n\n    return CheckboxButton;\n  }(cf.Button);\n\n  cf.CheckboxButton = CheckboxButton;\n})(cf || (cf = {})); /// <reference path=\"Button.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics10 = function extendStatics(d, b) {\n    _extendStatics10 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics10(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics10(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  cf.OptionButtonEvents = {\n    CLICK: \"cf-option-button-click\"\n  }; // class\n\n  var OptionButton =\n  /** @class */\n  function (_super) {\n    __extends(OptionButton, _super);\n\n    function OptionButton() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n\n      _this.isMultiChoice = false;\n      return _this;\n    }\n\n    Object.defineProperty(OptionButton.prototype, \"type\", {\n      get: function get() {\n        return \"OptionButton\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(OptionButton.prototype, \"selected\", {\n      get: function get() {\n        return this.el.hasAttribute(\"selected\");\n      },\n      set: function set(value) {\n        if (value) {\n          this.el.setAttribute(\"selected\", \"selected\");\n        } else {\n          this.el.removeAttribute(\"selected\");\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    OptionButton.prototype.setData = function (options) {\n      this.isMultiChoice = options.isMultiChoice;\n\n      _super.prototype.setData.call(this, options);\n    };\n\n    OptionButton.prototype.onClick = function (event) {\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.OptionButtonEvents.CLICK, this);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.OptionButtonEvents.CLICK, {\n        detail: this\n      }));\n    }; // override\n\n\n    OptionButton.prototype.getTemplate = function () {\n      // be aware that first option element on none multiple select tags will be selected by default\n      var tmpl = '<cf-button class=\"cf-button ' + (this.isMultiChoice ? \"cf-checkbox-button\" : \"\") + '\" ' + (this.referenceTag.domElement.selected ? \"selected='selected'\" : \"\") + '>';\n      tmpl += \"<div>\";\n      if (this.isMultiChoice) tmpl += \"<cf-checkbox></cf-checkbox>\";\n      tmpl += this.referenceTag.label;\n      tmpl += \"</div>\";\n      tmpl += \"</cf-button>\";\n      return tmpl;\n    };\n\n    return OptionButton;\n  }(cf.Button);\n\n  cf.OptionButton = OptionButton;\n})(cf || (cf = {})); /// <reference path=\"ControlElement.ts\"/>\n/// <reference path=\"OptionButton.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  // builds x OptionsButton from the registered SelectTag\n  var OptionsList =\n  /** @class */\n  function () {\n    function OptionsList(options) {\n      this.context = options.context;\n      this.eventTarget = options.eventTarget;\n      this.referenceTag = options.referenceTag; // check for multi choice select tag\n\n      this.multiChoice = this.referenceTag.domElement.hasAttribute(\"multiple\");\n      this.onOptionButtonClickCallback = this.onOptionButtonClick.bind(this);\n      this.eventTarget.addEventListener(cf.OptionButtonEvents.CLICK, this.onOptionButtonClickCallback, false);\n      this.createElements();\n    }\n\n    Object.defineProperty(OptionsList.prototype, \"type\", {\n      get: function get() {\n        return \"OptionsList\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    OptionsList.prototype.getValue = function () {\n      var arr = [];\n\n      for (var i = 0; i < this.elements.length; i++) {\n        var element = this.elements[i];\n\n        if (!this.multiChoice && element.selected) {\n          arr.push(element);\n          return arr;\n        } else if (this.multiChoice && element.selected) {\n          arr.push(element);\n        }\n      }\n\n      return arr;\n    };\n\n    OptionsList.prototype.onOptionButtonClick = function (event) {\n      // if mutiple... then dont remove selection on other buttons\n      if (!this.multiChoice) {\n        // only one is selectable at the time.\n        for (var i = 0; i < this.elements.length; i++) {\n          var element = this.elements[i];\n\n          if (element != event.detail) {\n            element.selected = false;\n          } else {\n            element.selected = true;\n          }\n        }\n\n        cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ControlElementEvents.SUBMIT_VALUE, this.referenceTag);\n        this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.SUBMIT_VALUE, {\n          detail: event.detail\n        }));\n      } else {\n        event.detail.selected = !event.detail.selected;\n      }\n    };\n\n    OptionsList.prototype.createElements = function () {\n      this.elements = [];\n      var optionTags = this.referenceTag.optionTags;\n\n      for (var i = 0; i < optionTags.length; i++) {\n        var tag = optionTags[i];\n        var btn = new cf.OptionButton({\n          referenceTag: tag,\n          isMultiChoice: this.referenceTag.multipleChoice,\n          eventTarget: this.eventTarget\n        });\n        this.elements.push(btn);\n        this.context.appendChild(btn.el);\n      }\n    };\n\n    OptionsList.prototype.dealloc = function () {\n      this.eventTarget.removeEventListener(cf.OptionButtonEvents.CLICK, this.onOptionButtonClickCallback, false);\n      this.onOptionButtonClickCallback = null;\n\n      while (this.elements.length > 0) {\n        this.elements.pop().dealloc();\n      }\n\n      this.elements = null;\n    };\n\n    return OptionsList;\n  }();\n\n  cf.OptionsList = OptionsList;\n})(cf || (cf = {})); /// <reference path=\"Button.ts\"/>\n/// <reference path=\"../../logic/Helpers.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics11 = function extendStatics(d, b) {\n    _extendStatics11 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics11(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics11(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var UploadFileUI =\n  /** @class */\n  function (_super) {\n    __extends(UploadFileUI, _super);\n\n    function UploadFileUI(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this.maxFileSize = 100000000000;\n      _this.loading = false;\n      _this.submitTimer = 0;\n      _this._fileName = \"\";\n      _this._readerResult = \"\";\n\n      if (cf.Helpers.caniuse.fileReader()) {\n        var maxFileSizeStr = _this.referenceTag.domElement.getAttribute(\"cf-max-size\") || _this.referenceTag.domElement.getAttribute(\"max-size\");\n\n        if (maxFileSizeStr) {\n          var maxFileSize = parseInt(maxFileSizeStr, 10);\n          _this.maxFileSize = maxFileSize;\n        }\n\n        _this.progressBar = _this.el.getElementsByTagName(\"cf-upload-file-progress-bar\")[0];\n        _this.onDomElementChangeCallback = _this.onDomElementChange.bind(_this);\n\n        _this.referenceTag.domElement.addEventListener(\"change\", _this.onDomElementChangeCallback, false);\n      } else {\n        throw new Error(\"Conversational Form Error: No FileReader available for client.\");\n      }\n\n      return _this;\n    }\n\n    Object.defineProperty(UploadFileUI.prototype, \"value\", {\n      get: function get() {\n        return this.referenceTag.domElement.value; //;this.readerResult || this.fileName;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UploadFileUI.prototype, \"readerResult\", {\n      get: function get() {\n        return this._readerResult;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UploadFileUI.prototype, \"files\", {\n      get: function get() {\n        return this._files;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UploadFileUI.prototype, \"fileName\", {\n      get: function get() {\n        return this._fileName;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UploadFileUI.prototype, \"type\", {\n      get: function get() {\n        return \"UploadFileUI\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    UploadFileUI.prototype.getFilesAsString = function () {\n      // value is for the chat response -->\n      var icon = document.createElement(\"span\");\n      icon.innerHTML = cf.Dictionary.get(\"icon-type-file\") + this.fileName;\n      return icon.outerHTML;\n    };\n\n    UploadFileUI.prototype.onDomElementChange = function (event) {\n      var _this = this;\n\n      if (!cf.ConversationalForm.suppressLog) console.log(\"...onDomElementChange\");\n      var reader = new FileReader();\n      this._files = this.referenceTag.domElement.files;\n\n      reader.onerror = function (event) {\n        if (!cf.ConversationalForm.suppressLog) console.log(\"onerror\", event);\n      };\n\n      reader.onprogress = function (event) {\n        if (!cf.ConversationalForm.suppressLog) console.log(\"onprogress\", event);\n        _this.progressBar.style.width = event.loaded / event.total * 100 + \"%\";\n      };\n\n      reader.onabort = function (event) {\n        if (!cf.ConversationalForm.suppressLog) console.log(\"onabort\", event);\n      };\n\n      reader.onloadstart = function (event) {\n        // check for file size\n        var file = _this.files[0];\n        var fileSize = file ? file.size : _this.maxFileSize + 1; // if file is undefined then abort ...\n\n        if (fileSize > _this.maxFileSize) {\n          reader.abort();\n          var dto = {\n            errorText: cf.Dictionary.get(\"input-placeholder-file-size-error\")\n          };\n          cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.FlowEvents.USER_INPUT_INVALID, dto);\n\n          _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n            detail: dto\n          }));\n        } else {\n          // good to go\n          _this._fileName = file.name;\n          _this.loading = true;\n\n          _this.animateIn(); // set text\n\n\n          var sizeConversion = Math.floor(Math.log(fileSize) / Math.log(1024));\n          var sizeChart = [\"b\", \"kb\", \"mb\", \"gb\"];\n          sizeConversion = Math.min(sizeChart.length - 1, sizeConversion);\n          var humanSizeString = Number((fileSize / Math.pow(1024, sizeConversion)).toFixed(2)) * 1 + \" \" + sizeChart[sizeConversion];\n          var text = file.name + \" (\" + humanSizeString + \")\";\n          _this.el.getElementsByTagName(\"cf-upload-file-text\")[0].innerHTML = text;\n\n          _this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.PROGRESS_CHANGE, {\n            detail: cf.ControlElementProgressStates.BUSY\n          }));\n        }\n      };\n\n      reader.onload = function (event) {\n        _this._readerResult = event.target.result;\n\n        _this.progressBar.classList.add(\"loaded\");\n\n        _this.submitTimer = setTimeout(function () {\n          _this.el.classList.remove(\"animate-in\");\n\n          _this.onChoose(); // submit the file\n\n\n          _this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.PROGRESS_CHANGE, {\n            detail: cf.ControlElementProgressStates.READY\n          }));\n        }, 0);\n      };\n\n      reader.readAsDataURL(this.files[0]);\n    };\n\n    UploadFileUI.prototype.animateIn = function () {\n      if (this.loading) _super.prototype.animateIn.call(this);\n    };\n\n    UploadFileUI.prototype.onClick = function (event) {// super.onClick(event);\n    };\n\n    UploadFileUI.prototype.triggerFileSelect = function () {\n      // trigger file prompt\n      this.referenceTag.domElement.click();\n    }; // override\n\n\n    UploadFileUI.prototype.dealloc = function () {\n      clearTimeout(this.submitTimer);\n      this.progressBar = null;\n\n      if (this.onDomElementChangeCallback) {\n        this.referenceTag.domElement.removeEventListener(\"change\", this.onDomElementChangeCallback, false);\n        this.onDomElementChangeCallback = null;\n      }\n\n      _super.prototype.dealloc.call(this);\n    };\n\n    UploadFileUI.prototype.getTemplate = function () {\n      var isChecked = this.referenceTag.value == \"1\" || this.referenceTag.domElement.hasAttribute(\"checked\");\n      return \"<cf-upload-file-ui>\\n\\t\\t\\t\\t<cf-upload-file-text></cf-upload-file-text>\\n\\t\\t\\t\\t<cf-upload-file-progress>\\n\\t\\t\\t\\t\\t<cf-upload-file-progress-bar></cf-upload-file-progress-bar>\\n\\t\\t\\t\\t</cf-upload-file-progress>\\n\\t\\t\\t</cf-upload-file-ui>\\n\\t\\t\\t\";\n    };\n\n    return UploadFileUI;\n  }(cf.Button);\n\n  cf.UploadFileUI = UploadFileUI;\n})(cf || (cf = {})); /// <reference path=\"../ui/BasicElement.ts\"/>\n/// <reference path=\"../ui//control-elements/ControlElements.ts\"/>\n/// <reference path=\"../logic/FlowManager.ts\"/>\n/// <reference path=\"../interfaces/IUserInputElement.ts\"/>\n/// <reference path=\"../ui/inputs/UserInputElement.ts\"/>\n/// <reference path=\"../interfaces/IUserInputElement.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  cf.MicrophoneBridgeEvent = {\n    ERROR: \"cf-microphone-bridge-error\",\n    TERMNIAL_ERROR: \"cf-microphone-bridge-terminal-error\"\n  }; // class\n\n  var MicrophoneBridge =\n  /** @class */\n  function () {\n    function MicrophoneBridge(options) {\n      this.currentTextResponse = \"\";\n      this._hasUserMedia = false;\n      this.inputErrorCount = 0;\n      this.inputCurrentError = \"\";\n      this.el = options.el;\n      this.button = options.button;\n      this.eventTarget = options.eventTarget; // data object\n\n      this.microphoneObj = options.microphoneObj;\n      this.flowUpdateCallback = this.onFlowUpdate.bind(this);\n      this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n    }\n\n    Object.defineProperty(MicrophoneBridge.prototype, \"hasUserMedia\", {\n      set: function set(value) {\n        this._hasUserMedia = value;\n\n        if (!value) {// this.submitButton.classList.add(\"permission-waiting\");\n        } else {// this.submitButton.classList.remove(\"permission-waiting\");\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(MicrophoneBridge.prototype, \"active\", {\n      set: function set(value) {\n        if (this.equalizer) {\n          this.equalizer.disabled = !value;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    MicrophoneBridge.prototype.cancel = function () {\n      this.button.loading = false;\n\n      if (this.microphoneObj.cancelInput) {\n        this.microphoneObj.cancelInput();\n      }\n    };\n\n    MicrophoneBridge.prototype.onFlowUpdate = function () {\n      var _this = this;\n\n      this.currentTextResponse = null;\n\n      if (!this._hasUserMedia) {\n        // check if user has granted\n        var hasGranted_1 = false;\n\n        if (window.navigator.mediaDevices) {\n          window.navigator.mediaDevices.enumerateDevices().then(function (devices) {\n            devices.forEach(function (device) {\n              if (!hasGranted_1 && device.label !== \"\") {\n                hasGranted_1 = true;\n              }\n            });\n\n            if (hasGranted_1) {\n              // user has previously granted, so call getusermedia, as this wont prombt user\n              _this.getUserMedia();\n            } else {// await click on button, wait state\n            }\n          });\n        }\n      } else {\n        // user has granted ready to go go\n        if (!this.microphoneObj.awaitingCallback) {\n          this.callInput();\n        }\n      }\n    };\n\n    MicrophoneBridge.prototype.getUserMedia = function () {\n      var _this = this;\n\n      try {\n        // from https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n        // Older browsers might not implement mediaDevices at all, so we set an empty object first\n        if (navigator.mediaDevices === undefined) {\n          navigator.mediaDevices = {};\n        } // Some browsers partially implement mediaDevices. We can't just assign an object\n        // with getUserMedia as it would overwrite existing properties.\n        // Here, we will just add the getUserMedia property if it's missing.\n\n\n        if (navigator.mediaDevices.getUserMedia === undefined) {\n          navigator.mediaDevices.getUserMedia = function (constraints) {\n            // First get ahold of the legacy getUserMedia, if present\n            var getUserMedia = navigator.getUserMedia || window.navigator.webkitGetUserMedia || window.navigator.mozGetUserMedia; // Some browsers just don't implement it - return a rejected promise with an error\n            // to keep a consistent interface\n\n            if (!getUserMedia) {\n              return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n            } // Otherwise, wrap the call to the old navigator.getUserMedia with a Promise\n\n\n            return new Promise(function (resolve, reject) {\n              getUserMedia.call(navigator, constraints, resolve, reject);\n            });\n          };\n        }\n\n        navigator.mediaDevices.getUserMedia({\n          audio: true\n        }).then(function (stream) {\n          _this.currentStream = stream;\n\n          if (stream.getAudioTracks().length > 0) {\n            // interface is active and available, so call it immidiatly\n            _this.hasUserMedia = true;\n\n            _this.setupEqualizer();\n\n            if (!_this.microphoneObj.awaitingCallback) {\n              // microphone interface awaits speak out loud callback\n              _this.callInput();\n            }\n          } else {\n            // code for when both devices are available\n            // interface is not active, button should be clicked\n            _this.hasUserMedia = false;\n          }\n        }).catch(function (error) {\n          // Promise catch\n          _this.hasUserMedia = false;\n\n          _this.eventTarget.dispatchEvent(new Event(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR));\n        });\n      } catch (error) {\n        // try catch\n        // whoops no getUserMedia, so roll back to standard UI\n        this.hasUserMedia = false;\n        this.eventTarget.dispatchEvent(new Event(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR));\n      }\n    };\n\n    MicrophoneBridge.prototype.dealloc = function () {\n      this.cancel();\n      this.promise = null;\n      this.currentStream = null;\n\n      if (this.equalizer) {\n        this.equalizer.dealloc();\n      }\n\n      this.equalizer = null;\n      this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n      this.flowUpdateCallback = null;\n    };\n\n    MicrophoneBridge.prototype.callInput = function (messageTime) {\n      // remove current error message after x time\n      // clearTimeout(this.clearMessageTimer);\n      // this.clearMessageTimer = setTimeout(() =>{\n      // \tthis.el.removeAttribute(\"message\");\n      // }, messageTime);\n      var _this = this;\n\n      if (messageTime === void 0) {\n        messageTime = 0;\n      }\n\n      this.button.loading = true;\n\n      if (this.equalizer) {\n        this.equalizer.disabled = false;\n      } // call API, SpeechRecognintion etc. you decide, passing along the stream from getUserMedia can be used.. as long as the resolve is called with string attribute\n\n\n      this.promise = new Promise(function (resolve, reject) {\n        return _this.microphoneObj.input(resolve, reject, _this.currentStream);\n      }).then(function (result) {\n        // api contacted\n        _this.promise = null; // save response so it's available in getFlowDTO\n\n        _this.currentTextResponse = result.toString();\n\n        if (!_this.currentTextResponse || _this.currentTextResponse == \"\") {\n          _this.showError(cf.Dictionary.get(\"user-audio-reponse-invalid\")); // invalid input, so call API again\n\n\n          _this.callInput();\n\n          return;\n        }\n\n        _this.inputErrorCount = 0;\n        _this.inputCurrentError = \"\";\n        _this.button.loading = false; // continue flow\n\n        var dto = {\n          text: _this.currentTextResponse\n        };\n        cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.UserInputEvents.SUBMIT, dto);\n\n        _this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.SUBMIT, {\n          detail: dto\n        }));\n      }).catch(function (error) {\n        // API error\n        // ConversationalForm.illustrateFlow(this, \"dispatch\", MicrophoneBridgeEvent.ERROR, error);\n        // this.eventTarget.dispatchEvent(new CustomEvent(MicrophoneBridgeEvent.ERROR, {\n        // \tdetail: error\n        // }));\n        if (_this.isErrorTerminal(error)) {\n          // terminal error, fallback to \n          _this.eventTarget.dispatchEvent(new CustomEvent(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, {\n            detail: cf.Dictionary.get(\"microphone-terminal-error\")\n          }));\n\n          if (!cf.ConversationalForm.suppressLog) console.log(\"Conversational Form: Terminal error: \", error);\n        } else {\n          if (_this.inputCurrentError != error) {\n            // api failed ...\n            // show result in UI\n            _this.inputErrorCount = 0;\n            _this.inputCurrentError = error;\n          } else {}\n\n          _this.inputErrorCount++;\n\n          if (_this.inputErrorCount > 2) {\n            _this.showError(error);\n          } else {\n            _this.eventTarget.dispatchEvent(new CustomEvent(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, {\n              detail: cf.Dictionary.get(\"microphone-terminal-error\")\n            }));\n\n            if (!cf.ConversationalForm.suppressLog) console.log(\"Conversational Form: Terminal error: \", error);\n          }\n        }\n      });\n    };\n\n    MicrophoneBridge.prototype.isErrorTerminal = function (error) {\n      var terminalErrors = [\"network\"];\n      if (terminalErrors.indexOf(error) !== -1) return true;\n      return false;\n    };\n\n    MicrophoneBridge.prototype.showError = function (error) {\n      var dto = {\n        errorText: error\n      };\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.FlowEvents.USER_INPUT_INVALID, dto);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n        detail: dto\n      }));\n      this.callInput();\n    };\n\n    MicrophoneBridge.prototype.setupEqualizer = function () {\n      var eqEl = this.el.getElementsByTagName(\"cf-icon-audio-eq\")[0];\n\n      if (SimpleEqualizer.supported && eqEl) {\n        this.equalizer = new SimpleEqualizer({\n          stream: this.currentStream,\n          elementToScale: eqEl\n        });\n      }\n    };\n\n    return MicrophoneBridge;\n  }();\n\n  cf.MicrophoneBridge = MicrophoneBridge;\n\n  var SimpleEqualizer =\n  /** @class */\n  function () {\n    function SimpleEqualizer(options) {\n      var _this = this;\n\n      this.maxBorderWidth = 0;\n      this._disabled = false;\n      this.elementToScale = options.elementToScale;\n      this.context = new AudioContext();\n      this.analyser = this.context.createAnalyser();\n      this.mic = this.context.createMediaStreamSource(options.stream);\n      this.javascriptNode = this.context.createScriptProcessor(2048, 1, 1);\n      this.analyser.smoothingTimeConstant = 0.3;\n      this.analyser.fftSize = 1024;\n      this.mic.connect(this.analyser);\n      this.analyser.connect(this.javascriptNode);\n      this.javascriptNode.connect(this.context.destination);\n\n      this.javascriptNode.onaudioprocess = function () {\n        _this.onAudioProcess();\n      };\n    }\n\n    Object.defineProperty(SimpleEqualizer.prototype, \"disabled\", {\n      set: function set(value) {\n        this._disabled = value;\n        this.elementToScale.style.borderWidth = 0 + \"px\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    SimpleEqualizer.prototype.onAudioProcess = function () {\n      if (this._disabled) return;\n      var array = new Uint8Array(this.analyser.frequencyBinCount);\n      this.analyser.getByteFrequencyData(array);\n      var values = 0;\n      var length = array.length;\n\n      for (var i = 0; i < length; i++) {\n        values += array[i];\n      }\n\n      var average = values / length;\n      var percent = Math.min(1, Math.max(0, 1 - (50 - average) / 50));\n\n      if (!this.maxBorderWidth) {\n        this.maxBorderWidth = this.elementToScale.offsetWidth * 0.5;\n      }\n\n      this.elementToScale.style.borderWidth = this.maxBorderWidth * percent + \"px\";\n    };\n\n    SimpleEqualizer.prototype.dealloc = function () {\n      this.javascriptNode.onaudioprocess = null;\n      this.javascriptNode = null;\n      this.analyser = null;\n      this.mic = null;\n      this.elementToScale = null;\n      this.context = null;\n    };\n\n    SimpleEqualizer.supported = function () {\n      window.AudioContext = window.AudioContext || window.webkitAudioContext;\n\n      if (window.AudioContext) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n\n    return SimpleEqualizer;\n  }();\n})(cf || (cf = {})); /// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../control-elements/ControlElements.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\n/// <reference path=\"../../logic/MicrophoneBridge.ts\"/>\n/// <reference path=\"../../interfaces/IUserInputElement.ts\"/>\n/// <reference path=\"UserInputElement.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  cf.UserInputSubmitButtonEvents = {\n    CHANGE: \"userinput-submit-button-change-value\"\n  }; // class\n\n  var UserInputSubmitButton =\n  /** @class */\n  function () {\n    function UserInputSubmitButton(options) {\n      this._active = true;\n      this.eventTarget = options.eventTarget;\n      var template = document.createElement('template');\n      template.innerHTML = this.getTemplate();\n      this.el = template.firstChild || template.content.firstChild;\n      this.onClickCallback = this.onClick.bind(this);\n      this.el.addEventListener(\"click\", this.onClickCallback, false);\n      this.onMicrophoneTerminalErrorCallback = this.onMicrophoneTerminalError.bind(this);\n      this.eventTarget.addEventListener(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, this.onMicrophoneTerminalErrorCallback, false);\n    }\n\n    Object.defineProperty(UserInputSubmitButton.prototype, \"typing\", {\n      get: function get() {\n        return this.el.classList.contains(\"typing\");\n      },\n      set: function set(value) {\n        if (value) {\n          this.el.classList.add(\"typing\");\n          this.loading = false;\n\n          if (this.mic) {\n            this.mic.cancel();\n          }\n        } else {\n          this.el.classList.remove(\"typing\");\n\n          if (this.mic) {\n            this.mic.callInput();\n          }\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UserInputSubmitButton.prototype, \"active\", {\n      get: function get() {\n        return this._active;\n      },\n      set: function set(value) {\n        this._active = value;\n\n        if (this.mic) {\n          this.mic.active = value;\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UserInputSubmitButton.prototype, \"loading\", {\n      get: function get() {\n        return this.el.classList.contains(\"loading\");\n      },\n      set: function set(value) {\n        if (value) this.el.classList.add(\"loading\");else this.el.classList.remove(\"loading\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    UserInputSubmitButton.prototype.addMicrophone = function (microphoneObj) {\n      this.el.classList.add(\"microphone-interface\");\n      var template = document.createElement('template');\n      template.innerHTML = \"<div class=\\\"cf-input-icons cf-microphone\\\">\\n\\t\\t\\t\\t<div class=\\\"cf-icon-audio\\\"></div>\\n\\t\\t\\t\\t<cf-icon-audio-eq></cf-icon-audio-eq>\\n\\t\\t\\t</div>\";\n      var mic = template.firstChild || template.content.firstChild;\n      this.mic = new cf.MicrophoneBridge({\n        el: mic,\n        button: this,\n        eventTarget: this.eventTarget,\n        microphoneObj: microphoneObj\n      });\n      this.el.appendChild(mic); // this.mic = null;\n      // this.el.appendChild(this.mic.el);\n    };\n\n    UserInputSubmitButton.prototype.reset = function () {\n      if (this.mic && !this.typing) {\n        // if microphone and not typing\n        this.mic.callInput();\n      }\n    };\n\n    UserInputSubmitButton.prototype.getTemplate = function () {\n      return \"<cf-input-button class=\\\"cf-input-button\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"cf-input-icons\\\">\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"cf-icon-progress\\\"></div>\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"cf-icon-attachment\\\"></div>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t</cf-input-button>\";\n    };\n\n    UserInputSubmitButton.prototype.onMicrophoneTerminalError = function (event) {\n      if (this.mic) {\n        this.mic.dealloc();\n        this.mic = null;\n        this.el.removeChild(this.el.getElementsByClassName(\"cf-microphone\")[0]);\n        this.el.classList.remove(\"microphone-interface\");\n        this.loading = false;\n        this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n          detail: {\n            errorText: event.detail\n          } //UserTextInput value\n\n        }));\n      }\n    };\n\n    UserInputSubmitButton.prototype.onClick = function (event) {\n      var isMicVisible = this.mic && !this.typing;\n\n      if (isMicVisible) {\n        this.mic.callInput();\n      } else {\n        this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputSubmitButtonEvents.CHANGE));\n      }\n    };\n    /**\n    * @name click\n    * force click on button\n    */\n\n\n    UserInputSubmitButton.prototype.click = function () {\n      this.el.click();\n    };\n    /**\n    * @name dealloc\n    * remove instance\n    */\n\n\n    UserInputSubmitButton.prototype.dealloc = function () {\n      this.eventTarget.removeEventListener(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, this.onMicrophoneTerminalErrorCallback, false);\n      this.onMicrophoneTerminalErrorCallback = null;\n\n      if (this.mic) {\n        this.mic.dealloc();\n      }\n\n      this.mic = null;\n      this.el.removeEventListener(\"click\", this.onClickCallback, false);\n      this.onClickCallback = null;\n      this.el = null;\n      this.eventTarget = null;\n    };\n\n    return UserInputSubmitButton;\n  }();\n\n  cf.UserInputSubmitButton = UserInputSubmitButton;\n})(cf || (cf = {})); /// <reference path=\"../logic/FlowManager.ts\"/>\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  cf.UserInputTypes = {\n    VOICE: \"voice\",\n    VR_GESTURE: \"vr-gesture\",\n    TEXT: \"text\" // <-- default\n\n  };\n})(cf || (cf = {})); /// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../control-elements/ControlElements.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\n/// <reference path=\"../../interfaces/IUserInput.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics12 = function extendStatics(d, b) {\n    _extendStatics12 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics12(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics12(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // Abstract UserInpt element, should be extended when adding a new UI for user input\n// namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  var UserInputElement =\n  /** @class */\n  function (_super) {\n    __extends(UserInputElement, _super);\n\n    function UserInputElement(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this._disabled = false;\n      _this._visible = false;\n      _this.onChatReponsesUpdatedCallback = _this.onChatReponsesUpdated.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.ChatListEvents.CHATLIST_UPDATED, _this.onChatReponsesUpdatedCallback, false);\n\n      _this.windowFocusCallback = _this.windowFocus.bind(_this);\n      window.addEventListener('focus', _this.windowFocusCallback, false);\n      _this.inputInvalidCallback = _this.inputInvalid.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.FlowEvents.USER_INPUT_INVALID, _this.inputInvalidCallback, false);\n\n      _this.flowUpdateCallback = _this.onFlowUpdate.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, _this.flowUpdateCallback, false);\n\n      return _this;\n    }\n\n    Object.defineProperty(UserInputElement.prototype, \"currentTag\", {\n      get: function get() {\n        return this._currentTag;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UserInputElement.prototype, \"visible\", {\n      set: function set(value) {\n        var _this = this;\n\n        this._visible = value;\n\n        if (!this.el.classList.contains(\"animate-in\") && value) {\n          setTimeout(function () {\n            _this.el.classList.add(\"animate-in\");\n          }, 0);\n        } else if (this.el.classList.contains(\"animate-in\") && !value) {\n          this.el.classList.remove(\"animate-in\");\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UserInputElement.prototype, \"disabled\", {\n      get: function get() {\n        return this._disabled;\n      },\n      set: function set(value) {\n        var hasChanged = this._disabled != value;\n\n        if (hasChanged) {\n          this._disabled = value;\n\n          if (value) {\n            this.el.setAttribute(\"disabled\", \"disabled\");\n          } else {\n            this.setFocusOnInput();\n            this.el.removeAttribute(\"disabled\");\n          }\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UserInputElement.prototype, \"height\", {\n      get: function get() {\n        var elHeight = 0;\n        var elMargin = 0;\n        var el = this.el;\n\n        if (cf.Helpers.isInternetExlorer()) {\n          // IE\n          elHeight = el.offsetHeight;\n          elMargin = parseInt(el.currentStyle.marginTop, 10) + parseInt(el.currentStyle.marginBottom, 10);\n          elMargin *= 2;\n        } else {\n          // none-IE\n          elHeight = parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('height'), 10);\n          elMargin = parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-top')) + parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-bottom'));\n        }\n\n        return elHeight + elMargin;\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    UserInputElement.prototype.onEnterOrSubmitButtonSubmit = function (event) {\n      if (event === void 0) {\n        event = null;\n      }\n    };\n\n    UserInputElement.prototype.inputInvalid = function (event) {};\n    /**\n    * @name deactivate\n    * DEactivate the field\n    */\n\n\n    UserInputElement.prototype.deactivate = function () {\n      this.disabled = true;\n    };\n    /**\n    * @name reactivate\n    * REactivate the field\n    */\n\n\n    UserInputElement.prototype.reactivate = function () {\n      this.disabled = false;\n    };\n\n    UserInputElement.prototype.getFlowDTO = function () {\n      var value; // = this.inputElement.value;\n\n      return value;\n    };\n\n    UserInputElement.prototype.setFocusOnInput = function () {};\n\n    UserInputElement.prototype.onFlowStopped = function () {};\n\n    UserInputElement.prototype.reset = function () {};\n\n    UserInputElement.prototype.dealloc = function () {\n      this.eventTarget.removeEventListener(cf.ChatListEvents.CHATLIST_UPDATED, this.onChatReponsesUpdatedCallback, false);\n      this.onChatReponsesUpdatedCallback = null;\n      this.eventTarget.removeEventListener(cf.FlowEvents.USER_INPUT_INVALID, this.inputInvalidCallback, false);\n      this.inputInvalidCallback = null;\n      window.removeEventListener('focus', this.windowFocusCallback, false);\n      this.windowFocusCallback = null;\n      this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n      this.flowUpdateCallback = null;\n\n      _super.prototype.dealloc.call(this);\n    };\n\n    UserInputElement.prototype.onFlowUpdate = function (event) {\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n      this._currentTag = event.detail.tag;\n    };\n\n    UserInputElement.prototype.windowFocus = function (event) {};\n\n    UserInputElement.prototype.onChatReponsesUpdated = function (event) {\n      // only show when user response\n      if (!event.detail.currentResponse.isRobotResponse) {\n        this.visible = true;\n        this.disabled = false;\n        this.setFocusOnInput();\n      }\n    };\n\n    UserInputElement.ERROR_TIME = 2000;\n    UserInputElement.preventAutoFocus = false;\n    UserInputElement.hideUserInputOnNoneTextInput = false;\n    return UserInputElement;\n  }(cf.BasicElement);\n\n  cf.UserInputElement = UserInputElement;\n  cf.UserInputEvents = {\n    SUBMIT: \"cf-input-user-input-submit\",\n    KEY_CHANGE: \"cf-input-key-change\",\n    CONTROL_ELEMENTS_ADDED: \"cf-input-control-elements-added\",\n    HEIGHT_CHANGE: \"cf-input-height-change\",\n    FOCUS: \"cf-input-focus\",\n    BLUR: \"cf-input-blur\"\n  };\n})(cf || (cf = {})); /// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../control-elements/ControlElements.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\n/// <reference path=\"../../interfaces/IUserInputElement.ts\"/>\n/// <reference path=\"UserInputElement.ts\"/>\n/// <reference path=\"UserInputSubmitButton.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics13 = function extendStatics(d, b) {\n    _extendStatics13 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics13(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics13(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  // class\n  var UserTextInput =\n  /** @class */\n  function (_super) {\n    __extends(UserTextInput, _super);\n\n    function UserTextInput(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this.initialInputHeight = 0;\n      _this.shiftIsDown = false; //acts as a fallback for ex. shadow dom implementation\n\n      _this._active = false;\n      _this.cfReference = options.cfReference;\n      _this.eventTarget = options.eventTarget;\n      _this.inputElement = _this.el.getElementsByTagName(\"textarea\")[0];\n      _this.onInputFocusCallback = _this.onInputFocus.bind(_this);\n      _this.onInputBlurCallback = _this.onInputBlur.bind(_this);\n\n      _this.inputElement.addEventListener('focus', _this.onInputFocusCallback, false);\n\n      _this.inputElement.addEventListener('blur', _this.onInputBlurCallback, false);\n\n      if (!cf.ConversationalForm.animationsEnabled) {\n        _this.inputElement.setAttribute('no-animations', '');\n      } //<cf-input-control-elements> is defined in the ChatList.ts\n\n\n      _this.controlElements = new cf.ControlElements({\n        el: _this.el.getElementsByTagName(\"cf-input-control-elements\")[0],\n        cfReference: _this.cfReference,\n        infoEl: _this.el.getElementsByTagName(\"cf-info\")[0],\n        eventTarget: _this.eventTarget\n      }); // setup event listeners\n\n      _this.keyUpCallback = _this.onKeyUp.bind(_this);\n      document.addEventListener(\"keyup\", _this.keyUpCallback, false);\n      _this.keyDownCallback = _this.onKeyDown.bind(_this);\n      document.addEventListener(\"keydown\", _this.keyDownCallback, false);\n      _this.onOriginalTagChangedCallback = _this.onOriginalTagChanged.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.TagEvents.ORIGINAL_ELEMENT_CHANGED, _this.onOriginalTagChangedCallback, false);\n\n      _this.onControlElementSubmitCallback = _this.onControlElementSubmit.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.ControlElementEvents.SUBMIT_VALUE, _this.onControlElementSubmitCallback, false);\n\n      _this.onControlElementProgressChangeCallback = _this.onControlElementProgressChange.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.ControlElementEvents.PROGRESS_CHANGE, _this.onControlElementProgressChangeCallback, false);\n\n      _this.onSubmitButtonChangeStateCallback = _this.onSubmitButtonChangeState.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.UserInputSubmitButtonEvents.CHANGE, _this.onSubmitButtonChangeStateCallback, false); // this.eventTarget.addEventListener(ControlElementsEvents.ON_RESIZE, () => {}, false);\n\n\n      _this.submitButton = new cf.UserInputSubmitButton({\n        eventTarget: _this.eventTarget\n      });\n\n      _this.el.querySelector('div').appendChild(_this.submitButton.el); // setup microphone support, audio\n\n\n      if (options.microphoneInputObj) {\n        _this.microphoneObj = options.microphoneInputObj;\n\n        if (_this.microphoneObj && _this.microphoneObj.init) {\n          // init if init method is defined\n          _this.microphoneObj.init();\n        }\n\n        _this.submitButton.addMicrophone(_this.microphoneObj);\n      }\n\n      return _this;\n    }\n\n    Object.defineProperty(UserTextInput.prototype, \"active\", {\n      get: function get() {\n        return this.inputElement === document.activeElement || this._active;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(UserTextInput.prototype, \"disabled\", {\n      set: function set(value) {\n        var hasChanged = this._disabled != value;\n        if (!cf.ConversationalForm.suppressLog) console.log('option hasChanged', value);\n\n        if (hasChanged) {\n          this._disabled = value;\n\n          if (value) {\n            this.el.setAttribute(\"disabled\", \"disabled\");\n            this.inputElement.blur();\n          } else {\n            this.setFocusOnInput();\n            this.el.removeAttribute(\"disabled\");\n          }\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    UserTextInput.prototype.getInputValue = function () {\n      var str = this.inputElement.value; // Build-in way to handle XSS issues ->\n\n      var div = document.createElement('div');\n      div.appendChild(document.createTextNode(str));\n      return div.innerHTML;\n    };\n\n    UserTextInput.prototype.getFlowDTO = function () {\n      var value; // = this.inputElement.value;\n      // check for values on control elements as they should overwrite the input value.\n\n      if (this.controlElements && this.controlElements.active) {\n        value = this.controlElements.getDTO();\n      } else {\n        value = {\n          text: this.getInputValue()\n        };\n      } // add current tag to DTO if not set\n\n\n      if (!value.tag) value.tag = this.currentTag;\n      value.input = this;\n      value.tag = this.currentTag;\n      return value;\n    };\n\n    UserTextInput.prototype.reset = function () {\n      if (this.controlElements) {\n        this.controlElements.clearTagsAndReset();\n      }\n    };\n\n    UserTextInput.prototype.deactivate = function () {\n      _super.prototype.deactivate.call(this);\n\n      if (this.microphoneObj) {\n        this.submitButton.active = false;\n      }\n    };\n\n    UserTextInput.prototype.reactivate = function () {\n      _super.prototype.reactivate.call(this); // called from microphone interface, check if active microphone, and set loading if yes\n\n\n      if (this.microphoneObj && !this.submitButton.typing) {\n        this.submitButton.loading = true; // setting typing to false calls the externa interface, like Microphone\n\n        this.submitButton.typing = false;\n        this.submitButton.active = true;\n      }\n    };\n\n    UserTextInput.prototype.onFlowStopped = function () {\n      this.submitButton.loading = false;\n      if (this.submitButton.typing) this.submitButton.typing = false;\n      if (this.controlElements) this.controlElements.clearTagsAndReset();\n      this.disabled = true;\n    };\n    /**\n    * @name onOriginalTagChanged\n    * on domElement from a Tag value changed..\n    */\n\n\n    UserTextInput.prototype.onOriginalTagChanged = function (event) {\n      if (this.currentTag == event.detail.tag) {\n        this.onInputChange();\n      }\n\n      if (this.controlElements && this.controlElements.active) {\n        this.controlElements.updateStateOnElementsFromTag(event.detail.tag);\n      }\n    };\n\n    UserTextInput.prototype.onInputChange = function () {\n      if (!this.active && !this.controlElements.active) return; // safari likes to jump around with the scrollHeight value, let's keep it in check with an initial height.\n\n      var oldHeight = Math.max(this.initialInputHeight, parseInt(this.inputElement.style.height, 10));\n      this.inputElement.style.height = '0px'; // console.log(this.inputElement.style.height, this.inputElement.style);\n\n      this.inputElement.style.height = (this.inputElement.scrollHeight === 0 ? oldHeight : this.inputElement.scrollHeight) + \"px\";\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.UserInputEvents.HEIGHT_CHANGE);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.HEIGHT_CHANGE, {\n        detail: this.inputElement.scrollHeight\n      }));\n    };\n\n    UserTextInput.prototype.resetInputHeight = function () {\n      if (this.inputElement.getAttribute('rows') === '1') {\n        this.inputElement.style.height = this.initialInputHeight + 'px';\n      } else {\n        this.inputElement.style.height = '0px';\n      }\n    };\n\n    UserTextInput.prototype.inputInvalid = function (event) {\n      var _this = this;\n\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n      var dto = event.detail;\n      this.inputElement.setAttribute(\"data-value\", this.inputElement.value);\n      this.inputElement.value = \"\";\n      this.el.setAttribute(\"error\", \"\");\n      this.disabled = true; // cf-error\n\n      this.inputElement.setAttribute(\"placeholder\", dto.errorText || (this._currentTag ? this._currentTag.errorMessage : \"\"));\n      clearTimeout(this.errorTimer); // remove loading class\n\n      this.submitButton.loading = false;\n      this.errorTimer = setTimeout(function () {\n        _this.disabled = false;\n        if (!cf.ConversationalForm.suppressLog) console.log('option, disabled 1');\n\n        _this.el.removeAttribute(\"error\");\n\n        _this.inputElement.value = _this.inputElement.getAttribute(\"data-value\");\n\n        _this.inputElement.setAttribute(\"data-value\", \"\");\n\n        _this.setPlaceholder();\n\n        _this.setFocusOnInput(); //TODO: reset submit button..\n\n\n        _this.submitButton.reset();\n\n        if (_this.controlElements) _this.controlElements.resetAfterErrorMessage();\n      }, cf.UserInputElement.ERROR_TIME);\n    };\n\n    UserTextInput.prototype.setPlaceholder = function () {\n      if (this._currentTag) {\n        if (this._currentTag.inputPlaceholder) {\n          this.inputElement.setAttribute(\"placeholder\", this._currentTag.inputPlaceholder);\n        } else {\n          this.inputElement.setAttribute(\"placeholder\", this._currentTag.type == \"group\" ? cf.Dictionary.get(\"group-placeholder\") : cf.Dictionary.get(\"input-placeholder\"));\n        }\n      } else {\n        this.inputElement.setAttribute(\"placeholder\", cf.Dictionary.get(\"group-placeholder\"));\n      }\n    };\n    /**\n     * TODO: handle detect input/textarea in a simpler way - too conditional heavy\n     *\n     * @private\n     * @memberof UserTextInput\n     */\n\n\n    UserTextInput.prototype.checkForCorrectInputTag = function () {\n      var tagName = this.tagType(this._currentTag); // remove focus and blur events, because we want to create a new element\n\n      if (this.inputElement && this.inputElement.tagName !== tagName) {\n        this.inputElement.removeEventListener('focus', this.onInputFocusCallback, false);\n        this.inputElement.removeEventListener('blur', this.onInputBlurCallback, false);\n      }\n\n      this.removeAttribute('autocomplete');\n      this.removeAttribute('list');\n\n      if (tagName === 'INPUT') {\n        // change to input\n        var input_1 = document.createElement(\"input\");\n        Array.prototype.slice.call(this.inputElement.attributes).forEach(function (item) {\n          input_1.setAttribute(item.name, item.value);\n        });\n\n        if (this.inputElement.type === 'password') {\n          input_1.setAttribute(\"autocomplete\", \"new-password\");\n        }\n\n        if (this._currentTag.domElement.hasAttribute('autocomplete')) {\n          input_1.setAttribute('autocomplete', this._currentTag.domElement.getAttribute('autocomplete'));\n        }\n\n        if (this._currentTag.domElement.hasAttribute('list')) {\n          input_1.setAttribute('list', this._currentTag.domElement.getAttribute('list'));\n        }\n\n        this.inputElement.parentNode.replaceChild(input_1, this.inputElement);\n        this.inputElement = input_1;\n      } else if (this.inputElement && this.inputElement.tagName !== tagName) {\n        // change to textarea\n        var textarea_1 = document.createElement(\"textarea\");\n        Array.prototype.slice.call(this.inputElement.attributes).forEach(function (item) {\n          textarea_1.setAttribute(item.name, item.value);\n        });\n        this.inputElement.parentNode.replaceChild(textarea_1, this.inputElement);\n        this.inputElement = textarea_1;\n      } // add focus and blur events to newly created input element\n\n\n      if (this.inputElement && this.inputElement.tagName !== tagName) {\n        this.inputElement.addEventListener('focus', this.onInputFocusCallback, false);\n        this.inputElement.addEventListener('blur', this.onInputBlurCallback, false);\n      }\n\n      if (this.initialInputHeight == 0) {\n        // initial height not set\n        this.initialInputHeight = this.inputElement.offsetHeight;\n      }\n\n      this.setFocusOnInput();\n    };\n    /**\n     * Removes attribute on input element if attribute is present\n     *\n     * @private\n     * @param {string} attribute\n     * @memberof UserTextInput\n     */\n\n\n    UserTextInput.prototype.removeAttribute = function (attribute) {\n      if (this.inputElement && this.inputElement.hasAttribute(attribute)) {\n        this.inputElement.removeAttribute(attribute);\n      }\n    };\n\n    UserTextInput.prototype.tagType = function (inputElement) {\n      if (!inputElement.domElement || !inputElement.domElement.tagName) {\n        return 'TEXTAREA';\n      }\n\n      if (inputElement.domElement.tagName === 'TEXTAREA' || inputElement.domElement.hasAttribute('rows') && parseInt(inputElement.domElement.getAttribute('rows'), 10) > 1) return 'TEXTAREA';\n      if (inputElement.domElement.tagName === 'INPUT') return 'INPUT';\n      return 'TEXTAREA'; // TODO\n    };\n\n    UserTextInput.prototype.onFlowUpdate = function (event) {\n      var _this = this;\n\n      _super.prototype.onFlowUpdate.call(this, event);\n\n      this.submitButton.loading = false;\n      if (this.submitButton.typing) this.submitButton.typing = false; // animate input field in\n\n      this.el.setAttribute(\"tag-type\", this._currentTag.type); // replace textarea and visa versa\n\n      this.checkForCorrectInputTag(); // set input field to type password if the dom input field is that, covering up the input\n\n      var isInputSpecificType = [\"password\", \"number\", \"email\", \"tel\"].indexOf(this._currentTag.type) !== -1;\n      this.inputElement.setAttribute(\"type\", isInputSpecificType ? this._currentTag.type : \"input\");\n      clearTimeout(this.errorTimer);\n      this.el.removeAttribute(\"error\");\n      this.inputElement.setAttribute(\"data-value\", \"\");\n      this.inputElement.value = \"\";\n      this.submitButton.loading = false;\n      this.setPlaceholder();\n      this.resetValue();\n      this.setFocusOnInput();\n      this.controlElements.reset();\n\n      if (this._currentTag.type == \"group\") {\n        this.buildControlElements(this._currentTag.elements);\n      } else {\n        this.buildControlElements([this._currentTag]);\n      }\n\n      if (this._currentTag.defaultValue) {\n        this.inputElement.value = this._currentTag.defaultValue.toString();\n      }\n\n      if (this._currentTag.skipUserInput === true) {\n        this.el.classList.add(\"hide-input\");\n      } else {\n        this.el.classList.remove(\"hide-input\");\n      } // Set rows attribute if present\n\n\n      if (this._currentTag.rows && this._currentTag.rows > 1) {\n        this.inputElement.setAttribute('rows', this._currentTag.rows.toString());\n      }\n\n      if (cf.UserInputElement.hideUserInputOnNoneTextInput) {\n        // toggle userinput hide\n        if (this.controlElements.active) {\n          this.el.classList.add(\"hide-input\"); // set focus on first control element\n\n          this.controlElements.focusFrom(\"bottom\");\n        } else {\n          this.el.classList.remove(\"hide-input\");\n        }\n      }\n\n      this.resetInputHeight();\n      setTimeout(function () {\n        _this.onInputChange();\n      }, 300);\n    };\n\n    UserTextInput.prototype.onControlElementProgressChange = function (event) {\n      var status = event.detail;\n      this.disabled = status == cf.ControlElementProgressStates.BUSY;\n      if (!cf.ConversationalForm.suppressLog) console.log('option, disabled 2');\n    };\n\n    UserTextInput.prototype.buildControlElements = function (tags) {\n      this.controlElements.buildTags(tags);\n    };\n\n    UserTextInput.prototype.onControlElementSubmit = function (event) {\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail); // when ex a RadioButton is clicked..\n\n      var controlElement = event.detail;\n      this.controlElements.updateStateOnElements(controlElement);\n      this.doSubmit();\n    };\n\n    UserTextInput.prototype.onSubmitButtonChangeState = function (event) {\n      this.onEnterOrSubmitButtonSubmit(event);\n    };\n\n    UserTextInput.prototype.isMetaKeyPressed = function (event) {\n      // if any meta keys, then ignore, getModifierState, but safari does not support..\n      if (event.metaKey || [91, 93].indexOf(event.keyCode) !== -1) return;\n    };\n\n    UserTextInput.prototype.onKeyDown = function (event) {\n      if (!this.active && !this.controlElements.focus) return;\n      if (this.isControlElementsActiveAndUserInputHidden()) return;\n      if (this.isMetaKeyPressed(event)) return; // if any meta keys, then ignore\n\n      if (event.keyCode == cf.Dictionary.keyCodes[\"shift\"]) this.shiftIsDown = true; // If submit is prevented by option 'preventSubmitOnEnter'\n\n      if (this.cfReference.preventSubmitOnEnter === true && this.inputElement.hasAttribute('rows') && parseInt(this.inputElement.getAttribute('rows')) > 1) {\n        return;\n      } // prevent textarea line breaks\n\n\n      if (event.keyCode == cf.Dictionary.keyCodes[\"enter\"] && !event.shiftKey) {\n        event.preventDefault();\n      }\n    };\n\n    UserTextInput.prototype.isControlElementsActiveAndUserInputHidden = function () {\n      return this.controlElements && this.controlElements.active && cf.UserInputElement.hideUserInputOnNoneTextInput;\n    };\n\n    UserTextInput.prototype.onKeyUp = function (event) {\n      if (!this.active && !this.isControlElementsActiveAndUserInputHidden() && !this.controlElements.focus) return;\n      if (this.isMetaKeyPressed(event)) return;\n\n      if (event.keyCode == cf.Dictionary.keyCodes[\"shift\"]) {\n        this.shiftIsDown = false;\n      } else if (event.keyCode == cf.Dictionary.keyCodes[\"up\"]) {\n        event.preventDefault();\n        if (this.active && !this.controlElements.focus) this.controlElements.focusFrom(\"bottom\");\n      } else if (event.keyCode == cf.Dictionary.keyCodes[\"down\"]) {\n        event.preventDefault();\n        if (this.active && !this.controlElements.focus) this.controlElements.focusFrom(\"top\");\n      } else if (event.keyCode == cf.Dictionary.keyCodes[\"tab\"]) {\n        // tab key pressed, check if node is child of CF, if then then reset focus to input element\n        var doesKeyTargetExistInCF = false;\n        var node = event.target.parentNode;\n\n        while (node != null) {\n          if (node === this.cfReference.el) {\n            doesKeyTargetExistInCF = true;\n            break;\n          }\n\n          node = node.parentNode;\n        } // prevent normal behaviour, we are not here to take part, we are here to take over!\n\n\n        if (!doesKeyTargetExistInCF) {\n          event.preventDefault();\n          if (!this.controlElements.active) this.setFocusOnInput();\n        }\n      }\n\n      if (this.el.hasAttribute(\"disabled\")) return;\n      var value = this.getFlowDTO();\n\n      if (event.keyCode == cf.Dictionary.keyCodes[\"enter\"] && !event.shiftKey || event.keyCode == cf.Dictionary.keyCodes[\"space\"]) {\n        if (event.keyCode == cf.Dictionary.keyCodes[\"enter\"] && this.active) {\n          if (this.cfReference.preventSubmitOnEnter === true) return;\n          event.preventDefault();\n          this.onEnterOrSubmitButtonSubmit();\n        } else {\n          // either click on submit button or do something with control elements\n          if (event.keyCode == cf.Dictionary.keyCodes[\"enter\"] || event.keyCode == cf.Dictionary.keyCodes[\"space\"]) {\n            event.preventDefault();\n            var tagType = this._currentTag.type == \"group\" ? this._currentTag.getGroupTagType() : this._currentTag.type;\n\n            if (tagType == \"select\" || tagType == \"checkbox\") {\n              var mutiTag = this._currentTag; // if select or checkbox then check for multi select item\n\n              if (tagType == \"checkbox\" || mutiTag.multipleChoice) {\n                if ((this.active || this.isControlElementsActiveAndUserInputHidden()) && event.keyCode == cf.Dictionary.keyCodes[\"enter\"]) {\n                  // click on UserTextInput submit button, only ENTER allowed\n                  this.submitButton.click();\n                } else {\n                  // let UI know that we changed the key\n                  if (!this.active && !this.controlElements.active && !this.isControlElementsActiveAndUserInputHidden()) {\n                    // after ui has been selected we RESET the input/filter\n                    this.resetValue();\n                    this.setFocusOnInput();\n                  }\n\n                  this.dispatchKeyChange(value, event.keyCode);\n                }\n              } else {\n                this.dispatchKeyChange(value, event.keyCode);\n              }\n            } else {\n              if (this._currentTag.type == \"group\") {\n                // let the controlements handle action\n                this.dispatchKeyChange(value, event.keyCode);\n              }\n            }\n          } else if (event.keyCode == cf.Dictionary.keyCodes[\"space\"] && document.activeElement) {\n            this.dispatchKeyChange(value, event.keyCode);\n          }\n        }\n      } else if (event.keyCode != cf.Dictionary.keyCodes[\"shift\"] && event.keyCode != cf.Dictionary.keyCodes[\"tab\"]) {\n        this.dispatchKeyChange(value, event.keyCode);\n      }\n\n      this.onInputChange();\n    };\n\n    UserTextInput.prototype.dispatchKeyChange = function (dto, keyCode) {\n      // typing --->\n      this.submitButton.typing = dto.text && dto.text.length > 0;\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.UserInputEvents.KEY_CHANGE, dto);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.KEY_CHANGE, {\n        detail: {\n          dto: dto,\n          keyCode: keyCode,\n          inputFieldActive: this.active\n        }\n      }));\n    };\n\n    UserTextInput.prototype.windowFocus = function (event) {\n      _super.prototype.windowFocus.call(this, event);\n\n      this.setFocusOnInput();\n    };\n\n    UserTextInput.prototype.onInputBlur = function (event) {\n      this._active = false;\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.BLUR));\n    };\n\n    UserTextInput.prototype.onInputFocus = function (event) {\n      this._active = true;\n      this.onInputChange();\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.FOCUS));\n    };\n\n    UserTextInput.prototype.setFocusOnInput = function () {\n      if (!cf.UserInputElement.preventAutoFocus && !this.el.classList.contains(\"hide-input\")) {\n        this.inputElement.focus();\n      }\n    };\n\n    UserTextInput.prototype.onEnterOrSubmitButtonSubmit = function (event) {\n      if (event === void 0) {\n        event = null;\n      }\n\n      var isControlElementsActiveAndUserInputHidden = this.controlElements.active && cf.UserInputElement.hideUserInputOnNoneTextInput;\n\n      if ((this.active || isControlElementsActiveAndUserInputHidden) && this.controlElements.highlighted) {\n        // active input field and focus on control elements happens when a control element is highlighted\n        this.controlElements.clickOnHighlighted();\n      } else {\n        if (!this._currentTag) {\n          // happens when a form is empty, so just play along and submit response to chatlist..\n          this.eventTarget.cf.addUserChatResponse(this.inputElement.value);\n        } else {\n          // we need to check if current tag is file\n          if (this._currentTag.type == \"file\" && event) {\n            // trigger <input type=\"file\" but only when it's from clicking button\n            this.controlElements.getElement(0).triggerFileSelect();\n          } else {\n            // for groups, we expect that there is always a default value set\n            this.doSubmit();\n          }\n        }\n      }\n    };\n\n    UserTextInput.prototype.doSubmit = function () {\n      var dto = this.getFlowDTO();\n      this.submitButton.loading = true;\n      this.disabled = true;\n      this.el.removeAttribute(\"error\");\n      this.inputElement.setAttribute(\"data-value\", \"\");\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.UserInputEvents.SUBMIT, dto);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.SUBMIT, {\n        detail: dto\n      }));\n    };\n\n    UserTextInput.prototype.resetValue = function () {\n      this.inputElement.value = \"\";\n      if (this.inputElement.hasAttribute('rows')) this.inputElement.setAttribute('rows', '1');\n      this.onInputChange();\n    };\n\n    UserTextInput.prototype.dealloc = function () {\n      this.inputElement.removeEventListener('blur', this.onInputBlurCallback, false);\n      this.onInputBlurCallback = null;\n      this.inputElement.removeEventListener('focus', this.onInputFocusCallback, false);\n      this.onInputFocusCallback = null;\n      document.removeEventListener(\"keydown\", this.keyDownCallback, false);\n      this.keyDownCallback = null;\n      document.removeEventListener(\"keyup\", this.keyUpCallback, false);\n      this.keyUpCallback = null;\n      this.eventTarget.removeEventListener(cf.ControlElementEvents.SUBMIT_VALUE, this.onControlElementSubmitCallback, false);\n      this.onControlElementSubmitCallback = null; // remove submit button instance\n\n      this.submitButton.el.removeEventListener(cf.UserInputSubmitButtonEvents.CHANGE, this.onSubmitButtonChangeStateCallback, false);\n      this.onSubmitButtonChangeStateCallback = null;\n      this.submitButton.dealloc();\n      this.submitButton = null;\n\n      _super.prototype.dealloc.call(this);\n    }; // override\n\n\n    UserTextInput.prototype.getTemplate = function () {\n      return this.customTemplate || \"<cf-input>\\n\\t\\t\\t\\t<cf-info></cf-info>\\n\\t\\t\\t\\t<cf-input-control-elements>\\n\\t\\t\\t\\t\\t<cf-list-button direction=\\\"prev\\\">\\n\\t\\t\\t\\t\\t</cf-list-button>\\n\\t\\t\\t\\t\\t<cf-list-button direction=\\\"next\\\">\\n\\t\\t\\t\\t\\t</cf-list-button>\\n\\t\\t\\t\\t\\t<cf-list>\\n\\t\\t\\t\\t\\t</cf-list>\\n\\t\\t\\t\\t</cf-input-control-elements>\\n\\t\\t\\t\\t<div class=\\\"inputWrapper\\\">\\n\\t\\t\\t\\t\\t<textarea type='input' tabindex=\\\"1\\\" rows=\\\"1\\\"></textarea>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</cf-input>\\n\\t\\t\\t\";\n    };\n\n    return UserTextInput;\n  }(cf.UserInputElement);\n\n  cf.UserTextInput = UserTextInput;\n})(cf || (cf = {})); /// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../../logic/Helpers.ts\"/>\n/// <reference path=\"../../ConversationalForm.ts\"/>\n/// <reference path=\"../../interfaces/IUserInterfaceOptions.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics14 = function extendStatics(d, b) {\n    _extendStatics14 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics14(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics14(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  cf.ChatResponseEvents = {\n    USER_ANSWER_CLICKED: \"cf-on-user-answer-clicked\"\n  }; // class\n\n  var ChatResponse =\n  /** @class */\n  function (_super) {\n    __extends(ChatResponse, _super);\n\n    function ChatResponse(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this.container = options.container;\n      _this.uiOptions = options.cfReference.uiOptions;\n      _this._tag = options.tag;\n      return _this;\n    }\n\n    Object.defineProperty(ChatResponse.prototype, \"tag\", {\n      get: function get() {\n        return this._tag;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ChatResponse.prototype, \"added\", {\n      get: function get() {\n        return !!this.el || !!this.el.parentNode || !!this.el.parentNode.parentNode;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ChatResponse.prototype, \"disabled\", {\n      get: function get() {\n        return this.el.classList.contains(\"disabled\");\n      },\n      set: function set(value) {\n        if (value) this.el.classList.add(\"disabled\");else this.el.classList.remove(\"disabled\");\n      },\n      enumerable: true,\n      configurable: true\n    });\n    /**\n     * We depend on scroll in a column-reverse flex container. This is where Edge and Firefox comes up short\n     */\n\n    ChatResponse.prototype.hasFlexBug = function () {\n      return this.cfReference.el.classList.contains('browser-firefox') || this.cfReference.el.classList.contains('browser-edge');\n    };\n\n    ChatResponse.prototype.animateIn = function () {\n      var _this = this;\n\n      var outer = document.querySelector('scrollable');\n      var inner = document.querySelector('.scrollableInner');\n      if (this.hasFlexBug()) inner.classList.remove('scroll');\n      requestAnimationFrame(function () {\n        var height = _this.el.scrollHeight;\n        _this.el.style.height = '0px';\n        requestAnimationFrame(function () {\n          _this.el.style.height = height + 'px';\n\n          _this.el.classList.add('show'); // Listen for transitionend and set to height:auto\n\n\n          try {\n            var sm = window.getComputedStyle(document.querySelectorAll('p.show')[0]);\n            var cssAnimationTime = +sm.animationDuration.replace('s', ''); // format '0.234234xs\n\n            var cssAnimationDelayTime = +sm.animationDelay.replace('s', '');\n            setTimeout(function () {\n              _this.el.style.height = 'auto';\n\n              if (_this.hasFlexBug() && inner.scrollHeight > outer.offsetHeight) {\n                inner.classList.add('scroll');\n                inner.scrollTop = inner.scrollHeight;\n              }\n            }, (cssAnimationTime + cssAnimationDelayTime) * 1500);\n          } catch (err) {\n            // Fallback method. Assuming animations do not take longer than 1000ms\n            setTimeout(function () {\n              if (_this.hasFlexBug() && inner.scrollHeight > outer.offsetHeight) {\n                inner.classList.add('scroll');\n                inner.scrollTop = inner.scrollHeight;\n              }\n\n              _this.el.style.height = 'auto';\n            }, 3000);\n          }\n        });\n      });\n    };\n\n    Object.defineProperty(ChatResponse.prototype, \"visible\", {\n      set: function set(value) {},\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ChatResponse.prototype, \"strippedSesponse\", {\n      get: function get() {\n        var html = this.response; // use browsers native way of stripping\n\n        var div = document.createElement(\"div\");\n        div.innerHTML = html;\n        return div.textContent || div.innerText || \"\";\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    ChatResponse.prototype.whenReady = function (resolve) {\n      this.onReadyCallback = resolve;\n    };\n\n    ChatResponse.prototype.setValue = function (dto) {\n      // if(!this.visible){\n      // \tthis.visible = true;\n      // }\n      if (dto === void 0) {\n        dto = null;\n      }\n\n      var isThinking = this.el.hasAttribute(\"thinking\");\n\n      if (!dto) {\n        this.setToThinking();\n      } else {\n        // same same\n        this.response = this.originalResponse = dto.text;\n        this.processResponseAndSetText();\n\n        if (this.responseLink && !this.isRobotResponse) {\n          // call robot and update for binding values ->\n          this.responseLink.processResponseAndSetText();\n        } // check for if response type is file upload...\n\n\n        if (dto && dto.controlElements && dto.controlElements[0]) {\n          switch (dto.controlElements[0].type) {\n            case \"UploadFileUI\":\n              this.textEl.classList.add(\"file-icon\");\n              break;\n          }\n        }\n\n        if (!this.isRobotResponse && !this.onClickCallback) {\n          // edit\n          this.onClickCallback = this.onClick.bind(this);\n          this.el.addEventListener(cf.Helpers.getMouseEvent(\"click\"), this.onClickCallback, false);\n        }\n      }\n    };\n\n    ChatResponse.prototype.show = function () {\n      this.visible = true;\n      this.disabled = false;\n\n      if (!this.response) {\n        this.setToThinking();\n      } else {\n        this.checkForEditMode();\n      }\n    };\n\n    ChatResponse.prototype.updateThumbnail = function (src) {\n      var thumbEl = this.el.getElementsByTagName(\"thumb\")[0];\n\n      if (src.indexOf(\"text:\") === 0) {\n        var thumbElSpan = thumbEl.getElementsByTagName(\"span\")[0];\n        thumbElSpan.innerHTML = src.split(\"text:\")[1];\n        thumbElSpan.setAttribute(\"length\", src.length.toString());\n      } else {\n        this.image = src;\n        thumbEl.style.backgroundImage = 'url(\"' + this.image + '\")';\n      }\n    };\n\n    ChatResponse.prototype.setLinkToOtherReponse = function (response) {\n      // link reponse to another one, keeping the update circle complete.\n      this.responseLink = response;\n    };\n\n    ChatResponse.prototype.processResponseAndSetText = function () {\n      var _this = this;\n\n      if (!this.originalResponse) return;\n      var innerResponse = this.originalResponse;\n\n      if (this._tag && this._tag.type == \"password\" && !this.isRobotResponse) {\n        var newStr = \"\";\n\n        for (var i_1 = 0; i_1 < innerResponse.length; i_1++) {\n          newStr += \"*\";\n        }\n\n        innerResponse = newStr;\n      } // if robot, then check linked response for binding values\n\n\n      if (this.responseLink && this.isRobotResponse) {\n        // one way data binding values:\n        innerResponse = innerResponse.split(\"{previous-answer}\").join(this.responseLink.parsedResponse);\n      }\n\n      if (this.isRobotResponse) {\n        // Piping, look through IDs, and map values to dynamics\n        var reponses = ChatResponse.list.getResponses();\n\n        for (var i = 0; i < reponses.length; i++) {\n          var response = reponses[i];\n\n          if (response !== this) {\n            if (response.tag) {\n              // check for id, standard\n              if (response.tag.id) {\n                innerResponse = innerResponse.split(\"{\" + response.tag.id + \"}\").join(response.tag.value);\n              } //fallback check for name\n\n\n              if (response.tag.name) {\n                innerResponse = innerResponse.split(\"{\" + response.tag.name + \"}\").join(response.tag.value);\n              }\n            }\n          }\n        }\n      } // check if response contains an image as answer\n\n\n      var responseContains = innerResponse.indexOf(\"contains-image\") != -1;\n      if (responseContains) this.textEl.classList.add(\"contains-image\"); // now set it\n\n      if (this.isRobotResponse) {\n        this.textEl.innerHTML = \"\";\n        if (!this.uiOptions) this.uiOptions = this.cfReference.uiOptions; // On edit uiOptions are empty, so this mitigates the problem. Not ideal.\n\n        var robotInitResponseTime = this.uiOptions.robot.robotResponseTime;\n\n        if (robotInitResponseTime != 0) {\n          this.setToThinking();\n        } // robot response, allow for && for multiple responses\n\n\n        var chainedResponses = innerResponse.split(\"&&\");\n\n        if (robotInitResponseTime === 0) {\n          for (var i_2 = 0; i_2 < chainedResponses.length; i_2++) {\n            var str = chainedResponses[i_2];\n            this.textEl.innerHTML += \"<p>\" + str + \"</p>\";\n          }\n\n          var _loop_1 = function _loop_1(i_3) {\n            setTimeout(function () {\n              _this.tryClearThinking();\n\n              var p = _this.textEl.getElementsByTagName(\"p\");\n\n              p[i_3].classList.add(\"show\");\n\n              _this.scrollTo();\n            }, chainedResponses.length > 1 && i_3 > 0 ? robotInitResponseTime + (i_3 + 1) * this_1.uiOptions.robot.chainedResponseTime : 0);\n          };\n\n          var this_1 = this;\n\n          for (var i_3 = 0; i_3 < chainedResponses.length; i_3++) {\n            _loop_1(i_3);\n          }\n        } else {\n          var _loop_2 = function _loop_2(i_4) {\n            var revealAfter = robotInitResponseTime + i_4 * this_2.uiOptions.robot.chainedResponseTime;\n            var str = chainedResponses[i_4];\n            setTimeout(function () {\n              _this.tryClearThinking();\n\n              _this.textEl.innerHTML += \"<p>\" + str + \"</p>\";\n\n              var p = _this.textEl.getElementsByTagName(\"p\");\n\n              p[i_4].classList.add(\"show\");\n\n              _this.scrollTo();\n            }, revealAfter);\n          };\n\n          var this_2 = this;\n\n          for (var i_4 = 0; i_4 < chainedResponses.length; i_4++) {\n            _loop_2(i_4);\n          }\n        }\n\n        this.readyTimer = setTimeout(function () {\n          if (_this.onReadyCallback) _this.onReadyCallback(); // reset, as it can be called again\n\n          _this.onReadyCallback = null;\n\n          if (_this._tag && _this._tag.skipUserInput === true) {\n            setTimeout(function () {\n              _this._tag.flowManager.nextStep();\n\n              _this._tag.skipUserInput = false; // to avoid nextStep being fired again as this would make the flow jump too far when editing a response\n            }, _this.uiOptions.robot.chainedResponseTime);\n          }\n        }, robotInitResponseTime + chainedResponses.length * this.uiOptions.robot.chainedResponseTime);\n      } else {\n        // user response, act normal\n        this.tryClearThinking();\n        var hasImage = innerResponse.indexOf('<img') > -1;\n        var imageRegex = new RegExp('<img[^>]*?>', 'g');\n        var imageTag = innerResponse.match(imageRegex);\n\n        if (hasImage && imageTag) {\n          innerResponse = innerResponse.replace(imageTag[0], '');\n          this.textEl.innerHTML = \"<p class=\\\"hasImage\\\">\" + imageTag + \"<span>\" + innerResponse + \"</span></p>\";\n        } else {\n          this.textEl.innerHTML = \"<p>\" + innerResponse + \"</p>\";\n        }\n\n        var p = this.textEl.getElementsByTagName(\"p\");\n        p[p.length - 1].offsetWidth;\n        p[p.length - 1].classList.add(\"show\");\n        this.scrollTo();\n      }\n\n      this.parsedResponse = innerResponse; // }\n      // value set, so add element, if not added\n\n      if (this.uiOptions.robot && this.uiOptions.robot.robotResponseTime === 0) {\n        this.addSelf();\n      } else {\n        setTimeout(function () {\n          _this.addSelf();\n        }, 0);\n      } // bounce\n\n\n      this.textEl.removeAttribute(\"value-added\");\n      setTimeout(function () {\n        _this.textEl.setAttribute(\"value-added\", \"\");\n\n        _this.el.classList.add(\"peak-thumb\");\n      }, 0);\n      this.checkForEditMode(); // update response\n      // remove the double ampersands if present\n\n      this.response = innerResponse.split(\"&&\").join(\" \");\n    };\n\n    ChatResponse.prototype.scrollTo = function () {\n      var y = this.el.offsetTop;\n      var h = this.el.offsetHeight;\n      if (!this.container && this.el) this.container = this.el; // On edit this.container is empty so this is a fix to reassign it. Not ideal, but...\n\n      if (this.container && this.container.parentElement && this.container.parentElement.scrollHeight) {\n        this.container.parentElement.scrollTop = y + h + this.container.parentElement.scrollHeight;\n      }\n    };\n\n    ChatResponse.prototype.checkForEditMode = function () {\n      if (!this.isRobotResponse && !this.el.hasAttribute(\"thinking\")) {\n        this.el.classList.add(\"can-edit\");\n        this.disabled = false;\n      }\n    };\n\n    ChatResponse.prototype.tryClearThinking = function () {\n      if (this.el.hasAttribute(\"thinking\")) {\n        this.textEl.innerHTML = \"\";\n        this.el.removeAttribute(\"thinking\");\n      }\n    };\n\n    ChatResponse.prototype.setToThinking = function () {\n      var canShowThinking = this.isRobotResponse && this.uiOptions.robot.robotResponseTime !== 0 || !this.isRobotResponse && this.cfReference.uiOptions.user.showThinking && !this._tag.skipUserInput;\n\n      if (canShowThinking) {\n        this.textEl.innerHTML = ChatResponse.THINKING_MARKUP;\n        this.el.classList.remove(\"can-edit\");\n        this.el.setAttribute(\"thinking\", \"\");\n      }\n\n      if (this.cfReference.uiOptions.user.showThinking || this.cfReference.uiOptions.user.showThumb) {\n        this.addSelf();\n      }\n    };\n    /**\n    * @name addSelf\n    * add one self to the chat list\n    */\n\n\n    ChatResponse.prototype.addSelf = function () {\n      if (this.el.parentNode != this.container) {\n        this.container.appendChild(this.el);\n        this.animateIn();\n      }\n    };\n    /**\n    * @name onClickCallback\n    * click handler for el\n    */\n\n\n    ChatResponse.prototype.onClick = function (event) {\n      this.setToThinking();\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ChatResponseEvents.USER_ANSWER_CLICKED, event);\n      this.eventTarget.dispatchEvent(new CustomEvent(cf.ChatResponseEvents.USER_ANSWER_CLICKED, {\n        detail: this._tag\n      }));\n    };\n\n    ChatResponse.prototype.setData = function (options) {\n      this.image = options.image;\n      this.response = this.originalResponse = options.response;\n      this.isRobotResponse = options.isRobotResponse;\n\n      _super.prototype.setData.call(this, options);\n    };\n\n    ChatResponse.prototype.onElementCreated = function () {\n      var _this = this;\n\n      this.textEl = this.el.getElementsByTagName(\"text\")[0];\n      this.updateThumbnail(this.image);\n\n      if (this.isRobotResponse || this.response != null) {\n        // Robot is pseudo thinking, can also be user -->\n        // , but if addUserChatResponse is called from ConversationalForm, then the value is there, therefore skip ...\n        setTimeout(function () {\n          _this.setValue({\n            text: _this.response\n          });\n        }, 0); //ConversationalForm.animationsEnabled ? Helpers.lerp(Math.random(), 500, 900) : 0);\n      } else {\n        if (this.cfReference.uiOptions.user.showThumb) {\n          this.el.classList.add(\"peak-thumb\");\n        }\n      }\n    };\n\n    ChatResponse.prototype.dealloc = function () {\n      clearTimeout(this.readyTimer);\n      this.container = null;\n      this.uiOptions = null;\n      this.onReadyCallback = null;\n\n      if (this.onClickCallback) {\n        this.el.removeEventListener(cf.Helpers.getMouseEvent(\"click\"), this.onClickCallback, false);\n        this.onClickCallback = null;\n      }\n\n      _super.prototype.dealloc.call(this);\n    }; // template, can be overwritten ...\n\n\n    ChatResponse.prototype.getTemplate = function () {\n      return \"<cf-chat-response class=\\\"\" + (this.isRobotResponse ? \"robot\" : \"user\") + \"\\\">\\n\\t\\t\\t\\t<thumb><span></span></thumb>\\n\\t\\t\\t\\t<text></text>\\n\\t\\t\\t</cf-chat-response>\";\n    };\n\n    ChatResponse.THINKING_MARKUP = \"<p class='show'><thinking><span>.</span><span>.</span><span>.</span></thinking></p>\";\n    return ChatResponse;\n  }(cf.BasicElement);\n\n  cf.ChatResponse = ChatResponse;\n})(cf || (cf = {})); /// <reference path=\"ChatResponse.ts\"/>\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics15 = function extendStatics(d, b) {\n    _extendStatics15 = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics15(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics15(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // namespace\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  cf.ChatListEvents = {\n    CHATLIST_UPDATED: \"cf-chatlist-updated\"\n  }; // class\n\n  var ChatList =\n  /** @class */\n  function (_super) {\n    __extends(ChatList, _super);\n\n    function ChatList(options) {\n      var _this = _super.call(this, options) || this;\n\n      _this.updateTimer = 0;\n      cf.ChatResponse.list = _this;\n      _this.responses = []; // flow update\n\n      _this.flowUpdateCallback = _this.onFlowUpdate.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, _this.flowUpdateCallback, false); // user input update\n\n\n      _this.userInputUpdateCallback = _this.onUserInputUpdate.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.FlowEvents.USER_INPUT_UPDATE, _this.userInputUpdateCallback, false); // user input key change\n\n\n      _this.onInputKeyChangeCallback = _this.onInputKeyChange.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.UserInputEvents.KEY_CHANGE, _this.onInputKeyChangeCallback, false); // user input height change\n\n\n      _this.onInputHeightChangeCallback = _this.onInputHeightChange.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.UserInputEvents.HEIGHT_CHANGE, _this.onInputHeightChangeCallback, false); // on control elements changed\n\n\n      _this.onControlElementsResizedCallback = _this.onControlElementsResized.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.ControlElementsEvents.ON_RESIZE, _this.onControlElementsResizedCallback, false);\n\n      _this.onControlElementsChangedCallback = _this.onControlElementsChanged.bind(_this);\n\n      _this.eventTarget.addEventListener(cf.ControlElementsEvents.CHANGED, _this.onControlElementsChangedCallback, false);\n\n      return _this;\n    }\n\n    ChatList.prototype.onInputHeightChange = function (event) {\n      var dto = event.detail.dto;\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, dto); // this.input.controlElements.el.style.transition = \"height 2s ease-out\";\n      // this.input.controlElements.el.style.height = this.input.controlElements.el.scrollHeight + 'px';\n\n      this.onInputElementChanged();\n    };\n\n    ChatList.prototype.onInputKeyChange = function (event) {\n      var dto = event.detail.dto;\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, dto);\n    };\n\n    ChatList.prototype.onUserInputUpdate = function (event) {\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n\n      if (this.currentUserResponse) {\n        var response = event.detail;\n        this.setCurrentUserResponse(response);\n      }\n    };\n\n    ChatList.prototype.addInput = function (input) {\n      this.input = input;\n    };\n    /**\n    * @name onControlElementsChanged\n    * on control elements change\n    */\n\n\n    ChatList.prototype.onControlElementsChanged = function (event) {\n      this.onInputElementChanged();\n    };\n    /**\n    * @name onControlElementsResized\n    * on control elements resize\n    */\n\n\n    ChatList.prototype.onControlElementsResized = function (event) {\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", cf.ControlElementsEvents.ON_RESIZE);\n      var responseToScrollTo = this.currentResponse;\n\n      if (responseToScrollTo) {\n        if (!responseToScrollTo.added) {\n          // element not added yet, so find closest\n          for (var i = this.responses.indexOf(responseToScrollTo); i >= 0; i--) {\n            var element = this.responses[i];\n\n            if (element.added) {\n              responseToScrollTo = element;\n              break;\n            }\n          }\n        }\n\n        responseToScrollTo.scrollTo();\n      }\n\n      this.onInputElementChanged();\n    };\n\n    ChatList.prototype.onInputElementChanged = function () {\n      if (!this.cfReference || !this.cfReference.el) return;\n      var cfHeight = this.cfReference.el.offsetHeight;\n      var inputHeight = this.input.height;\n      var listHeight = cfHeight - inputHeight; //this.el.style.height = listHeight + \"px\";\n    };\n\n    ChatList.prototype.onFlowUpdate = function (event) {\n      var _this = this;\n\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n      var currentTag = event.detail.tag;\n      if (this.currentResponse) this.currentResponse.disabled = false;\n\n      if (this.containsTagResponse(currentTag) && !event.detail.ignoreExistingTag) {\n        // because user maybe have scrolled up and wants to edit\n        // tag is already in list, so re-activate it\n        this.onUserWantsToEditTag(currentTag);\n      } else {\n        // robot response\n        setTimeout(function () {\n          var robot = _this.createResponse(true, currentTag, currentTag.question);\n\n          robot.whenReady(function () {\n            // create user response\n            _this.currentUserResponse = _this.createResponse(false, currentTag);\n            robot.scrollTo();\n          });\n\n          if (_this.currentUserResponse) {\n            // linked, but only if we should not ignore existing tag\n            _this.currentUserResponse.setLinkToOtherReponse(robot);\n\n            robot.setLinkToOtherReponse(_this.currentUserResponse);\n          }\n        }, this.responses.length === 0 ? 500 : 0);\n      }\n    };\n    /**\n    * @name containsTagResponse\n    * @return boolean\n    * check if tag has already been responded to\n    */\n\n\n    ChatList.prototype.containsTagResponse = function (tagToChange) {\n      for (var i = 0; i < this.responses.length; i++) {\n        var element = this.responses[i];\n\n        if (!element.isRobotResponse && element.tag == tagToChange && !tagToChange.hasConditions()) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n    /**\n    * @name onUserAnswerClicked\n    * on user ChatReponse clicked\n    */\n\n\n    ChatList.prototype.onUserWantsToEditTag = function (tagToChange) {\n      var responseUserWantsToEdit;\n\n      for (var i = 0; i < this.responses.length; i++) {\n        var element = this.responses[i];\n\n        if (!element.isRobotResponse && element.tag == tagToChange) {\n          // update element thhat user wants to edit\n          responseUserWantsToEdit = element;\n          break;\n        }\n      } // reset the current user response\n\n\n      this.currentUserResponse.processResponseAndSetText();\n\n      if (responseUserWantsToEdit) {\n        // remove latest user response, if it is there any, also make sure we don't remove the first one\n        if (this.responses.length > 2) {\n          if (!this.responses[this.responses.length - 1].isRobotResponse) {\n            this.responses.pop().dealloc();\n          } // remove latest robot response, it should always be a robot response\n\n\n          this.responses.pop().dealloc();\n        }\n\n        this.currentUserResponse = responseUserWantsToEdit; // TODO: Set user field to thinking?\n        // this.currentUserResponse.setToThinking??\n\n        this.currentResponse = this.responses[this.responses.length - 1];\n        this.onListUpdate(this.currentUserResponse);\n      }\n    };\n\n    ChatList.prototype.onListUpdate = function (chatResponse) {\n      var _this = this;\n\n      clearTimeout(this.updateTimer);\n      this.updateTimer = setTimeout(function () {\n        _this.eventTarget.dispatchEvent(new CustomEvent(cf.ChatListEvents.CHATLIST_UPDATED, {\n          detail: _this\n        }));\n\n        chatResponse.show();\n      }, 0);\n    };\n    /**\n    * @name clearFrom\n    * remove responses, this usually happens if a user jumps back to a conditional element\n    */\n\n\n    ChatList.prototype.clearFrom = function (index) {\n      index = index * 2; // double up because of robot responses\n\n      index += index % 2; // round up so we dont remove the user response element\n\n      while (this.responses.length > index) {\n        this.responses.pop().dealloc();\n      }\n    };\n    /**\n    * @name setCurrentUserResponse\n    * Update current reponse, is being called automatically from onFlowUpdate, but can also, in rare cases, be called when flow is controlled manually.\n    * reponse: FlowDTO\n    */\n\n\n    ChatList.prototype.setCurrentUserResponse = function (dto) {\n      this.flowDTOFromUserInputUpdate = dto;\n\n      if (!this.flowDTOFromUserInputUpdate.text && dto.tag) {\n        if (dto.tag.type == \"group\") {\n          this.flowDTOFromUserInputUpdate.text = cf.Dictionary.get(\"user-reponse-missing-group\");\n        } else if (dto.tag.type != \"password\") {\n          this.flowDTOFromUserInputUpdate.text = cf.Dictionary.get(\"user-reponse-missing\");\n        }\n      }\n\n      this.currentUserResponse.setValue(this.flowDTOFromUserInputUpdate);\n    };\n    /**\n    * @name getResponses\n    * returns the submitted responses.\n    */\n\n\n    ChatList.prototype.getResponses = function () {\n      return this.responses;\n    };\n\n    ChatList.prototype.updateThumbnail = function (robot, img) {\n      cf.Dictionary.set(robot ? \"robot-image\" : \"user-image\", robot ? \"robot\" : \"human\", img);\n      var newImage = robot ? cf.Dictionary.getRobotResponse(\"robot-image\") : cf.Dictionary.get(\"user-image\");\n\n      for (var i = 0; i < this.responses.length; i++) {\n        var element = this.responses[i];\n\n        if (robot && element.isRobotResponse) {\n          element.updateThumbnail(newImage);\n        } else if (!robot && !element.isRobotResponse) {\n          element.updateThumbnail(newImage);\n        }\n      }\n    };\n\n    ChatList.prototype.createResponse = function (isRobotResponse, currentTag, value) {\n      if (value === void 0) {\n        value = null;\n      }\n\n      var scrollable = this.el.querySelector(\".scrollableInner\");\n      var response = new cf.ChatResponse({\n        // image: null,\n        cfReference: this.cfReference,\n        list: this,\n        tag: currentTag,\n        eventTarget: this.eventTarget,\n        isRobotResponse: isRobotResponse,\n        response: value,\n        image: isRobotResponse ? cf.Dictionary.getRobotResponse(\"robot-image\") : cf.Dictionary.get(\"user-image\"),\n        container: scrollable\n      });\n      this.responses.push(response);\n      this.currentResponse = response;\n      this.onListUpdate(response);\n      return response;\n    };\n\n    ChatList.prototype.getTemplate = function () {\n      return \"<cf-chat type='pluto'>\\n\\t\\t\\t\\t\\t\\t<scrollable>\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"scrollableInner\\\"></div>\\n\\t\\t\\t\\t\\t\\t</scrollable>\\n\\t\\t\\t\\t\\t</cf-chat>\";\n    };\n\n    ChatList.prototype.dealloc = function () {\n      this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n      this.flowUpdateCallback = null;\n      this.eventTarget.removeEventListener(cf.FlowEvents.USER_INPUT_UPDATE, this.userInputUpdateCallback, false);\n      this.userInputUpdateCallback = null;\n      this.eventTarget.removeEventListener(cf.UserInputEvents.KEY_CHANGE, this.onInputKeyChangeCallback, false);\n      this.onInputKeyChangeCallback = null;\n\n      _super.prototype.dealloc.call(this);\n    };\n\n    return ChatList;\n  }(cf.BasicElement);\n\n  cf.ChatList = ChatList;\n})(cf || (cf = {})); /// <reference path=\"../form-tags/Tag.ts\"/>\n/// <reference path=\"../ConversationalForm.ts\"/>\n\n\nvar cf;\n\n(function (cf) {\n  // interface\n  cf.FlowEvents = {\n    USER_INPUT_UPDATE: \"cf-flow-user-input-update\",\n    USER_INPUT_INVALID: \"cf-flow-user-input-invalid\",\n    //\tdetail: string\n    FLOW_UPDATE: \"cf-flow-update\",\n    FORM_SUBMIT: \"cf-form-submit\"\n  }; // class\n\n  var FlowManager =\n  /** @class */\n  function () {\n    function FlowManager(options) {\n      this.stopped = false;\n      this.maxSteps = 0;\n      this.step = 0;\n      this.savedStep = -1;\n      this.stepTimer = 0;\n      /**\n      * ignoreExistingTags\n      * @type boolean\n      * ignore existing tags, usually this is set to true when using startFrom, where you don't want it to check for exisintg tags in the list\n      */\n\n      this.ignoreExistingTags = false;\n      this.cfReference = options.cfReference;\n      this.eventTarget = options.eventTarget;\n      this.flowStepCallback = options.flowStepCallback;\n      this.setTags(options.tags);\n      this.userInputSubmitCallback = this.userInputSubmit.bind(this);\n      this.eventTarget.addEventListener(cf.UserInputEvents.SUBMIT, this.userInputSubmitCallback, false);\n    }\n\n    Object.defineProperty(FlowManager.prototype, \"currentTag\", {\n      get: function get() {\n        return this.tags[this.step];\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    FlowManager.prototype.userInputSubmit = function (event) {\n      var _this = this;\n\n      cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n      var appDTO = event.detail;\n      if (!appDTO.tag) appDTO.tag = this.currentTag;\n      var isTagValid = this.currentTag.setTagValueAndIsValid(appDTO);\n      var hasCheckedForTagSpecificValidation = false;\n      var hasCheckedForGlobalFlowValidation = false;\n\n      var onValidationCallback = function onValidationCallback() {\n        // check 1\n        if (_this.currentTag.validationCallback && typeof _this.currentTag.validationCallback == \"function\") {\n          if (!hasCheckedForTagSpecificValidation && isTagValid) {\n            hasCheckedForTagSpecificValidation = true;\n\n            _this.currentTag.validationCallback(appDTO, function () {\n              isTagValid = true;\n              onValidationCallback();\n            }, function (optionalErrorMessage) {\n              isTagValid = false;\n              if (optionalErrorMessage) appDTO.errorText = optionalErrorMessage;\n              onValidationCallback();\n            });\n\n            return;\n          }\n        } // check 2, this.currentTag.required <- required should be handled in the callback.\n\n\n        if (_this.flowStepCallback && typeof _this.flowStepCallback == \"function\") {\n          if (!hasCheckedForGlobalFlowValidation && isTagValid) {\n            hasCheckedForGlobalFlowValidation = true; // use global validationCallback method\n\n            _this.flowStepCallback(appDTO, function () {\n              isTagValid = true;\n              onValidationCallback();\n            }, function (optionalErrorMessage) {\n              isTagValid = false;\n              if (optionalErrorMessage) appDTO.errorText = optionalErrorMessage;\n              onValidationCallback();\n            });\n\n            return;\n          }\n        } // go on with the flow\n\n\n        if (isTagValid) {\n          // do the normal flow..\n          cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.FlowEvents.USER_INPUT_UPDATE, appDTO); // update to latest DTO because values can be changed in validation flow...\n\n          if (appDTO.input) appDTO = appDTO.input.getFlowDTO();\n\n          _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_UPDATE, {\n            detail: appDTO //UserTextInput value\n\n          })); // goto next step when user has answered\n\n\n          setTimeout(function () {\n            return _this.nextStep();\n          }, cf.ConversationalForm.animationsEnabled ? 250 : 0);\n        } else {\n          cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.FlowEvents.USER_INPUT_INVALID, appDTO); // Value not valid\n\n          _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n            detail: appDTO //UserTextInput value\n\n          }));\n        }\n      }; // TODO, make into promises when IE is rolling with it..\n\n\n      onValidationCallback();\n    };\n\n    FlowManager.prototype.startFrom = function (indexOrTag, ignoreExistingTags) {\n      if (ignoreExistingTags === void 0) {\n        ignoreExistingTags = false;\n      }\n\n      if (typeof indexOrTag == \"number\") this.step = indexOrTag;else {\n        // find the index..\n        this.step = this.tags.indexOf(indexOrTag);\n      }\n      this.ignoreExistingTags = ignoreExistingTags;\n\n      if (!this.ignoreExistingTags) {\n        this.editTag(this.tags[this.step]);\n      } else {\n        //validate step, and ask for skipping of current step\n        this.showStep();\n      }\n    };\n\n    FlowManager.prototype.areConditionsInFlowFullfilled = function (tagWithConditions, tagConditions) {\n      if (!this.activeConditions) {\n        // we don't use this (yet), it's only to keep track of active conditions\n        this.activeConditions = [];\n      }\n\n      var numConditionsFound = 0; // find out if tagWithConditions fullfills conditions\n\n      for (var i = 0; i < this.tags.length; i++) {\n        var tag = this.tags[i];\n\n        if (tag !== tagWithConditions) {\n          // check if tags are fullfilled\n          for (var j = 0; j < tagConditions.length; j++) {\n            var tagCondition = tagConditions[j]; // only check tags where tag id or name is defined\n\n            var tagName = (tag.name || tag.id || \"\").toLowerCase();\n\n            if (tagName !== \"\" && \"cf-conditional-\" + tagName === tagCondition.key.toLowerCase()) {\n              // key found, so check condition\n              var flowTagValue = typeof tag.value === \"string\" ? tag.value : tag.value;\n              var areConditionsMeet = cf.Tag.testConditions(flowTagValue, tagCondition);\n\n              if (areConditionsMeet) {\n                this.activeConditions[tagName] = tagConditions; // conditions are meet\n\n                if (++numConditionsFound == tagConditions.length) {\n                  return true;\n                }\n              }\n            }\n          }\n        }\n      }\n\n      return false;\n    };\n\n    FlowManager.prototype.start = function () {\n      this.stopped = false;\n      this.validateStepAndUpdate();\n    };\n\n    FlowManager.prototype.stop = function () {\n      this.stopped = true;\n    };\n\n    FlowManager.prototype.nextStep = function () {\n      if (this.stopped) return;\n\n      if (this.savedStep != -1) {\n        // if you are looking for where the none EDIT tag conditionsl check is done\n        // then look at a tags disabled getter\n        var foundConditionsToCurrentTag = false; // this happens when editing a tag..\n        // check if any tags has a conditional check for this.currentTag.name\n\n        for (var i = 0; i < this.tags.length; i++) {\n          var tag = this.tags[i];\n\n          if (tag !== this.currentTag && tag.hasConditions()) {\n            // tag has conditions so check if it also has the right conditions\n            if (tag.hasConditionsFor(this.currentTag.name)) {\n              foundConditionsToCurrentTag = true;\n              this.step = this.tags.indexOf(this.currentTag);\n              break;\n            }\n          }\n        } // no conditional linking found, so resume flow\n\n\n        if (!foundConditionsToCurrentTag) {\n          this.step = this.savedStep;\n        }\n      }\n\n      this.savedStep = -1; //reset saved step\n\n      this.step++;\n      this.validateStepAndUpdate();\n    };\n\n    FlowManager.prototype.previousStep = function () {\n      this.step--;\n      this.validateStepAndUpdate();\n    };\n\n    FlowManager.prototype.getStep = function () {\n      return this.step;\n    };\n\n    FlowManager.prototype.addTags = function (tags, atIndex) {\n      if (atIndex === void 0) {\n        atIndex = -1;\n      } // used to append new tag\n\n\n      if (atIndex !== -1 && atIndex < this.tags.length) {\n        var pre = this.tags.slice(0, atIndex);\n        var post = this.tags.slice(atIndex, this.tags.length);\n        this.tags = this.tags.slice(0, atIndex).concat(tags).concat(post);\n      } else {\n        this.tags = this.tags.concat(tags);\n      }\n\n      this.setTags(this.tags);\n      return this.tags;\n    };\n\n    FlowManager.prototype.dealloc = function () {\n      this.eventTarget.removeEventListener(cf.UserInputEvents.SUBMIT, this.userInputSubmitCallback, false);\n      this.userInputSubmitCallback = null;\n    };\n    /**\n    * @name editTag\n    * go back in time and edit a tag.\n    */\n\n\n    FlowManager.prototype.editTag = function (tag) {\n      this.ignoreExistingTags = false;\n      this.savedStep = this.step - 1; //save step\n\n      this.step = this.tags.indexOf(tag); // === this.currentTag\n\n      this.validateStepAndUpdate();\n\n      if (this.activeConditions && Object.keys(this.activeConditions).length > 0) {\n        this.savedStep = -1; //don't save step, as we wont return\n        // clear chatlist.\n\n        this.cfReference.chatList.clearFrom(this.step + 1); //reset from active tag, brute force\n\n        var editTagIndex = this.tags.indexOf(tag);\n\n        for (var i = editTagIndex + 1; i < this.tags.length; i++) {\n          var tag_1 = this.tags[i];\n          tag_1.reset();\n        }\n      }\n    };\n\n    FlowManager.prototype.setTags = function (tags) {\n      this.tags = tags;\n\n      for (var i = 0; i < this.tags.length; i++) {\n        var tag = this.tags[i];\n        tag.eventTarget = this.eventTarget;\n        tag.flowManager = this;\n      }\n\n      this.maxSteps = this.tags.length;\n    };\n\n    FlowManager.prototype.skipStep = function () {\n      this.nextStep();\n    };\n\n    FlowManager.prototype.validateStepAndUpdate = function () {\n      if (this.maxSteps > 0) {\n        if (this.step == this.maxSteps) {\n          // console.warn(\"We are at the end..., submit click\")\n          this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.FORM_SUBMIT, {}));\n          this.cfReference.doSubmitForm();\n        } else {\n          this.step %= this.maxSteps;\n\n          if (this.currentTag.disabled) {\n            // check if current tag has become or is disabled, if it is, then skip step.\n            this.skipStep();\n          } else {\n            this.showStep();\n          }\n        }\n      }\n    };\n\n    FlowManager.prototype.showStep = function () {\n      var _this = this;\n\n      if (this.stopped) return;\n      cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.FlowEvents.FLOW_UPDATE, this.currentTag);\n      this.currentTag.refresh();\n      setTimeout(function () {\n        _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.FLOW_UPDATE, {\n          detail: {\n            tag: _this.currentTag,\n            ignoreExistingTag: _this.ignoreExistingTags,\n            step: _this.step,\n            maxSteps: _this.maxSteps\n          }\n        }));\n      }, 0);\n    };\n\n    FlowManager.STEP_TIME = 1000;\n    return FlowManager;\n  }();\n\n  cf.FlowManager = FlowManager;\n})(cf || (cf = {})); /// <reference path=\"ui/inputs/UserTextInput.ts\"/>\n/// <reference path=\"ui/chat/ChatList.ts\"/>\n/// <reference path=\"logic/FlowManager.ts\"/>\n/// <reference path=\"ui/ProgressBar.ts\"/>\n/// <reference path=\"logic/EventDispatcher.ts\"/>\n/// <reference path=\"form-tags/Tag.ts\"/>\n/// <reference path=\"form-tags/CfRobotMessageTag.ts\"/>\n/// <reference path=\"form-tags/TagGroup.ts\"/>\n/// <reference path=\"form-tags/InputTag.ts\"/>\n/// <reference path=\"form-tags/SelectTag.ts\"/>\n/// <reference path=\"form-tags/ButtonTag.ts\"/>\n/// <reference path=\"data/Dictionary.ts\"/>\n/// <reference path=\"parsing/TagsParser.ts\"/>\n/// <reference path=\"interfaces/IUserInput.ts\"/>\n/// <reference path=\"interfaces/IUserInterfaceOptions.ts\"/>\n\n\nvar cf;\n\n(function (cf_1) {\n  var ConversationalForm =\n  /** @class */\n  function () {\n    function ConversationalForm(options) {\n      this.version = \"1.0.2\";\n      this.cdnPath = \"https://cdn.jsdelivr.net/gh/space10-community/conversational-form@{version}/dist/\";\n      this.isDevelopment = false;\n      this.loadExternalStyleSheet = true;\n      this.theme = 'light';\n      this.preventAutoAppend = false;\n      this.preventAutoStart = false;\n      window.ConversationalForm = this;\n      this.cdnPath = this.cdnPath.split(\"{version}\").join(this.version);\n      if (typeof options.suppressLog === 'boolean') ConversationalForm.suppressLog = options.suppressLog;\n      if (typeof options.showProgressBar === 'boolean') ConversationalForm.showProgressBar = options.showProgressBar;\n      if (typeof options.preventSubmitOnEnter === 'boolean') this.preventSubmitOnEnter = options.preventSubmitOnEnter;\n      if (!ConversationalForm.suppressLog) console.log('Conversational Form > version:', this.version);\n      if (!ConversationalForm.suppressLog) console.log('Conversational Form > options:', options);\n      window.ConversationalForm[this.createId] = this; // possible to create your own event dispatcher, so you can tap into the events of the app\n\n      if (options.eventDispatcher) this._eventTarget = options.eventDispatcher;\n      if (!this.eventTarget.cf) this.eventTarget.cf = this; // set a general step validation callback\n\n      if (options.flowStepCallback) this.flowStepCallback = options.flowStepCallback;\n      this.isDevelopment = ConversationalForm.illustrateAppFlow = !!document.getElementById(\"conversational-form-development\");\n\n      if (options.loadExternalStyleSheet == false) {\n        this.loadExternalStyleSheet = false;\n      }\n\n      if (typeof options.theme === 'string') this.theme = options.theme;\n      if (!isNaN(options.scrollAcceleration)) cf_1.ScrollController.acceleration = options.scrollAcceleration;\n      this.preventAutoStart = options.preventAutoStart;\n      this.preventAutoAppend = options.preventAutoAppend;\n      if (!options.formEl) throw new Error(\"Conversational Form error, the formEl needs to be defined.\");\n      this.formEl = options.formEl;\n      this.formEl.setAttribute(\"cf-create-id\", this.createId);\n\n      if (options.hideUserInputOnNoneTextInput === true) {\n        cf_1.UserInputElement.hideUserInputOnNoneTextInput = true;\n      }\n\n      this.submitCallback = options.submitCallback;\n\n      if (this.submitCallback && typeof this.submitCallback === \"string\") {\n        // Must be a string on window, rewritten to avoid unsafe eval() calls\n        var fn = window[this.submitCallback];\n        this.submitCallback = fn;\n      }\n\n      if (this.formEl.getAttribute(\"cf-no-animation\") == \"\") ConversationalForm.animationsEnabled = false;\n\n      if (typeof options.animationsEnabled === 'boolean' && options.animationsEnabled === false) {\n        ConversationalForm.animationsEnabled = false;\n        this.formEl.setAttribute(\"cf-no-animation\", \"\");\n      }\n\n      if (options.preventAutoFocus || this.formEl.getAttribute(\"cf-prevent-autofocus\") == \"\") cf_1.UserInputElement.preventAutoFocus = true;\n      this.dictionary = new cf_1.Dictionary({\n        data: options.dictionaryData,\n        robotData: options.dictionaryRobot,\n        userImage: options.userImage,\n        robotImage: options.robotImage,\n        version: this.version\n      });\n      this.context = options.context ? options.context : document.body;\n      this.tags = options.tags;\n\n      if (options.microphoneInput) {\n        // validate the user ..... TODO....\n        if (!options.microphoneInput.init || !options.microphoneInput.input) {\n          console.warn(\"Conversational Form: microphoneInput is not correctly setup\", options.microphoneInput);\n          options.microphoneInput = null;\n        }\n      }\n\n      this.microphoneInputObj = options.microphoneInput; // set the ui options\n\n      this.uiOptions = cf_1.Helpers.extendObject(cf_1.UserInterfaceDefaultOptions, options.userInterfaceOptions || {}); // console.log('this.uiOptions:', this.uiOptions);\n\n      this.options = options;\n      this.init();\n    }\n\n    Object.defineProperty(ConversationalForm.prototype, \"createId\", {\n      get: function get() {\n        if (!this._createId) {\n          this._createId = new Date().getTime().toString();\n        }\n\n        return this._createId;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(ConversationalForm.prototype, \"eventTarget\", {\n      get: function get() {\n        if (!this._eventTarget) {\n          this._eventTarget = new cf_1.EventDispatcher(this);\n        }\n\n        return this._eventTarget;\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    ConversationalForm.prototype.init = function () {\n      switch (this.theme) {\n        case 'dark':\n          this.theme = 'conversational-form-dark.min.css';\n          if (!this.options.robotImage) this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%233A3A3C'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%23E5E6EA'/%3E%3C/svg%3E%0A\");\n          if (!this.options.userImage) this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23E5E6EA'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%233A3A3C'/%3E%3C/svg%3E%0A\");\n          break;\n\n        case 'green':\n          this.theme = 'conversational-form-green.min.css';\n          if (!this.options.robotImage) this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23EEEFF0'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%2300BF75'/%3E%3C/svg%3E%0A\");\n          if (!this.options.userImage) this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%2300BF75'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23EEEFF0'/%3E%3C/svg%3E%0A\");\n          break;\n\n        case 'blue':\n          this.theme = 'conversational-form-irisblue.min.css';\n          if (!this.options.robotImage) this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23E8E9EB'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%2300C2DF'/%3E%3C/svg%3E%0A\");\n          if (!this.options.userImage) this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%2300C2DF'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23E8E9EB'/%3E%3C/svg%3E%0A\");\n          break;\n\n        case 'purple':\n          this.theme = 'conversational-form-purple.min.css';\n          if (!this.options.robotImage) this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23EEEFF0'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%235A1DE4'/%3E%3C/svg%3E%0A\");\n          if (!this.options.userImage) this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%235A1DE4'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23EEEFF0'/%3E%3C/svg%3E%0A\");\n          break;\n\n        case 'red':\n          this.theme = 'conversational-form-red.min.css';\n          if (!this.options.robotImage) this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23E8E9EB'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%23FF3233'/%3E%3C/svg%3E%0A\");\n          if (!this.options.userImage) this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23FF3233'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23E8E9EB'/%3E%3C/svg%3E%0A\");\n          break;\n\n        default:\n          this.theme = 'conversational-form.min.css';\n      }\n\n      if (this.isDevelopment) {\n        // Set path for development\n        this.cdnPath = '../build/'; // strip .min from filename since we do not have minified css in build\n\n        this.theme = this.theme.replace('.min', '');\n      }\n\n      if (this.loadExternalStyleSheet) {\n        // not in development/examples, so inject production css\n        var head = document.head || document.getElementsByTagName(\"head\")[0];\n        var style = document.createElement(\"link\");\n        var githubMasterUrl = this.cdnPath + this.theme;\n        style.type = \"text/css\";\n        style.media = \"all\";\n        style.setAttribute(\"rel\", \"stylesheet\");\n        style.setAttribute(\"href\", githubMasterUrl);\n        head.appendChild(style);\n      } // set context position to relative, else we break out of the box\n\n\n      var position = window.getComputedStyle(this.context).getPropertyValue(\"position\").toLowerCase();\n\n      if ([\"fixed\", \"absolute\", \"relative\"].indexOf(position) == -1) {\n        this.context.style.position = \"relative\";\n      } // if tags are not defined then we will try and build some tags our selves..\n\n\n      if (!this.tags || this.tags.length == 0) {\n        this.tags = [];\n        var fields = [].slice.call(this.formEl.querySelectorAll(\"input, select, button, textarea, cf-robot-message\"), 0);\n\n        for (var i = 0; i < fields.length; i++) {\n          var element = fields[i];\n\n          if (cf_1.Tag.isTagValid(element)) {\n            // ignore hidden tags\n            this.tags.push(cf_1.Tag.createTag(element));\n          }\n        }\n      } else {// tags are manually setup and passed as options.tags.\n      } // remove invalid tags if they've sneaked in.. this could happen if tags are setup manually as we don't encurage to use static Tag.isTagValid\n\n\n      var indexesToRemove = [];\n\n      for (var i = 0; i < this.tags.length; i++) {\n        var element = this.tags[i];\n\n        if (!element || !cf_1.Tag.isTagValid(element.domElement)) {\n          indexesToRemove.push(element);\n        }\n      }\n\n      for (var i = 0; i < indexesToRemove.length; i++) {\n        var tag = indexesToRemove[i];\n        this.tags.splice(this.tags.indexOf(tag), 1);\n      }\n\n      if (!ConversationalForm.suppressLog && (!this.tags || this.tags.length == 0)) {\n        console.warn(\"Conversational Form: No tags found or registered.\");\n      } //let's start the conversation\n\n\n      this.tags = this.setupTagGroups(this.tags);\n      this.setupUI();\n      return this;\n    };\n    /**\n    * @name updateDictionaryValue\n    * set a dictionary value at \"runtime\"\n    *\tid: string, id of the value to update\n    *\ttype: string, \"human\" || \"robot\"\n    *\tvalue: string, value to be inserted\n    */\n\n\n    ConversationalForm.prototype.updateDictionaryValue = function (id, type, value) {\n      cf_1.Dictionary.set(id, type, value); // if([\"robot-image\", \"user-image\"].indexOf(id) != -1){\n      // \tthis.chatList.updateThumbnail(id == \"robot-image\", value);\n      // }\n    };\n\n    ConversationalForm.prototype.getFormData = function (serialized) {\n      if (serialized === void 0) {\n        serialized = false;\n      }\n\n      if (serialized) {\n        var serialized_1 = {};\n\n        for (var i = 0; i < this.tags.length; i++) {\n          var element = this.tags[i];\n          if (element.value) serialized_1[element.name || \"tag-\" + i.toString()] = element.value;\n        }\n\n        return serialized_1;\n      } else {\n        var formData = new FormData(this.formEl);\n        return formData;\n      }\n    };\n\n    ConversationalForm.prototype.addRobotChatResponse = function (response) {\n      this.chatList.createResponse(true, null, response);\n    };\n\n    ConversationalForm.prototype.addUserChatResponse = function (response) {\n      // add a \"fake\" user response..\n      this.chatList.createResponse(false, null, response);\n    };\n\n    ConversationalForm.prototype.stop = function (optionalStoppingMessage) {\n      if (optionalStoppingMessage === void 0) {\n        optionalStoppingMessage = \"\";\n      }\n\n      this.flowManager.stop();\n      if (optionalStoppingMessage != \"\") this.chatList.createResponse(true, null, optionalStoppingMessage);\n      this.userInput.onFlowStopped();\n    };\n\n    ConversationalForm.prototype.start = function () {\n      this.userInput.disabled = false;\n      if (!ConversationalForm.suppressLog) console.log('option, disabled 3');\n      this.userInput.visible = true;\n      this.flowManager.start();\n    };\n\n    ConversationalForm.prototype.getTag = function (nameOrIndex) {\n      if (typeof nameOrIndex == \"number\") {\n        return this.tags[nameOrIndex];\n      } else {\n        // TODO: fix so you can get a tag by its name attribute\n        return null;\n      }\n    };\n\n    ConversationalForm.prototype.setupTagGroups = function (tags) {\n      // make groups, from input tag[type=radio | type=checkbox]\n      // groups are used to bind logic like radio-button or checkbox dependencies\n      var groups = [];\n\n      for (var i = 0; i < tags.length; i++) {\n        var tag = tags[i];\n\n        if (tag.type == \"radio\" || tag.type == \"checkbox\") {\n          if (!groups[tag.name]) groups[tag.name] = [];\n          groups[tag.name].push(tag);\n        }\n      }\n\n      if (Object.keys(groups).length > 0) {\n        for (var group in groups) {\n          if (groups[group].length > 0) {\n            // always build groupd when radio or checkbox\n            // find the fieldset, if any..\n            var isFieldsetValidForCF = function isFieldsetValidForCF(tag) {\n              return tag && tag.tagName.toLowerCase() !== \"fieldset\" && !tag.hasAttribute(\"cf-questions\");\n            };\n\n            var fieldset = groups[group][0].domElement.parentNode;\n\n            if (fieldset && fieldset.tagName.toLowerCase() !== \"fieldset\") {\n              fieldset = fieldset.parentNode;\n\n              if (isFieldsetValidForCF(fieldset)) {\n                // not a valid fieldset, we only accept fieldsets that contain cf attr\n                fieldset = null;\n              }\n            }\n\n            var tagGroup = new cf_1.TagGroup({\n              fieldset: fieldset,\n              elements: groups[group]\n            }); // remove the tags as they are now apart of a group\n\n            for (var i = 0; i < groups[group].length; i++) {\n              var tagToBeRemoved = groups[group][i];\n              if (i == 0) // add the group at same index as the the first tag to be removed\n                tags.splice(tags.indexOf(tagToBeRemoved), 1, tagGroup);else tags.splice(tags.indexOf(tagToBeRemoved), 1);\n            }\n          }\n        }\n      }\n\n      return tags;\n    };\n\n    ConversationalForm.prototype.setupUI = function () {\n      // start the flow\n      this.flowManager = new cf_1.FlowManager({\n        cfReference: this,\n        flowStepCallback: this.flowStepCallback,\n        eventTarget: this.eventTarget,\n        tags: this.tags\n      });\n      this.el = document.createElement(\"div\");\n      this.el.id = \"conversational-form\";\n      this.el.className = \"conversational-form\";\n      this.addBrowserTypes(this.el);\n      if (ConversationalForm.animationsEnabled) this.el.classList.add(\"conversational-form--enable-animation\"); // add conversational form to context\n\n      if (!this.preventAutoAppend) this.context.appendChild(this.el); //hide until stylesheet is rendered\n\n      this.el.style.visibility = \"hidden\";\n      var innerWrap = document.createElement(\"div\");\n      innerWrap.className = \"conversational-form-inner\";\n      this.el.appendChild(innerWrap); // Conversational Form UI\n\n      this.chatList = new cf_1.ChatList({\n        eventTarget: this.eventTarget,\n        cfReference: this\n      });\n      innerWrap.appendChild(this.chatList.el);\n      this.userInput = new cf_1.UserTextInput({\n        microphoneInputObj: this.microphoneInputObj,\n        eventTarget: this.eventTarget,\n        cfReference: this\n      });\n\n      if (ConversationalForm.showProgressBar) {\n        var progressBar = new cf_1.ProgressBar(this);\n        innerWrap.appendChild(progressBar.el);\n      }\n\n      this.chatList.addInput(this.userInput);\n      innerWrap.appendChild(this.userInput.el);\n      this.onUserAnswerClickedCallback = this.onUserAnswerClicked.bind(this);\n      this.eventTarget.addEventListener(cf_1.ChatResponseEvents.USER_ANSWER_CLICKED, this.onUserAnswerClickedCallback, false);\n      this.el.classList.add(\"conversational-form--show\");\n      if (!this.preventAutoStart) this.flowManager.start();\n\n      if (!this.tags || this.tags.length == 0) {\n        // no tags, so just show the input\n        this.userInput.visible = true;\n      }\n    };\n    /**\n    * @name onUserAnswerClicked\n    * on user ChatReponse clicked\n    */\n\n\n    ConversationalForm.prototype.onUserAnswerClicked = function (event) {\n      var tag = event.detail;\n      this.flowManager.editTag(tag);\n    };\n\n    ConversationalForm.prototype.addBrowserTypes = function (el) {\n      if (navigator.userAgent.indexOf('Firefox') > -1) el.classList.add('browser-firefox');\n      if (/Edge/.test(navigator.userAgent)) el.classList.add('browser-edge');\n    };\n    /**\n    * @name addTag\n    * Add a tag to the conversation. This can be used to add tags at runtime\n    * see examples/formless.html\n    */\n\n\n    ConversationalForm.prototype.addTags = function (tagsData, addAfterCurrentStep, atIndex) {\n      if (addAfterCurrentStep === void 0) {\n        addAfterCurrentStep = true;\n      }\n\n      if (atIndex === void 0) {\n        atIndex = -1;\n      }\n\n      var tags = [];\n\n      for (var i = 0; i < tagsData.length; i++) {\n        var tagData = tagsData[i];\n\n        if (tagData.tag === \"fieldset\") {\n          // group ..\n          // const fieldSetChildren: Array<DataTag> = tagData.children;\n          // parse group tag\n          var groupTag = cf_1.TagsParser.parseGroupTag(tagData);\n\n          for (var j = 0; j < groupTag.children.length; j++) {\n            var tag = groupTag.children[j];\n\n            if (cf_1.Tag.isTagValid(tag)) {\n              var tagElement = cf_1.Tag.createTag(tag); // add ref for group creation\n\n              if (!tagElement.name) {\n                tagElement.name = \"tag-ref-\" + j.toString();\n              }\n\n              tags.push(tagElement);\n            }\n          }\n        } else {\n          var tag = tagData.tag === \"select\" ? cf_1.TagsParser.parseGroupTag(tagData) : cf_1.TagsParser.parseTag(tagData);\n\n          if (cf_1.Tag.isTagValid(tag)) {\n            var tagElement = cf_1.Tag.createTag(tag);\n            tags.push(tagElement);\n          }\n        }\n      } // map free roaming checkbox and radio tags into groups\n\n\n      tags = this.setupTagGroups(tags); // add new tags to the flow\n\n      this.tags = this.flowManager.addTags(tags, addAfterCurrentStep ? this.flowManager.getStep() + 1 : atIndex); //this.flowManager.startFrom ?\n    };\n    /**\n    * @name remapTagsAndStartFrom\n    * index: number, what index to start from\n    * setCurrentTagValue: boolean, usually this method is called when wanting to loop or skip over questions, therefore it might be usefull to set the value of the current tag before changing index.\n    * ignoreExistingTags: boolean, possible to ignore existing tags, to allow for the flow to just \"happen\"\n    */\n\n\n    ConversationalForm.prototype.remapTagsAndStartFrom = function (index, setCurrentTagValue, ignoreExistingTags) {\n      if (index === void 0) {\n        index = 0;\n      }\n\n      if (setCurrentTagValue === void 0) {\n        setCurrentTagValue = false;\n      }\n\n      if (ignoreExistingTags === void 0) {\n        ignoreExistingTags = false;\n      }\n\n      if (setCurrentTagValue) {\n        this.chatList.setCurrentUserResponse(this.userInput.getFlowDTO());\n      } // possibility to start the form flow over from {index}\n\n\n      for (var i = 0; i < this.tags.length; i++) {\n        var tag = this.tags[i];\n        tag.refresh();\n      }\n\n      this.flowManager.startFrom(index, ignoreExistingTags);\n    };\n    /**\n    * @name focus\n    * Sets focus on Conversational Form\n    */\n\n\n    ConversationalForm.prototype.focus = function () {\n      if (this.userInput) this.userInput.setFocusOnInput();\n    };\n\n    ConversationalForm.prototype.doSubmitForm = function () {\n      this.el.classList.add(\"done\");\n      this.userInput.reset();\n\n      if (this.submitCallback) {\n        // remove should be called in the submitCallback\n        this.submitCallback(this);\n      } else {\n        // this.formEl.submit();\n        // doing classic .submit wont trigger onsubmit if that is present on form element\n        // as described here: http://wayback.archive.org/web/20090323062817/http://blogs.vertigosoftware.com/snyholm/archive/2006/09/27/3788.aspx\n        // so we mimic a click.\n        var button = this.formEl.ownerDocument.createElement('button');\n        button.style.display = 'none';\n        button.type = 'submit';\n        this.formEl.appendChild(button);\n        button.click();\n        this.formEl.removeChild(button); // remove conversational\n\n        this.remove();\n      }\n    };\n\n    ConversationalForm.prototype.remove = function () {\n      if (this.microphoneInputObj) {\n        this.microphoneInputObj = null;\n      }\n\n      if (this.onUserAnswerClickedCallback) {\n        this.eventTarget.removeEventListener(cf_1.ChatResponseEvents.USER_ANSWER_CLICKED, this.onUserAnswerClickedCallback, false);\n        this.onUserAnswerClickedCallback = null;\n      }\n\n      if (this.flowManager) this.flowManager.dealloc();\n      if (this.userInput) this.userInput.dealloc();\n      if (this.chatList) this.chatList.dealloc();\n      this.dictionary = null;\n      this.flowManager = null;\n      this.userInput = null;\n      this.chatList = null;\n      this.context = null;\n      this.formEl = null;\n      this.tags = null;\n      this.submitCallback = null;\n      this.el.parentNode.removeChild(this.el);\n      this.el = null;\n      window.ConversationalForm[this.createId] = null;\n    }; // to illustrate the event flow of the app\n\n\n    ConversationalForm.illustrateFlow = function (classRef, type, eventType, detail) {\n      // ConversationalForm.illustrateFlow(this, \"dispatch\", FlowEvents.USER_INPUT_INVALID, event.detail);\n      // ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n      if (detail === void 0) {\n        detail = null;\n      }\n\n      if (ConversationalForm.illustrateAppFlow) {\n        var highlight = \"font-weight: 900; background: \" + (type == \"receive\" ? \"#e6f3fe\" : \"pink\") + \"; color: black; padding: 0px 5px;\";\n        if (!ConversationalForm.suppressLog) console.log(\"%c** event flow: %c\" + eventType + \"%c flow type: %c\" + type + \"%c from: %c\" + classRef.constructor.name, \"font-weight: 900;\", highlight, \"font-weight: 400;\", highlight, \"font-weight: 400;\", highlight);\n        if (detail) if (!ConversationalForm.suppressLog) console.log(\"** event flow detail:\", detail);\n      }\n    };\n\n    ConversationalForm.startTheConversation = function (data) {\n      var isFormless = !!data.formEl === false;\n      var formlessTags;\n      var constructorOptions;\n\n      if (isFormless) {\n        if (typeof data === \"string\") {\n          // Formless init w. string\n          isFormless = true;\n          var json = JSON.parse(data);\n          constructorOptions = json.options;\n          formlessTags = json.tags;\n        } else {\n          // Formless init w. JSON object\n          constructorOptions = data.options;\n          formlessTags = data.tags;\n        } // formless, so generate the pseudo tags\n\n\n        var formEl = cf.TagsParser.parseJSONIntoElements(formlessTags);\n        constructorOptions.formEl = formEl;\n      } else {\n        // keep it standard\n        constructorOptions = data;\n      }\n\n      return new cf.ConversationalForm(constructorOptions);\n    };\n\n    ConversationalForm.autoStartTheConversation = function () {\n      if (cf.ConversationalForm.hasAutoInstantiated) return; // auto start the conversation\n\n      var formElements = document.querySelectorAll(\"form[cf-form]\"); // no form elements found, look for the old init attribute\n\n      if (formElements.length === 0) {\n        formElements = document.querySelectorAll(\"form[cf-form-element]\");\n      }\n\n      var formContexts = document.querySelectorAll(\"*[cf-context]\");\n\n      if (formElements && formElements.length > 0) {\n        for (var i = 0; i < formElements.length; i++) {\n          var form = formElements[i];\n          var context = formContexts[i];\n          cf.ConversationalForm.startTheConversation({\n            formEl: form,\n            context: context\n          });\n        }\n\n        cf.ConversationalForm.hasAutoInstantiated = true;\n      }\n    };\n\n    ConversationalForm.animationsEnabled = true;\n    ConversationalForm.illustrateAppFlow = true;\n    ConversationalForm.suppressLog = true;\n    ConversationalForm.showProgressBar = false;\n    ConversationalForm.preventSubmitOnEnter = false;\n    ConversationalForm.hasAutoInstantiated = false;\n    return ConversationalForm;\n  }();\n\n  cf_1.ConversationalForm = ConversationalForm;\n})(cf || (cf = {}));\n\nif (document.readyState == \"complete\") {\n  // if document alread instantiated, usually this happens if Conversational Form is injected through JS\n  setTimeout(function () {\n    return cf.ConversationalForm.autoStartTheConversation();\n  }, 0);\n} else {\n  // await for when document is ready\n  window.addEventListener(\"load\", function () {\n    cf.ConversationalForm.autoStartTheConversation();\n  }, false);\n} // jquery plugin\n\n\n(function (factory) {\n  try {\n    factory(jQuery);\n  } catch (e) {// whoops no jquery..\n  }\n})(function ($) {\n  $.fn.conversationalForm = function (options\n  /* ConversationalFormOptions, see README */\n  ) {\n    options = options || {};\n\n    if (!options.formEl) {\n      options.formEl = this[0];\n    }\n\n    if (!options.context) {\n      var formContexts = document.querySelectorAll(\"*[cf-context]\");\n\n      if (formContexts[0]) {\n        options.context = formContexts[0];\n      }\n    }\n\n    return new cf.ConversationalForm(options);\n  };\n}); // requirejs/amd plugin\n\n\n(function (root, factory) {\n  // from http://ifandelse.com/its-not-hard-making-your-library-support-amd-and-commonjs/#update\n  if (typeof define === \"function\" && define.amd) {\n    define([\"conversational-form\"], function (conversationalform) {\n      return root.conversationalform = factory(conversationalform);\n    });\n  } else if (typeof module === \"object\" && module.exports) {\n    module.exports = root.conversationalform = factory(require(\"conversational-form\"));\n  } else {\n    root.conversationalform = factory(cf.ConversationalForm);\n  }\n})(window, function (conversationalform) {\n  // module code here....\n  return cf;\n});","map":{"version":3,"sources":["/media/palash/Data/xfinito/React projects/react-conversational-form-example/node_modules/conversational-form/dist/conversational-form.js"],"names":["root","setTimeoutFunc","setTimeout","noop","bind","fn","thisArg","apply","arguments","Promise","TypeError","_state","_handled","_value","undefined","_deferreds","doResolve","handle","self","deferred","push","_immediateFn","cb","onFulfilled","onRejected","resolve","reject","promise","ret","e","newValue","then","finale","length","_unhandledRejectionFn","i","len","Handler","done","value","reason","ex","prototype","prom","constructor","all","arr","args","Array","slice","call","remaining","res","val","race","values","setImmediate","err","console","warn","_setImmediateFn","_setUnhandledRejectionFn","module","exports","ce","window","CustomEvent","preventDefault","defaultPrevented","Error","event","params","evt","origPrevent","bubbles","cancelable","detail","document","createEvent","initCustomEvent","Object","defineProperty","get","Event","cf","Helpers","lerp","norm","min","max","getXYFromMouseTouchEvent","touches","originalEvent","changedTouches","x","pageX","y","pageY","getInnerTextOfElement","element","tmp","createElement","innerHTML","text","textContent","innerText","String","replace","getMouseEvent","eventString","mappings","isInternetExlorer","ua","navigator","userAgent","msie","indexOf","match","getValuesOfBars","str","strs","split","setTransform","el","transformString","style","extendObject","destination","source","property","callee","caniuse","fileReader","File","FileReader","FileList","Blob","EventDispatcher","cfRef","_cf","target","createDocumentFragment","set","enumerable","configurable","addEventListener","type","listener","useCapture","dispatchEvent","removeEventListener","TagsParser","parseTag","tag","setAttribute","k","parseGroupTag","groupTag","groupEl","groupChildren","children","j","fieldSetTagData","appendChild","parseJSONIntoElements","data","formEl","subElement","isElementFormless","hasAttribute","UserInterfaceDefaultOptions","controlElementsInAnimationDelay","robot","robotResponseTime","chainedResponseTime","user","showThinking","showThumb","BasicElement","options","eventTarget","cfReference","customTemplate","name","setData","onElementCreated","template","getTemplate","firstChild","content","dealloc","parentNode","removeChild","__extends","extendStatics","d","b","setPrototypeOf","__proto__","p","hasOwnProperty","__","create","ControlElementEvents","SUBMIT_VALUE","PROGRESS_CHANGE","ON_FOCUS","ON_LOADED","ControlElementProgressStates","BUSY","READY","ControlElement","_super","_this","animateInTimer","_partOfSeveralChoices","_focus","onFocusCallback","onFocus","onBlurCallback","onBlur","referenceTag","disabled","hasTagImage","hasImage","partOfSeveralChoices","image","domElement","getAttribute","_positionVector","tabIndex","classList","contains","add","remove","focus","blur","highlight","ConversationalForm","illustrateFlow","positionVector","calcPosition","mr","parseInt","getComputedStyle","getPropertyValue","height","offsetHeight","width","offsetWidth","offsetLeft","offsetTop","centerX","centerY","animateIn","clearTimeout","animateOut","onChoose","ControlElementsEvents","ON_RESIZE","CHANGED","ControlElements","ignoreKeyboardInput","rowIndex","columnIndex","elementWidth","filterListNumberOfVisible","listWidth","list","getElementsByTagName","infoElement","infoEl","onScrollCallback","onScroll","onResizeCallback","onResize","onElementFocusCallback","onElementFocus","onElementLoadedCallback","onElementLoaded","onChatReponsesUpdatedCallback","onChatReponsesUpdated","ChatListEvents","CHATLIST_UPDATED","onUserInputKeyChangeCallback","onUserInputKeyChange","UserInputEvents","KEY_CHANGE","userInputUpdateCallback","onUserInputUpdate","FlowEvents","USER_INPUT_UPDATE","listScrollController","ScrollController","interactionListener","listToScroll","listNavButtons","elements","getElements","scrollLeft","vector","updateRowColIndexFromVector","setScroll","tableableRows","items","item","animateInFromResponseTimer","currentResponse","isRobotResponse","animateElementsIn","uiOptions","onListChanged","requestAnimationFrame","dto","userInput","input","active","isNavKey","Dictionary","keyCodes","keyCode","shouldFilter","inputFieldActive","dto_1","inputValue","getInputValue","filterElementsFrom","updateRowIndex","click","validateRowColIndexes","setFocusOnInput","maxRowIndex","resetTabList","direction","oldRowIndex","currentDistance","Math","abs","inputValuesLowerCase","toLowerCase","splice","itemsVisible","elementVisibility","i_1","inputWord","visible","join","hasListChanged","clickOnHighlighted","resize","scrollHeight","querySelector","scrollContainer","scrollTop","buildTabableRows","resetAfterErrorMessage","currentControlElement","focusFrom","angle","preventAutoFocus","updateStateOnElementsFromTag","index","updateStateOnElements","controlElement","checked","isChecked","reset","getElement","getDTO","controlElements","numChecked","element_1","element_2","parseAndGetMultiValueString","element_3","getValue","i_2","element_4","getFilesAsString","clearTagsAndReset","pop","buildTags","tags","topList","bottomList","RadioButton","CheckboxButton","OptionsList","context","UploadFileUI","isElementsOptionsList","h","controlElementsAddedDTO","CONTROL_ELEMENTS_ADDED","listWidthValues","listWidthValues2","containsElementWithImage","elOffsetWidth","isListWidthOverElementWidth","round","floor","elementsCopyForSorting","tabIndexFilteredElements","sort","a","aOverB","visibleAreaWidth","interacting","xTarget","startX","startXTarget","mouseSpeed","mouseSpeedTarget","directionTarget","inputAccerlation","inputAccerlationTarget","prevButton","nextButton","onListNavButtonsClickCallback","onListNavButtonsClick","documentLeaveCallback","documentLeave","onInteractStartCallback","onInteractStart","onInteractEndCallback","onInteractEnd","onInteractMoveCallback","onInteractMove","dirClick","currentTarget","pushDirection","render","newAcc","magnifier","rAF","cancelAnimationFrame","acceleration","accDamping","xRounded","xx","dir","ProgressBar","flowUpdateCallback","onFlowUpdate","FLOW_UPDATE","FORM_SUBMIT","setWidth","className","bar","init","step","maxSteps","percentage","robotData","instance","version","validateAndSetNewData","userImage","robotImage","id","ins","random","obj","getRobotResponse","tagType","generals","sym","newData","originalDataObject","key","TagEvents","ORIGINAL_ELEMENT_CHANGED","Tag","initialDefaultValue","changeCallback","onDomElementChange","skipUserInput","questions","validationCallback","pattern","RegExp","illustrateAppFlow","suppressLog","log","refresh","tagName","_inputPlaceholder","getLabel","checkConditionalAndIsValid","_eventTarget","errorMessages","required","defaultValue","_label","testConditions","tagValue","condition","testValue","conditional","test","isValid","conditionals","toString","isTagValid","display","visibility","isTagFormless","getClientRects","createTag","InputTag","SelectTag","ButtonTag","OptionTag","CfRobotMessageTag","findAndSetQuestions","findConditionalAttributes","hasConditionsFor","hasConditions","conditionalTags","flowManager","areConditionsInFlowFullfilled","setTagValueAndIsValid","valueText","isMaxMinValueValid","validateMaxMinValue","parsedValue","minValue","maxValue","findAndSetLabel","keys","attributes","attr","_conditionals","conditionalsFromAttribute","_conditional","parent_1","elId","forLabel","parentDomNode","labelTags","label","TagGroup","_fieldset","fieldset","question","tagQuestion","robotReponse","getGroupTagType","_activeElements","_values","allShouldBedisabled","errorMessage","groupType","wasRadioButtonChecked","numberRadioButtonsVisible","v1","v2","optionTags","domOptionTags","numberOptionButtonsVisible","controllerElement","selected","wasSelected","formless","removeAttribute","Button","clickCallback","onClick","mouseDownCallback","onMouseDown","checkForImage","imgEl","imageLoadedCallback","onImageLoaded","src","insertBefore","_checked","trim","OptionButtonEvents","CLICK","OptionButton","isMultiChoice","tmpl","multiChoice","onOptionButtonClickCallback","onOptionButtonClick","createElements","btn","multipleChoice","maxFileSize","loading","submitTimer","_fileName","_readerResult","maxFileSizeStr","progressBar","onDomElementChangeCallback","_files","icon","fileName","outerHTML","reader","files","onerror","onprogress","loaded","total","onabort","onloadstart","file","fileSize","size","abort","errorText","USER_INPUT_INVALID","sizeConversion","sizeChart","humanSizeString","Number","pow","toFixed","onload","result","readAsDataURL","triggerFileSelect","MicrophoneBridgeEvent","ERROR","TERMNIAL_ERROR","MicrophoneBridge","currentTextResponse","_hasUserMedia","inputErrorCount","inputCurrentError","button","microphoneObj","equalizer","cancel","cancelInput","hasGranted_1","mediaDevices","enumerateDevices","devices","forEach","device","getUserMedia","awaitingCallback","callInput","constraints","webkitGetUserMedia","mozGetUserMedia","audio","stream","currentStream","getAudioTracks","hasUserMedia","setupEqualizer","catch","error","messageTime","showError","SUBMIT","isErrorTerminal","terminalErrors","eqEl","SimpleEqualizer","supported","elementToScale","maxBorderWidth","_disabled","AudioContext","analyser","createAnalyser","mic","createMediaStreamSource","javascriptNode","createScriptProcessor","smoothingTimeConstant","fftSize","connect","onaudioprocess","onAudioProcess","borderWidth","array","Uint8Array","frequencyBinCount","getByteFrequencyData","average","percent","webkitAudioContext","UserInputSubmitButtonEvents","CHANGE","UserInputSubmitButton","_active","onClickCallback","onMicrophoneTerminalErrorCallback","onMicrophoneTerminalError","addMicrophone","typing","getElementsByClassName","isMicVisible","UserInputTypes","VOICE","VR_GESTURE","TEXT","UserInputElement","_visible","windowFocusCallback","windowFocus","inputInvalidCallback","inputInvalid","_currentTag","hasChanged","elHeight","elMargin","currentStyle","marginTop","marginBottom","defaultView","onEnterOrSubmitButtonSubmit","deactivate","reactivate","getFlowDTO","onFlowStopped","ERROR_TIME","hideUserInputOnNoneTextInput","HEIGHT_CHANGE","FOCUS","BLUR","UserTextInput","initialInputHeight","shiftIsDown","inputElement","onInputFocusCallback","onInputFocus","onInputBlurCallback","onInputBlur","animationsEnabled","keyUpCallback","onKeyUp","keyDownCallback","onKeyDown","onOriginalTagChangedCallback","onOriginalTagChanged","onControlElementSubmitCallback","onControlElementSubmit","onControlElementProgressChangeCallback","onControlElementProgressChange","onSubmitButtonChangeStateCallback","onSubmitButtonChangeState","submitButton","microphoneInputObj","activeElement","div","createTextNode","currentTag","onInputChange","oldHeight","resetInputHeight","errorTimer","setPlaceholder","inputPlaceholder","checkForCorrectInputTag","input_1","replaceChild","textarea_1","attribute","isInputSpecificType","resetValue","buildControlElements","rows","status","doSubmit","isMetaKeyPressed","metaKey","isControlElementsActiveAndUserInputHidden","preventSubmitOnEnter","shiftKey","doesKeyTargetExistInCF","node","mutiTag","dispatchKeyChange","highlighted","addUserChatResponse","ChatResponseEvents","USER_ANSWER_CLICKED","ChatResponse","container","_tag","hasFlexBug","outer","inner","sm","querySelectorAll","cssAnimationTime","animationDuration","cssAnimationDelayTime","animationDelay","html","response","whenReady","onReadyCallback","setValue","isThinking","setToThinking","originalResponse","processResponseAndSetText","responseLink","textEl","show","checkForEditMode","updateThumbnail","thumbEl","thumbElSpan","backgroundImage","setLinkToOtherReponse","innerResponse","newStr","parsedResponse","reponses","getResponses","responseContains","robotInitResponseTime","chainedResponses","_loop_1","i_3","tryClearThinking","scrollTo","this_1","_loop_2","i_4","revealAfter","this_2","readyTimer","nextStep","imageRegex","imageTag","addSelf","parentElement","canShowThinking","THINKING_MARKUP","ChatList","updateTimer","responses","onInputKeyChangeCallback","onInputKeyChange","onInputHeightChangeCallback","onInputHeightChange","onControlElementsResizedCallback","onControlElementsResized","onControlElementsChangedCallback","onControlElementsChanged","onInputElementChanged","currentUserResponse","setCurrentUserResponse","addInput","responseToScrollTo","added","cfHeight","inputHeight","listHeight","containsTagResponse","ignoreExistingTag","onUserWantsToEditTag","createResponse","tagToChange","responseUserWantsToEdit","onListUpdate","chatResponse","clearFrom","flowDTOFromUserInputUpdate","img","newImage","scrollable","FlowManager","stopped","savedStep","stepTimer","ignoreExistingTags","flowStepCallback","setTags","userInputSubmitCallback","userInputSubmit","appDTO","hasCheckedForTagSpecificValidation","hasCheckedForGlobalFlowValidation","onValidationCallback","optionalErrorMessage","startFrom","indexOrTag","editTag","showStep","tagWithConditions","tagConditions","activeConditions","numConditionsFound","tagCondition","flowTagValue","areConditionsMeet","start","validateStepAndUpdate","stop","foundConditionsToCurrentTag","previousStep","getStep","addTags","atIndex","pre","post","concat","chatList","editTagIndex","tag_1","skipStep","doSubmitForm","STEP_TIME","cf_1","cdnPath","isDevelopment","loadExternalStyleSheet","theme","preventAutoAppend","preventAutoStart","showProgressBar","createId","eventDispatcher","getElementById","isNaN","scrollAcceleration","submitCallback","dictionary","dictionaryData","dictionaryRobot","body","microphoneInput","userInterfaceOptions","_createId","Date","getTime","updateDictionaryValue","head","githubMasterUrl","media","position","fields","indexesToRemove","setupTagGroups","setupUI","getFormData","serialized","serialized_1","formData","FormData","addRobotChatResponse","optionalStoppingMessage","getTag","nameOrIndex","groups","group","isFieldsetValidForCF","tagGroup","tagToBeRemoved","addBrowserTypes","innerWrap","onUserAnswerClickedCallback","onUserAnswerClicked","tagsData","addAfterCurrentStep","tagData","tagElement","remapTagsAndStartFrom","setCurrentTagValue","ownerDocument","classRef","eventType","startTheConversation","isFormless","formlessTags","constructorOptions","json","JSON","parse","autoStartTheConversation","hasAutoInstantiated","formElements","formContexts","form","readyState","factory","jQuery","$","conversationalForm","define","amd","conversationalform","require"],"mappings":"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","sourcesContent":["(function (root) {\n\n  // Store setTimeout reference so promise-polyfill will be unaffected by\n  // other code modifying setTimeout (like sinon.useFakeTimers())\n  var setTimeoutFunc = setTimeout;\n\n  function noop() {}\n  \n  // Polyfill for Function.prototype.bind\n  function bind(fn, thisArg) {\n    return function () {\n      fn.apply(thisArg, arguments);\n    };\n  }\n\n  function Promise(fn) {\n    if (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n    if (typeof fn !== 'function') throw new TypeError('not a function');\n    this._state = 0;\n    this._handled = false;\n    this._value = undefined;\n    this._deferreds = [];\n\n    doResolve(fn, this);\n  }\n\n  function handle(self, deferred) {\n    while (self._state === 3) {\n      self = self._value;\n    }\n    if (self._state === 0) {\n      self._deferreds.push(deferred);\n      return;\n    }\n    self._handled = true;\n    Promise._immediateFn(function () {\n      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n      if (cb === null) {\n        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n        return;\n      }\n      var ret;\n      try {\n        ret = cb(self._value);\n      } catch (e) {\n        reject(deferred.promise, e);\n        return;\n      }\n      resolve(deferred.promise, ret);\n    });\n  }\n\n  function resolve(self, newValue) {\n    try {\n      // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n      if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n        var then = newValue.then;\n        if (newValue instanceof Promise) {\n          self._state = 3;\n          self._value = newValue;\n          finale(self);\n          return;\n        } else if (typeof then === 'function') {\n          doResolve(bind(then, newValue), self);\n          return;\n        }\n      }\n      self._state = 1;\n      self._value = newValue;\n      finale(self);\n    } catch (e) {\n      reject(self, e);\n    }\n  }\n\n  function reject(self, newValue) {\n    self._state = 2;\n    self._value = newValue;\n    finale(self);\n  }\n\n  function finale(self) {\n    if (self._state === 2 && self._deferreds.length === 0) {\n      Promise._immediateFn(function() {\n        if (!self._handled) {\n          Promise._unhandledRejectionFn(self._value);\n        }\n      });\n    }\n\n    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n      handle(self, self._deferreds[i]);\n    }\n    self._deferreds = null;\n  }\n\n  function Handler(onFulfilled, onRejected, promise) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.promise = promise;\n  }\n\n  /**\n   * Take a potentially misbehaving resolver function and make sure\n   * onFulfilled and onRejected are only called once.\n   *\n   * Makes no guarantees about asynchrony.\n   */\n  function doResolve(fn, self) {\n    var done = false;\n    try {\n      fn(function (value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      }, function (reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      });\n    } catch (ex) {\n      if (done) return;\n      done = true;\n      reject(self, ex);\n    }\n  }\n\n  Promise.prototype['catch'] = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n\n  Promise.prototype.then = function (onFulfilled, onRejected) {\n    var prom = new (this.constructor)(noop);\n\n    handle(this, new Handler(onFulfilled, onRejected, prom));\n    return prom;\n  };\n\n  Promise.all = function (arr) {\n    var args = Array.prototype.slice.call(arr);\n\n    return new Promise(function (resolve, reject) {\n      if (args.length === 0) return resolve([]);\n      var remaining = args.length;\n\n      function res(i, val) {\n        try {\n          if (val && (typeof val === 'object' || typeof val === 'function')) {\n            var then = val.then;\n            if (typeof then === 'function') {\n              then.call(val, function (val) {\n                res(i, val);\n              }, reject);\n              return;\n            }\n          }\n          args[i] = val;\n          if (--remaining === 0) {\n            resolve(args);\n          }\n        } catch (ex) {\n          reject(ex);\n        }\n      }\n\n      for (var i = 0; i < args.length; i++) {\n        res(i, args[i]);\n      }\n    });\n  };\n\n  Promise.resolve = function (value) {\n    if (value && typeof value === 'object' && value.constructor === Promise) {\n      return value;\n    }\n\n    return new Promise(function (resolve) {\n      resolve(value);\n    });\n  };\n\n  Promise.reject = function (value) {\n    return new Promise(function (resolve, reject) {\n      reject(value);\n    });\n  };\n\n  Promise.race = function (values) {\n    return new Promise(function (resolve, reject) {\n      for (var i = 0, len = values.length; i < len; i++) {\n        values[i].then(resolve, reject);\n      }\n    });\n  };\n\n  // Use polyfill for setImmediate for performance gains\n  Promise._immediateFn = (typeof setImmediate === 'function' && function (fn) { setImmediate(fn); }) ||\n    function (fn) {\n      setTimeoutFunc(fn, 0);\n    };\n\n  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n    if (typeof console !== 'undefined' && console) {\n      console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n    }\n  };\n\n  /**\n   * Set the immediate function to execute callbacks\n   * @param fn {function} Function to execute\n   * @deprecated\n   */\n  Promise._setImmediateFn = function _setImmediateFn(fn) {\n    Promise._immediateFn = fn;\n  };\n\n  /**\n   * Change the function to execute on unhandled rejection\n   * @param {function} fn Function to execute on unhandled rejection\n   * @deprecated\n   */\n  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n    Promise._unhandledRejectionFn = fn;\n  };\n  \n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = Promise;\n  } else if (!root.Promise) {\n    root.Promise = Promise;\n  }\n\n})(this);\n\n// Polyfill for creating CustomEvents on IE9/10/11\n\n// code pulled from:\n// https://github.com/d4tocchini/customevent-polyfill\n// https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent#Polyfill\n\ntry {\n    var ce = new window.CustomEvent('test');\n    ce.preventDefault();\n    if (ce.defaultPrevented !== true) {\n        // IE has problems with .preventDefault() on custom events\n        // http://stackoverflow.com/questions/23349191\n        throw new Error('Could not prevent default');\n    }\n} catch(e) {\n  var CustomEvent = function(event, params) {\n    var evt, origPrevent;\n    params = params || {\n      bubbles: false,\n      cancelable: false,\n      detail: undefined\n    };\n\n    evt = document.createEvent(\"CustomEvent\");\n    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n    origPrevent = evt.preventDefault;\n    evt.preventDefault = function () {\n      origPrevent.call(this);\n      try {\n        Object.defineProperty(this, 'defaultPrevented', {\n          get: function () {\n            return true;\n          }\n        });\n      } catch(e) {\n        this.defaultPrevented = true;\n      }\n    };\n    return evt;\n  };\n\n  CustomEvent.prototype = window.Event.prototype;\n  window.CustomEvent = CustomEvent; // expose definition to window\n}\n\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var Helpers = /** @class */ (function () {\n        function Helpers() {\n        }\n        Helpers.lerp = function (norm, min, max) {\n            return (max - min) * norm + min;\n        };\n        Helpers.norm = function (value, min, max) {\n            return (value - min) / (max - min);\n        };\n        Helpers.getXYFromMouseTouchEvent = function (event) {\n            var touches = null;\n            if (event.originalEvent)\n                touches = event.originalEvent.touches || event.originalEvent.changedTouches;\n            else if (event.changedTouches)\n                touches = event.changedTouches;\n            if (touches) {\n                return { x: touches[0].pageX, y: touches[0].pageY, touches: touches[0] };\n            }\n            else {\n                return { x: event.pageX, y: event.pageY, touches: null };\n            }\n        };\n        Helpers.getInnerTextOfElement = function (element) {\n            var tmp = document.createElement(\"DIV\");\n            tmp.innerHTML = element.innerHTML;\n            // return \n            var text = tmp.textContent || tmp.innerText || \"\";\n            // text = String(text).replace('\\t','');\n            text = String(text).replace(/^\\s+|\\s+$/g, '');\n            return text;\n        };\n        Helpers.getMouseEvent = function (eventString) {\n            var mappings = [];\n            mappings[\"click\"] = \"ontouchstart\" in window ? \"touchstart\" : \"click\";\n            mappings[\"mousedown\"] = \"ontouchstart\" in window ? \"touchstart\" : \"mousedown\";\n            mappings[\"mouseup\"] = \"ontouchstart\" in window ? \"touchend\" : \"mouseup\";\n            mappings[\"mousemove\"] = \"ontouchstart\" in window ? \"touchmove\" : \"mousemove\";\n            return mappings[eventString];\n        };\n        Helpers.isInternetExlorer = function () {\n            var ua = window.navigator.userAgent;\n            var msie = ua.indexOf(\"MSIE \");\n            return msie > 0 || !!navigator.userAgent.match(/Trident.*rv\\:11\\./);\n        };\n        Helpers.getValuesOfBars = function (str) {\n            var strs = str.split(\"||\");\n            // TODO: remove single |\n            // fallback to the standard\n            if (strs.length <= 1)\n                strs = str.split(\"|\");\n            return strs;\n        };\n        Helpers.setTransform = function (el, transformString) {\n            el.style[\"-webkit-transform\"] = transformString;\n            el.style[\"-moz-transform\"] = transformString;\n            el.style[\"-ms-transform\"] = transformString;\n            el.style[\"transform\"] = transformString;\n        };\n        // deep extends and object, from: https://andrewdupont.net/2009/08/28/deep-extending-objects-in-javascript/\n        Helpers.extendObject = function (destination, source) {\n            for (var property in source) {\n                if (source[property] && source[property].constructor &&\n                    source[property].constructor === Object) {\n                    destination[property] = destination[property] || {};\n                    arguments.callee(destination[property], source[property]);\n                }\n                else {\n                    destination[property] = source[property];\n                }\n            }\n            return destination;\n        };\n        ;\n        Helpers.caniuse = {\n            fileReader: function () {\n                if (window.File && window.FileReader && window.FileList && window.Blob)\n                    return true;\n                return false;\n            }\n        };\n        return Helpers;\n    }());\n    cf.Helpers = Helpers;\n})(cf || (cf = {}));\n\n/// <reference path=\"../ConversationalForm.ts\"/>\nvar cf;\n(function (cf) {\n    // interface\n    var EventDispatcher = /** @class */ (function () {\n        function EventDispatcher(cfRef) {\n            if (cfRef === void 0) { cfRef = null; }\n            this._cf = cfRef;\n            this.target = document.createDocumentFragment();\n        }\n        Object.defineProperty(EventDispatcher.prototype, \"cf\", {\n            get: function () {\n                return this._cf;\n            },\n            set: function (value) {\n                this._cf = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        EventDispatcher.prototype.addEventListener = function (type, listener, useCapture) {\n            return this.target.addEventListener(type, listener, useCapture);\n        };\n        EventDispatcher.prototype.dispatchEvent = function (event) {\n            return this.target.dispatchEvent(event);\n        };\n        EventDispatcher.prototype.removeEventListener = function (type, listener, useCapture) {\n            this.target.removeEventListener(type, listener, useCapture);\n        };\n        return EventDispatcher;\n    }());\n    cf.EventDispatcher = EventDispatcher;\n})(cf || (cf = {}));\n\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    var TagsParser = /** @class */ (function () {\n        function TagsParser() {\n        }\n        TagsParser.parseTag = function (element) {\n            var tag = document.createElement(element.tag);\n            tag.setAttribute(\"cf-formless\", \"\");\n            // TODO: ES6 mapping??\n            for (var k in element) {\n                if (k !== \"tag\" && k !== \"children\") {\n                    tag.setAttribute(k, element[k]);\n                }\n            }\n            return tag;\n        };\n        TagsParser.parseGroupTag = function (groupTag) {\n            var groupEl = TagsParser.parseTag(groupTag);\n            var groupChildren = groupTag.children;\n            for (var j = 0; j < groupChildren.length; j++) {\n                var fieldSetTagData = groupChildren[j];\n                var tag = TagsParser.parseTag(fieldSetTagData);\n                groupEl.appendChild(tag);\n            }\n            return groupEl;\n        };\n        TagsParser.parseJSONIntoElements = function (data) {\n            var formEl = document.createElement(\"form\");\n            for (var i = 0; i < data.length; i++) {\n                var element = data[i];\n                var tag = TagsParser.parseTag(element);\n                // add sub children to tag, ex. option, checkbox, etc.\n                if (element.children && element.children.length > 0) {\n                    for (var j = 0; j < element.children.length; j++) {\n                        var subElement = TagsParser.parseTag(element.children[j]);\n                        tag.appendChild(subElement);\n                    }\n                }\n                formEl.appendChild(tag);\n            }\n            return formEl;\n        };\n        TagsParser.isElementFormless = function (element) {\n            if (element.hasAttribute(\"cf-formless\"))\n                return true;\n            return false;\n        };\n        return TagsParser;\n    }());\n    cf.TagsParser = TagsParser;\n})(cf || (cf = {}));\n\n// namespace\nvar cf;\n(function (cf) {\n    // default options interface for optional parameters for the UI of Conversational Form\n    cf.UserInterfaceDefaultOptions = {\n        controlElementsInAnimationDelay: 250,\n        robot: {\n            robotResponseTime: 0,\n            chainedResponseTime: 500\n        },\n        user: {\n            showThinking: false,\n            showThumb: false\n        }\n    };\n})(cf || (cf = {}));\n\n/// <reference path=\"../logic/EventDispatcher.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    // class\n    var BasicElement = /** @class */ (function () {\n        function BasicElement(options) {\n            this.eventTarget = options.eventTarget;\n            this.cfReference = options.cfReference;\n            if (options.customTemplate)\n                this.customTemplate = options.customTemplate;\n            // TODO: remove\n            if (!this.eventTarget)\n                throw new Error(\"this.eventTarget not set!! : \" + this.constructor.name);\n            this.setData(options);\n            this.createElement();\n            this.onElementCreated();\n        }\n        BasicElement.prototype.setData = function (options) {\n        };\n        BasicElement.prototype.onElementCreated = function () {\n        };\n        BasicElement.prototype.createElement = function () {\n            var template = document.createElement('template');\n            template.innerHTML = this.getTemplate();\n            this.el = template.firstChild || template.content.firstChild;\n            return this.el;\n        };\n        // template, should be overwritten ...\n        BasicElement.prototype.getTemplate = function () { return this.customTemplate || \"should be overwritten...\"; };\n        ;\n        BasicElement.prototype.dealloc = function () {\n            this.el.parentNode.removeChild(this.el);\n        };\n        return BasicElement;\n    }());\n    cf.BasicElement = BasicElement;\n})(cf || (cf = {}));\n\n/// <reference path=\"../../ConversationalForm.ts\"/>\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../../form-tags/Tag.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    cf.ControlElementEvents = {\n        SUBMIT_VALUE: \"cf-basic-element-submit\",\n        PROGRESS_CHANGE: \"cf-basic-element-progress\",\n        ON_FOCUS: \"cf-basic-element-on-focus\",\n        ON_LOADED: \"cf-basic-element-on-loaded\",\n    };\n    cf.ControlElementProgressStates = {\n        BUSY: \"cf-control-element-progress-BUSY\",\n        READY: \"cf-control-element-progress-READY\",\n    };\n    // class\n    var ControlElement = /** @class */ (function (_super) {\n        __extends(ControlElement, _super);\n        function ControlElement(options) {\n            var _this = _super.call(this, options) || this;\n            _this.animateInTimer = 0;\n            _this._partOfSeveralChoices = false;\n            _this._focus = false;\n            _this.onFocusCallback = _this.onFocus.bind(_this);\n            _this.el.addEventListener('focus', _this.onFocusCallback, false);\n            _this.onBlurCallback = _this.onBlur.bind(_this);\n            _this.el.addEventListener('blur', _this.onBlurCallback, false);\n            if (_this.referenceTag.disabled) {\n                _this.el.setAttribute(\"disabled\", \"disabled\");\n            }\n            return _this;\n        }\n        Object.defineProperty(ControlElement.prototype, \"type\", {\n            get: function () {\n                return \"ControlElement\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElement.prototype, \"partOfSeveralChoices\", {\n            get: function () {\n                return this._partOfSeveralChoices;\n            },\n            set: function (value) {\n                this._partOfSeveralChoices = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElement.prototype, \"value\", {\n            get: function () {\n                // value is for the chat response -->\n                var hasTagImage = this.referenceTag.hasImage;\n                var str;\n                if (hasTagImage && !this.partOfSeveralChoices) {\n                    // const image: string = hasTagImage ? \"<img src='\" + this.referenceTag.domElement.getAttribute(\"cf-image\") + \"'/>\" : \"\";\n                    var image = hasTagImage ? \"<img src=\\\"\" + this.referenceTag.domElement.getAttribute(\"cf-image\") + \"\\\"/>\" : \"\";\n                    // str = \"<div class='contains-image'>\"\n                    // str += image;\n                    // str += \"<span>\" + Helpers.getInnerTextOfElement(this.el) + \"</span>\";\n                    // str += \"</div>\";\n                    str = image + cf.Helpers.getInnerTextOfElement(this.el);\n                }\n                else {\n                    // str = \"<div><span>\" + Helpers.getInnerTextOfElement(this.el) + \"</span></div>\";\n                    str = cf.Helpers.getInnerTextOfElement(this.el);\n                }\n                return str;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElement.prototype, \"positionVector\", {\n            get: function () {\n                return this._positionVector;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElement.prototype, \"tabIndex\", {\n            set: function (value) {\n                this.el.tabIndex = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElement.prototype, \"highlight\", {\n            get: function () {\n                return this.el.classList.contains(\"highlight\");\n            },\n            set: function (value) {\n                if (value)\n                    this.el.classList.add(\"highlight\");\n                else\n                    this.el.classList.remove(\"highlight\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElement.prototype, \"focus\", {\n            get: function () {\n                return this._focus;\n            },\n            set: function (value) {\n                this._focus = value;\n                if (this._focus)\n                    this.el.focus();\n                else\n                    this.el.blur();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElement.prototype, \"visible\", {\n            get: function () {\n                return !this.el.classList.contains(\"hide\");\n            },\n            set: function (value) {\n                if (value) {\n                    this.el.classList.remove(\"hide\");\n                }\n                else {\n                    this.el.classList.add(\"hide\");\n                    this.tabIndex = -1;\n                    this.highlight = false;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        ControlElement.prototype.onBlur = function (event) {\n            this._focus = false;\n        };\n        ControlElement.prototype.onFocus = function (event) {\n            this._focus = true;\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ControlElementEvents.ON_FOCUS, this.referenceTag);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.ON_FOCUS, {\n                detail: this.positionVector\n            }));\n        };\n        /**\n        * @name hasImage\n        * if control element contains an image element\n        */\n        ControlElement.prototype.hasImage = function () {\n            return false;\n        };\n        ControlElement.prototype.calcPosition = function () {\n            var mr = parseInt(window.getComputedStyle(this.el).getPropertyValue(\"margin-right\"), 10);\n            // try not to do this to often, re-paint whammy!\n            this._positionVector = {\n                height: this.el.offsetHeight,\n                width: this.el.offsetWidth + mr,\n                x: this.el.offsetLeft,\n                y: this.el.offsetTop,\n                el: this,\n            };\n            this._positionVector.centerX = this._positionVector.x + (this._positionVector.width * 0.5);\n            this._positionVector.centerY = this._positionVector.y + (this._positionVector.height * 0.5);\n        };\n        ControlElement.prototype.setData = function (options) {\n            this.referenceTag = options.referenceTag;\n            _super.prototype.setData.call(this, options);\n        };\n        ControlElement.prototype.animateIn = function () {\n            clearTimeout(this.animateInTimer);\n            this.el.classList.add(\"animate-in\");\n        };\n        ControlElement.prototype.animateOut = function () {\n            this.el.classList.add(\"animate-out\");\n        };\n        ControlElement.prototype.onChoose = function () {\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ControlElementEvents.SUBMIT_VALUE, this.referenceTag);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.SUBMIT_VALUE, {\n                detail: this\n            }));\n        };\n        ControlElement.prototype.dealloc = function () {\n            this.el.removeEventListener('blur', this.onBlurCallback, false);\n            this.onBlurCallback = null;\n            this.el.removeEventListener('focus', this.onFocusCallback, false);\n            this.onFocusCallback = null;\n            _super.prototype.dealloc.call(this);\n        };\n        return ControlElement;\n    }(cf.BasicElement));\n    cf.ControlElement = ControlElement;\n})(cf || (cf = {}));\n\n/// <reference path=\"Button.ts\"/>\n/// <reference path=\"ControlElement.ts\"/>\n/// <reference path=\"RadioButton.ts\"/>\n/// <reference path=\"CheckboxButton.ts\"/>\n/// <reference path=\"OptionsList.ts\"/>\n/// <reference path=\"UploadFileUI.ts\"/>\n/// <reference path=\"../../logic/EventDispatcher.ts\"/>\n/// <reference path=\"../ScrollController.ts\"/>\n/// <reference path=\"../chat/ChatResponse.ts\"/>\n/// <reference path=\"../../../typings/globals/es6-promise/index.d.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    cf.ControlElementsEvents = {\n        ON_RESIZE: \"cf-on-control-elements-resize\",\n        CHANGED: \"cf-on-control-elements-changed\"\n    };\n    var ControlElements = /** @class */ (function () {\n        function ControlElements(options) {\n            this.ignoreKeyboardInput = false;\n            this.rowIndex = -1;\n            this.columnIndex = 0;\n            this.elementWidth = 0;\n            this.filterListNumberOfVisible = 0;\n            this.listWidth = 0;\n            this.el = options.el;\n            this.eventTarget = options.eventTarget;\n            this.cfReference = options.cfReference;\n            this.list = this.el.getElementsByTagName(\"cf-list\")[0];\n            this.infoElement = options.infoEl;\n            this.onScrollCallback = this.onScroll.bind(this);\n            this.el.addEventListener('scroll', this.onScrollCallback, false);\n            this.onResizeCallback = this.onResize.bind(this);\n            window.addEventListener('resize', this.onResizeCallback, false);\n            this.onElementFocusCallback = this.onElementFocus.bind(this);\n            this.eventTarget.addEventListener(cf.ControlElementEvents.ON_FOCUS, this.onElementFocusCallback, false);\n            this.onElementLoadedCallback = this.onElementLoaded.bind(this);\n            this.eventTarget.addEventListener(cf.ControlElementEvents.ON_LOADED, this.onElementLoadedCallback, false);\n            this.onChatReponsesUpdatedCallback = this.onChatReponsesUpdated.bind(this);\n            this.eventTarget.addEventListener(cf.ChatListEvents.CHATLIST_UPDATED, this.onChatReponsesUpdatedCallback, false);\n            this.onUserInputKeyChangeCallback = this.onUserInputKeyChange.bind(this);\n            this.eventTarget.addEventListener(cf.UserInputEvents.KEY_CHANGE, this.onUserInputKeyChangeCallback, false);\n            // user input update\n            this.userInputUpdateCallback = this.onUserInputUpdate.bind(this);\n            this.eventTarget.addEventListener(cf.FlowEvents.USER_INPUT_UPDATE, this.userInputUpdateCallback, false);\n            this.listScrollController = new cf.ScrollController({\n                interactionListener: this.el,\n                listToScroll: this.list,\n                eventTarget: this.eventTarget,\n                listNavButtons: this.el.getElementsByTagName(\"cf-list-button\"),\n            });\n        }\n        Object.defineProperty(ControlElements.prototype, \"active\", {\n            get: function () {\n                return this.elements && this.elements.length > 0;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElements.prototype, \"focus\", {\n            get: function () {\n                if (!this.elements)\n                    return false;\n                var elements = this.getElements();\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element.focus) {\n                        return true;\n                    }\n                }\n                return false;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElements.prototype, \"highlighted\", {\n            get: function () {\n                if (!this.elements)\n                    return false;\n                var elements = this.getElements();\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element.highlight) {\n                        return true;\n                    }\n                }\n                return false;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElements.prototype, \"disabled\", {\n            set: function (value) {\n                if (value)\n                    this.list.classList.add(\"disabled\");\n                else\n                    this.list.classList.remove(\"disabled\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ControlElements.prototype, \"length\", {\n            get: function () {\n                var elements = this.getElements();\n                return elements.length;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        ControlElements.prototype.onScroll = function (event) {\n            // some times the tabbing will result in el scroll, reset this.\n            this.el.scrollLeft = 0;\n        };\n        /**\n        * @name onElementLoaded\n        * when element is loaded, usally image loaded.\n        */\n        ControlElements.prototype.onElementLoaded = function (event) {\n            this.onResize(null);\n        };\n        ControlElements.prototype.onElementFocus = function (event) {\n            var vector = event.detail;\n            var x = (vector.x + vector.width < this.elementWidth ? 0 : vector.x - vector.width);\n            x *= -1;\n            this.updateRowColIndexFromVector(vector);\n            this.listScrollController.setScroll(x, 0);\n        };\n        ControlElements.prototype.updateRowColIndexFromVector = function (vector) {\n            for (var i = 0; i < this.tableableRows.length; i++) {\n                var items = this.tableableRows[i];\n                for (var j = 0; j < items.length; j++) {\n                    var item = items[j];\n                    if (item == vector.el) {\n                        this.rowIndex = i;\n                        this.columnIndex = j;\n                        break;\n                    }\n                }\n            }\n        };\n        ControlElements.prototype.onChatReponsesUpdated = function (event) {\n            var _this = this;\n            clearTimeout(this.animateInFromResponseTimer);\n            // only show when user response\n            if (!event.detail.currentResponse.isRobotResponse) {\n                this.animateInFromResponseTimer = setTimeout(function () {\n                    _this.animateElementsIn();\n                }, this.cfReference.uiOptions.controlElementsInAnimationDelay);\n            }\n        };\n        ControlElements.prototype.onListChanged = function () {\n            var _this = this;\n            // reflow\n            this.list.offsetHeight;\n            requestAnimationFrame(function () {\n                cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.ControlElementsEvents.CHANGED);\n                _this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementsEvents.CHANGED));\n            });\n        };\n        ControlElements.prototype.onUserInputKeyChange = function (event) {\n            if (this.ignoreKeyboardInput) {\n                this.ignoreKeyboardInput = false;\n                return;\n            }\n            var dto = event.detail;\n            var userInput = dto.dto.input;\n            if (this.active) {\n                var isNavKey = [cf.Dictionary.keyCodes[\"left\"], cf.Dictionary.keyCodes[\"right\"], cf.Dictionary.keyCodes[\"down\"], cf.Dictionary.keyCodes[\"up\"]].indexOf(dto.keyCode) != -1;\n                var shouldFilter = dto.inputFieldActive && !isNavKey;\n                if (shouldFilter) {\n                    // input field is active, so we should filter..\n                    var dto_1 = event.detail.dto;\n                    var inputValue = dto_1.input.getInputValue();\n                    this.filterElementsFrom(inputValue);\n                }\n                else {\n                    if (dto.keyCode == cf.Dictionary.keyCodes[\"left\"]) {\n                        this.columnIndex--;\n                    }\n                    else if (dto.keyCode == cf.Dictionary.keyCodes[\"right\"]) {\n                        this.columnIndex++;\n                    }\n                    else if (dto.keyCode == cf.Dictionary.keyCodes[\"down\"]) {\n                        this.updateRowIndex(1);\n                    }\n                    else if (dto.keyCode == cf.Dictionary.keyCodes[\"up\"]) {\n                        this.updateRowIndex(-1);\n                    }\n                    else if (dto.keyCode == cf.Dictionary.keyCodes[\"enter\"] || dto.keyCode == cf.Dictionary.keyCodes[\"space\"]) {\n                        if (this.tableableRows[this.rowIndex] && this.tableableRows[this.rowIndex][this.columnIndex]) {\n                            this.tableableRows[this.rowIndex][this.columnIndex].el.click();\n                        }\n                        else if (this.tableableRows[0] && this.tableableRows[0].length == 1) {\n                            // this is when only one element in a filter, then we click it!\n                            this.tableableRows[0][0].el.click();\n                        }\n                    }\n                    if (!this.validateRowColIndexes()) {\n                        userInput.setFocusOnInput();\n                    }\n                }\n            }\n            if (!userInput.active && this.validateRowColIndexes() && this.tableableRows && (this.rowIndex == 0 || this.rowIndex == 1)) {\n                this.tableableRows[this.rowIndex][this.columnIndex].focus = true;\n            }\n            else if (!userInput.active) {\n                userInput.setFocusOnInput();\n            }\n        };\n        ControlElements.prototype.validateRowColIndexes = function () {\n            var maxRowIndex = (this.el.classList.contains(\"two-row\") ? 1 : 0);\n            if (this.rowIndex != -1 && this.tableableRows[this.rowIndex]) {\n                // columnIndex is only valid if rowIndex is valid\n                if (this.columnIndex < 0) {\n                    this.columnIndex = this.tableableRows[this.rowIndex].length - 1;\n                }\n                if (this.columnIndex > this.tableableRows[this.rowIndex].length - 1) {\n                    this.columnIndex = 0;\n                }\n                return true;\n            }\n            else {\n                this.resetTabList();\n                return false;\n            }\n        };\n        ControlElements.prototype.updateRowIndex = function (direction) {\n            var oldRowIndex = this.rowIndex;\n            this.rowIndex += direction;\n            if (this.tableableRows[this.rowIndex]) {\n                // when row index is changed we need to find the closest column element, we cannot expect them to be indexly aligned\n                var centerX = this.tableableRows[oldRowIndex] ? this.tableableRows[oldRowIndex][this.columnIndex].positionVector.centerX : 0;\n                var items = this.tableableRows[this.rowIndex];\n                var currentDistance = 10000000000000;\n                for (var i = 0; i < items.length; i++) {\n                    var element = items[i];\n                    if (currentDistance > Math.abs(centerX - element.positionVector.centerX)) {\n                        currentDistance = Math.abs(centerX - element.positionVector.centerX);\n                        this.columnIndex = i;\n                    }\n                }\n            }\n        };\n        ControlElements.prototype.resetTabList = function () {\n            this.rowIndex = -1;\n            this.columnIndex = -1;\n        };\n        ControlElements.prototype.onUserInputUpdate = function (event) {\n            this.el.classList.remove(\"animate-in\");\n            this.infoElement.classList.remove(\"show\");\n            if (this.elements) {\n                var elements = this.getElements();\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    element.animateOut();\n                }\n            }\n        };\n        ControlElements.prototype.filterElementsFrom = function (value) {\n            var inputValuesLowerCase = value.toLowerCase().split(\" \");\n            if (inputValuesLowerCase.indexOf(\"\") != -1)\n                inputValuesLowerCase.splice(inputValuesLowerCase.indexOf(\"\"), 1);\n            var elements = this.getElements();\n            if (elements.length > 1) {\n                // the type is not strong with this one..\n                var itemsVisible = [];\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    element.highlight = false;\n                    var elementVisibility = true;\n                    // check for all words of input\n                    for (var i_1 = 0; i_1 < inputValuesLowerCase.length; i_1++) {\n                        var inputWord = inputValuesLowerCase[i_1];\n                        if (elementVisibility) {\n                            elementVisibility = element.value.toLowerCase().indexOf(inputWord) != -1;\n                        }\n                    }\n                    // set element visibility.\n                    element.visible = elementVisibility;\n                    if (elementVisibility && element.visible)\n                        itemsVisible.push(element);\n                }\n                // set feedback text for filter..\n                this.infoElement.innerHTML = itemsVisible.length == 0 ? cf.Dictionary.get(\"input-no-filter\").split(\"{input-value}\").join(value) : \"\";\n                if (itemsVisible.length == 0) {\n                    this.infoElement.classList.add(\"show\");\n                }\n                else {\n                    this.infoElement.classList.remove(\"show\");\n                }\n                // crude way of checking if list has changed...\n                var hasListChanged = this.filterListNumberOfVisible != itemsVisible.length;\n                if (hasListChanged) {\n                    this.animateElementsIn();\n                }\n                this.filterListNumberOfVisible = itemsVisible.length;\n                // highlight first item\n                if (value != \"\" && this.filterListNumberOfVisible > 0)\n                    itemsVisible[0].highlight = true;\n            }\n        };\n        ControlElements.prototype.clickOnHighlighted = function () {\n            var elements = this.getElements();\n            for (var i = 0; i < elements.length; i++) {\n                var element = elements[i];\n                if (element.highlight) {\n                    element.el.click();\n                    break;\n                }\n            }\n        };\n        ControlElements.prototype.animateElementsIn = function () {\n            var _this = this;\n            if (this.elements.length > 0) {\n                this.resize();\n                // this.el.style.transition = 'height 0.35s ease-out 0.2s';\n                this.list.style.height = '0px';\n                setTimeout(function () {\n                    _this.list.style.height = _this.list.scrollHeight + 'px';\n                    var elements = _this.getElements();\n                    setTimeout(function () {\n                        if (elements.length > 0) {\n                            if (!_this.el.classList.contains(\"animate-in\"))\n                                _this.el.classList.add(\"animate-in\");\n                            for (var i = 0; i < elements.length; i++) {\n                                var element = elements[i];\n                                element.animateIn();\n                            }\n                        }\n                        document.querySelector('.scrollableInner').classList.remove('scroll');\n                        // Check if chatlist is scrolled to the bottom - if not we need to do it manually (pertains to Chrome)\n                        var scrollContainer = document.querySelector('scrollable');\n                        if (scrollContainer.scrollTop < scrollContainer.scrollHeight) {\n                            scrollContainer.scrollTop = scrollContainer.scrollHeight;\n                        }\n                    }, 300);\n                }, 200);\n            }\n        };\n        ControlElements.prototype.getElements = function () {\n            if (this.elements && this.elements.length > 0 && this.elements[0].type == \"OptionsList\")\n                return this.elements[0].elements;\n            return this.elements;\n        };\n        /**\n        * @name buildTabableRows\n        * build the tabable array index\n        */\n        ControlElements.prototype.buildTabableRows = function () {\n            this.tableableRows = [];\n            this.resetTabList();\n            var elements = this.getElements();\n            if (this.el.classList.contains(\"two-row\")) {\n                // two rows\n                this.tableableRows[0] = [];\n                this.tableableRows[1] = [];\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element.visible) {\n                        // crude way of checking if element is top row or bottom row..\n                        if (element.positionVector.y < 30)\n                            this.tableableRows[0].push(element);\n                        else\n                            this.tableableRows[1].push(element);\n                    }\n                }\n            }\n            else {\n                // single row\n                this.tableableRows[0] = [];\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element.visible)\n                        this.tableableRows[0].push(element);\n                }\n            }\n        };\n        ControlElements.prototype.resetAfterErrorMessage = function () {\n            this.currentControlElement = null;\n            this.disabled = false;\n        };\n        ControlElements.prototype.focusFrom = function (angle) {\n            if (!this.tableableRows)\n                return;\n            this.columnIndex = 0;\n            if (angle == \"bottom\") {\n                this.rowIndex = this.el.classList.contains(\"two-row\") ? 1 : 0;\n            }\n            else if (angle == \"top\") {\n                this.rowIndex = 0;\n            }\n            if (this.tableableRows[this.rowIndex] && this.tableableRows[this.rowIndex][this.columnIndex]) {\n                this.ignoreKeyboardInput = true;\n                if (!this.cfReference.options.preventAutoFocus) {\n                    this.tableableRows[this.rowIndex][this.columnIndex].focus = true;\n                }\n            }\n            else {\n                this.resetTabList();\n            }\n        };\n        ControlElements.prototype.updateStateOnElementsFromTag = function (tag) {\n            for (var index = 0; index < this.elements.length; index++) {\n                var element = this.elements[index];\n                if (element.referenceTag == tag) {\n                    this.updateStateOnElements(element);\n                    break;\n                }\n            }\n        };\n        ControlElements.prototype.updateStateOnElements = function (controlElement) {\n            this.currentControlElement = controlElement;\n            if (this.currentControlElement.type == \"RadioButton\") {\n                // uncheck other radio buttons...\n                var elements = this.getElements();\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element != controlElement) {\n                        element.checked = false;\n                    }\n                    else {\n                        element.checked = true;\n                    }\n                }\n            }\n            else if (this.currentControlElement.type == \"CheckboxButton\") {\n                // change only the changed input\n                var elements = this.getElements();\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element == controlElement) {\n                        var isChecked = element.referenceTag.domElement.checked;\n                        element.checked = isChecked;\n                    }\n                }\n            }\n        };\n        ControlElements.prototype.reset = function () {\n            this.infoElement.classList.remove(\"show\");\n            this.el.classList.remove(\"one-row\");\n            this.el.classList.remove(\"two-row\");\n            // this.el.style.transition = 'height 0.35s ease-out 0.2s';\n            this.list.style.height = '0px';\n        };\n        ControlElements.prototype.getElement = function (index) {\n            return this.elements[index];\n        };\n        ControlElements.prototype.getDTO = function () {\n            var dto = {\n                text: undefined,\n                controlElements: [],\n            };\n            // generate text value for ChatReponse\n            if (this.elements && this.elements.length > 0) {\n                switch (this.elements[0].type) {\n                    case \"CheckboxButton\":\n                        var numChecked = 0; // check if more than 1 is checked.\n                        var values = [];\n                        for (var i = 0; i < this.elements.length; i++) {\n                            var element_1 = this.elements[i];\n                            if (element_1.checked) {\n                                if (numChecked++ > 1)\n                                    break;\n                            }\n                        }\n                        for (var i = 0; i < this.elements.length; i++) {\n                            var element_2 = this.elements[i];\n                            if (element_2.checked) {\n                                if (numChecked > 1)\n                                    element_2.partOfSeveralChoices = true;\n                                values.push(element_2.value);\n                            }\n                            dto.controlElements.push(element_2);\n                        }\n                        dto.text = cf.Dictionary.parseAndGetMultiValueString(values);\n                        break;\n                    case \"RadioButton\":\n                        for (var i = 0; i < this.elements.length; i++) {\n                            var element_3 = this.elements[i];\n                            if (element_3.checked) {\n                                dto.text = element_3.value;\n                            }\n                            dto.controlElements.push(element_3);\n                        }\n                        break;\n                    case \"OptionsList\":\n                        var element = this.elements[0];\n                        dto.controlElements = element.getValue();\n                        var values = [];\n                        if (dto.controlElements && dto.controlElements[0]) {\n                            for (var i_2 = 0; i_2 < dto.controlElements.length; i_2++) {\n                                var element_4 = dto.controlElements[i_2];\n                                values.push(dto.controlElements[i_2].value);\n                            }\n                        }\n                        // after value is created then set to all elements\n                        dto.controlElements = element.elements;\n                        dto.text = cf.Dictionary.parseAndGetMultiValueString(values);\n                        break;\n                    case \"UploadFileUI\":\n                        dto.text = this.elements[0].getFilesAsString(); //Dictionary.parseAndGetMultiValueString(values);\n                        dto.controlElements.push(this.elements[0]);\n                        break;\n                }\n            }\n            return dto;\n        };\n        ControlElements.prototype.clearTagsAndReset = function () {\n            this.reset();\n            if (this.elements) {\n                while (this.elements.length > 0) {\n                    this.elements.pop().dealloc();\n                }\n            }\n            this.list.innerHTML = \"\";\n            this.onListChanged();\n        };\n        ControlElements.prototype.buildTags = function (tags) {\n            var _this = this;\n            this.disabled = false;\n            var topList = this.el.parentNode.getElementsByTagName(\"ul\")[0];\n            var bottomList = this.el.parentNode.getElementsByTagName(\"ul\")[1];\n            // remove old elements\n            this.clearTagsAndReset();\n            this.elements = [];\n            for (var i = 0; i < tags.length; i++) {\n                var tag = tags[i];\n                switch (tag.type) {\n                    case \"radio\":\n                        this.elements.push(new cf.RadioButton({\n                            referenceTag: tag,\n                            eventTarget: this.eventTarget\n                        }));\n                        break;\n                    case \"checkbox\":\n                        this.elements.push(new cf.CheckboxButton({\n                            referenceTag: tag,\n                            eventTarget: this.eventTarget\n                        }));\n                        break;\n                    case \"select\":\n                        this.elements.push(new cf.OptionsList({\n                            referenceTag: tag,\n                            context: this.list,\n                            eventTarget: this.eventTarget\n                        }));\n                        break;\n                    case \"input\":\n                    default:\n                        if (tag.type == \"file\") {\n                            this.elements.push(new cf.UploadFileUI({\n                                referenceTag: tag,\n                                eventTarget: this.eventTarget\n                            }));\n                        }\n                        // nothing to add.\n                        break;\n                }\n                if (tag.type != \"select\" && this.elements.length > 0) {\n                    var element = this.elements[this.elements.length - 1];\n                    this.list.appendChild(element.el);\n                }\n            }\n            var isElementsOptionsList = this.elements[0] && this.elements[0].type == \"OptionsList\";\n            if (isElementsOptionsList) {\n                this.filterListNumberOfVisible = this.elements[0].elements.length;\n            }\n            else {\n                this.filterListNumberOfVisible = tags.length;\n            }\n            new Promise(function (resolve, reject) { return _this.resize(resolve, reject); }).then(function () {\n                var h = _this.list.offsetHeight; //this.el.classList.contains(\"one-row\") ? 52 : this.el.classList.contains(\"two-row\") ? 102 : 0;\n                var controlElementsAddedDTO = {\n                    height: h,\n                };\n                _this.onListChanged();\n                cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.UserInputEvents.CONTROL_ELEMENTS_ADDED, controlElementsAddedDTO);\n                _this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.CONTROL_ELEMENTS_ADDED, {\n                    detail: controlElementsAddedDTO\n                }));\n            });\n        };\n        ControlElements.prototype.onResize = function (event) {\n            this.resize();\n        };\n        ControlElements.prototype.resize = function (resolve, reject) {\n            // scrollbar things\n            // Element.offsetWidth - Element.clientWidth\n            this.list.style.width = \"100%\";\n            this.el.classList.remove(\"resized\");\n            this.el.classList.remove(\"one-row\");\n            this.el.classList.remove(\"two-row\");\n            this.elementWidth = 0;\n            this.listWidth = 0;\n            var elements = this.getElements();\n            if (elements && elements.length > 0) {\n                var listWidthValues = [];\n                var listWidthValues2 = [];\n                var containsElementWithImage = false;\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element.visible) {\n                        element.calcPosition();\n                        this.listWidth += element.positionVector.width;\n                        listWidthValues.push(element.positionVector.x + element.positionVector.width);\n                        listWidthValues2.push(element);\n                    }\n                    if (element.hasImage())\n                        containsElementWithImage = true;\n                }\n                var elOffsetWidth = this.el.offsetWidth;\n                var isListWidthOverElementWidth = this.listWidth > elOffsetWidth;\n                if (isListWidthOverElementWidth && !containsElementWithImage) {\n                    this.el.classList.add(\"two-row\");\n                    this.listWidth = Math.max(elOffsetWidth, Math.round((listWidthValues[Math.floor(listWidthValues.length / 2)]) + 50));\n                    this.list.style.width = this.listWidth + \"px\";\n                }\n                else {\n                    this.el.classList.add(\"one-row\");\n                }\n                // recalc after LIST classes has been added\n                for (var i = 0; i < elements.length; i++) {\n                    var element = elements[i];\n                    if (element.visible) {\n                        element.calcPosition();\n                    }\n                }\n                // check again after classes are set.\n                elOffsetWidth = this.el.offsetWidth;\n                isListWidthOverElementWidth = this.listWidth > elOffsetWidth;\n                // sort the list so we can set tabIndex properly\n                var elementsCopyForSorting = elements.slice();\n                var tabIndexFilteredElements = elementsCopyForSorting.sort(function (a, b) {\n                    var aOverB = a.positionVector.y > b.positionVector.y;\n                    return a.positionVector.x == b.positionVector.x ? (aOverB ? 1 : -1) : a.positionVector.x < b.positionVector.x ? -1 : 1;\n                });\n                var tabIndex = 0;\n                for (var i = 0; i < tabIndexFilteredElements.length; i++) {\n                    var element = tabIndexFilteredElements[i];\n                    if (element.visible) {\n                        //tabindex 1 are the UserTextInput element\n                        element.tabIndex = 2 + (tabIndex++);\n                    }\n                    else {\n                        element.tabIndex = -1;\n                    }\n                }\n                // toggle nav button visiblity\n                if (isListWidthOverElementWidth) {\n                    this.el.classList.remove(\"hide-nav-buttons\");\n                }\n                else {\n                    this.el.classList.add(\"hide-nav-buttons\");\n                }\n                this.elementWidth = elOffsetWidth;\n                // resize scroll\n                this.listScrollController.resize(this.listWidth, this.elementWidth);\n                this.el.classList.add(\"resized\");\n                this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementsEvents.ON_RESIZE));\n                if (resolve) {\n                    // only build when there is something to resolve\n                    this.buildTabableRows();\n                    resolve();\n                }\n            }\n        };\n        ControlElements.prototype.dealloc = function () {\n            this.currentControlElement = null;\n            this.tableableRows = null;\n            window.removeEventListener('resize', this.onResizeCallback, false);\n            this.onResizeCallback = null;\n            this.el.removeEventListener('scroll', this.onScrollCallback, false);\n            this.onScrollCallback = null;\n            this.eventTarget.removeEventListener(cf.ControlElementEvents.ON_FOCUS, this.onElementFocusCallback, false);\n            this.onElementFocusCallback = null;\n            this.eventTarget.removeEventListener(cf.ChatListEvents.CHATLIST_UPDATED, this.onChatReponsesUpdatedCallback, false);\n            this.onChatReponsesUpdatedCallback = null;\n            this.eventTarget.removeEventListener(cf.UserInputEvents.KEY_CHANGE, this.onUserInputKeyChangeCallback, false);\n            this.onUserInputKeyChangeCallback = null;\n            this.eventTarget.removeEventListener(cf.FlowEvents.USER_INPUT_UPDATE, this.userInputUpdateCallback, false);\n            this.userInputUpdateCallback = null;\n            this.eventTarget.removeEventListener(cf.ControlElementEvents.ON_LOADED, this.onElementLoadedCallback, false);\n            this.onElementLoadedCallback = null;\n            this.listScrollController.dealloc();\n        };\n        return ControlElements;\n    }());\n    cf.ControlElements = ControlElements;\n})(cf || (cf = {}));\n\n/// <reference path=\"../logic/Helpers.ts\"/>\n/// <reference path=\"../logic/EventDispatcher.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    var ScrollController = /** @class */ (function () {\n        function ScrollController(options) {\n            this.listWidth = 0;\n            this.visibleAreaWidth = 0;\n            this.max = 0;\n            this.interacting = false;\n            this.x = 0;\n            this.xTarget = 0;\n            this.startX = 0;\n            this.startXTarget = 0;\n            this.mouseSpeed = 0;\n            this.mouseSpeedTarget = 0;\n            this.direction = 0;\n            this.directionTarget = 0;\n            this.inputAccerlation = 0;\n            this.inputAccerlationTarget = 0;\n            this.interactionListener = options.interactionListener;\n            this.eventTarget = options.eventTarget;\n            this.listToScroll = options.listToScroll;\n            this.prevButton = options.listNavButtons[0];\n            this.nextButton = options.listNavButtons[1];\n            this.onListNavButtonsClickCallback = this.onListNavButtonsClick.bind(this);\n            this.prevButton.addEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n            this.nextButton.addEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n            this.documentLeaveCallback = this.documentLeave.bind(this);\n            this.onInteractStartCallback = this.onInteractStart.bind(this);\n            this.onInteractEndCallback = this.onInteractEnd.bind(this);\n            this.onInteractMoveCallback = this.onInteractMove.bind(this);\n            document.addEventListener(\"mouseleave\", this.documentLeaveCallback, false);\n            document.addEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.documentLeaveCallback, false);\n            this.interactionListener.addEventListener(cf.Helpers.getMouseEvent(\"mousedown\"), this.onInteractStartCallback, false);\n            this.interactionListener.addEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.onInteractEndCallback, false);\n            this.interactionListener.addEventListener(cf.Helpers.getMouseEvent(\"mousemove\"), this.onInteractMoveCallback, false);\n        }\n        ScrollController.prototype.onListNavButtonsClick = function (event) {\n            var dirClick = event.currentTarget.getAttribute(\"direction\");\n            this.pushDirection(dirClick == \"next\" ? -1 : 1);\n        };\n        ScrollController.prototype.documentLeave = function (event) {\n            this.onInteractEnd(event);\n        };\n        ScrollController.prototype.onInteractStart = function (event) {\n            var vector = cf.Helpers.getXYFromMouseTouchEvent(event);\n            this.interacting = true;\n            this.startX = vector.x;\n            this.startXTarget = this.startX;\n            this.inputAccerlation = 0;\n            this.render();\n        };\n        ScrollController.prototype.onInteractEnd = function (event) {\n            this.interacting = false;\n        };\n        ScrollController.prototype.onInteractMove = function (event) {\n            if (this.interacting) {\n                var vector = cf.Helpers.getXYFromMouseTouchEvent(event);\n                var newAcc = vector.x - this.startX;\n                var magnifier = 6.2;\n                this.inputAccerlationTarget = newAcc * magnifier;\n                this.directionTarget = this.inputAccerlationTarget < 0 ? -1 : 1;\n                this.startXTarget = vector.x;\n            }\n        };\n        ScrollController.prototype.render = function () {\n            var _this = this;\n            if (this.rAF)\n                cancelAnimationFrame(this.rAF);\n            // normalise startX\n            this.startX += (this.startXTarget - this.startX) * 0.2;\n            // animate accerlaration\n            this.inputAccerlation += (this.inputAccerlationTarget - this.inputAccerlation) * (this.interacting ? Math.min(ScrollController.acceleration + 0.1, 1) : ScrollController.acceleration);\n            var accDamping = 0.25;\n            this.inputAccerlationTarget *= accDamping;\n            // animate directions\n            this.direction += (this.directionTarget - this.direction) * 0.2;\n            // extra extra\n            this.mouseSpeed += (this.mouseSpeedTarget - this.mouseSpeed) * 0.2;\n            this.direction += this.mouseSpeed;\n            // animate x\n            this.xTarget += this.inputAccerlation * 0.05;\n            // bounce back when over\n            if (this.xTarget > 0)\n                this.xTarget += (0 - this.xTarget) * cf.Helpers.lerp(ScrollController.acceleration, 0.3, 0.8);\n            if (this.xTarget < this.max)\n                this.xTarget += (this.max - this.xTarget) * cf.Helpers.lerp(ScrollController.acceleration, 0.3, 0.8);\n            this.x += (this.xTarget - this.x) * 0.4;\n            // toggle visibility on nav arrows\n            var xRounded = Math.round(this.x);\n            if (xRounded < 0) {\n                if (!this.prevButton.classList.contains(\"active\"))\n                    this.prevButton.classList.add(\"active\");\n                if (!this.prevButton.classList.contains(\"cf-gradient\"))\n                    this.prevButton.classList.add(\"cf-gradient\");\n            }\n            if (xRounded == 0) {\n                if (this.prevButton.classList.contains(\"active\"))\n                    this.prevButton.classList.remove(\"active\");\n                if (this.prevButton.classList.contains(\"cf-gradient\"))\n                    this.prevButton.classList.remove(\"cf-gradient\");\n            }\n            if (xRounded > this.max) {\n                if (!this.nextButton.classList.contains(\"active\"))\n                    this.nextButton.classList.add(\"active\");\n                if (!this.nextButton.classList.contains(\"cf-gradient\"))\n                    this.nextButton.classList.add(\"cf-gradient\");\n            }\n            if (xRounded <= this.max) {\n                if (this.nextButton.classList.contains(\"active\"))\n                    this.nextButton.classList.remove(\"active\");\n                if (this.nextButton.classList.contains(\"cf-gradient\"))\n                    this.nextButton.classList.remove(\"cf-gradient\");\n            }\n            // set css transforms\n            var xx = this.x;\n            cf.Helpers.setTransform(this.listToScroll, \"translateX(\" + xx + \"px)\");\n            // cycle render\n            if (this.interacting || (Math.abs(this.x - this.xTarget) > 0.02 && !this.interacting))\n                this.rAF = window.requestAnimationFrame(function () { return _this.render(); });\n        };\n        ScrollController.prototype.setScroll = function (x, y) {\n            this.xTarget = this.visibleAreaWidth == this.listWidth ? 0 : x;\n            this.render();\n        };\n        ScrollController.prototype.pushDirection = function (dir) {\n            this.inputAccerlationTarget += (5000) * dir;\n            this.render();\n        };\n        ScrollController.prototype.dealloc = function () {\n            this.prevButton.removeEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n            this.nextButton.removeEventListener(\"click\", this.onListNavButtonsClickCallback, false);\n            this.onListNavButtonsClickCallback = null;\n            this.prevButton = null;\n            this.nextButton = null;\n            document.removeEventListener(\"mouseleave\", this.documentLeaveCallback, false);\n            document.removeEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.documentLeaveCallback, false);\n            this.interactionListener.removeEventListener(cf.Helpers.getMouseEvent(\"mousedown\"), this.onInteractStartCallback, false);\n            this.interactionListener.removeEventListener(cf.Helpers.getMouseEvent(\"mouseup\"), this.onInteractEndCallback, false);\n            this.interactionListener.removeEventListener(cf.Helpers.getMouseEvent(\"mousemove\"), this.onInteractMoveCallback, false);\n            this.documentLeaveCallback = null;\n            this.onInteractStartCallback = null;\n            this.onInteractEndCallback = null;\n            this.onInteractMoveCallback = null;\n        };\n        ScrollController.prototype.reset = function () {\n            this.interacting = false;\n            this.startX = 0;\n            this.startXTarget = this.startX;\n            this.inputAccerlation = 0;\n            this.x = 0;\n            this.xTarget = 0;\n            cf.Helpers.setTransform(this.listToScroll, \"translateX(0px)\");\n            this.render();\n            this.prevButton.classList.remove(\"active\");\n            this.nextButton.classList.remove(\"active\");\n        };\n        ScrollController.prototype.resize = function (listWidth, visibleAreaWidth) {\n            this.reset();\n            this.visibleAreaWidth = visibleAreaWidth;\n            this.listWidth = Math.max(visibleAreaWidth, listWidth);\n            this.max = (this.listWidth - this.visibleAreaWidth) * -1;\n            this.render();\n        };\n        ScrollController.acceleration = 0.1;\n        return ScrollController;\n    }());\n    cf.ScrollController = ScrollController;\n})(cf || (cf = {}));\n\n/// <reference path=\"../logic/FlowManager.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var ProgressBar = /** @class */ (function () {\n        function ProgressBar(options) {\n            var _this = this;\n            this.flowUpdateCallback = this.onFlowUpdate.bind(this);\n            this.eventTarget = options.eventTarget;\n            this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n            this.eventTarget.addEventListener(cf.FlowEvents.FORM_SUBMIT, function () { return _this.setWidth(100); }, false);\n            this.el = document.createElement(\"div\");\n            this.el.className = \"cf-progressBar\";\n            this.bar = document.createElement(\"div\");\n            this.bar.className = 'bar';\n            this.el.appendChild(this.bar);\n            setTimeout(function () { return _this.init(); }, 800);\n        }\n        ProgressBar.prototype.init = function () {\n            this.el.classList.add('show');\n        };\n        ProgressBar.prototype.onFlowUpdate = function (event) {\n            this.setWidth(event.detail.step / event.detail.maxSteps * 100);\n        };\n        ProgressBar.prototype.setWidth = function (percentage) {\n            this.bar.style.width = percentage + \"%\";\n        };\n        ProgressBar.prototype.dealloc = function () {\n            this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n            this.flowUpdateCallback = null;\n        };\n        return ProgressBar;\n    }());\n    cf.ProgressBar = ProgressBar;\n})(cf || (cf = {}));\n\n/// <reference path=\"../logic/Helpers.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    // class\n    var Dictionary = /** @class */ (function () {\n        function Dictionary(options) {\n            // can be overwrittenMicrophone error\n            this.data = {\n                \"user-image\": 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iMTAwIiBmaWxsPSIjMzAzMDMwIi8+CjxwYXRoIGQ9Ik0xMDAgNTVMMTM4Ljk3MSAxMjIuNUg2MS4wMjg5TDEwMCA1NVoiIGZpbGw9IiNFNUU2RUEiLz4KPC9zdmc+Cg==',\n                \"entry-not-found\": \"Dictionary item not found.\",\n                \"awaiting-mic-permission\": \"Awaiting mic permission\",\n                \"user-audio-reponse-invalid\": \"I didn't get that, try again.\",\n                \"microphone-terminal-error\": \"Audio input not supported\",\n                \"input-placeholder\": \"Type your answer here ...\",\n                \"group-placeholder\": \"Type to filter ...\",\n                \"input-placeholder-error\": \"Your input is not correct ...\",\n                \"input-placeholder-required\": \"Input is required ...\",\n                \"input-placeholder-file-error\": \"File upload failed ...\",\n                \"input-placeholder-file-size-error\": \"File size too big ...\",\n                \"input-no-filter\": \"No results found for {input-value}\",\n                \"user-reponse-and\": \" and \",\n                \"user-reponse-missing\": \"Missing input ...\",\n                \"user-reponse-missing-group\": \"Nothing selected ...\",\n                \"general\": \"General type1||General type2\",\n                \"icon-type-file\": \"<svg class='cf-icon-file' viewBox='0 0 10 14' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'><g transform='translate(-756.000000, -549.000000)' fill='#0D83FF'><g transform='translate(736.000000, 127.000000)'><g transform='translate(0.000000, 406.000000)'><polygon points='20 16 26.0030799 16 30 19.99994 30 30 20 30'></polygon></g></g></g></g></svg>\",\n            };\n            // can be overwriten\n            this.robotData = {\n                \"robot-image\": 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iMTAwIiBmaWxsPSIjRTVFNkVBIi8+CjxyZWN0IHg9IjY2IiB5PSI2NiIgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiBmaWxsPSIjMzAzMDMwIi8+Cjwvc3ZnPgo=',\n                \"input\": \"Please write some text.\",\n                \"text\": \"Please write some text.\",\n                \"textarea\": \"Please write some text.\",\n                \"checkbox\": \"Select as many as you want.\",\n                \"name\": \"What's your name?\",\n                \"email\": \"Need your e-mail.\",\n                \"password\": \"Please provide password\",\n                \"tel\": \"What's your phone number?\",\n                \"radio\": \"I need you to select one of these.\",\n                \"select\": \"Choose any of these options.\",\n                \"file\": \"Select a file to upload.\",\n                \"general\": \"General1||General2||General3..\"\n            };\n            Dictionary.instance = this;\n            this.version = options.version;\n            // overwrite data if defined \n            if (options && options.data)\n                this.data = this.validateAndSetNewData(options.data, this.data);\n            // overwrite user image\n            if (options.userImage) {\n                this.data[\"user-image\"] = options.userImage;\n            }\n            else {\n                this.data['user-image'] = this.data['user-image'];\n            }\n            // overwrite robot image\n            if (options.robotImage) {\n                this.robotData[\"robot-image\"] = options.robotImage;\n            }\n            else {\n                this.robotData['robot-image'] = this.robotData['robot-image'];\n            }\n            // overwrite robot questions if defined\n            if (options && options.robotData)\n                this.robotData = this.validateAndSetNewData(options.robotData, this.robotData);\n        }\n        Dictionary.get = function (id) {\n            var ins = Dictionary.instance;\n            var value = ins.data[id];\n            if (!value) {\n                value = ins.data[\"entry-not-found\"];\n            }\n            else {\n                var values = cf.Helpers.getValuesOfBars(value);\n                value = values[Math.floor(Math.random() * values.length)];\n            }\n            return value;\n        };\n        /**\n        * @name set\n        * set a dictionary value\n        *\tid: string, id of the value to update\n        *\ttype: string, \"human\" || \"robot\"\n        *\tvalue: string, value to be inserted\n        */\n        Dictionary.set = function (id, type, value) {\n            var ins = Dictionary.instance;\n            var obj = type == \"robot\" ? ins.robotData : ins.data;\n            obj[id] = value;\n            return obj[id];\n        };\n        Dictionary.getRobotResponse = function (tagType) {\n            var ins = Dictionary.instance;\n            var value = ins.robotData[tagType];\n            if (!value) {\n                // value not found, so pick a general one\n                var generals = cf.Helpers.getValuesOfBars(ins.robotData[\"general\"]);\n                value = generals[Math.floor(Math.random() * generals.length)];\n            }\n            else {\n                var values = cf.Helpers.getValuesOfBars(value);\n                value = values[Math.floor(Math.random() * values.length)];\n            }\n            return value;\n        };\n        Dictionary.parseAndGetMultiValueString = function (arr) {\n            // check ControlElement.ts for value(s)\n            var value = \"\";\n            for (var i = 0; i < arr.length; i++) {\n                var str = arr[i];\n                var sym = (arr.length > 1 && i == arr.length - 2 ? Dictionary.get(\"user-reponse-and\") : \", \");\n                value += str + (i < arr.length - 1 ? sym : \"\");\n            }\n            return value;\n        };\n        Dictionary.prototype.validateAndSetNewData = function (newData, originalDataObject) {\n            for (var key in originalDataObject) {\n                if (!newData[key]) {\n                    console.warn(\"Conversational Form Dictionary warning, '\" + key + \"' value is undefined, mapping '\" + key + \"' to default value. See Dictionary.ts for keys.\");\n                    newData[key] = originalDataObject[key];\n                }\n            }\n            return newData;\n        };\n        Dictionary.keyCodes = {\n            \"left\": 37,\n            \"right\": 39,\n            \"down\": 40,\n            \"up\": 38,\n            \"backspace\": 8,\n            \"enter\": 13,\n            \"space\": 32,\n            \"shift\": 16,\n            \"tab\": 9,\n        };\n        return Dictionary;\n    }());\n    cf.Dictionary = Dictionary;\n})(cf || (cf = {}));\n\n/// <reference path=\"../data/Dictionary.ts\"/>\n/// <reference path=\"InputTag.ts\"/>\n/// <reference path=\"ButtonTag.ts\"/>\n/// <reference path=\"SelectTag.ts\"/>\n/// <reference path=\"OptionTag.ts\"/>\n/// <reference path=\"CfRobotMessageTag.ts\"/>\n/// <reference path=\"../ConversationalForm.ts\"/>\n/// <reference path=\"../logic/EventDispatcher.ts\"/>\n/// <reference path=\"../parsing/TagsParser.ts\"/>\n// basic tag from form logic\n// types:\n// radio\n// text\n// email\n// tel\n// password\n// checkbox\n// radio\n// select\n// button\n// namespace\nvar cf;\n(function (cf) {\n    cf.TagEvents = {\n        ORIGINAL_ELEMENT_CHANGED: \"cf-tag-dom-element-changed\"\n    };\n    // class\n    var Tag = /** @class */ (function () {\n        function Tag(options) {\n            this.domElement = options.domElement;\n            this.initialDefaultValue = this.domElement.value || this.domElement.getAttribute(\"value\") || \"\";\n            this.changeCallback = this.onDomElementChange.bind(this);\n            this.domElement.addEventListener(\"change\", this.changeCallback, false);\n            // remove tabIndex from the dom element.. danger zone... should we or should we not...\n            this.domElement.tabIndex = -1;\n            this.skipUserInput = false;\n            // questions array\n            if (options.questions)\n                this.questions = options.questions;\n            // custom tag validation - must be a method on window to avoid unsafe eval() calls\n            if (this.domElement.getAttribute(\"cf-validation\")) {\n                var fn = window[this.domElement.getAttribute(\"cf-validation\")];\n                this.validationCallback = fn;\n            }\n            // reg ex pattern is set on the Tag, so use it in our validation\n            if (this.domElement.getAttribute(\"pattern\"))\n                this.pattern = new RegExp(this.domElement.getAttribute(\"pattern\"));\n            if (this.type != \"group\" && cf.ConversationalForm.illustrateAppFlow) {\n                if (!cf.ConversationalForm.suppressLog)\n                    console.log('Conversational Form > Tag registered:', this.type, this);\n            }\n            this.refresh();\n        }\n        Object.defineProperty(Tag.prototype, \"type\", {\n            get: function () {\n                return this.domElement.getAttribute(\"type\") || this.domElement.tagName.toLowerCase();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"name\", {\n            get: function () {\n                return this.domElement.getAttribute(\"name\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"id\", {\n            get: function () {\n                return this.domElement.getAttribute(\"id\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"inputPlaceholder\", {\n            get: function () {\n                return this._inputPlaceholder;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"formless\", {\n            get: function () {\n                return cf.TagsParser.isElementFormless(this.domElement);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"label\", {\n            get: function () {\n                return this.getLabel();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"value\", {\n            get: function () {\n                return this.domElement.value || this.initialDefaultValue;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"hasImage\", {\n            get: function () {\n                return this.domElement.hasAttribute(\"cf-image\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"rows\", {\n            get: function () {\n                return this.domElement.hasAttribute(\"rows\") ? parseInt(this.domElement.getAttribute(\"rows\")) : 0;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"disabled\", {\n            get: function () {\n                // a tag is disabled if its conditions are not meet, also if it contains the disabled attribute\n                return !this.checkConditionalAndIsValid() || (this.domElement.getAttribute(\"disabled\") != undefined && this.domElement.getAttribute(\"disabled\") != null);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"required\", {\n            get: function () {\n                return !!this.domElement.getAttribute(\"required\") || this.domElement.getAttribute(\"required\") == \"\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"question\", {\n            get: function () {\n                // if questions are empty, then fall back to dictionary, every time\n                if (!this.questions || this.questions.length == 0)\n                    return cf.Dictionary.getRobotResponse(this.type);\n                else\n                    return this.questions[Math.floor(Math.random() * this.questions.length)];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"eventTarget\", {\n            set: function (value) {\n                this._eventTarget = value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(Tag.prototype, \"errorMessage\", {\n            get: function () {\n                if (!this.errorMessages) {\n                    // custom tag error messages\n                    if (this.domElement.getAttribute(\"cf-error\")) {\n                        this.errorMessages = cf.Helpers.getValuesOfBars(this.domElement.getAttribute(\"cf-error\"));\n                    }\n                    else if (this.domElement.parentNode && this.domElement.parentNode.getAttribute(\"cf-error\")) {\n                        this.errorMessages = cf.Helpers.getValuesOfBars(this.domElement.parentNode.getAttribute(\"cf-error\"));\n                    }\n                    else if (this.required) {\n                        this.errorMessages = [cf.Dictionary.get(\"input-placeholder-required\")];\n                    }\n                    else {\n                        if (this.type == \"file\")\n                            this.errorMessages = [cf.Dictionary.get(\"input-placeholder-file-error\")];\n                        else {\n                            this.errorMessages = [cf.Dictionary.get(\"input-placeholder-error\")];\n                        }\n                    }\n                }\n                return this.errorMessages[Math.floor(Math.random() * this.errorMessages.length)];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Tag.prototype.dealloc = function () {\n            this.domElement.removeEventListener(\"change\", this.changeCallback, false);\n            this.changeCallback = null;\n            this.domElement = null;\n            this.defaultValue = null;\n            this.errorMessages = null;\n            this.pattern = null;\n            this._label = null;\n            this.validationCallback = null;\n            this.questions = null;\n        };\n        Tag.testConditions = function (tagValue, condition) {\n            var testValue = function (value, conditional) {\n                if (typeof conditional === \"object\") {\n                    // regex\n                    return conditional.test(value);\n                }\n                // string comparisson\n                return tagValue === conditional;\n            };\n            if (typeof tagValue === \"string\") {\n                // tag value is a string\n                var value = tagValue;\n                var isValid = false;\n                for (var i = 0; i < condition.conditionals.length; i++) {\n                    var conditional = condition.conditionals[i];\n                    isValid = testValue(value, conditional);\n                    if (isValid)\n                        break;\n                }\n                return isValid;\n            }\n            else {\n                if (!tagValue) {\n                    return false;\n                }\n                else {\n                    // tag value is an array\n                    var isValid = false;\n                    for (var i = 0; i < condition.conditionals.length; i++) {\n                        var conditional = condition.conditionals[i];\n                        if (typeof tagValue !== \"string\") {\n                            for (var j = 0; j < tagValue.length; j++) {\n                                isValid = testValue(tagValue[j], conditional);\n                                if (isValid)\n                                    break;\n                            }\n                        }\n                        else {\n                            // string comparisson\n                            isValid = testValue(tagValue.toString(), conditional);\n                        }\n                        if (isValid)\n                            break;\n                    }\n                    return isValid;\n                }\n                // arrays need to be the same\n            }\n        };\n        Tag.isTagValid = function (element) {\n            if (element.getAttribute(\"type\") === \"hidden\")\n                return false;\n            if (element.getAttribute(\"type\") === \"submit\")\n                return false;\n            // ignore buttons, we submit the form automatially\n            if (element.getAttribute(\"type\") == \"button\")\n                return false;\n            if (element.style) {\n                // element style can be null if markup is created from DOMParser\n                if (element.style.display === \"none\")\n                    return false;\n                if (element.style.visibility === \"hidden\")\n                    return false;\n            }\n            var isTagFormless = cf.TagsParser.isElementFormless(element);\n            var innerText = cf.Helpers.getInnerTextOfElement(element);\n            if (element.tagName.toLowerCase() == \"option\" && (!isTagFormless && innerText == \"\" || innerText == \" \")) {\n                return false;\n            }\n            if (element.tagName.toLowerCase() == \"select\" || element.tagName.toLowerCase() == \"option\")\n                return true;\n            else if (isTagFormless) {\n                return true;\n            }\n            else {\n                return !!(element.offsetWidth || element.offsetHeight || element.getClientRects().length);\n            }\n        };\n        Tag.createTag = function (element) {\n            if (Tag.isTagValid(element)) {\n                // ignore hidden tags\n                var tag = void 0;\n                if (element.tagName.toLowerCase() == \"input\") {\n                    tag = new cf.InputTag({\n                        domElement: element\n                    });\n                }\n                else if (element.tagName.toLowerCase() == \"textarea\") {\n                    tag = new cf.InputTag({\n                        domElement: element\n                    });\n                }\n                else if (element.tagName.toLowerCase() == \"select\") {\n                    tag = new cf.SelectTag({\n                        domElement: element\n                    });\n                }\n                else if (element.tagName.toLowerCase() == \"button\") {\n                    tag = new cf.ButtonTag({\n                        domElement: element\n                    });\n                }\n                else if (element.tagName.toLowerCase() == \"option\") {\n                    tag = new cf.OptionTag({\n                        domElement: element\n                    });\n                }\n                else if (element.tagName.toLowerCase() == \"cf-robot-message\") {\n                    tag = new cf.CfRobotMessageTag({\n                        domElement: element\n                    });\n                }\n                return tag;\n            }\n            else {\n                // console.warn(\"Tag is not valid!: \"+ element);\n                return null;\n            }\n        };\n        Tag.prototype.reset = function () {\n            this.refresh();\n            // this.disabled = false;\n            // reset to initial value.\n            this.defaultValue = this.domElement.value = this.initialDefaultValue.toString();\n        };\n        Tag.prototype.refresh = function () {\n            // default value of Tag, check every refresh\n            this.defaultValue = this.domElement.value || this.domElement.getAttribute(\"value\") || \"\";\n            this.questions = null;\n            this.findAndSetQuestions();\n            this.findConditionalAttributes();\n        };\n        Tag.prototype.hasConditionsFor = function (tagName) {\n            if (!this.hasConditions()) {\n                return false;\n            }\n            for (var i = 0; i < this.conditionalTags.length; i++) {\n                var condition = this.conditionalTags[i];\n                if (\"cf-conditional-\" + tagName.toLowerCase() === condition.key.toLowerCase()) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        Tag.prototype.hasConditions = function () {\n            return this.conditionalTags && this.conditionalTags.length > 0;\n        };\n        /**\n        * @name checkConditionalAndIsValid\n        * checks for conditional logic, see documentaiton (wiki)\n        * here we check after cf-conditional{-name}, if we find an attribute we look through tags for value, and ignore the tag if\n        */\n        Tag.prototype.checkConditionalAndIsValid = function () {\n            // can we tap into disabled\n            // if contains attribute, cf-conditional{-name} then check for conditional value across tags\n            if (this.hasConditions()) {\n                return this.flowManager.areConditionsInFlowFullfilled(this, this.conditionalTags);\n            }\n            // else return true, as no conditional means uncomplicated and happy tag\n            return true;\n        };\n        Tag.prototype.setTagValueAndIsValid = function (dto) {\n            // this sets the value of the tag in the DOM\n            // validation\n            var isValid = true;\n            var valueText = dto.text;\n            if (this.domElement.hasAttribute('type')\n                && this.domElement.getAttribute('type') === 'email'\n                && !this.pattern\n                && valueText.length > 0) {\n                this.pattern = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n            }\n            else if (\n            // When NOT required: Reset in the event user already typed something, and now they clear their input and want to submit nothing ==> remove pattern previously applied\n            this.domElement.hasAttribute('type')\n                && this.domElement.getAttribute('type') === 'email'\n                && this.pattern\n                && valueText.length === 0\n                && !this.required) {\n                this.pattern = null;\n            }\n            if (this.pattern) {\n                isValid = this.pattern.test(valueText);\n            }\n            if (valueText == \"\" && this.required) {\n                isValid = false;\n            }\n            // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-minlength\n            var min = parseInt(this.domElement.getAttribute(\"minlength\"), 10) || -1;\n            // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-maxlength\n            var max = parseInt(this.domElement.getAttribute(\"maxlength\"), 10) || -1;\n            if (min != -1 && valueText.length < min) {\n                isValid = false;\n            }\n            if (max != -1 && valueText.length > max) {\n                isValid = false;\n            }\n            var isMaxMinValueValid = this.validateMaxMinValue(valueText);\n            if (!isMaxMinValueValid)\n                isValid = false;\n            if (isValid) {\n                // we cannot set the dom element value when type is file\n                if (this.type != \"file\")\n                    this.domElement.value = valueText;\n            }\n            return isValid;\n        };\n        /**\n         * Validates value against tag max and min attributes\n         *\n         * @private\n         * @param {string} value\n         * @returns {boolean}\n         * @memberof Tag\n         */\n        Tag.prototype.validateMaxMinValue = function (value) {\n            if (!value)\n                return true;\n            var parsedValue = parseInt(value, 10);\n            var minValue = parseInt(this.domElement.getAttribute(\"min\"), 10) || -1;\n            var maxValue = parseInt(this.domElement.getAttribute(\"max\"), 10) || -1;\n            if (minValue !== -1 && parsedValue < minValue)\n                return false;\n            if (maxValue !== -1 && parsedValue > maxValue)\n                return false;\n            return true;\n        };\n        Tag.prototype.getLabel = function () {\n            if (!this._label)\n                this.findAndSetLabel();\n            if (this._label)\n                return this._label;\n            return cf.Dictionary.getRobotResponse(this.type);\n        };\n        /**\n        * @name findConditionalAttributes\n        * look for conditional attributes and map them\n        */\n        Tag.prototype.findConditionalAttributes = function () {\n            var keys = this.domElement.attributes;\n            if (keys.length > 0) {\n                this.conditionalTags = [];\n                for (var key in keys) {\n                    if (keys.hasOwnProperty(key)) {\n                        var attr = keys[key];\n                        if (attr && attr.name && attr.name.indexOf(\"cf-conditional\") !== -1) {\n                            // conditional found\n                            var _conditionals = [];\n                            // TODO: when && use to combine multiple values to complete condition.\n                            var conditionalsFromAttribute = attr.value.indexOf(\"||\") !== -1 ? attr.value.split(\"||\") : attr.value.split(\"&&\");\n                            for (var i = 0; i < conditionalsFromAttribute.length; i++) {\n                                var _conditional = conditionalsFromAttribute[i];\n                                try {\n                                    _conditionals.push(new RegExp(_conditional));\n                                }\n                                catch (e) {\n                                }\n                                _conditionals.push(_conditional);\n                            }\n                            this.conditionalTags.push({\n                                key: attr.name,\n                                conditionals: _conditionals\n                            });\n                        }\n                    }\n                }\n            }\n        };\n        Tag.prototype.findAndSetQuestions = function () {\n            if (this.questions)\n                return;\n            // <label tag with label:for attribute to el:id\n            // check for label tag, we only go 2 steps backwards..\n            // from standardize markup: http://www.w3schools.com/tags/tag_label.asp\n            if (this.domElement.getAttribute(\"cf-questions\")) {\n                this.questions = cf.Helpers.getValuesOfBars(this.domElement.getAttribute(\"cf-questions\"));\n                if (this.domElement.getAttribute(\"cf-input-placeholder\"))\n                    this._inputPlaceholder = this.domElement.getAttribute(\"cf-input-placeholder\");\n            }\n            else if (this.domElement.parentNode && this.domElement.parentNode.getAttribute(\"cf-questions\")) {\n                // for groups the parentNode can have the cf-questions..\n                var parent_1 = this.domElement.parentNode;\n                this.questions = cf.Helpers.getValuesOfBars(parent_1.getAttribute(\"cf-questions\"));\n                if (parent_1.getAttribute(\"cf-input-placeholder\"))\n                    this._inputPlaceholder = parent_1.getAttribute(\"cf-input-placeholder\");\n            }\n            else {\n                // questions not set, so find it in the DOM\n                // try a broader search using for and id attributes\n                var elId = this.domElement.getAttribute(\"id\");\n                var forLabel = document.querySelector(\"label[for='\" + elId + \"']\");\n                if (forLabel) {\n                    this.questions = [cf.Helpers.getInnerTextOfElement(forLabel)];\n                }\n            }\n            if (!this.questions && this.domElement.getAttribute(\"placeholder\")) {\n                // check for placeholder attr if questions are still undefined\n                this.questions = [this.domElement.getAttribute(\"placeholder\")];\n            }\n        };\n        Tag.prototype.findAndSetLabel = function () {\n            // find label..\n            if (this.domElement.getAttribute(\"cf-label\")) {\n                this._label = this.domElement.getAttribute(\"cf-label\");\n            }\n            else {\n                var parentDomNode = this.domElement.parentNode;\n                if (parentDomNode) {\n                    // step backwards and check for label tag.\n                    var labelTags = parentDomNode.tagName.toLowerCase() == \"label\" ? [parentDomNode] : parentDomNode.getElementsByTagName(\"label\");\n                    if (labelTags.length == 0) {\n                        // check for innerText\n                        var innerText = cf.Helpers.getInnerTextOfElement(parentDomNode);\n                        if (innerText && innerText.length > 0)\n                            labelTags = [parentDomNode];\n                    }\n                    else if (labelTags.length > 0) {\n                        // check for \"for\" attribute\n                        for (var i = 0; i < labelTags.length; i++) {\n                            var label = labelTags[i];\n                            if (label.getAttribute(\"for\") == this.id) {\n                                this._label = cf.Helpers.getInnerTextOfElement(label);\n                            }\n                        }\n                    }\n                    if (!this._label && labelTags[0]) {\n                        this._label = cf.Helpers.getInnerTextOfElement(labelTags[0]);\n                    }\n                }\n            }\n        };\n        /**\n        * @name onDomElementChange\n        * on dom element value change event, ex. w. browser autocomplete mode\n        */\n        Tag.prototype.onDomElementChange = function () {\n            this._eventTarget.dispatchEvent(new CustomEvent(cf.TagEvents.ORIGINAL_ELEMENT_CHANGED, {\n                detail: {\n                    value: this.value,\n                    tag: this\n                }\n            }));\n        };\n        return Tag;\n    }());\n    cf.Tag = Tag;\n})(cf || (cf = {}));\n\n/// <reference path=\"ButtonTag.ts\"/>\n/// <reference path=\"InputTag.ts\"/>\n/// <reference path=\"SelectTag.ts\"/>\n/// <reference path=\"../ui/inputs/UserTextInput.ts\"/>\n// group tags together, this is done automatically by looking through InputTags with type radio or checkbox and same name attribute.\n// single choice logic for Radio Button, <input type=\"radio\", where name is the same\n// multi choice logic for Checkboxes, <input type=\"checkbox\", where name is the same\n// namespace\nvar cf;\n(function (cf) {\n    // class\n    var TagGroup = /** @class */ (function () {\n        function TagGroup(options) {\n            this.elements = options.elements;\n            // set wrapping element\n            this._fieldset = options.fieldset;\n            if (this._fieldset && this._fieldset.getAttribute(\"cf-questions\")) {\n                this.questions = cf.Helpers.getValuesOfBars(this._fieldset.getAttribute(\"cf-questions\"));\n            }\n            if (this._fieldset && this._fieldset.getAttribute(\"cf-input-placeholder\")) {\n                this._inputPlaceholder = this._fieldset.getAttribute(\"cf-input-placeholder\");\n            }\n            if (cf.ConversationalForm.illustrateAppFlow)\n                if (!cf.ConversationalForm.suppressLog)\n                    console.log('Conversational Form > TagGroup registered:', this.elements[0].type, this);\n            this.skipUserInput = false;\n        }\n        Object.defineProperty(TagGroup.prototype, \"required\", {\n            get: function () {\n                for (var i = 0; i < this.elements.length; i++) {\n                    var element = this.elements[i];\n                    if (this.elements[i].required) {\n                        return true;\n                    }\n                }\n                return false;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"eventTarget\", {\n            set: function (value) {\n                this._eventTarget = value;\n                for (var i = 0; i < this.elements.length; i++) {\n                    var tag = this.elements[i];\n                    tag.eventTarget = value;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"flowManager\", {\n            set: function (value) {\n                for (var i = 0; i < this.elements.length; i++) {\n                    var tag = this.elements[i];\n                    tag.flowManager = value;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"type\", {\n            get: function () {\n                return \"group\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"label\", {\n            get: function () {\n                return \"\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"name\", {\n            get: function () {\n                return this._fieldset && this._fieldset.hasAttribute(\"name\") ? this._fieldset.getAttribute(\"name\") : this.elements[0].name;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"id\", {\n            get: function () {\n                return this._fieldset && this._fieldset.id ? this._fieldset.id : this.elements[0].id;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"question\", {\n            get: function () {\n                // check if elements have the questions, else fallback\n                if (this.questions && this.questions.length > 0) {\n                    return this.questions[Math.floor(Math.random() * this.questions.length)];\n                }\n                else if (this.elements[0] && this.elements[0].question) {\n                    var tagQuestion = this.elements[0].question;\n                    return tagQuestion;\n                }\n                else {\n                    // fallback to robot response from dictionary\n                    var robotReponse = cf.Dictionary.getRobotResponse(this.getGroupTagType());\n                    return robotReponse;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"activeElements\", {\n            get: function () {\n                return this._activeElements;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"value\", {\n            get: function () {\n                // TODO: fix value???\n                return this._values ? this._values : [\"\"];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"disabled\", {\n            get: function () {\n                var disabled = false;\n                var allShouldBedisabled = 0;\n                for (var i = 0; i < this.elements.length; i++) {\n                    var element = this.elements[i];\n                    if (element.disabled)\n                        allShouldBedisabled++;\n                }\n                return allShouldBedisabled === this.elements.length;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"errorMessage\", {\n            get: function () {\n                var errorMessage = cf.Dictionary.get(\"input-placeholder-error\");\n                for (var i = 0; i < this.elements.length; i++) {\n                    var element = this.elements[i];\n                    errorMessage = element.errorMessage;\n                }\n                return errorMessage;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TagGroup.prototype, \"inputPlaceholder\", {\n            get: function () {\n                return this._inputPlaceholder;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        TagGroup.prototype.dealloc = function () {\n            for (var i = 0; i < this.elements.length; i++) {\n                var element = this.elements[i];\n                element.dealloc();\n            }\n            this.elements = null;\n        };\n        TagGroup.prototype.refresh = function () {\n            for (var i = 0; i < this.elements.length; i++) {\n                var element = this.elements[i];\n                element.refresh();\n            }\n        };\n        TagGroup.prototype.reset = function () {\n            this._values = [];\n            for (var i = 0; i < this.elements.length; i++) {\n                var element = this.elements[i];\n                element.reset();\n            }\n        };\n        TagGroup.prototype.getGroupTagType = function () {\n            return this.elements[0].type;\n        };\n        TagGroup.prototype.hasConditionsFor = function (tagName) {\n            for (var i = 0; i < this.elements.length; i++) {\n                var element = this.elements[i];\n                if (element.hasConditionsFor(tagName)) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        TagGroup.prototype.hasConditions = function () {\n            for (var i = 0; i < this.elements.length; i++) {\n                var element = this.elements[i];\n                if (element.hasConditions()) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        /**\n        * @name checkConditionalAndIsValid\n        * checks for conditional logic, see documentaiton (wiki)\n        * here we check after cf-conditional{-name} on group tags\n        */\n        TagGroup.prototype.checkConditionalAndIsValid = function () {\n            // can we tap into disabled\n            // if contains attribute, cf-conditional{-name} then check for conditional value across tags\n            for (var i = 0; i < this.elements.length; i++) {\n                var element = this.elements[i];\n                element.checkConditionalAndIsValid();\n            }\n            // else return true, as no conditional means happy tag\n            return true;\n        };\n        TagGroup.prototype.setTagValueAndIsValid = function (dto) {\n            var isValid = false;\n            var groupType = this.elements[0].type;\n            this._values = [];\n            this._activeElements = [];\n            switch (groupType) {\n                case \"radio\":\n                    var wasRadioButtonChecked = false;\n                    var numberRadioButtonsVisible = [];\n                    if (dto.controlElements) {\n                        // TODO: Refactor this so it is less dependant on controlElements\n                        for (var i = 0; i < dto.controlElements.length; i++) {\n                            var element = dto.controlElements[i];\n                            var tag = this.elements[this.elements.indexOf(element.referenceTag)];\n                            numberRadioButtonsVisible.push(element);\n                            if (tag == element.referenceTag) {\n                                if (element.checked) {\n                                    this._values.push(tag.value);\n                                    this._activeElements.push(tag);\n                                }\n                                // a radio button was checked\n                                if (!wasRadioButtonChecked && element.checked)\n                                    wasRadioButtonChecked = true;\n                            }\n                        }\n                    }\n                    else {\n                        // for when we don't have any control elements, then we just try and map values\n                        for (var i = 0; i < this.elements.length; i++) {\n                            var tag = this.elements[i];\n                            var v1 = tag.value.toString().toLowerCase();\n                            var v2 = dto.text.toString().toLowerCase();\n                            //brute force checking...\n                            if (v1.indexOf(v2) !== -1 || v2.indexOf(v1) !== -1) {\n                                this._activeElements.push(tag);\n                                // check the original tag\n                                this._values.push(tag.value);\n                                tag.domElement.checked = true;\n                                wasRadioButtonChecked = true;\n                            }\n                        }\n                    }\n                    isValid = wasRadioButtonChecked;\n                    break;\n                case \"checkbox\":\n                    // checkbox is always valid\n                    isValid = true;\n                    if (dto.controlElements) {\n                        for (var i = 0; i < dto.controlElements.length; i++) {\n                            var element = dto.controlElements[i];\n                            var tag = this.elements[this.elements.indexOf(element.referenceTag)];\n                            tag.domElement.checked = element.checked;\n                            if (element.checked) {\n                                this._values.push(tag.value);\n                                this._activeElements.push(tag);\n                            }\n                        }\n                    }\n                    if (this.required && this._activeElements.length == 0) {\n                        // checkbox can be required\n                        isValid = false;\n                    }\n                    break;\n            }\n            return isValid;\n        };\n        return TagGroup;\n    }());\n    cf.TagGroup = TagGroup;\n})(cf || (cf = {}));\n\n/// <reference path=\"Tag.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var InputTag = /** @class */ (function (_super) {\n        __extends(InputTag, _super);\n        function InputTag(options) {\n            var _this = _super.call(this, options) || this;\n            if (_this.type == \"text\") {\n            }\n            else if (_this.type == \"email\") {\n            }\n            else if (_this.type == \"tel\") {\n            }\n            else if (_this.type == \"checkbox\") {\n            }\n            else if (_this.type == \"radio\") {\n            }\n            else if (_this.type == \"password\") {\n            }\n            else if (_this.type == \"file\") {\n                // check InputFileTag.ts\n            }\n            return _this;\n        }\n        InputTag.prototype.findAndSetQuestions = function () {\n            _super.prototype.findAndSetQuestions.call(this);\n            // special use cases for <input> tag add here...\n        };\n        InputTag.prototype.findAndSetLabel = function () {\n            _super.prototype.findAndSetLabel.call(this);\n            if (!this._label) {\n                // special use cases for <input> tag add here...\n            }\n        };\n        InputTag.prototype.setTagValueAndIsValid = function (value) {\n            if (this.type == \"checkbox\") {\n                // checkbox is always true..\n                return true;\n            }\n            else {\n                return _super.prototype.setTagValueAndIsValid.call(this, value);\n            }\n        };\n        InputTag.prototype.dealloc = function () {\n            _super.prototype.dealloc.call(this);\n        };\n        return InputTag;\n    }(cf.Tag));\n    cf.InputTag = InputTag;\n})(cf || (cf = {}));\n\n/// <reference path=\"Tag.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var SelectTag = /** @class */ (function (_super) {\n        __extends(SelectTag, _super);\n        function SelectTag(options) {\n            var _this = _super.call(this, options) || this;\n            // build the option tags\n            _this.optionTags = [];\n            var domOptionTags = _this.domElement.getElementsByTagName(\"option\");\n            for (var i = 0; i < domOptionTags.length; i++) {\n                var element = domOptionTags[i];\n                var tag = cf.Tag.createTag(element);\n                if (tag) {\n                    _this.optionTags.push(tag);\n                }\n                else {\n                    console.warn(_this.constructor.name, 'option tag invalid:', tag);\n                }\n            }\n            return _this;\n        }\n        Object.defineProperty(SelectTag.prototype, \"type\", {\n            get: function () {\n                return \"select\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(SelectTag.prototype, \"name\", {\n            get: function () {\n                return this.domElement && this.domElement.hasAttribute(\"name\") ? this.domElement.getAttribute(\"name\") : this.optionTags[0].name;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(SelectTag.prototype, \"value\", {\n            get: function () {\n                return this._values;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(SelectTag.prototype, \"multipleChoice\", {\n            get: function () {\n                return this.domElement.hasAttribute(\"multiple\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        SelectTag.prototype.setTagValueAndIsValid = function (dto) {\n            var isValid = false;\n            // select tag values are set via selected attribute on option tag\n            var numberOptionButtonsVisible = [];\n            this._values = [];\n            if (dto.controlElements) {\n                // TODO: Refactor this so it is less dependant on controlElements\n                for (var i = 0; i < this.optionTags.length; i++) {\n                    var tag = this.optionTags[i];\n                    for (var j = 0; j < dto.controlElements.length; j++) {\n                        var controllerElement = dto.controlElements[j];\n                        if (controllerElement.referenceTag == tag) {\n                            // tag match found, so set value\n                            tag.selected = controllerElement.selected;\n                            // check for minimum one selected\n                            if (!isValid && tag.selected)\n                                isValid = true;\n                            if (tag.selected)\n                                this._values.push(tag.value);\n                            if (controllerElement.visible)\n                                numberOptionButtonsVisible.push(controllerElement);\n                        }\n                    }\n                }\n            }\n            else {\n                var wasSelected = false;\n                // for when we don't have any control elements, then we just try and map values\n                for (var i = 0; i < this.optionTags.length; i++) {\n                    var tag = this.optionTags[i];\n                    var v1 = tag.value.toString().toLowerCase();\n                    var v2 = dto.text.toString().toLowerCase();\n                    //brute force checking...\n                    if (v1.indexOf(v2) !== -1 || v2.indexOf(v1) !== -1) {\n                        // check the original tag\n                        this._values.push(tag.value);\n                        tag.domElement.checked = true;\n                        wasSelected = true;\n                    }\n                }\n                isValid = wasSelected;\n            }\n            // special case 1, only one optiontag visible from a filter\n            if (!isValid && numberOptionButtonsVisible.length == 1) {\n                var element = numberOptionButtonsVisible[0];\n                var tag = this.optionTags[this.optionTags.indexOf(element.referenceTag)];\n                element.selected = true;\n                tag.selected = true;\n                isValid = true;\n                if (tag.selected)\n                    this._values.push(tag.value);\n            }\n            return isValid;\n        };\n        return SelectTag;\n    }(cf.Tag));\n    cf.SelectTag = SelectTag;\n})(cf || (cf = {}));\n\n/// <reference path=\"Tag.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var ButtonTag = /** @class */ (function (_super) {\n        __extends(ButtonTag, _super);\n        function ButtonTag(options) {\n            var _this = _super.call(this, options) || this;\n            if (_this.domElement.getAttribute(\"type\") == \"submit\") {\n            }\n            else if (_this.domElement.getAttribute(\"type\") == \"button\") {\n                // this.onClick = eval(this.domElement.onclick);\n            }\n            return _this;\n        }\n        return ButtonTag;\n    }(cf.Tag));\n    cf.ButtonTag = ButtonTag;\n})(cf || (cf = {}));\n\n/// <reference path=\"Tag.ts\"/>\n/// <reference path=\"../parsing/TagsParser.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var OptionTag = /** @class */ (function (_super) {\n        __extends(OptionTag, _super);\n        function OptionTag() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        Object.defineProperty(OptionTag.prototype, \"type\", {\n            get: function () {\n                return \"option\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(OptionTag.prototype, \"label\", {\n            get: function () {\n                if (this.formless) {\n                    return _super.prototype.getLabel.call(this);\n                }\n                else {\n                    return cf.Helpers.getInnerTextOfElement(this.domElement);\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(OptionTag.prototype, \"selected\", {\n            get: function () {\n                return this.domElement.hasAttribute(\"selected\");\n                // return (<HTMLOptionElement> this.domElement).selected;\n            },\n            set: function (value) {\n                this.domElement.selected = value;\n                if (value) {\n                    this.domElement.setAttribute(\"selected\", \"selected\");\n                }\n                else {\n                    this.domElement.removeAttribute(\"selected\");\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        OptionTag.prototype.setTagValueAndIsValid = function (value) {\n            var isValid = true;\n            // OBS: No need to set any validation og value for this tag type ..\n            // .. it is atm. only used to create pseudo elements in the OptionsList\n            return isValid;\n        };\n        return OptionTag;\n    }(cf.Tag));\n    cf.OptionTag = OptionTag;\n})(cf || (cf = {}));\n\n/// <reference path=\"Tag.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var CfRobotMessageTag = /** @class */ (function (_super) {\n        __extends(CfRobotMessageTag, _super);\n        function CfRobotMessageTag(options) {\n            var _this = _super.call(this, options) || this;\n            _this.skipUserInput = true;\n            return _this;\n        }\n        CfRobotMessageTag.prototype.dealloc = function () {\n            _super.prototype.dealloc.call(this);\n        };\n        return CfRobotMessageTag;\n    }(cf.Tag));\n    cf.CfRobotMessageTag = CfRobotMessageTag;\n})(cf || (cf = {}));\n\n/// <reference path=\"ControlElement.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var Button = /** @class */ (function (_super) {\n        __extends(Button, _super);\n        function Button(options) {\n            var _this = _super.call(this, options) || this;\n            _this.clickCallback = _this.onClick.bind(_this);\n            _this.el.addEventListener(\"click\", _this.clickCallback, false);\n            _this.mouseDownCallback = _this.onMouseDown.bind(_this);\n            _this.el.addEventListener(\"mousedown\", _this.mouseDownCallback, false);\n            //image\n            _this.checkForImage();\n            return _this;\n        }\n        Object.defineProperty(Button.prototype, \"type\", {\n            get: function () {\n                return \"Button\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Button.prototype.hasImage = function () {\n            return this.referenceTag.hasImage;\n        };\n        /**\n        * @name checkForImage\n        * checks if element has cf-image, if it has then change UI\n        */\n        Button.prototype.checkForImage = function () {\n            var hasImage = this.hasImage();\n            if (hasImage) {\n                this.el.classList.add(\"has-image\");\n                this.imgEl = document.createElement(\"img\");\n                this.imageLoadedCallback = this.onImageLoaded.bind(this);\n                this.imgEl.classList.add(\"cf-image\");\n                this.imgEl.addEventListener(\"load\", this.imageLoadedCallback, false);\n                this.imgEl.src = this.referenceTag.domElement.getAttribute(\"cf-image\");\n                this.el.insertBefore(this.imgEl, this.el.children[0]);\n            }\n        };\n        Button.prototype.onImageLoaded = function () {\n            this.imgEl.classList.add(\"loaded\");\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.ON_LOADED, {}));\n        };\n        Button.prototype.onMouseDown = function (event) {\n            event.preventDefault();\n        };\n        Button.prototype.onClick = function (event) {\n            this.onChoose();\n        };\n        Button.prototype.dealloc = function () {\n            this.el.removeEventListener(\"click\", this.clickCallback, false);\n            this.clickCallback = null;\n            if (this.imageLoadedCallback) {\n                this.imgEl.removeEventListener(\"load\", this.imageLoadedCallback, false);\n                this.imageLoadedCallback = null;\n            }\n            this.el.removeEventListener(\"mousedown\", this.mouseDownCallback, false);\n            this.mouseDownCallback = null;\n            _super.prototype.dealloc.call(this);\n        };\n        // override\n        Button.prototype.getTemplate = function () {\n            return \"<cf-button class=\\\"cf-button\\\">\\n\\t\\t\\t\\t\" + this.referenceTag.label + \"\\n\\t\\t\\t</cf-button>\\n\\t\\t\\t\";\n        };\n        return Button;\n    }(cf.ControlElement));\n    cf.Button = Button;\n})(cf || (cf = {}));\n\n/// <reference path=\"Button.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var RadioButton = /** @class */ (function (_super) {\n        __extends(RadioButton, _super);\n        function RadioButton() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        Object.defineProperty(RadioButton.prototype, \"type\", {\n            get: function () {\n                return \"RadioButton\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(RadioButton.prototype, \"checked\", {\n            get: function () {\n                var _checked = this.el.hasAttribute(\"checked\") && this.el.getAttribute(\"checked\") == \"checked\";\n                return _checked;\n            },\n            set: function (value) {\n                if (!value) {\n                    this.el.removeAttribute(\"checked\");\n                    this.referenceTag.domElement.removeAttribute(\"checked\");\n                    this.referenceTag.domElement.checked = false;\n                }\n                else {\n                    this.el.setAttribute(\"checked\", \"checked\");\n                    this.referenceTag.domElement.setAttribute(\"checked\", \"checked\");\n                    this.referenceTag.domElement.checked = true;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        RadioButton.prototype.onClick = function (event) {\n            this.checked = true; // checked always true like native radio buttons\n            _super.prototype.onClick.call(this, event);\n        };\n        // override\n        RadioButton.prototype.getTemplate = function () {\n            var isChecked = this.referenceTag.domElement.checked || this.referenceTag.domElement.hasAttribute(\"checked\");\n            return \"<cf-radio-button class=\\\"cf-button\\\" \" + (isChecked ? \"checked=checked\" : \"\") + \">\\n\\t\\t\\t\\t<div>\\n\\t\\t\\t\\t\\t<cf-radio></cf-radio>\\n\\t\\t\\t\\t\\t<span>\" + this.referenceTag.label + \"</span>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</cf-radio-button>\\n\\t\\t\\t\";\n        };\n        return RadioButton;\n    }(cf.Button));\n    cf.RadioButton = RadioButton;\n})(cf || (cf = {}));\n\n/// <reference path=\"Button.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var CheckboxButton = /** @class */ (function (_super) {\n        __extends(CheckboxButton, _super);\n        function CheckboxButton() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        Object.defineProperty(CheckboxButton.prototype, \"type\", {\n            get: function () {\n                return \"CheckboxButton\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(CheckboxButton.prototype, \"checked\", {\n            get: function () {\n                return this.el.getAttribute(\"checked\") == \"checked\";\n            },\n            set: function (value) {\n                if (!value) {\n                    this.el.removeAttribute(\"checked\");\n                    this.referenceTag.domElement.removeAttribute(\"checked\");\n                    this.referenceTag.domElement.checked = false;\n                }\n                else {\n                    this.el.setAttribute(\"checked\", \"checked\");\n                    this.referenceTag.domElement.setAttribute(\"checked\", \"checked\");\n                    this.referenceTag.domElement.checked = true;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        CheckboxButton.prototype.onClick = function (event) {\n            this.checked = !this.checked;\n        };\n        // override\n        CheckboxButton.prototype.getTemplate = function () {\n            var isChecked = this.referenceTag.domElement.checked && this.referenceTag.domElement.hasAttribute(\"checked\");\n            return \"<cf-button class=\\\"cf-button cf-checkbox-button \" + (this.referenceTag.label.trim().length == 0 ? \"no-text\" : \"\") + \"\\\" checked=\" + (isChecked ? \"checked\" : \"\") + \">\\n\\t\\t\\t\\t<div>\\n\\t\\t\\t\\t\\t<cf-checkbox></cf-checkbox>\\n\\t\\t\\t\\t\\t<span>\" + this.referenceTag.label + \"</span>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</cf-button>\\n\\t\\t\\t\";\n        };\n        return CheckboxButton;\n    }(cf.Button));\n    cf.CheckboxButton = CheckboxButton;\n})(cf || (cf = {}));\n\n/// <reference path=\"Button.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    cf.OptionButtonEvents = {\n        CLICK: \"cf-option-button-click\"\n    };\n    // class\n    var OptionButton = /** @class */ (function (_super) {\n        __extends(OptionButton, _super);\n        function OptionButton() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.isMultiChoice = false;\n            return _this;\n        }\n        Object.defineProperty(OptionButton.prototype, \"type\", {\n            get: function () {\n                return \"OptionButton\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(OptionButton.prototype, \"selected\", {\n            get: function () {\n                return this.el.hasAttribute(\"selected\");\n            },\n            set: function (value) {\n                if (value) {\n                    this.el.setAttribute(\"selected\", \"selected\");\n                }\n                else {\n                    this.el.removeAttribute(\"selected\");\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        OptionButton.prototype.setData = function (options) {\n            this.isMultiChoice = options.isMultiChoice;\n            _super.prototype.setData.call(this, options);\n        };\n        OptionButton.prototype.onClick = function (event) {\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.OptionButtonEvents.CLICK, this);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.OptionButtonEvents.CLICK, {\n                detail: this\n            }));\n        };\n        // override\n        OptionButton.prototype.getTemplate = function () {\n            // be aware that first option element on none multiple select tags will be selected by default\n            var tmpl = '<cf-button class=\"cf-button ' + (this.isMultiChoice ? \"cf-checkbox-button\" : \"\") + '\" ' + (this.referenceTag.domElement.selected ? \"selected='selected'\" : \"\") + '>';\n            tmpl += \"<div>\";\n            if (this.isMultiChoice)\n                tmpl += \"<cf-checkbox></cf-checkbox>\";\n            tmpl += this.referenceTag.label;\n            tmpl += \"</div>\";\n            tmpl += \"</cf-button>\";\n            return tmpl;\n        };\n        return OptionButton;\n    }(cf.Button));\n    cf.OptionButton = OptionButton;\n})(cf || (cf = {}));\n\n/// <reference path=\"ControlElement.ts\"/>\n/// <reference path=\"OptionButton.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    // builds x OptionsButton from the registered SelectTag\n    var OptionsList = /** @class */ (function () {\n        function OptionsList(options) {\n            this.context = options.context;\n            this.eventTarget = options.eventTarget;\n            this.referenceTag = options.referenceTag;\n            // check for multi choice select tag\n            this.multiChoice = this.referenceTag.domElement.hasAttribute(\"multiple\");\n            this.onOptionButtonClickCallback = this.onOptionButtonClick.bind(this);\n            this.eventTarget.addEventListener(cf.OptionButtonEvents.CLICK, this.onOptionButtonClickCallback, false);\n            this.createElements();\n        }\n        Object.defineProperty(OptionsList.prototype, \"type\", {\n            get: function () {\n                return \"OptionsList\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        OptionsList.prototype.getValue = function () {\n            var arr = [];\n            for (var i = 0; i < this.elements.length; i++) {\n                var element = this.elements[i];\n                if (!this.multiChoice && element.selected) {\n                    arr.push(element);\n                    return arr;\n                }\n                else if (this.multiChoice && element.selected) {\n                    arr.push(element);\n                }\n            }\n            return arr;\n        };\n        OptionsList.prototype.onOptionButtonClick = function (event) {\n            // if mutiple... then dont remove selection on other buttons\n            if (!this.multiChoice) {\n                // only one is selectable at the time.\n                for (var i = 0; i < this.elements.length; i++) {\n                    var element = this.elements[i];\n                    if (element != event.detail) {\n                        element.selected = false;\n                    }\n                    else {\n                        element.selected = true;\n                    }\n                }\n                cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ControlElementEvents.SUBMIT_VALUE, this.referenceTag);\n                this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.SUBMIT_VALUE, {\n                    detail: event.detail\n                }));\n            }\n            else {\n                event.detail.selected = !event.detail.selected;\n            }\n        };\n        OptionsList.prototype.createElements = function () {\n            this.elements = [];\n            var optionTags = this.referenceTag.optionTags;\n            for (var i = 0; i < optionTags.length; i++) {\n                var tag = optionTags[i];\n                var btn = new cf.OptionButton({\n                    referenceTag: tag,\n                    isMultiChoice: this.referenceTag.multipleChoice,\n                    eventTarget: this.eventTarget\n                });\n                this.elements.push(btn);\n                this.context.appendChild(btn.el);\n            }\n        };\n        OptionsList.prototype.dealloc = function () {\n            this.eventTarget.removeEventListener(cf.OptionButtonEvents.CLICK, this.onOptionButtonClickCallback, false);\n            this.onOptionButtonClickCallback = null;\n            while (this.elements.length > 0)\n                this.elements.pop().dealloc();\n            this.elements = null;\n        };\n        return OptionsList;\n    }());\n    cf.OptionsList = OptionsList;\n})(cf || (cf = {}));\n\n/// <reference path=\"Button.ts\"/>\n/// <reference path=\"../../logic/Helpers.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var UploadFileUI = /** @class */ (function (_super) {\n        __extends(UploadFileUI, _super);\n        function UploadFileUI(options) {\n            var _this = _super.call(this, options) || this;\n            _this.maxFileSize = 100000000000;\n            _this.loading = false;\n            _this.submitTimer = 0;\n            _this._fileName = \"\";\n            _this._readerResult = \"\";\n            if (cf.Helpers.caniuse.fileReader()) {\n                var maxFileSizeStr = _this.referenceTag.domElement.getAttribute(\"cf-max-size\") || _this.referenceTag.domElement.getAttribute(\"max-size\");\n                if (maxFileSizeStr) {\n                    var maxFileSize = parseInt(maxFileSizeStr, 10);\n                    _this.maxFileSize = maxFileSize;\n                }\n                _this.progressBar = _this.el.getElementsByTagName(\"cf-upload-file-progress-bar\")[0];\n                _this.onDomElementChangeCallback = _this.onDomElementChange.bind(_this);\n                _this.referenceTag.domElement.addEventListener(\"change\", _this.onDomElementChangeCallback, false);\n            }\n            else {\n                throw new Error(\"Conversational Form Error: No FileReader available for client.\");\n            }\n            return _this;\n        }\n        Object.defineProperty(UploadFileUI.prototype, \"value\", {\n            get: function () {\n                return this.referenceTag.domElement.value; //;this.readerResult || this.fileName;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UploadFileUI.prototype, \"readerResult\", {\n            get: function () {\n                return this._readerResult;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UploadFileUI.prototype, \"files\", {\n            get: function () {\n                return this._files;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UploadFileUI.prototype, \"fileName\", {\n            get: function () {\n                return this._fileName;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UploadFileUI.prototype, \"type\", {\n            get: function () {\n                return \"UploadFileUI\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        UploadFileUI.prototype.getFilesAsString = function () {\n            // value is for the chat response -->\n            var icon = document.createElement(\"span\");\n            icon.innerHTML = cf.Dictionary.get(\"icon-type-file\") + this.fileName;\n            return icon.outerHTML;\n        };\n        UploadFileUI.prototype.onDomElementChange = function (event) {\n            var _this = this;\n            if (!cf.ConversationalForm.suppressLog)\n                console.log(\"...onDomElementChange\");\n            var reader = new FileReader();\n            this._files = this.referenceTag.domElement.files;\n            reader.onerror = function (event) {\n                if (!cf.ConversationalForm.suppressLog)\n                    console.log(\"onerror\", event);\n            };\n            reader.onprogress = function (event) {\n                if (!cf.ConversationalForm.suppressLog)\n                    console.log(\"onprogress\", event);\n                _this.progressBar.style.width = ((event.loaded / event.total) * 100) + \"%\";\n            };\n            reader.onabort = function (event) {\n                if (!cf.ConversationalForm.suppressLog)\n                    console.log(\"onabort\", event);\n            };\n            reader.onloadstart = function (event) {\n                // check for file size\n                var file = _this.files[0];\n                var fileSize = file ? file.size : _this.maxFileSize + 1; // if file is undefined then abort ...\n                if (fileSize > _this.maxFileSize) {\n                    reader.abort();\n                    var dto = {\n                        errorText: cf.Dictionary.get(\"input-placeholder-file-size-error\")\n                    };\n                    cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.FlowEvents.USER_INPUT_INVALID, dto);\n                    _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n                        detail: dto\n                    }));\n                }\n                else {\n                    // good to go\n                    _this._fileName = file.name;\n                    _this.loading = true;\n                    _this.animateIn();\n                    // set text\n                    var sizeConversion = Math.floor(Math.log(fileSize) / Math.log(1024));\n                    var sizeChart = [\"b\", \"kb\", \"mb\", \"gb\"];\n                    sizeConversion = Math.min(sizeChart.length - 1, sizeConversion);\n                    var humanSizeString = Number((fileSize / Math.pow(1024, sizeConversion)).toFixed(2)) * 1 + \" \" + sizeChart[sizeConversion];\n                    var text = file.name + \" (\" + humanSizeString + \")\";\n                    _this.el.getElementsByTagName(\"cf-upload-file-text\")[0].innerHTML = text;\n                    _this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.PROGRESS_CHANGE, {\n                        detail: cf.ControlElementProgressStates.BUSY\n                    }));\n                }\n            };\n            reader.onload = function (event) {\n                _this._readerResult = event.target.result;\n                _this.progressBar.classList.add(\"loaded\");\n                _this.submitTimer = setTimeout(function () {\n                    _this.el.classList.remove(\"animate-in\");\n                    _this.onChoose(); // submit the file\n                    _this.eventTarget.dispatchEvent(new CustomEvent(cf.ControlElementEvents.PROGRESS_CHANGE, {\n                        detail: cf.ControlElementProgressStates.READY\n                    }));\n                }, 0);\n            };\n            reader.readAsDataURL(this.files[0]);\n        };\n        UploadFileUI.prototype.animateIn = function () {\n            if (this.loading)\n                _super.prototype.animateIn.call(this);\n        };\n        UploadFileUI.prototype.onClick = function (event) {\n            // super.onClick(event);\n        };\n        UploadFileUI.prototype.triggerFileSelect = function () {\n            // trigger file prompt\n            this.referenceTag.domElement.click();\n        };\n        // override\n        UploadFileUI.prototype.dealloc = function () {\n            clearTimeout(this.submitTimer);\n            this.progressBar = null;\n            if (this.onDomElementChangeCallback) {\n                this.referenceTag.domElement.removeEventListener(\"change\", this.onDomElementChangeCallback, false);\n                this.onDomElementChangeCallback = null;\n            }\n            _super.prototype.dealloc.call(this);\n        };\n        UploadFileUI.prototype.getTemplate = function () {\n            var isChecked = this.referenceTag.value == \"1\" || this.referenceTag.domElement.hasAttribute(\"checked\");\n            return \"<cf-upload-file-ui>\\n\\t\\t\\t\\t<cf-upload-file-text></cf-upload-file-text>\\n\\t\\t\\t\\t<cf-upload-file-progress>\\n\\t\\t\\t\\t\\t<cf-upload-file-progress-bar></cf-upload-file-progress-bar>\\n\\t\\t\\t\\t</cf-upload-file-progress>\\n\\t\\t\\t</cf-upload-file-ui>\\n\\t\\t\\t\";\n        };\n        return UploadFileUI;\n    }(cf.Button));\n    cf.UploadFileUI = UploadFileUI;\n})(cf || (cf = {}));\n\n/// <reference path=\"../ui/BasicElement.ts\"/>\n/// <reference path=\"../ui//control-elements/ControlElements.ts\"/>\n/// <reference path=\"../logic/FlowManager.ts\"/>\n/// <reference path=\"../interfaces/IUserInputElement.ts\"/>\n/// <reference path=\"../ui/inputs/UserInputElement.ts\"/>\n/// <reference path=\"../interfaces/IUserInputElement.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    cf.MicrophoneBridgeEvent = {\n        ERROR: \"cf-microphone-bridge-error\",\n        TERMNIAL_ERROR: \"cf-microphone-bridge-terminal-error\"\n    };\n    // class\n    var MicrophoneBridge = /** @class */ (function () {\n        function MicrophoneBridge(options) {\n            this.currentTextResponse = \"\";\n            this._hasUserMedia = false;\n            this.inputErrorCount = 0;\n            this.inputCurrentError = \"\";\n            this.el = options.el;\n            this.button = options.button;\n            this.eventTarget = options.eventTarget;\n            // data object\n            this.microphoneObj = options.microphoneObj;\n            this.flowUpdateCallback = this.onFlowUpdate.bind(this);\n            this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n        }\n        Object.defineProperty(MicrophoneBridge.prototype, \"hasUserMedia\", {\n            set: function (value) {\n                this._hasUserMedia = value;\n                if (!value) {\n                    // this.submitButton.classList.add(\"permission-waiting\");\n                }\n                else {\n                    // this.submitButton.classList.remove(\"permission-waiting\");\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(MicrophoneBridge.prototype, \"active\", {\n            set: function (value) {\n                if (this.equalizer) {\n                    this.equalizer.disabled = !value;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        MicrophoneBridge.prototype.cancel = function () {\n            this.button.loading = false;\n            if (this.microphoneObj.cancelInput) {\n                this.microphoneObj.cancelInput();\n            }\n        };\n        MicrophoneBridge.prototype.onFlowUpdate = function () {\n            var _this = this;\n            this.currentTextResponse = null;\n            if (!this._hasUserMedia) {\n                // check if user has granted\n                var hasGranted_1 = false;\n                if (window.navigator.mediaDevices) {\n                    window.navigator.mediaDevices.enumerateDevices().then(function (devices) {\n                        devices.forEach(function (device) {\n                            if (!hasGranted_1 && device.label !== \"\") {\n                                hasGranted_1 = true;\n                            }\n                        });\n                        if (hasGranted_1) {\n                            // user has previously granted, so call getusermedia, as this wont prombt user\n                            _this.getUserMedia();\n                        }\n                        else {\n                            // await click on button, wait state\n                        }\n                    });\n                }\n            }\n            else {\n                // user has granted ready to go go\n                if (!this.microphoneObj.awaitingCallback) {\n                    this.callInput();\n                }\n            }\n        };\n        MicrophoneBridge.prototype.getUserMedia = function () {\n            var _this = this;\n            try {\n                // from https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n                // Older browsers might not implement mediaDevices at all, so we set an empty object first\n                if (navigator.mediaDevices === undefined) {\n                    navigator.mediaDevices = {};\n                }\n                // Some browsers partially implement mediaDevices. We can't just assign an object\n                // with getUserMedia as it would overwrite existing properties.\n                // Here, we will just add the getUserMedia property if it's missing.\n                if (navigator.mediaDevices.getUserMedia === undefined) {\n                    navigator.mediaDevices.getUserMedia = function (constraints) {\n                        // First get ahold of the legacy getUserMedia, if present\n                        var getUserMedia = navigator.getUserMedia || window.navigator.webkitGetUserMedia || window.navigator.mozGetUserMedia;\n                        // Some browsers just don't implement it - return a rejected promise with an error\n                        // to keep a consistent interface\n                        if (!getUserMedia) {\n                            return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n                        }\n                        // Otherwise, wrap the call to the old navigator.getUserMedia with a Promise\n                        return new Promise(function (resolve, reject) {\n                            getUserMedia.call(navigator, constraints, resolve, reject);\n                        });\n                    };\n                }\n                navigator.mediaDevices.getUserMedia({ audio: true })\n                    .then(function (stream) {\n                    _this.currentStream = stream;\n                    if (stream.getAudioTracks().length > 0) {\n                        // interface is active and available, so call it immidiatly\n                        _this.hasUserMedia = true;\n                        _this.setupEqualizer();\n                        if (!_this.microphoneObj.awaitingCallback) {\n                            // microphone interface awaits speak out loud callback\n                            _this.callInput();\n                        }\n                    }\n                    else {\n                        // code for when both devices are available\n                        // interface is not active, button should be clicked\n                        _this.hasUserMedia = false;\n                    }\n                })\n                    .catch(function (error) {\n                    // Promise catch\n                    _this.hasUserMedia = false;\n                    _this.eventTarget.dispatchEvent(new Event(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR));\n                });\n            }\n            catch (error) {\n                // try catch\n                // whoops no getUserMedia, so roll back to standard UI\n                this.hasUserMedia = false;\n                this.eventTarget.dispatchEvent(new Event(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR));\n            }\n        };\n        MicrophoneBridge.prototype.dealloc = function () {\n            this.cancel();\n            this.promise = null;\n            this.currentStream = null;\n            if (this.equalizer) {\n                this.equalizer.dealloc();\n            }\n            this.equalizer = null;\n            this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n            this.flowUpdateCallback = null;\n        };\n        MicrophoneBridge.prototype.callInput = function (messageTime) {\n            // remove current error message after x time\n            // clearTimeout(this.clearMessageTimer);\n            // this.clearMessageTimer = setTimeout(() =>{\n            // \tthis.el.removeAttribute(\"message\");\n            // }, messageTime);\n            var _this = this;\n            if (messageTime === void 0) { messageTime = 0; }\n            this.button.loading = true;\n            if (this.equalizer) {\n                this.equalizer.disabled = false;\n            }\n            // call API, SpeechRecognintion etc. you decide, passing along the stream from getUserMedia can be used.. as long as the resolve is called with string attribute\n            this.promise = new Promise(function (resolve, reject) { return _this.microphoneObj.input(resolve, reject, _this.currentStream); })\n                .then(function (result) {\n                // api contacted\n                _this.promise = null;\n                // save response so it's available in getFlowDTO\n                _this.currentTextResponse = result.toString();\n                if (!_this.currentTextResponse || _this.currentTextResponse == \"\") {\n                    _this.showError(cf.Dictionary.get(\"user-audio-reponse-invalid\"));\n                    // invalid input, so call API again\n                    _this.callInput();\n                    return;\n                }\n                _this.inputErrorCount = 0;\n                _this.inputCurrentError = \"\";\n                _this.button.loading = false;\n                // continue flow\n                var dto = {\n                    text: _this.currentTextResponse\n                };\n                cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.UserInputEvents.SUBMIT, dto);\n                _this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.SUBMIT, {\n                    detail: dto\n                }));\n            }).catch(function (error) {\n                // API error\n                // ConversationalForm.illustrateFlow(this, \"dispatch\", MicrophoneBridgeEvent.ERROR, error);\n                // this.eventTarget.dispatchEvent(new CustomEvent(MicrophoneBridgeEvent.ERROR, {\n                // \tdetail: error\n                // }));\n                if (_this.isErrorTerminal(error)) {\n                    // terminal error, fallback to \n                    _this.eventTarget.dispatchEvent(new CustomEvent(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, {\n                        detail: cf.Dictionary.get(\"microphone-terminal-error\")\n                    }));\n                    if (!cf.ConversationalForm.suppressLog)\n                        console.log(\"Conversational Form: Terminal error: \", error);\n                }\n                else {\n                    if (_this.inputCurrentError != error) {\n                        // api failed ...\n                        // show result in UI\n                        _this.inputErrorCount = 0;\n                        _this.inputCurrentError = error;\n                    }\n                    else {\n                    }\n                    _this.inputErrorCount++;\n                    if (_this.inputErrorCount > 2) {\n                        _this.showError(error);\n                    }\n                    else {\n                        _this.eventTarget.dispatchEvent(new CustomEvent(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, {\n                            detail: cf.Dictionary.get(\"microphone-terminal-error\")\n                        }));\n                        if (!cf.ConversationalForm.suppressLog)\n                            console.log(\"Conversational Form: Terminal error: \", error);\n                    }\n                }\n            });\n        };\n        MicrophoneBridge.prototype.isErrorTerminal = function (error) {\n            var terminalErrors = [\"network\"];\n            if (terminalErrors.indexOf(error) !== -1)\n                return true;\n            return false;\n        };\n        MicrophoneBridge.prototype.showError = function (error) {\n            var dto = {\n                errorText: error\n            };\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.FlowEvents.USER_INPUT_INVALID, dto);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n                detail: dto\n            }));\n            this.callInput();\n        };\n        MicrophoneBridge.prototype.setupEqualizer = function () {\n            var eqEl = this.el.getElementsByTagName(\"cf-icon-audio-eq\")[0];\n            if (SimpleEqualizer.supported && eqEl) {\n                this.equalizer = new SimpleEqualizer({\n                    stream: this.currentStream,\n                    elementToScale: eqEl\n                });\n            }\n        };\n        return MicrophoneBridge;\n    }());\n    cf.MicrophoneBridge = MicrophoneBridge;\n    var SimpleEqualizer = /** @class */ (function () {\n        function SimpleEqualizer(options) {\n            var _this = this;\n            this.maxBorderWidth = 0;\n            this._disabled = false;\n            this.elementToScale = options.elementToScale;\n            this.context = new AudioContext();\n            this.analyser = this.context.createAnalyser();\n            this.mic = this.context.createMediaStreamSource(options.stream);\n            this.javascriptNode = this.context.createScriptProcessor(2048, 1, 1);\n            this.analyser.smoothingTimeConstant = 0.3;\n            this.analyser.fftSize = 1024;\n            this.mic.connect(this.analyser);\n            this.analyser.connect(this.javascriptNode);\n            this.javascriptNode.connect(this.context.destination);\n            this.javascriptNode.onaudioprocess = function () {\n                _this.onAudioProcess();\n            };\n        }\n        Object.defineProperty(SimpleEqualizer.prototype, \"disabled\", {\n            set: function (value) {\n                this._disabled = value;\n                this.elementToScale.style.borderWidth = 0 + \"px\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        SimpleEqualizer.prototype.onAudioProcess = function () {\n            if (this._disabled)\n                return;\n            var array = new Uint8Array(this.analyser.frequencyBinCount);\n            this.analyser.getByteFrequencyData(array);\n            var values = 0;\n            var length = array.length;\n            for (var i = 0; i < length; i++) {\n                values += array[i];\n            }\n            var average = values / length;\n            var percent = Math.min(1, Math.max(0, 1 - ((50 - average) / 50)));\n            if (!this.maxBorderWidth) {\n                this.maxBorderWidth = this.elementToScale.offsetWidth * 0.5;\n            }\n            this.elementToScale.style.borderWidth = (this.maxBorderWidth * percent) + \"px\";\n        };\n        SimpleEqualizer.prototype.dealloc = function () {\n            this.javascriptNode.onaudioprocess = null;\n            this.javascriptNode = null;\n            this.analyser = null;\n            this.mic = null;\n            this.elementToScale = null;\n            this.context = null;\n        };\n        SimpleEqualizer.supported = function () {\n            window.AudioContext = window.AudioContext || window.webkitAudioContext;\n            if (window.AudioContext) {\n                return true;\n            }\n            else {\n                return false;\n            }\n        };\n        return SimpleEqualizer;\n    }());\n})(cf || (cf = {}));\n\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../control-elements/ControlElements.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\n/// <reference path=\"../../logic/MicrophoneBridge.ts\"/>\n/// <reference path=\"../../interfaces/IUserInputElement.ts\"/>\n/// <reference path=\"UserInputElement.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    cf.UserInputSubmitButtonEvents = {\n        CHANGE: \"userinput-submit-button-change-value\"\n    };\n    // class\n    var UserInputSubmitButton = /** @class */ (function () {\n        function UserInputSubmitButton(options) {\n            this._active = true;\n            this.eventTarget = options.eventTarget;\n            var template = document.createElement('template');\n            template.innerHTML = this.getTemplate();\n            this.el = template.firstChild || template.content.firstChild;\n            this.onClickCallback = this.onClick.bind(this);\n            this.el.addEventListener(\"click\", this.onClickCallback, false);\n            this.onMicrophoneTerminalErrorCallback = this.onMicrophoneTerminalError.bind(this);\n            this.eventTarget.addEventListener(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, this.onMicrophoneTerminalErrorCallback, false);\n        }\n        Object.defineProperty(UserInputSubmitButton.prototype, \"typing\", {\n            get: function () {\n                return this.el.classList.contains(\"typing\");\n            },\n            set: function (value) {\n                if (value) {\n                    this.el.classList.add(\"typing\");\n                    this.loading = false;\n                    if (this.mic) {\n                        this.mic.cancel();\n                    }\n                }\n                else {\n                    this.el.classList.remove(\"typing\");\n                    if (this.mic) {\n                        this.mic.callInput();\n                    }\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UserInputSubmitButton.prototype, \"active\", {\n            get: function () {\n                return this._active;\n            },\n            set: function (value) {\n                this._active = value;\n                if (this.mic) {\n                    this.mic.active = value;\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UserInputSubmitButton.prototype, \"loading\", {\n            get: function () {\n                return this.el.classList.contains(\"loading\");\n            },\n            set: function (value) {\n                if (value)\n                    this.el.classList.add(\"loading\");\n                else\n                    this.el.classList.remove(\"loading\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        UserInputSubmitButton.prototype.addMicrophone = function (microphoneObj) {\n            this.el.classList.add(\"microphone-interface\");\n            var template = document.createElement('template');\n            template.innerHTML = \"<div class=\\\"cf-input-icons cf-microphone\\\">\\n\\t\\t\\t\\t<div class=\\\"cf-icon-audio\\\"></div>\\n\\t\\t\\t\\t<cf-icon-audio-eq></cf-icon-audio-eq>\\n\\t\\t\\t</div>\";\n            var mic = template.firstChild || template.content.firstChild;\n            this.mic = new cf.MicrophoneBridge({\n                el: mic,\n                button: this,\n                eventTarget: this.eventTarget,\n                microphoneObj: microphoneObj\n            });\n            this.el.appendChild(mic);\n            // this.mic = null;\n            // this.el.appendChild(this.mic.el);\n        };\n        UserInputSubmitButton.prototype.reset = function () {\n            if (this.mic && !this.typing) {\n                // if microphone and not typing\n                this.mic.callInput();\n            }\n        };\n        UserInputSubmitButton.prototype.getTemplate = function () {\n            return \"<cf-input-button class=\\\"cf-input-button\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"cf-input-icons\\\">\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"cf-icon-progress\\\"></div>\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"cf-icon-attachment\\\"></div>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t</cf-input-button>\";\n        };\n        UserInputSubmitButton.prototype.onMicrophoneTerminalError = function (event) {\n            if (this.mic) {\n                this.mic.dealloc();\n                this.mic = null;\n                this.el.removeChild(this.el.getElementsByClassName(\"cf-microphone\")[0]);\n                this.el.classList.remove(\"microphone-interface\");\n                this.loading = false;\n                this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n                    detail: {\n                        errorText: event.detail\n                    } //UserTextInput value\n                }));\n            }\n        };\n        UserInputSubmitButton.prototype.onClick = function (event) {\n            var isMicVisible = this.mic && !this.typing;\n            if (isMicVisible) {\n                this.mic.callInput();\n            }\n            else {\n                this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputSubmitButtonEvents.CHANGE));\n            }\n        };\n        /**\n        * @name click\n        * force click on button\n        */\n        UserInputSubmitButton.prototype.click = function () {\n            this.el.click();\n        };\n        /**\n        * @name dealloc\n        * remove instance\n        */\n        UserInputSubmitButton.prototype.dealloc = function () {\n            this.eventTarget.removeEventListener(cf.MicrophoneBridgeEvent.TERMNIAL_ERROR, this.onMicrophoneTerminalErrorCallback, false);\n            this.onMicrophoneTerminalErrorCallback = null;\n            if (this.mic) {\n                this.mic.dealloc();\n            }\n            this.mic = null;\n            this.el.removeEventListener(\"click\", this.onClickCallback, false);\n            this.onClickCallback = null;\n            this.el = null;\n            this.eventTarget = null;\n        };\n        return UserInputSubmitButton;\n    }());\n    cf.UserInputSubmitButton = UserInputSubmitButton;\n})(cf || (cf = {}));\n\n/// <reference path=\"../logic/FlowManager.ts\"/>\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    cf.UserInputTypes = {\n        VOICE: \"voice\",\n        VR_GESTURE: \"vr-gesture\",\n        TEXT: \"text\" // <-- default\n    };\n})(cf || (cf = {}));\n\n\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../control-elements/ControlElements.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\n/// <reference path=\"../../interfaces/IUserInput.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// Abstract UserInpt element, should be extended when adding a new UI for user input\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    var UserInputElement = /** @class */ (function (_super) {\n        __extends(UserInputElement, _super);\n        function UserInputElement(options) {\n            var _this = _super.call(this, options) || this;\n            _this._disabled = false;\n            _this._visible = false;\n            _this.onChatReponsesUpdatedCallback = _this.onChatReponsesUpdated.bind(_this);\n            _this.eventTarget.addEventListener(cf.ChatListEvents.CHATLIST_UPDATED, _this.onChatReponsesUpdatedCallback, false);\n            _this.windowFocusCallback = _this.windowFocus.bind(_this);\n            window.addEventListener('focus', _this.windowFocusCallback, false);\n            _this.inputInvalidCallback = _this.inputInvalid.bind(_this);\n            _this.eventTarget.addEventListener(cf.FlowEvents.USER_INPUT_INVALID, _this.inputInvalidCallback, false);\n            _this.flowUpdateCallback = _this.onFlowUpdate.bind(_this);\n            _this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, _this.flowUpdateCallback, false);\n            return _this;\n        }\n        Object.defineProperty(UserInputElement.prototype, \"currentTag\", {\n            get: function () {\n                return this._currentTag;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UserInputElement.prototype, \"visible\", {\n            set: function (value) {\n                var _this = this;\n                this._visible = value;\n                if (!this.el.classList.contains(\"animate-in\") && value) {\n                    setTimeout(function () {\n                        _this.el.classList.add(\"animate-in\");\n                    }, 0);\n                }\n                else if (this.el.classList.contains(\"animate-in\") && !value) {\n                    this.el.classList.remove(\"animate-in\");\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UserInputElement.prototype, \"disabled\", {\n            get: function () {\n                return this._disabled;\n            },\n            set: function (value) {\n                var hasChanged = this._disabled != value;\n                if (hasChanged) {\n                    this._disabled = value;\n                    if (value) {\n                        this.el.setAttribute(\"disabled\", \"disabled\");\n                    }\n                    else {\n                        this.setFocusOnInput();\n                        this.el.removeAttribute(\"disabled\");\n                    }\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UserInputElement.prototype, \"height\", {\n            get: function () {\n                var elHeight = 0;\n                var elMargin = 0;\n                var el = this.el;\n                if (cf.Helpers.isInternetExlorer()) {\n                    // IE\n                    elHeight = el.offsetHeight;\n                    elMargin = parseInt(el.currentStyle.marginTop, 10) + parseInt(el.currentStyle.marginBottom, 10);\n                    elMargin *= 2;\n                }\n                else {\n                    // none-IE\n                    elHeight = parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('height'), 10);\n                    elMargin = parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-top')) + parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-bottom'));\n                }\n                return (elHeight + elMargin);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        UserInputElement.prototype.onEnterOrSubmitButtonSubmit = function (event) {\n            if (event === void 0) { event = null; }\n        };\n        UserInputElement.prototype.inputInvalid = function (event) {\n        };\n        /**\n        * @name deactivate\n        * DEactivate the field\n        */\n        UserInputElement.prototype.deactivate = function () {\n            this.disabled = true;\n        };\n        /**\n        * @name reactivate\n        * REactivate the field\n        */\n        UserInputElement.prototype.reactivate = function () {\n            this.disabled = false;\n        };\n        UserInputElement.prototype.getFlowDTO = function () {\n            var value; // = this.inputElement.value;\n            return value;\n        };\n        UserInputElement.prototype.setFocusOnInput = function () {\n        };\n        UserInputElement.prototype.onFlowStopped = function () {\n        };\n        UserInputElement.prototype.reset = function () {\n        };\n        UserInputElement.prototype.dealloc = function () {\n            this.eventTarget.removeEventListener(cf.ChatListEvents.CHATLIST_UPDATED, this.onChatReponsesUpdatedCallback, false);\n            this.onChatReponsesUpdatedCallback = null;\n            this.eventTarget.removeEventListener(cf.FlowEvents.USER_INPUT_INVALID, this.inputInvalidCallback, false);\n            this.inputInvalidCallback = null;\n            window.removeEventListener('focus', this.windowFocusCallback, false);\n            this.windowFocusCallback = null;\n            this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n            this.flowUpdateCallback = null;\n            _super.prototype.dealloc.call(this);\n        };\n        UserInputElement.prototype.onFlowUpdate = function (event) {\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n            this._currentTag = event.detail.tag;\n        };\n        UserInputElement.prototype.windowFocus = function (event) {\n        };\n        UserInputElement.prototype.onChatReponsesUpdated = function (event) {\n            // only show when user response\n            if (!event.detail.currentResponse.isRobotResponse) {\n                this.visible = true;\n                this.disabled = false;\n                this.setFocusOnInput();\n            }\n        };\n        UserInputElement.ERROR_TIME = 2000;\n        UserInputElement.preventAutoFocus = false;\n        UserInputElement.hideUserInputOnNoneTextInput = false;\n        return UserInputElement;\n    }(cf.BasicElement));\n    cf.UserInputElement = UserInputElement;\n    cf.UserInputEvents = {\n        SUBMIT: \"cf-input-user-input-submit\",\n        KEY_CHANGE: \"cf-input-key-change\",\n        CONTROL_ELEMENTS_ADDED: \"cf-input-control-elements-added\",\n        HEIGHT_CHANGE: \"cf-input-height-change\",\n        FOCUS: \"cf-input-focus\",\n        BLUR: \"cf-input-blur\",\n    };\n})(cf || (cf = {}));\n\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../control-elements/ControlElements.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\n/// <reference path=\"../../interfaces/IUserInputElement.ts\"/>\n/// <reference path=\"UserInputElement.ts\"/>\n/// <reference path=\"UserInputSubmitButton.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    // class\n    var UserTextInput = /** @class */ (function (_super) {\n        __extends(UserTextInput, _super);\n        function UserTextInput(options) {\n            var _this = _super.call(this, options) || this;\n            _this.initialInputHeight = 0;\n            _this.shiftIsDown = false;\n            //acts as a fallback for ex. shadow dom implementation\n            _this._active = false;\n            _this.cfReference = options.cfReference;\n            _this.eventTarget = options.eventTarget;\n            _this.inputElement = _this.el.getElementsByTagName(\"textarea\")[0];\n            _this.onInputFocusCallback = _this.onInputFocus.bind(_this);\n            _this.onInputBlurCallback = _this.onInputBlur.bind(_this);\n            _this.inputElement.addEventListener('focus', _this.onInputFocusCallback, false);\n            _this.inputElement.addEventListener('blur', _this.onInputBlurCallback, false);\n            if (!cf.ConversationalForm.animationsEnabled) {\n                _this.inputElement.setAttribute('no-animations', '');\n            }\n            //<cf-input-control-elements> is defined in the ChatList.ts\n            _this.controlElements = new cf.ControlElements({\n                el: _this.el.getElementsByTagName(\"cf-input-control-elements\")[0],\n                cfReference: _this.cfReference,\n                infoEl: _this.el.getElementsByTagName(\"cf-info\")[0],\n                eventTarget: _this.eventTarget\n            });\n            // setup event listeners\n            _this.keyUpCallback = _this.onKeyUp.bind(_this);\n            document.addEventListener(\"keyup\", _this.keyUpCallback, false);\n            _this.keyDownCallback = _this.onKeyDown.bind(_this);\n            document.addEventListener(\"keydown\", _this.keyDownCallback, false);\n            _this.onOriginalTagChangedCallback = _this.onOriginalTagChanged.bind(_this);\n            _this.eventTarget.addEventListener(cf.TagEvents.ORIGINAL_ELEMENT_CHANGED, _this.onOriginalTagChangedCallback, false);\n            _this.onControlElementSubmitCallback = _this.onControlElementSubmit.bind(_this);\n            _this.eventTarget.addEventListener(cf.ControlElementEvents.SUBMIT_VALUE, _this.onControlElementSubmitCallback, false);\n            _this.onControlElementProgressChangeCallback = _this.onControlElementProgressChange.bind(_this);\n            _this.eventTarget.addEventListener(cf.ControlElementEvents.PROGRESS_CHANGE, _this.onControlElementProgressChangeCallback, false);\n            _this.onSubmitButtonChangeStateCallback = _this.onSubmitButtonChangeState.bind(_this);\n            _this.eventTarget.addEventListener(cf.UserInputSubmitButtonEvents.CHANGE, _this.onSubmitButtonChangeStateCallback, false);\n            // this.eventTarget.addEventListener(ControlElementsEvents.ON_RESIZE, () => {}, false);\n            _this.submitButton = new cf.UserInputSubmitButton({\n                eventTarget: _this.eventTarget\n            });\n            _this.el.querySelector('div').appendChild(_this.submitButton.el);\n            // setup microphone support, audio\n            if (options.microphoneInputObj) {\n                _this.microphoneObj = options.microphoneInputObj;\n                if (_this.microphoneObj && _this.microphoneObj.init) {\n                    // init if init method is defined\n                    _this.microphoneObj.init();\n                }\n                _this.submitButton.addMicrophone(_this.microphoneObj);\n            }\n            return _this;\n        }\n        Object.defineProperty(UserTextInput.prototype, \"active\", {\n            get: function () {\n                return this.inputElement === document.activeElement || this._active;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(UserTextInput.prototype, \"disabled\", {\n            set: function (value) {\n                var hasChanged = this._disabled != value;\n                if (!cf.ConversationalForm.suppressLog)\n                    console.log('option hasChanged', value);\n                if (hasChanged) {\n                    this._disabled = value;\n                    if (value) {\n                        this.el.setAttribute(\"disabled\", \"disabled\");\n                        this.inputElement.blur();\n                    }\n                    else {\n                        this.setFocusOnInput();\n                        this.el.removeAttribute(\"disabled\");\n                    }\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        UserTextInput.prototype.getInputValue = function () {\n            var str = this.inputElement.value;\n            // Build-in way to handle XSS issues ->\n            var div = document.createElement('div');\n            div.appendChild(document.createTextNode(str));\n            return div.innerHTML;\n        };\n        UserTextInput.prototype.getFlowDTO = function () {\n            var value; // = this.inputElement.value;\n            // check for values on control elements as they should overwrite the input value.\n            if (this.controlElements && this.controlElements.active) {\n                value = this.controlElements.getDTO();\n            }\n            else {\n                value = {\n                    text: this.getInputValue()\n                };\n            }\n            // add current tag to DTO if not set\n            if (!value.tag)\n                value.tag = this.currentTag;\n            value.input = this;\n            value.tag = this.currentTag;\n            return value;\n        };\n        UserTextInput.prototype.reset = function () {\n            if (this.controlElements) {\n                this.controlElements.clearTagsAndReset();\n            }\n        };\n        UserTextInput.prototype.deactivate = function () {\n            _super.prototype.deactivate.call(this);\n            if (this.microphoneObj) {\n                this.submitButton.active = false;\n            }\n        };\n        UserTextInput.prototype.reactivate = function () {\n            _super.prototype.reactivate.call(this);\n            // called from microphone interface, check if active microphone, and set loading if yes\n            if (this.microphoneObj && !this.submitButton.typing) {\n                this.submitButton.loading = true;\n                // setting typing to false calls the externa interface, like Microphone\n                this.submitButton.typing = false;\n                this.submitButton.active = true;\n            }\n        };\n        UserTextInput.prototype.onFlowStopped = function () {\n            this.submitButton.loading = false;\n            if (this.submitButton.typing)\n                this.submitButton.typing = false;\n            if (this.controlElements)\n                this.controlElements.clearTagsAndReset();\n            this.disabled = true;\n        };\n        /**\n        * @name onOriginalTagChanged\n        * on domElement from a Tag value changed..\n        */\n        UserTextInput.prototype.onOriginalTagChanged = function (event) {\n            if (this.currentTag == event.detail.tag) {\n                this.onInputChange();\n            }\n            if (this.controlElements && this.controlElements.active) {\n                this.controlElements.updateStateOnElementsFromTag(event.detail.tag);\n            }\n        };\n        UserTextInput.prototype.onInputChange = function () {\n            if (!this.active && !this.controlElements.active)\n                return;\n            // safari likes to jump around with the scrollHeight value, let's keep it in check with an initial height.\n            var oldHeight = Math.max(this.initialInputHeight, parseInt(this.inputElement.style.height, 10));\n            this.inputElement.style.height = '0px';\n            // console.log(this.inputElement.style.height, this.inputElement.style);\n            this.inputElement.style.height = (this.inputElement.scrollHeight === 0 ? oldHeight : this.inputElement.scrollHeight) + \"px\";\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.UserInputEvents.HEIGHT_CHANGE);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.HEIGHT_CHANGE, {\n                detail: this.inputElement.scrollHeight\n            }));\n        };\n        UserTextInput.prototype.resetInputHeight = function () {\n            if (this.inputElement.getAttribute('rows') === '1') {\n                this.inputElement.style.height = this.initialInputHeight + 'px';\n            }\n            else {\n                this.inputElement.style.height = '0px';\n            }\n        };\n        UserTextInput.prototype.inputInvalid = function (event) {\n            var _this = this;\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n            var dto = event.detail;\n            this.inputElement.setAttribute(\"data-value\", this.inputElement.value);\n            this.inputElement.value = \"\";\n            this.el.setAttribute(\"error\", \"\");\n            this.disabled = true;\n            // cf-error\n            this.inputElement.setAttribute(\"placeholder\", dto.errorText || (this._currentTag ? this._currentTag.errorMessage : \"\"));\n            clearTimeout(this.errorTimer);\n            // remove loading class\n            this.submitButton.loading = false;\n            this.errorTimer = setTimeout(function () {\n                _this.disabled = false;\n                if (!cf.ConversationalForm.suppressLog)\n                    console.log('option, disabled 1');\n                _this.el.removeAttribute(\"error\");\n                _this.inputElement.value = _this.inputElement.getAttribute(\"data-value\");\n                _this.inputElement.setAttribute(\"data-value\", \"\");\n                _this.setPlaceholder();\n                _this.setFocusOnInput();\n                //TODO: reset submit button..\n                _this.submitButton.reset();\n                if (_this.controlElements)\n                    _this.controlElements.resetAfterErrorMessage();\n            }, cf.UserInputElement.ERROR_TIME);\n        };\n        UserTextInput.prototype.setPlaceholder = function () {\n            if (this._currentTag) {\n                if (this._currentTag.inputPlaceholder) {\n                    this.inputElement.setAttribute(\"placeholder\", this._currentTag.inputPlaceholder);\n                }\n                else {\n                    this.inputElement.setAttribute(\"placeholder\", this._currentTag.type == \"group\" ? cf.Dictionary.get(\"group-placeholder\") : cf.Dictionary.get(\"input-placeholder\"));\n                }\n            }\n            else {\n                this.inputElement.setAttribute(\"placeholder\", cf.Dictionary.get(\"group-placeholder\"));\n            }\n        };\n        /**\n         * TODO: handle detect input/textarea in a simpler way - too conditional heavy\n         *\n         * @private\n         * @memberof UserTextInput\n         */\n        UserTextInput.prototype.checkForCorrectInputTag = function () {\n            var tagName = this.tagType(this._currentTag);\n            // remove focus and blur events, because we want to create a new element\n            if (this.inputElement && this.inputElement.tagName !== tagName) {\n                this.inputElement.removeEventListener('focus', this.onInputFocusCallback, false);\n                this.inputElement.removeEventListener('blur', this.onInputBlurCallback, false);\n            }\n            this.removeAttribute('autocomplete');\n            this.removeAttribute('list');\n            if (tagName === 'INPUT') {\n                // change to input\n                var input_1 = document.createElement(\"input\");\n                Array.prototype.slice.call(this.inputElement.attributes).forEach(function (item) {\n                    input_1.setAttribute(item.name, item.value);\n                });\n                if (this.inputElement.type === 'password') {\n                    input_1.setAttribute(\"autocomplete\", \"new-password\");\n                }\n                if (this._currentTag.domElement.hasAttribute('autocomplete')) {\n                    input_1.setAttribute('autocomplete', this._currentTag.domElement.getAttribute('autocomplete'));\n                }\n                if (this._currentTag.domElement.hasAttribute('list')) {\n                    input_1.setAttribute('list', this._currentTag.domElement.getAttribute('list'));\n                }\n                this.inputElement.parentNode.replaceChild(input_1, this.inputElement);\n                this.inputElement = input_1;\n            }\n            else if (this.inputElement && this.inputElement.tagName !== tagName) {\n                // change to textarea\n                var textarea_1 = document.createElement(\"textarea\");\n                Array.prototype.slice.call(this.inputElement.attributes).forEach(function (item) {\n                    textarea_1.setAttribute(item.name, item.value);\n                });\n                this.inputElement.parentNode.replaceChild(textarea_1, this.inputElement);\n                this.inputElement = textarea_1;\n            }\n            // add focus and blur events to newly created input element\n            if (this.inputElement && this.inputElement.tagName !== tagName) {\n                this.inputElement.addEventListener('focus', this.onInputFocusCallback, false);\n                this.inputElement.addEventListener('blur', this.onInputBlurCallback, false);\n            }\n            if (this.initialInputHeight == 0) {\n                // initial height not set\n                this.initialInputHeight = this.inputElement.offsetHeight;\n            }\n            this.setFocusOnInput();\n        };\n        /**\n         * Removes attribute on input element if attribute is present\n         *\n         * @private\n         * @param {string} attribute\n         * @memberof UserTextInput\n         */\n        UserTextInput.prototype.removeAttribute = function (attribute) {\n            if (this.inputElement\n                && this.inputElement.hasAttribute(attribute)) {\n                this.inputElement.removeAttribute(attribute);\n            }\n        };\n        UserTextInput.prototype.tagType = function (inputElement) {\n            if (!inputElement.domElement\n                || !inputElement.domElement.tagName) {\n                return 'TEXTAREA';\n            }\n            if (inputElement.domElement.tagName === 'TEXTAREA'\n                || (inputElement.domElement.hasAttribute('rows')\n                    && parseInt(inputElement.domElement.getAttribute('rows'), 10) > 1))\n                return 'TEXTAREA';\n            if (inputElement.domElement.tagName === 'INPUT')\n                return 'INPUT';\n            return 'TEXTAREA'; // TODO\n        };\n        UserTextInput.prototype.onFlowUpdate = function (event) {\n            var _this = this;\n            _super.prototype.onFlowUpdate.call(this, event);\n            this.submitButton.loading = false;\n            if (this.submitButton.typing)\n                this.submitButton.typing = false;\n            // animate input field in\n            this.el.setAttribute(\"tag-type\", this._currentTag.type);\n            // replace textarea and visa versa\n            this.checkForCorrectInputTag();\n            // set input field to type password if the dom input field is that, covering up the input\n            var isInputSpecificType = [\"password\", \"number\", \"email\", \"tel\"].indexOf(this._currentTag.type) !== -1;\n            this.inputElement.setAttribute(\"type\", isInputSpecificType ? this._currentTag.type : \"input\");\n            clearTimeout(this.errorTimer);\n            this.el.removeAttribute(\"error\");\n            this.inputElement.setAttribute(\"data-value\", \"\");\n            this.inputElement.value = \"\";\n            this.submitButton.loading = false;\n            this.setPlaceholder();\n            this.resetValue();\n            this.setFocusOnInput();\n            this.controlElements.reset();\n            if (this._currentTag.type == \"group\") {\n                this.buildControlElements(this._currentTag.elements);\n            }\n            else {\n                this.buildControlElements([this._currentTag]);\n            }\n            if (this._currentTag.defaultValue) {\n                this.inputElement.value = this._currentTag.defaultValue.toString();\n            }\n            if (this._currentTag.skipUserInput === true) {\n                this.el.classList.add(\"hide-input\");\n            }\n            else {\n                this.el.classList.remove(\"hide-input\");\n            }\n            // Set rows attribute if present\n            if (this._currentTag.rows && this._currentTag.rows > 1) {\n                this.inputElement.setAttribute('rows', this._currentTag.rows.toString());\n            }\n            if (cf.UserInputElement.hideUserInputOnNoneTextInput) {\n                // toggle userinput hide\n                if (this.controlElements.active) {\n                    this.el.classList.add(\"hide-input\");\n                    // set focus on first control element\n                    this.controlElements.focusFrom(\"bottom\");\n                }\n                else {\n                    this.el.classList.remove(\"hide-input\");\n                }\n            }\n            this.resetInputHeight();\n            setTimeout(function () {\n                _this.onInputChange();\n            }, 300);\n        };\n        UserTextInput.prototype.onControlElementProgressChange = function (event) {\n            var status = event.detail;\n            this.disabled = status == cf.ControlElementProgressStates.BUSY;\n            if (!cf.ConversationalForm.suppressLog)\n                console.log('option, disabled 2');\n        };\n        UserTextInput.prototype.buildControlElements = function (tags) {\n            this.controlElements.buildTags(tags);\n        };\n        UserTextInput.prototype.onControlElementSubmit = function (event) {\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n            // when ex a RadioButton is clicked..\n            var controlElement = event.detail;\n            this.controlElements.updateStateOnElements(controlElement);\n            this.doSubmit();\n        };\n        UserTextInput.prototype.onSubmitButtonChangeState = function (event) {\n            this.onEnterOrSubmitButtonSubmit(event);\n        };\n        UserTextInput.prototype.isMetaKeyPressed = function (event) {\n            // if any meta keys, then ignore, getModifierState, but safari does not support..\n            if (event.metaKey || [91, 93].indexOf(event.keyCode) !== -1)\n                return;\n        };\n        UserTextInput.prototype.onKeyDown = function (event) {\n            if (!this.active && !this.controlElements.focus)\n                return;\n            if (this.isControlElementsActiveAndUserInputHidden())\n                return;\n            if (this.isMetaKeyPressed(event))\n                return;\n            // if any meta keys, then ignore\n            if (event.keyCode == cf.Dictionary.keyCodes[\"shift\"])\n                this.shiftIsDown = true;\n            // If submit is prevented by option 'preventSubmitOnEnter'\n            if (this.cfReference.preventSubmitOnEnter === true && this.inputElement.hasAttribute('rows') && parseInt(this.inputElement.getAttribute('rows')) > 1) {\n                return;\n            }\n            // prevent textarea line breaks\n            if (event.keyCode == cf.Dictionary.keyCodes[\"enter\"] && !event.shiftKey) {\n                event.preventDefault();\n            }\n        };\n        UserTextInput.prototype.isControlElementsActiveAndUserInputHidden = function () {\n            return this.controlElements && this.controlElements.active && cf.UserInputElement.hideUserInputOnNoneTextInput;\n        };\n        UserTextInput.prototype.onKeyUp = function (event) {\n            if ((!this.active && !this.isControlElementsActiveAndUserInputHidden()) && !this.controlElements.focus)\n                return;\n            if (this.isMetaKeyPressed(event))\n                return;\n            if (event.keyCode == cf.Dictionary.keyCodes[\"shift\"]) {\n                this.shiftIsDown = false;\n            }\n            else if (event.keyCode == cf.Dictionary.keyCodes[\"up\"]) {\n                event.preventDefault();\n                if (this.active && !this.controlElements.focus)\n                    this.controlElements.focusFrom(\"bottom\");\n            }\n            else if (event.keyCode == cf.Dictionary.keyCodes[\"down\"]) {\n                event.preventDefault();\n                if (this.active && !this.controlElements.focus)\n                    this.controlElements.focusFrom(\"top\");\n            }\n            else if (event.keyCode == cf.Dictionary.keyCodes[\"tab\"]) {\n                // tab key pressed, check if node is child of CF, if then then reset focus to input element\n                var doesKeyTargetExistInCF = false;\n                var node = event.target.parentNode;\n                while (node != null) {\n                    if (node === this.cfReference.el) {\n                        doesKeyTargetExistInCF = true;\n                        break;\n                    }\n                    node = node.parentNode;\n                }\n                // prevent normal behaviour, we are not here to take part, we are here to take over!\n                if (!doesKeyTargetExistInCF) {\n                    event.preventDefault();\n                    if (!this.controlElements.active)\n                        this.setFocusOnInput();\n                }\n            }\n            if (this.el.hasAttribute(\"disabled\"))\n                return;\n            var value = this.getFlowDTO();\n            if ((event.keyCode == cf.Dictionary.keyCodes[\"enter\"] && !event.shiftKey) || event.keyCode == cf.Dictionary.keyCodes[\"space\"]) {\n                if (event.keyCode == cf.Dictionary.keyCodes[\"enter\"] && this.active) {\n                    if (this.cfReference.preventSubmitOnEnter === true)\n                        return;\n                    event.preventDefault();\n                    this.onEnterOrSubmitButtonSubmit();\n                }\n                else {\n                    // either click on submit button or do something with control elements\n                    if (event.keyCode == cf.Dictionary.keyCodes[\"enter\"] || event.keyCode == cf.Dictionary.keyCodes[\"space\"]) {\n                        event.preventDefault();\n                        var tagType = this._currentTag.type == \"group\" ? this._currentTag.getGroupTagType() : this._currentTag.type;\n                        if (tagType == \"select\" || tagType == \"checkbox\") {\n                            var mutiTag = this._currentTag;\n                            // if select or checkbox then check for multi select item\n                            if (tagType == \"checkbox\" || mutiTag.multipleChoice) {\n                                if ((this.active || this.isControlElementsActiveAndUserInputHidden()) && event.keyCode == cf.Dictionary.keyCodes[\"enter\"]) {\n                                    // click on UserTextInput submit button, only ENTER allowed\n                                    this.submitButton.click();\n                                }\n                                else {\n                                    // let UI know that we changed the key\n                                    if (!this.active && !this.controlElements.active && !this.isControlElementsActiveAndUserInputHidden()) {\n                                        // after ui has been selected we RESET the input/filter\n                                        this.resetValue();\n                                        this.setFocusOnInput();\n                                    }\n                                    this.dispatchKeyChange(value, event.keyCode);\n                                }\n                            }\n                            else {\n                                this.dispatchKeyChange(value, event.keyCode);\n                            }\n                        }\n                        else {\n                            if (this._currentTag.type == \"group\") {\n                                // let the controlements handle action\n                                this.dispatchKeyChange(value, event.keyCode);\n                            }\n                        }\n                    }\n                    else if (event.keyCode == cf.Dictionary.keyCodes[\"space\"] && document.activeElement) {\n                        this.dispatchKeyChange(value, event.keyCode);\n                    }\n                }\n            }\n            else if (event.keyCode != cf.Dictionary.keyCodes[\"shift\"] && event.keyCode != cf.Dictionary.keyCodes[\"tab\"]) {\n                this.dispatchKeyChange(value, event.keyCode);\n            }\n            this.onInputChange();\n        };\n        UserTextInput.prototype.dispatchKeyChange = function (dto, keyCode) {\n            // typing --->\n            this.submitButton.typing = dto.text && dto.text.length > 0;\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.UserInputEvents.KEY_CHANGE, dto);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.KEY_CHANGE, {\n                detail: {\n                    dto: dto,\n                    keyCode: keyCode,\n                    inputFieldActive: this.active\n                }\n            }));\n        };\n        UserTextInput.prototype.windowFocus = function (event) {\n            _super.prototype.windowFocus.call(this, event);\n            this.setFocusOnInput();\n        };\n        UserTextInput.prototype.onInputBlur = function (event) {\n            this._active = false;\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.BLUR));\n        };\n        UserTextInput.prototype.onInputFocus = function (event) {\n            this._active = true;\n            this.onInputChange();\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.FOCUS));\n        };\n        UserTextInput.prototype.setFocusOnInput = function () {\n            if (!cf.UserInputElement.preventAutoFocus && !this.el.classList.contains(\"hide-input\")) {\n                this.inputElement.focus();\n            }\n        };\n        UserTextInput.prototype.onEnterOrSubmitButtonSubmit = function (event) {\n            if (event === void 0) { event = null; }\n            var isControlElementsActiveAndUserInputHidden = this.controlElements.active && cf.UserInputElement.hideUserInputOnNoneTextInput;\n            if ((this.active || isControlElementsActiveAndUserInputHidden) && this.controlElements.highlighted) {\n                // active input field and focus on control elements happens when a control element is highlighted\n                this.controlElements.clickOnHighlighted();\n            }\n            else {\n                if (!this._currentTag) {\n                    // happens when a form is empty, so just play along and submit response to chatlist..\n                    this.eventTarget.cf.addUserChatResponse(this.inputElement.value);\n                }\n                else {\n                    // we need to check if current tag is file\n                    if (this._currentTag.type == \"file\" && event) {\n                        // trigger <input type=\"file\" but only when it's from clicking button\n                        this.controlElements.getElement(0).triggerFileSelect();\n                    }\n                    else {\n                        // for groups, we expect that there is always a default value set\n                        this.doSubmit();\n                    }\n                }\n            }\n        };\n        UserTextInput.prototype.doSubmit = function () {\n            var dto = this.getFlowDTO();\n            this.submitButton.loading = true;\n            this.disabled = true;\n            this.el.removeAttribute(\"error\");\n            this.inputElement.setAttribute(\"data-value\", \"\");\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.UserInputEvents.SUBMIT, dto);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.UserInputEvents.SUBMIT, {\n                detail: dto\n            }));\n        };\n        UserTextInput.prototype.resetValue = function () {\n            this.inputElement.value = \"\";\n            if (this.inputElement.hasAttribute('rows'))\n                this.inputElement.setAttribute('rows', '1');\n            this.onInputChange();\n        };\n        UserTextInput.prototype.dealloc = function () {\n            this.inputElement.removeEventListener('blur', this.onInputBlurCallback, false);\n            this.onInputBlurCallback = null;\n            this.inputElement.removeEventListener('focus', this.onInputFocusCallback, false);\n            this.onInputFocusCallback = null;\n            document.removeEventListener(\"keydown\", this.keyDownCallback, false);\n            this.keyDownCallback = null;\n            document.removeEventListener(\"keyup\", this.keyUpCallback, false);\n            this.keyUpCallback = null;\n            this.eventTarget.removeEventListener(cf.ControlElementEvents.SUBMIT_VALUE, this.onControlElementSubmitCallback, false);\n            this.onControlElementSubmitCallback = null;\n            // remove submit button instance\n            this.submitButton.el.removeEventListener(cf.UserInputSubmitButtonEvents.CHANGE, this.onSubmitButtonChangeStateCallback, false);\n            this.onSubmitButtonChangeStateCallback = null;\n            this.submitButton.dealloc();\n            this.submitButton = null;\n            _super.prototype.dealloc.call(this);\n        };\n        // override\n        UserTextInput.prototype.getTemplate = function () {\n            return this.customTemplate || \"<cf-input>\\n\\t\\t\\t\\t<cf-info></cf-info>\\n\\t\\t\\t\\t<cf-input-control-elements>\\n\\t\\t\\t\\t\\t<cf-list-button direction=\\\"prev\\\">\\n\\t\\t\\t\\t\\t</cf-list-button>\\n\\t\\t\\t\\t\\t<cf-list-button direction=\\\"next\\\">\\n\\t\\t\\t\\t\\t</cf-list-button>\\n\\t\\t\\t\\t\\t<cf-list>\\n\\t\\t\\t\\t\\t</cf-list>\\n\\t\\t\\t\\t</cf-input-control-elements>\\n\\t\\t\\t\\t<div class=\\\"inputWrapper\\\">\\n\\t\\t\\t\\t\\t<textarea type='input' tabindex=\\\"1\\\" rows=\\\"1\\\"></textarea>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</cf-input>\\n\\t\\t\\t\";\n        };\n        return UserTextInput;\n    }(cf.UserInputElement));\n    cf.UserTextInput = UserTextInput;\n})(cf || (cf = {}));\n\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../../logic/Helpers.ts\"/>\n/// <reference path=\"../../ConversationalForm.ts\"/>\n/// <reference path=\"../../interfaces/IUserInterfaceOptions.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    cf.ChatResponseEvents = {\n        USER_ANSWER_CLICKED: \"cf-on-user-answer-clicked\"\n    };\n    // class\n    var ChatResponse = /** @class */ (function (_super) {\n        __extends(ChatResponse, _super);\n        function ChatResponse(options) {\n            var _this = _super.call(this, options) || this;\n            _this.container = options.container;\n            _this.uiOptions = options.cfReference.uiOptions;\n            _this._tag = options.tag;\n            return _this;\n        }\n        Object.defineProperty(ChatResponse.prototype, \"tag\", {\n            get: function () {\n                return this._tag;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ChatResponse.prototype, \"added\", {\n            get: function () {\n                return !!this.el || !!this.el.parentNode || !!this.el.parentNode.parentNode;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ChatResponse.prototype, \"disabled\", {\n            get: function () {\n                return this.el.classList.contains(\"disabled\");\n            },\n            set: function (value) {\n                if (value)\n                    this.el.classList.add(\"disabled\");\n                else\n                    this.el.classList.remove(\"disabled\");\n            },\n            enumerable: true,\n            configurable: true\n        });\n        /**\n         * We depend on scroll in a column-reverse flex container. This is where Edge and Firefox comes up short\n         */\n        ChatResponse.prototype.hasFlexBug = function () {\n            return this.cfReference.el.classList.contains('browser-firefox') || this.cfReference.el.classList.contains('browser-edge');\n        };\n        ChatResponse.prototype.animateIn = function () {\n            var _this = this;\n            var outer = document.querySelector('scrollable');\n            var inner = document.querySelector('.scrollableInner');\n            if (this.hasFlexBug())\n                inner.classList.remove('scroll');\n            requestAnimationFrame(function () {\n                var height = _this.el.scrollHeight;\n                _this.el.style.height = '0px';\n                requestAnimationFrame(function () {\n                    _this.el.style.height = height + 'px';\n                    _this.el.classList.add('show');\n                    // Listen for transitionend and set to height:auto\n                    try {\n                        var sm = window.getComputedStyle(document.querySelectorAll('p.show')[0]);\n                        var cssAnimationTime = +sm.animationDuration.replace('s', ''); // format '0.234234xs\n                        var cssAnimationDelayTime = +sm.animationDelay.replace('s', '');\n                        setTimeout(function () {\n                            _this.el.style.height = 'auto';\n                            if (_this.hasFlexBug() && inner.scrollHeight > outer.offsetHeight) {\n                                inner.classList.add('scroll');\n                                inner.scrollTop = inner.scrollHeight;\n                            }\n                        }, (cssAnimationTime + cssAnimationDelayTime) * 1500);\n                    }\n                    catch (err) {\n                        // Fallback method. Assuming animations do not take longer than 1000ms\n                        setTimeout(function () {\n                            if (_this.hasFlexBug() && inner.scrollHeight > outer.offsetHeight) {\n                                inner.classList.add('scroll');\n                                inner.scrollTop = inner.scrollHeight;\n                            }\n                            _this.el.style.height = 'auto';\n                        }, 3000);\n                    }\n                });\n            });\n        };\n        Object.defineProperty(ChatResponse.prototype, \"visible\", {\n            set: function (value) {\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ChatResponse.prototype, \"strippedSesponse\", {\n            get: function () {\n                var html = this.response;\n                // use browsers native way of stripping\n                var div = document.createElement(\"div\");\n                div.innerHTML = html;\n                return div.textContent || div.innerText || \"\";\n            },\n            enumerable: true,\n            configurable: true\n        });\n        ChatResponse.prototype.whenReady = function (resolve) {\n            this.onReadyCallback = resolve;\n        };\n        ChatResponse.prototype.setValue = function (dto) {\n            // if(!this.visible){\n            // \tthis.visible = true;\n            // }\n            if (dto === void 0) { dto = null; }\n            var isThinking = this.el.hasAttribute(\"thinking\");\n            if (!dto) {\n                this.setToThinking();\n            }\n            else {\n                // same same\n                this.response = this.originalResponse = dto.text;\n                this.processResponseAndSetText();\n                if (this.responseLink && !this.isRobotResponse) {\n                    // call robot and update for binding values ->\n                    this.responseLink.processResponseAndSetText();\n                }\n                // check for if response type is file upload...\n                if (dto && dto.controlElements && dto.controlElements[0]) {\n                    switch (dto.controlElements[0].type) {\n                        case \"UploadFileUI\":\n                            this.textEl.classList.add(\"file-icon\");\n                            break;\n                    }\n                }\n                if (!this.isRobotResponse && !this.onClickCallback) {\n                    // edit\n                    this.onClickCallback = this.onClick.bind(this);\n                    this.el.addEventListener(cf.Helpers.getMouseEvent(\"click\"), this.onClickCallback, false);\n                }\n            }\n        };\n        ChatResponse.prototype.show = function () {\n            this.visible = true;\n            this.disabled = false;\n            if (!this.response) {\n                this.setToThinking();\n            }\n            else {\n                this.checkForEditMode();\n            }\n        };\n        ChatResponse.prototype.updateThumbnail = function (src) {\n            var thumbEl = this.el.getElementsByTagName(\"thumb\")[0];\n            if (src.indexOf(\"text:\") === 0) {\n                var thumbElSpan = thumbEl.getElementsByTagName(\"span\")[0];\n                thumbElSpan.innerHTML = src.split(\"text:\")[1];\n                thumbElSpan.setAttribute(\"length\", src.length.toString());\n            }\n            else {\n                this.image = src;\n                thumbEl.style.backgroundImage = 'url(\"' + this.image + '\")';\n            }\n        };\n        ChatResponse.prototype.setLinkToOtherReponse = function (response) {\n            // link reponse to another one, keeping the update circle complete.\n            this.responseLink = response;\n        };\n        ChatResponse.prototype.processResponseAndSetText = function () {\n            var _this = this;\n            if (!this.originalResponse)\n                return;\n            var innerResponse = this.originalResponse;\n            if (this._tag && this._tag.type == \"password\" && !this.isRobotResponse) {\n                var newStr = \"\";\n                for (var i_1 = 0; i_1 < innerResponse.length; i_1++) {\n                    newStr += \"*\";\n                }\n                innerResponse = newStr;\n            }\n            // if robot, then check linked response for binding values\n            if (this.responseLink && this.isRobotResponse) {\n                // one way data binding values:\n                innerResponse = innerResponse.split(\"{previous-answer}\").join(this.responseLink.parsedResponse);\n            }\n            if (this.isRobotResponse) {\n                // Piping, look through IDs, and map values to dynamics\n                var reponses = ChatResponse.list.getResponses();\n                for (var i = 0; i < reponses.length; i++) {\n                    var response = reponses[i];\n                    if (response !== this) {\n                        if (response.tag) {\n                            // check for id, standard\n                            if (response.tag.id) {\n                                innerResponse = innerResponse.split(\"{\" + response.tag.id + \"}\").join(response.tag.value);\n                            }\n                            //fallback check for name\n                            if (response.tag.name) {\n                                innerResponse = innerResponse.split(\"{\" + response.tag.name + \"}\").join(response.tag.value);\n                            }\n                        }\n                    }\n                }\n            }\n            // check if response contains an image as answer\n            var responseContains = innerResponse.indexOf(\"contains-image\") != -1;\n            if (responseContains)\n                this.textEl.classList.add(\"contains-image\");\n            // now set it\n            if (this.isRobotResponse) {\n                this.textEl.innerHTML = \"\";\n                if (!this.uiOptions)\n                    this.uiOptions = this.cfReference.uiOptions; // On edit uiOptions are empty, so this mitigates the problem. Not ideal.\n                var robotInitResponseTime = this.uiOptions.robot.robotResponseTime;\n                if (robotInitResponseTime != 0) {\n                    this.setToThinking();\n                }\n                // robot response, allow for && for multiple responses\n                var chainedResponses = innerResponse.split(\"&&\");\n                if (robotInitResponseTime === 0) {\n                    for (var i_2 = 0; i_2 < chainedResponses.length; i_2++) {\n                        var str = chainedResponses[i_2];\n                        this.textEl.innerHTML += \"<p>\" + str + \"</p>\";\n                    }\n                    var _loop_1 = function (i_3) {\n                        setTimeout(function () {\n                            _this.tryClearThinking();\n                            var p = _this.textEl.getElementsByTagName(\"p\");\n                            p[i_3].classList.add(\"show\");\n                            _this.scrollTo();\n                        }, chainedResponses.length > 1 && i_3 > 0 ? robotInitResponseTime + ((i_3 + 1) * this_1.uiOptions.robot.chainedResponseTime) : 0);\n                    };\n                    var this_1 = this;\n                    for (var i_3 = 0; i_3 < chainedResponses.length; i_3++) {\n                        _loop_1(i_3);\n                    }\n                }\n                else {\n                    var _loop_2 = function (i_4) {\n                        var revealAfter = robotInitResponseTime + (i_4 * this_2.uiOptions.robot.chainedResponseTime);\n                        var str = chainedResponses[i_4];\n                        setTimeout(function () {\n                            _this.tryClearThinking();\n                            _this.textEl.innerHTML += \"<p>\" + str + \"</p>\";\n                            var p = _this.textEl.getElementsByTagName(\"p\");\n                            p[i_4].classList.add(\"show\");\n                            _this.scrollTo();\n                        }, revealAfter);\n                    };\n                    var this_2 = this;\n                    for (var i_4 = 0; i_4 < chainedResponses.length; i_4++) {\n                        _loop_2(i_4);\n                    }\n                }\n                this.readyTimer = setTimeout(function () {\n                    if (_this.onReadyCallback)\n                        _this.onReadyCallback();\n                    // reset, as it can be called again\n                    _this.onReadyCallback = null;\n                    if (_this._tag && _this._tag.skipUserInput === true) {\n                        setTimeout(function () {\n                            _this._tag.flowManager.nextStep();\n                            _this._tag.skipUserInput = false; // to avoid nextStep being fired again as this would make the flow jump too far when editing a response\n                        }, _this.uiOptions.robot.chainedResponseTime);\n                    }\n                }, robotInitResponseTime + (chainedResponses.length * this.uiOptions.robot.chainedResponseTime));\n            }\n            else {\n                // user response, act normal\n                this.tryClearThinking();\n                var hasImage = innerResponse.indexOf('<img') > -1;\n                var imageRegex = new RegExp('<img[^>]*?>', 'g');\n                var imageTag = innerResponse.match(imageRegex);\n                if (hasImage && imageTag) {\n                    innerResponse = innerResponse.replace(imageTag[0], '');\n                    this.textEl.innerHTML = \"<p class=\\\"hasImage\\\">\" + imageTag + \"<span>\" + innerResponse + \"</span></p>\";\n                }\n                else {\n                    this.textEl.innerHTML = \"<p>\" + innerResponse + \"</p>\";\n                }\n                var p = this.textEl.getElementsByTagName(\"p\");\n                p[p.length - 1].offsetWidth;\n                p[p.length - 1].classList.add(\"show\");\n                this.scrollTo();\n            }\n            this.parsedResponse = innerResponse;\n            // }\n            // value set, so add element, if not added\n            if (this.uiOptions.robot\n                && this.uiOptions.robot.robotResponseTime === 0) {\n                this.addSelf();\n            }\n            else {\n                setTimeout(function () {\n                    _this.addSelf();\n                }, 0);\n            }\n            // bounce\n            this.textEl.removeAttribute(\"value-added\");\n            setTimeout(function () {\n                _this.textEl.setAttribute(\"value-added\", \"\");\n                _this.el.classList.add(\"peak-thumb\");\n            }, 0);\n            this.checkForEditMode();\n            // update response\n            // remove the double ampersands if present\n            this.response = innerResponse.split(\"&&\").join(\" \");\n        };\n        ChatResponse.prototype.scrollTo = function () {\n            var y = this.el.offsetTop;\n            var h = this.el.offsetHeight;\n            if (!this.container && this.el)\n                this.container = this.el; // On edit this.container is empty so this is a fix to reassign it. Not ideal, but...\n            if (this.container\n                && this.container.parentElement\n                && this.container.parentElement.scrollHeight) {\n                this.container.parentElement.scrollTop = y + h + this.container.parentElement.scrollHeight;\n            }\n        };\n        ChatResponse.prototype.checkForEditMode = function () {\n            if (!this.isRobotResponse && !this.el.hasAttribute(\"thinking\")) {\n                this.el.classList.add(\"can-edit\");\n                this.disabled = false;\n            }\n        };\n        ChatResponse.prototype.tryClearThinking = function () {\n            if (this.el.hasAttribute(\"thinking\")) {\n                this.textEl.innerHTML = \"\";\n                this.el.removeAttribute(\"thinking\");\n            }\n        };\n        ChatResponse.prototype.setToThinking = function () {\n            var canShowThinking = (this.isRobotResponse && this.uiOptions.robot.robotResponseTime !== 0) || (!this.isRobotResponse && this.cfReference.uiOptions.user.showThinking && !this._tag.skipUserInput);\n            if (canShowThinking) {\n                this.textEl.innerHTML = ChatResponse.THINKING_MARKUP;\n                this.el.classList.remove(\"can-edit\");\n                this.el.setAttribute(\"thinking\", \"\");\n            }\n            if (this.cfReference.uiOptions.user.showThinking || this.cfReference.uiOptions.user.showThumb) {\n                this.addSelf();\n            }\n        };\n        /**\n        * @name addSelf\n        * add one self to the chat list\n        */\n        ChatResponse.prototype.addSelf = function () {\n            if (this.el.parentNode != this.container) {\n                this.container.appendChild(this.el);\n                this.animateIn();\n            }\n        };\n        /**\n        * @name onClickCallback\n        * click handler for el\n        */\n        ChatResponse.prototype.onClick = function (event) {\n            this.setToThinking();\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.ChatResponseEvents.USER_ANSWER_CLICKED, event);\n            this.eventTarget.dispatchEvent(new CustomEvent(cf.ChatResponseEvents.USER_ANSWER_CLICKED, {\n                detail: this._tag\n            }));\n        };\n        ChatResponse.prototype.setData = function (options) {\n            this.image = options.image;\n            this.response = this.originalResponse = options.response;\n            this.isRobotResponse = options.isRobotResponse;\n            _super.prototype.setData.call(this, options);\n        };\n        ChatResponse.prototype.onElementCreated = function () {\n            var _this = this;\n            this.textEl = this.el.getElementsByTagName(\"text\")[0];\n            this.updateThumbnail(this.image);\n            if (this.isRobotResponse || this.response != null) {\n                // Robot is pseudo thinking, can also be user -->\n                // , but if addUserChatResponse is called from ConversationalForm, then the value is there, therefore skip ...\n                setTimeout(function () {\n                    _this.setValue({ text: _this.response });\n                }, 0);\n                //ConversationalForm.animationsEnabled ? Helpers.lerp(Math.random(), 500, 900) : 0);\n            }\n            else {\n                if (this.cfReference.uiOptions.user.showThumb) {\n                    this.el.classList.add(\"peak-thumb\");\n                }\n            }\n        };\n        ChatResponse.prototype.dealloc = function () {\n            clearTimeout(this.readyTimer);\n            this.container = null;\n            this.uiOptions = null;\n            this.onReadyCallback = null;\n            if (this.onClickCallback) {\n                this.el.removeEventListener(cf.Helpers.getMouseEvent(\"click\"), this.onClickCallback, false);\n                this.onClickCallback = null;\n            }\n            _super.prototype.dealloc.call(this);\n        };\n        // template, can be overwritten ...\n        ChatResponse.prototype.getTemplate = function () {\n            return \"<cf-chat-response class=\\\"\" + (this.isRobotResponse ? \"robot\" : \"user\") + \"\\\">\\n\\t\\t\\t\\t<thumb><span></span></thumb>\\n\\t\\t\\t\\t<text></text>\\n\\t\\t\\t</cf-chat-response>\";\n        };\n        ChatResponse.THINKING_MARKUP = \"<p class='show'><thinking><span>.</span><span>.</span><span>.</span></thinking></p>\";\n        return ChatResponse;\n    }(cf.BasicElement));\n    cf.ChatResponse = ChatResponse;\n})(cf || (cf = {}));\n\n/// <reference path=\"ChatResponse.ts\"/>\n/// <reference path=\"../BasicElement.ts\"/>\n/// <reference path=\"../../logic/FlowManager.ts\"/>\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// namespace\nvar cf;\n(function (cf) {\n    // interface\n    cf.ChatListEvents = {\n        CHATLIST_UPDATED: \"cf-chatlist-updated\"\n    };\n    // class\n    var ChatList = /** @class */ (function (_super) {\n        __extends(ChatList, _super);\n        function ChatList(options) {\n            var _this = _super.call(this, options) || this;\n            _this.updateTimer = 0;\n            cf.ChatResponse.list = _this;\n            _this.responses = [];\n            // flow update\n            _this.flowUpdateCallback = _this.onFlowUpdate.bind(_this);\n            _this.eventTarget.addEventListener(cf.FlowEvents.FLOW_UPDATE, _this.flowUpdateCallback, false);\n            // user input update\n            _this.userInputUpdateCallback = _this.onUserInputUpdate.bind(_this);\n            _this.eventTarget.addEventListener(cf.FlowEvents.USER_INPUT_UPDATE, _this.userInputUpdateCallback, false);\n            // user input key change\n            _this.onInputKeyChangeCallback = _this.onInputKeyChange.bind(_this);\n            _this.eventTarget.addEventListener(cf.UserInputEvents.KEY_CHANGE, _this.onInputKeyChangeCallback, false);\n            // user input height change\n            _this.onInputHeightChangeCallback = _this.onInputHeightChange.bind(_this);\n            _this.eventTarget.addEventListener(cf.UserInputEvents.HEIGHT_CHANGE, _this.onInputHeightChangeCallback, false);\n            // on control elements changed\n            _this.onControlElementsResizedCallback = _this.onControlElementsResized.bind(_this);\n            _this.eventTarget.addEventListener(cf.ControlElementsEvents.ON_RESIZE, _this.onControlElementsResizedCallback, false);\n            _this.onControlElementsChangedCallback = _this.onControlElementsChanged.bind(_this);\n            _this.eventTarget.addEventListener(cf.ControlElementsEvents.CHANGED, _this.onControlElementsChangedCallback, false);\n            return _this;\n        }\n        ChatList.prototype.onInputHeightChange = function (event) {\n            var dto = event.detail.dto;\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, dto);\n            // this.input.controlElements.el.style.transition = \"height 2s ease-out\";\n            // this.input.controlElements.el.style.height = this.input.controlElements.el.scrollHeight + 'px';\n            this.onInputElementChanged();\n        };\n        ChatList.prototype.onInputKeyChange = function (event) {\n            var dto = event.detail.dto;\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, dto);\n        };\n        ChatList.prototype.onUserInputUpdate = function (event) {\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n            if (this.currentUserResponse) {\n                var response = event.detail;\n                this.setCurrentUserResponse(response);\n            }\n        };\n        ChatList.prototype.addInput = function (input) {\n            this.input = input;\n        };\n        /**\n        * @name onControlElementsChanged\n        * on control elements change\n        */\n        ChatList.prototype.onControlElementsChanged = function (event) {\n            this.onInputElementChanged();\n        };\n        /**\n        * @name onControlElementsResized\n        * on control elements resize\n        */\n        ChatList.prototype.onControlElementsResized = function (event) {\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", cf.ControlElementsEvents.ON_RESIZE);\n            var responseToScrollTo = this.currentResponse;\n            if (responseToScrollTo) {\n                if (!responseToScrollTo.added) {\n                    // element not added yet, so find closest\n                    for (var i = this.responses.indexOf(responseToScrollTo); i >= 0; i--) {\n                        var element = this.responses[i];\n                        if (element.added) {\n                            responseToScrollTo = element;\n                            break;\n                        }\n                    }\n                }\n                responseToScrollTo.scrollTo();\n            }\n            this.onInputElementChanged();\n        };\n        ChatList.prototype.onInputElementChanged = function () {\n            if (!this.cfReference || !this.cfReference.el)\n                return;\n            var cfHeight = this.cfReference.el.offsetHeight;\n            var inputHeight = this.input.height;\n            var listHeight = cfHeight - inputHeight;\n            //this.el.style.height = listHeight + \"px\";\n        };\n        ChatList.prototype.onFlowUpdate = function (event) {\n            var _this = this;\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n            var currentTag = event.detail.tag;\n            if (this.currentResponse)\n                this.currentResponse.disabled = false;\n            if (this.containsTagResponse(currentTag) && !event.detail.ignoreExistingTag) {\n                // because user maybe have scrolled up and wants to edit\n                // tag is already in list, so re-activate it\n                this.onUserWantsToEditTag(currentTag);\n            }\n            else {\n                // robot response\n                setTimeout(function () {\n                    var robot = _this.createResponse(true, currentTag, currentTag.question);\n                    robot.whenReady(function () {\n                        // create user response\n                        _this.currentUserResponse = _this.createResponse(false, currentTag);\n                        robot.scrollTo();\n                    });\n                    if (_this.currentUserResponse) {\n                        // linked, but only if we should not ignore existing tag\n                        _this.currentUserResponse.setLinkToOtherReponse(robot);\n                        robot.setLinkToOtherReponse(_this.currentUserResponse);\n                    }\n                }, this.responses.length === 0 ? 500 : 0);\n            }\n        };\n        /**\n        * @name containsTagResponse\n        * @return boolean\n        * check if tag has already been responded to\n        */\n        ChatList.prototype.containsTagResponse = function (tagToChange) {\n            for (var i = 0; i < this.responses.length; i++) {\n                var element = this.responses[i];\n                if (!element.isRobotResponse && element.tag == tagToChange && !tagToChange.hasConditions()) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        /**\n        * @name onUserAnswerClicked\n        * on user ChatReponse clicked\n        */\n        ChatList.prototype.onUserWantsToEditTag = function (tagToChange) {\n            var responseUserWantsToEdit;\n            for (var i = 0; i < this.responses.length; i++) {\n                var element = this.responses[i];\n                if (!element.isRobotResponse && element.tag == tagToChange) {\n                    // update element thhat user wants to edit\n                    responseUserWantsToEdit = element;\n                    break;\n                }\n            }\n            // reset the current user response\n            this.currentUserResponse.processResponseAndSetText();\n            if (responseUserWantsToEdit) {\n                // remove latest user response, if it is there any, also make sure we don't remove the first one\n                if (this.responses.length > 2) {\n                    if (!this.responses[this.responses.length - 1].isRobotResponse) {\n                        this.responses.pop().dealloc();\n                    }\n                    // remove latest robot response, it should always be a robot response\n                    this.responses.pop().dealloc();\n                }\n                this.currentUserResponse = responseUserWantsToEdit;\n                // TODO: Set user field to thinking?\n                // this.currentUserResponse.setToThinking??\n                this.currentResponse = this.responses[this.responses.length - 1];\n                this.onListUpdate(this.currentUserResponse);\n            }\n        };\n        ChatList.prototype.onListUpdate = function (chatResponse) {\n            var _this = this;\n            clearTimeout(this.updateTimer);\n            this.updateTimer = setTimeout(function () {\n                _this.eventTarget.dispatchEvent(new CustomEvent(cf.ChatListEvents.CHATLIST_UPDATED, {\n                    detail: _this\n                }));\n                chatResponse.show();\n            }, 0);\n        };\n        /**\n        * @name clearFrom\n        * remove responses, this usually happens if a user jumps back to a conditional element\n        */\n        ChatList.prototype.clearFrom = function (index) {\n            index = index * 2; // double up because of robot responses\n            index += index % 2; // round up so we dont remove the user response element\n            while (this.responses.length > index) {\n                this.responses.pop().dealloc();\n            }\n        };\n        /**\n        * @name setCurrentUserResponse\n        * Update current reponse, is being called automatically from onFlowUpdate, but can also, in rare cases, be called when flow is controlled manually.\n        * reponse: FlowDTO\n        */\n        ChatList.prototype.setCurrentUserResponse = function (dto) {\n            this.flowDTOFromUserInputUpdate = dto;\n            if (!this.flowDTOFromUserInputUpdate.text && dto.tag) {\n                if (dto.tag.type == \"group\") {\n                    this.flowDTOFromUserInputUpdate.text = cf.Dictionary.get(\"user-reponse-missing-group\");\n                }\n                else if (dto.tag.type != \"password\") {\n                    this.flowDTOFromUserInputUpdate.text = cf.Dictionary.get(\"user-reponse-missing\");\n                }\n            }\n            this.currentUserResponse.setValue(this.flowDTOFromUserInputUpdate);\n        };\n        /**\n        * @name getResponses\n        * returns the submitted responses.\n        */\n        ChatList.prototype.getResponses = function () {\n            return this.responses;\n        };\n        ChatList.prototype.updateThumbnail = function (robot, img) {\n            cf.Dictionary.set(robot ? \"robot-image\" : \"user-image\", robot ? \"robot\" : \"human\", img);\n            var newImage = robot ? cf.Dictionary.getRobotResponse(\"robot-image\") : cf.Dictionary.get(\"user-image\");\n            for (var i = 0; i < this.responses.length; i++) {\n                var element = this.responses[i];\n                if (robot && element.isRobotResponse) {\n                    element.updateThumbnail(newImage);\n                }\n                else if (!robot && !element.isRobotResponse) {\n                    element.updateThumbnail(newImage);\n                }\n            }\n        };\n        ChatList.prototype.createResponse = function (isRobotResponse, currentTag, value) {\n            if (value === void 0) { value = null; }\n            var scrollable = this.el.querySelector(\".scrollableInner\");\n            var response = new cf.ChatResponse({\n                // image: null,\n                cfReference: this.cfReference,\n                list: this,\n                tag: currentTag,\n                eventTarget: this.eventTarget,\n                isRobotResponse: isRobotResponse,\n                response: value,\n                image: isRobotResponse ? cf.Dictionary.getRobotResponse(\"robot-image\") : cf.Dictionary.get(\"user-image\"),\n                container: scrollable\n            });\n            this.responses.push(response);\n            this.currentResponse = response;\n            this.onListUpdate(response);\n            return response;\n        };\n        ChatList.prototype.getTemplate = function () {\n            return \"<cf-chat type='pluto'>\\n\\t\\t\\t\\t\\t\\t<scrollable>\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"scrollableInner\\\"></div>\\n\\t\\t\\t\\t\\t\\t</scrollable>\\n\\t\\t\\t\\t\\t</cf-chat>\";\n        };\n        ChatList.prototype.dealloc = function () {\n            this.eventTarget.removeEventListener(cf.FlowEvents.FLOW_UPDATE, this.flowUpdateCallback, false);\n            this.flowUpdateCallback = null;\n            this.eventTarget.removeEventListener(cf.FlowEvents.USER_INPUT_UPDATE, this.userInputUpdateCallback, false);\n            this.userInputUpdateCallback = null;\n            this.eventTarget.removeEventListener(cf.UserInputEvents.KEY_CHANGE, this.onInputKeyChangeCallback, false);\n            this.onInputKeyChangeCallback = null;\n            _super.prototype.dealloc.call(this);\n        };\n        return ChatList;\n    }(cf.BasicElement));\n    cf.ChatList = ChatList;\n})(cf || (cf = {}));\n\n/// <reference path=\"../form-tags/Tag.ts\"/>\n/// <reference path=\"../ConversationalForm.ts\"/>\nvar cf;\n(function (cf) {\n    // interface\n    cf.FlowEvents = {\n        USER_INPUT_UPDATE: \"cf-flow-user-input-update\",\n        USER_INPUT_INVALID: \"cf-flow-user-input-invalid\",\n        //\tdetail: string\n        FLOW_UPDATE: \"cf-flow-update\",\n        FORM_SUBMIT: \"cf-form-submit\",\n    };\n    // class\n    var FlowManager = /** @class */ (function () {\n        function FlowManager(options) {\n            this.stopped = false;\n            this.maxSteps = 0;\n            this.step = 0;\n            this.savedStep = -1;\n            this.stepTimer = 0;\n            /**\n            * ignoreExistingTags\n            * @type boolean\n            * ignore existing tags, usually this is set to true when using startFrom, where you don't want it to check for exisintg tags in the list\n            */\n            this.ignoreExistingTags = false;\n            this.cfReference = options.cfReference;\n            this.eventTarget = options.eventTarget;\n            this.flowStepCallback = options.flowStepCallback;\n            this.setTags(options.tags);\n            this.userInputSubmitCallback = this.userInputSubmit.bind(this);\n            this.eventTarget.addEventListener(cf.UserInputEvents.SUBMIT, this.userInputSubmitCallback, false);\n        }\n        Object.defineProperty(FlowManager.prototype, \"currentTag\", {\n            get: function () {\n                return this.tags[this.step];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        FlowManager.prototype.userInputSubmit = function (event) {\n            var _this = this;\n            cf.ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n            var appDTO = event.detail;\n            if (!appDTO.tag)\n                appDTO.tag = this.currentTag;\n            var isTagValid = this.currentTag.setTagValueAndIsValid(appDTO);\n            var hasCheckedForTagSpecificValidation = false;\n            var hasCheckedForGlobalFlowValidation = false;\n            var onValidationCallback = function () {\n                // check 1\n                if (_this.currentTag.validationCallback && typeof _this.currentTag.validationCallback == \"function\") {\n                    if (!hasCheckedForTagSpecificValidation && isTagValid) {\n                        hasCheckedForTagSpecificValidation = true;\n                        _this.currentTag.validationCallback(appDTO, function () {\n                            isTagValid = true;\n                            onValidationCallback();\n                        }, function (optionalErrorMessage) {\n                            isTagValid = false;\n                            if (optionalErrorMessage)\n                                appDTO.errorText = optionalErrorMessage;\n                            onValidationCallback();\n                        });\n                        return;\n                    }\n                }\n                // check 2, this.currentTag.required <- required should be handled in the callback.\n                if (_this.flowStepCallback && typeof _this.flowStepCallback == \"function\") {\n                    if (!hasCheckedForGlobalFlowValidation && isTagValid) {\n                        hasCheckedForGlobalFlowValidation = true;\n                        // use global validationCallback method\n                        _this.flowStepCallback(appDTO, function () {\n                            isTagValid = true;\n                            onValidationCallback();\n                        }, function (optionalErrorMessage) {\n                            isTagValid = false;\n                            if (optionalErrorMessage)\n                                appDTO.errorText = optionalErrorMessage;\n                            onValidationCallback();\n                        });\n                        return;\n                    }\n                }\n                // go on with the flow\n                if (isTagValid) {\n                    // do the normal flow..\n                    cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.FlowEvents.USER_INPUT_UPDATE, appDTO);\n                    // update to latest DTO because values can be changed in validation flow...\n                    if (appDTO.input)\n                        appDTO = appDTO.input.getFlowDTO();\n                    _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_UPDATE, {\n                        detail: appDTO //UserTextInput value\n                    }));\n                    // goto next step when user has answered\n                    setTimeout(function () { return _this.nextStep(); }, cf.ConversationalForm.animationsEnabled ? 250 : 0);\n                }\n                else {\n                    cf.ConversationalForm.illustrateFlow(_this, \"dispatch\", cf.FlowEvents.USER_INPUT_INVALID, appDTO);\n                    // Value not valid\n                    _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.USER_INPUT_INVALID, {\n                        detail: appDTO //UserTextInput value\n                    }));\n                }\n            };\n            // TODO, make into promises when IE is rolling with it..\n            onValidationCallback();\n        };\n        FlowManager.prototype.startFrom = function (indexOrTag, ignoreExistingTags) {\n            if (ignoreExistingTags === void 0) { ignoreExistingTags = false; }\n            if (typeof indexOrTag == \"number\")\n                this.step = indexOrTag;\n            else {\n                // find the index..\n                this.step = this.tags.indexOf(indexOrTag);\n            }\n            this.ignoreExistingTags = ignoreExistingTags;\n            if (!this.ignoreExistingTags) {\n                this.editTag(this.tags[this.step]);\n            }\n            else {\n                //validate step, and ask for skipping of current step\n                this.showStep();\n            }\n        };\n        FlowManager.prototype.areConditionsInFlowFullfilled = function (tagWithConditions, tagConditions) {\n            if (!this.activeConditions) {\n                // we don't use this (yet), it's only to keep track of active conditions\n                this.activeConditions = [];\n            }\n            var numConditionsFound = 0;\n            // find out if tagWithConditions fullfills conditions\n            for (var i = 0; i < this.tags.length; i++) {\n                var tag = this.tags[i];\n                if (tag !== tagWithConditions) {\n                    // check if tags are fullfilled\n                    for (var j = 0; j < tagConditions.length; j++) {\n                        var tagCondition = tagConditions[j];\n                        // only check tags where tag id or name is defined\n                        var tagName = (tag.name || tag.id || \"\").toLowerCase();\n                        if (tagName !== \"\" && \"cf-conditional-\" + tagName === tagCondition.key.toLowerCase()) {\n                            // key found, so check condition\n                            var flowTagValue = typeof tag.value === \"string\" ? tag.value : tag.value;\n                            var areConditionsMeet = cf.Tag.testConditions(flowTagValue, tagCondition);\n                            if (areConditionsMeet) {\n                                this.activeConditions[tagName] = tagConditions;\n                                // conditions are meet\n                                if (++numConditionsFound == tagConditions.length) {\n                                    return true;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            return false;\n        };\n        FlowManager.prototype.start = function () {\n            this.stopped = false;\n            this.validateStepAndUpdate();\n        };\n        FlowManager.prototype.stop = function () {\n            this.stopped = true;\n        };\n        FlowManager.prototype.nextStep = function () {\n            if (this.stopped)\n                return;\n            if (this.savedStep != -1) {\n                // if you are looking for where the none EDIT tag conditionsl check is done\n                // then look at a tags disabled getter\n                var foundConditionsToCurrentTag = false;\n                // this happens when editing a tag..\n                // check if any tags has a conditional check for this.currentTag.name\n                for (var i = 0; i < this.tags.length; i++) {\n                    var tag = this.tags[i];\n                    if (tag !== this.currentTag && tag.hasConditions()) {\n                        // tag has conditions so check if it also has the right conditions\n                        if (tag.hasConditionsFor(this.currentTag.name)) {\n                            foundConditionsToCurrentTag = true;\n                            this.step = this.tags.indexOf(this.currentTag);\n                            break;\n                        }\n                    }\n                }\n                // no conditional linking found, so resume flow\n                if (!foundConditionsToCurrentTag) {\n                    this.step = this.savedStep;\n                }\n            }\n            this.savedStep = -1; //reset saved step\n            this.step++;\n            this.validateStepAndUpdate();\n        };\n        FlowManager.prototype.previousStep = function () {\n            this.step--;\n            this.validateStepAndUpdate();\n        };\n        FlowManager.prototype.getStep = function () {\n            return this.step;\n        };\n        FlowManager.prototype.addTags = function (tags, atIndex) {\n            if (atIndex === void 0) { atIndex = -1; }\n            // used to append new tag\n            if (atIndex !== -1 && atIndex < this.tags.length) {\n                var pre = this.tags.slice(0, atIndex);\n                var post = this.tags.slice(atIndex, this.tags.length);\n                this.tags = this.tags.slice(0, atIndex).concat(tags).concat(post);\n            }\n            else {\n                this.tags = this.tags.concat(tags);\n            }\n            this.setTags(this.tags);\n            return this.tags;\n        };\n        FlowManager.prototype.dealloc = function () {\n            this.eventTarget.removeEventListener(cf.UserInputEvents.SUBMIT, this.userInputSubmitCallback, false);\n            this.userInputSubmitCallback = null;\n        };\n        /**\n        * @name editTag\n        * go back in time and edit a tag.\n        */\n        FlowManager.prototype.editTag = function (tag) {\n            this.ignoreExistingTags = false;\n            this.savedStep = this.step - 1; //save step\n            this.step = this.tags.indexOf(tag); // === this.currentTag\n            this.validateStepAndUpdate();\n            if (this.activeConditions && Object.keys(this.activeConditions).length > 0) {\n                this.savedStep = -1; //don't save step, as we wont return\n                // clear chatlist.\n                this.cfReference.chatList.clearFrom(this.step + 1);\n                //reset from active tag, brute force\n                var editTagIndex = this.tags.indexOf(tag);\n                for (var i = editTagIndex + 1; i < this.tags.length; i++) {\n                    var tag_1 = this.tags[i];\n                    tag_1.reset();\n                }\n            }\n        };\n        FlowManager.prototype.setTags = function (tags) {\n            this.tags = tags;\n            for (var i = 0; i < this.tags.length; i++) {\n                var tag = this.tags[i];\n                tag.eventTarget = this.eventTarget;\n                tag.flowManager = this;\n            }\n            this.maxSteps = this.tags.length;\n        };\n        FlowManager.prototype.skipStep = function () {\n            this.nextStep();\n        };\n        FlowManager.prototype.validateStepAndUpdate = function () {\n            if (this.maxSteps > 0) {\n                if (this.step == this.maxSteps) {\n                    // console.warn(\"We are at the end..., submit click\")\n                    this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.FORM_SUBMIT, {}));\n                    this.cfReference.doSubmitForm();\n                }\n                else {\n                    this.step %= this.maxSteps;\n                    if (this.currentTag.disabled) {\n                        // check if current tag has become or is disabled, if it is, then skip step.\n                        this.skipStep();\n                    }\n                    else {\n                        this.showStep();\n                    }\n                }\n            }\n        };\n        FlowManager.prototype.showStep = function () {\n            var _this = this;\n            if (this.stopped)\n                return;\n            cf.ConversationalForm.illustrateFlow(this, \"dispatch\", cf.FlowEvents.FLOW_UPDATE, this.currentTag);\n            this.currentTag.refresh();\n            setTimeout(function () {\n                _this.eventTarget.dispatchEvent(new CustomEvent(cf.FlowEvents.FLOW_UPDATE, {\n                    detail: {\n                        tag: _this.currentTag,\n                        ignoreExistingTag: _this.ignoreExistingTags,\n                        step: _this.step,\n                        maxSteps: _this.maxSteps\n                    }\n                }));\n            }, 0);\n        };\n        FlowManager.STEP_TIME = 1000;\n        return FlowManager;\n    }());\n    cf.FlowManager = FlowManager;\n})(cf || (cf = {}));\n\n/// <reference path=\"ui/inputs/UserTextInput.ts\"/>\n/// <reference path=\"ui/chat/ChatList.ts\"/>\n/// <reference path=\"logic/FlowManager.ts\"/>\n/// <reference path=\"ui/ProgressBar.ts\"/>\n/// <reference path=\"logic/EventDispatcher.ts\"/>\n/// <reference path=\"form-tags/Tag.ts\"/>\n/// <reference path=\"form-tags/CfRobotMessageTag.ts\"/>\n/// <reference path=\"form-tags/TagGroup.ts\"/>\n/// <reference path=\"form-tags/InputTag.ts\"/>\n/// <reference path=\"form-tags/SelectTag.ts\"/>\n/// <reference path=\"form-tags/ButtonTag.ts\"/>\n/// <reference path=\"data/Dictionary.ts\"/>\n/// <reference path=\"parsing/TagsParser.ts\"/>\n/// <reference path=\"interfaces/IUserInput.ts\"/>\n/// <reference path=\"interfaces/IUserInterfaceOptions.ts\"/>\nvar cf;\n(function (cf_1) {\n    var ConversationalForm = /** @class */ (function () {\n        function ConversationalForm(options) {\n            this.version = \"1.0.2\";\n            this.cdnPath = \"https://cdn.jsdelivr.net/gh/space10-community/conversational-form@{version}/dist/\";\n            this.isDevelopment = false;\n            this.loadExternalStyleSheet = true;\n            this.theme = 'light';\n            this.preventAutoAppend = false;\n            this.preventAutoStart = false;\n            window.ConversationalForm = this;\n            this.cdnPath = this.cdnPath.split(\"{version}\").join(this.version);\n            if (typeof options.suppressLog === 'boolean')\n                ConversationalForm.suppressLog = options.suppressLog;\n            if (typeof options.showProgressBar === 'boolean')\n                ConversationalForm.showProgressBar = options.showProgressBar;\n            if (typeof options.preventSubmitOnEnter === 'boolean')\n                this.preventSubmitOnEnter = options.preventSubmitOnEnter;\n            if (!ConversationalForm.suppressLog)\n                console.log('Conversational Form > version:', this.version);\n            if (!ConversationalForm.suppressLog)\n                console.log('Conversational Form > options:', options);\n            window.ConversationalForm[this.createId] = this;\n            // possible to create your own event dispatcher, so you can tap into the events of the app\n            if (options.eventDispatcher)\n                this._eventTarget = options.eventDispatcher;\n            if (!this.eventTarget.cf)\n                this.eventTarget.cf = this;\n            // set a general step validation callback\n            if (options.flowStepCallback)\n                this.flowStepCallback = options.flowStepCallback;\n            this.isDevelopment = ConversationalForm.illustrateAppFlow = !!document.getElementById(\"conversational-form-development\");\n            if (options.loadExternalStyleSheet == false) {\n                this.loadExternalStyleSheet = false;\n            }\n            if (typeof options.theme === 'string')\n                this.theme = options.theme;\n            if (!isNaN(options.scrollAcceleration))\n                cf_1.ScrollController.acceleration = options.scrollAcceleration;\n            this.preventAutoStart = options.preventAutoStart;\n            this.preventAutoAppend = options.preventAutoAppend;\n            if (!options.formEl)\n                throw new Error(\"Conversational Form error, the formEl needs to be defined.\");\n            this.formEl = options.formEl;\n            this.formEl.setAttribute(\"cf-create-id\", this.createId);\n            if (options.hideUserInputOnNoneTextInput === true) {\n                cf_1.UserInputElement.hideUserInputOnNoneTextInput = true;\n            }\n            this.submitCallback = options.submitCallback;\n            if (this.submitCallback && typeof this.submitCallback === \"string\") {\n                // Must be a string on window, rewritten to avoid unsafe eval() calls\n                var fn = window[this.submitCallback];\n                this.submitCallback = fn;\n            }\n            if (this.formEl.getAttribute(\"cf-no-animation\") == \"\")\n                ConversationalForm.animationsEnabled = false;\n            if (typeof options.animationsEnabled === 'boolean'\n                && options.animationsEnabled === false) {\n                ConversationalForm.animationsEnabled = false;\n                this.formEl.setAttribute(\"cf-no-animation\", \"\");\n            }\n            if (options.preventAutoFocus || this.formEl.getAttribute(\"cf-prevent-autofocus\") == \"\")\n                cf_1.UserInputElement.preventAutoFocus = true;\n            this.dictionary = new cf_1.Dictionary({\n                data: options.dictionaryData,\n                robotData: options.dictionaryRobot,\n                userImage: options.userImage,\n                robotImage: options.robotImage,\n                version: this.version\n            });\n            this.context = options.context ? options.context : document.body;\n            this.tags = options.tags;\n            if (options.microphoneInput) {\n                // validate the user ..... TODO....\n                if (!options.microphoneInput.init || !options.microphoneInput.input) {\n                    console.warn(\"Conversational Form: microphoneInput is not correctly setup\", options.microphoneInput);\n                    options.microphoneInput = null;\n                }\n            }\n            this.microphoneInputObj = options.microphoneInput;\n            // set the ui options\n            this.uiOptions = cf_1.Helpers.extendObject(cf_1.UserInterfaceDefaultOptions, options.userInterfaceOptions || {});\n            // console.log('this.uiOptions:', this.uiOptions);\n            this.options = options;\n            this.init();\n        }\n        Object.defineProperty(ConversationalForm.prototype, \"createId\", {\n            get: function () {\n                if (!this._createId) {\n                    this._createId = new Date().getTime().toString();\n                }\n                return this._createId;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ConversationalForm.prototype, \"eventTarget\", {\n            get: function () {\n                if (!this._eventTarget) {\n                    this._eventTarget = new cf_1.EventDispatcher(this);\n                }\n                return this._eventTarget;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        ConversationalForm.prototype.init = function () {\n            switch (this.theme) {\n                case 'dark':\n                    this.theme = 'conversational-form-dark.min.css';\n                    if (!this.options.robotImage)\n                        this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%233A3A3C'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%23E5E6EA'/%3E%3C/svg%3E%0A\");\n                    if (!this.options.userImage)\n                        this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23E5E6EA'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%233A3A3C'/%3E%3C/svg%3E%0A\");\n                    break;\n                case 'green':\n                    this.theme = 'conversational-form-green.min.css';\n                    if (!this.options.robotImage)\n                        this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23EEEFF0'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%2300BF75'/%3E%3C/svg%3E%0A\");\n                    if (!this.options.userImage)\n                        this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%2300BF75'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23EEEFF0'/%3E%3C/svg%3E%0A\");\n                    break;\n                case 'blue':\n                    this.theme = 'conversational-form-irisblue.min.css';\n                    if (!this.options.robotImage)\n                        this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23E8E9EB'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%2300C2DF'/%3E%3C/svg%3E%0A\");\n                    if (!this.options.userImage)\n                        this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%2300C2DF'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23E8E9EB'/%3E%3C/svg%3E%0A\");\n                    break;\n                case 'purple':\n                    this.theme = 'conversational-form-purple.min.css';\n                    if (!this.options.robotImage)\n                        this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23EEEFF0'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%235A1DE4'/%3E%3C/svg%3E%0A\");\n                    if (!this.options.userImage)\n                        this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%235A1DE4'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23EEEFF0'/%3E%3C/svg%3E%0A\");\n                    break;\n                case 'red':\n                    this.theme = 'conversational-form-red.min.css';\n                    if (!this.options.robotImage)\n                        this.updateDictionaryValue('robot-image', 'robot', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23E8E9EB'/%3E%3Crect x='66' y='66' width='68' height='68' fill='%23FF3233'/%3E%3C/svg%3E%0A\");\n                    if (!this.options.userImage)\n                        this.updateDictionaryValue('user-image', 'user', \"data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23FF3233'/%3E%3Cpath d='M100 55L138.971 122.5H61.0289L100 55Z' fill='%23E8E9EB'/%3E%3C/svg%3E%0A\");\n                    break;\n                default:\n                    this.theme = 'conversational-form.min.css';\n            }\n            if (this.isDevelopment) {\n                // Set path for development\n                this.cdnPath = '../build/';\n                // strip .min from filename since we do not have minified css in build\n                this.theme = this.theme.replace('.min', '');\n            }\n            if (this.loadExternalStyleSheet) {\n                // not in development/examples, so inject production css\n                var head = document.head || document.getElementsByTagName(\"head\")[0];\n                var style = document.createElement(\"link\");\n                var githubMasterUrl = this.cdnPath + this.theme;\n                style.type = \"text/css\";\n                style.media = \"all\";\n                style.setAttribute(\"rel\", \"stylesheet\");\n                style.setAttribute(\"href\", githubMasterUrl);\n                head.appendChild(style);\n            }\n            // set context position to relative, else we break out of the box\n            var position = window.getComputedStyle(this.context).getPropertyValue(\"position\").toLowerCase();\n            if ([\"fixed\", \"absolute\", \"relative\"].indexOf(position) == -1) {\n                this.context.style.position = \"relative\";\n            }\n            // if tags are not defined then we will try and build some tags our selves..\n            if (!this.tags || this.tags.length == 0) {\n                this.tags = [];\n                var fields = [].slice.call(this.formEl.querySelectorAll(\"input, select, button, textarea, cf-robot-message\"), 0);\n                for (var i = 0; i < fields.length; i++) {\n                    var element = fields[i];\n                    if (cf_1.Tag.isTagValid(element)) {\n                        // ignore hidden tags\n                        this.tags.push(cf_1.Tag.createTag(element));\n                    }\n                }\n            }\n            else {\n                // tags are manually setup and passed as options.tags.\n            }\n            // remove invalid tags if they've sneaked in.. this could happen if tags are setup manually as we don't encurage to use static Tag.isTagValid\n            var indexesToRemove = [];\n            for (var i = 0; i < this.tags.length; i++) {\n                var element = this.tags[i];\n                if (!element || !cf_1.Tag.isTagValid(element.domElement)) {\n                    indexesToRemove.push(element);\n                }\n            }\n            for (var i = 0; i < indexesToRemove.length; i++) {\n                var tag = indexesToRemove[i];\n                this.tags.splice(this.tags.indexOf(tag), 1);\n            }\n            if (!ConversationalForm.suppressLog && (!this.tags || this.tags.length == 0)) {\n                console.warn(\"Conversational Form: No tags found or registered.\");\n            }\n            //let's start the conversation\n            this.tags = this.setupTagGroups(this.tags);\n            this.setupUI();\n            return this;\n        };\n        /**\n        * @name updateDictionaryValue\n        * set a dictionary value at \"runtime\"\n        *\tid: string, id of the value to update\n        *\ttype: string, \"human\" || \"robot\"\n        *\tvalue: string, value to be inserted\n        */\n        ConversationalForm.prototype.updateDictionaryValue = function (id, type, value) {\n            cf_1.Dictionary.set(id, type, value);\n            // if([\"robot-image\", \"user-image\"].indexOf(id) != -1){\n            // \tthis.chatList.updateThumbnail(id == \"robot-image\", value);\n            // }\n        };\n        ConversationalForm.prototype.getFormData = function (serialized) {\n            if (serialized === void 0) { serialized = false; }\n            if (serialized) {\n                var serialized_1 = {};\n                for (var i = 0; i < this.tags.length; i++) {\n                    var element = this.tags[i];\n                    if (element.value)\n                        serialized_1[element.name || \"tag-\" + i.toString()] = element.value;\n                }\n                return serialized_1;\n            }\n            else {\n                var formData = new FormData(this.formEl);\n                return formData;\n            }\n        };\n        ConversationalForm.prototype.addRobotChatResponse = function (response) {\n            this.chatList.createResponse(true, null, response);\n        };\n        ConversationalForm.prototype.addUserChatResponse = function (response) {\n            // add a \"fake\" user response..\n            this.chatList.createResponse(false, null, response);\n        };\n        ConversationalForm.prototype.stop = function (optionalStoppingMessage) {\n            if (optionalStoppingMessage === void 0) { optionalStoppingMessage = \"\"; }\n            this.flowManager.stop();\n            if (optionalStoppingMessage != \"\")\n                this.chatList.createResponse(true, null, optionalStoppingMessage);\n            this.userInput.onFlowStopped();\n        };\n        ConversationalForm.prototype.start = function () {\n            this.userInput.disabled = false;\n            if (!ConversationalForm.suppressLog)\n                console.log('option, disabled 3');\n            this.userInput.visible = true;\n            this.flowManager.start();\n        };\n        ConversationalForm.prototype.getTag = function (nameOrIndex) {\n            if (typeof nameOrIndex == \"number\") {\n                return this.tags[nameOrIndex];\n            }\n            else {\n                // TODO: fix so you can get a tag by its name attribute\n                return null;\n            }\n        };\n        ConversationalForm.prototype.setupTagGroups = function (tags) {\n            // make groups, from input tag[type=radio | type=checkbox]\n            // groups are used to bind logic like radio-button or checkbox dependencies\n            var groups = [];\n            for (var i = 0; i < tags.length; i++) {\n                var tag = tags[i];\n                if (tag.type == \"radio\" || tag.type == \"checkbox\") {\n                    if (!groups[tag.name])\n                        groups[tag.name] = [];\n                    groups[tag.name].push(tag);\n                }\n            }\n            if (Object.keys(groups).length > 0) {\n                for (var group in groups) {\n                    if (groups[group].length > 0) {\n                        // always build groupd when radio or checkbox\n                        // find the fieldset, if any..\n                        var isFieldsetValidForCF = function (tag) { return tag && tag.tagName.toLowerCase() !== \"fieldset\" && !tag.hasAttribute(\"cf-questions\"); };\n                        var fieldset = groups[group][0].domElement.parentNode;\n                        if (fieldset && fieldset.tagName.toLowerCase() !== \"fieldset\") {\n                            fieldset = fieldset.parentNode;\n                            if (isFieldsetValidForCF(fieldset)) {\n                                // not a valid fieldset, we only accept fieldsets that contain cf attr\n                                fieldset = null;\n                            }\n                        }\n                        var tagGroup = new cf_1.TagGroup({\n                            fieldset: fieldset,\n                            elements: groups[group]\n                        });\n                        // remove the tags as they are now apart of a group\n                        for (var i = 0; i < groups[group].length; i++) {\n                            var tagToBeRemoved = groups[group][i];\n                            if (i == 0) // add the group at same index as the the first tag to be removed\n                                tags.splice(tags.indexOf(tagToBeRemoved), 1, tagGroup);\n                            else\n                                tags.splice(tags.indexOf(tagToBeRemoved), 1);\n                        }\n                    }\n                }\n            }\n            return tags;\n        };\n        ConversationalForm.prototype.setupUI = function () {\n            // start the flow\n            this.flowManager = new cf_1.FlowManager({\n                cfReference: this,\n                flowStepCallback: this.flowStepCallback,\n                eventTarget: this.eventTarget,\n                tags: this.tags\n            });\n            this.el = document.createElement(\"div\");\n            this.el.id = \"conversational-form\";\n            this.el.className = \"conversational-form\";\n            this.addBrowserTypes(this.el);\n            if (ConversationalForm.animationsEnabled)\n                this.el.classList.add(\"conversational-form--enable-animation\");\n            // add conversational form to context\n            if (!this.preventAutoAppend)\n                this.context.appendChild(this.el);\n            //hide until stylesheet is rendered\n            this.el.style.visibility = \"hidden\";\n            var innerWrap = document.createElement(\"div\");\n            innerWrap.className = \"conversational-form-inner\";\n            this.el.appendChild(innerWrap);\n            // Conversational Form UI\n            this.chatList = new cf_1.ChatList({\n                eventTarget: this.eventTarget,\n                cfReference: this\n            });\n            innerWrap.appendChild(this.chatList.el);\n            this.userInput = new cf_1.UserTextInput({\n                microphoneInputObj: this.microphoneInputObj,\n                eventTarget: this.eventTarget,\n                cfReference: this\n            });\n            if (ConversationalForm.showProgressBar) {\n                var progressBar = new cf_1.ProgressBar(this);\n                innerWrap.appendChild(progressBar.el);\n            }\n            this.chatList.addInput(this.userInput);\n            innerWrap.appendChild(this.userInput.el);\n            this.onUserAnswerClickedCallback = this.onUserAnswerClicked.bind(this);\n            this.eventTarget.addEventListener(cf_1.ChatResponseEvents.USER_ANSWER_CLICKED, this.onUserAnswerClickedCallback, false);\n            this.el.classList.add(\"conversational-form--show\");\n            if (!this.preventAutoStart)\n                this.flowManager.start();\n            if (!this.tags || this.tags.length == 0) {\n                // no tags, so just show the input\n                this.userInput.visible = true;\n            }\n        };\n        /**\n        * @name onUserAnswerClicked\n        * on user ChatReponse clicked\n        */\n        ConversationalForm.prototype.onUserAnswerClicked = function (event) {\n            var tag = event.detail;\n            this.flowManager.editTag(tag);\n        };\n        ConversationalForm.prototype.addBrowserTypes = function (el) {\n            if (navigator.userAgent.indexOf('Firefox') > -1)\n                el.classList.add('browser-firefox');\n            if (/Edge/.test(navigator.userAgent))\n                el.classList.add('browser-edge');\n        };\n        /**\n        * @name addTag\n        * Add a tag to the conversation. This can be used to add tags at runtime\n        * see examples/formless.html\n        */\n        ConversationalForm.prototype.addTags = function (tagsData, addAfterCurrentStep, atIndex) {\n            if (addAfterCurrentStep === void 0) { addAfterCurrentStep = true; }\n            if (atIndex === void 0) { atIndex = -1; }\n            var tags = [];\n            for (var i = 0; i < tagsData.length; i++) {\n                var tagData = tagsData[i];\n                if (tagData.tag === \"fieldset\") {\n                    // group ..\n                    // const fieldSetChildren: Array<DataTag> = tagData.children;\n                    // parse group tag\n                    var groupTag = cf_1.TagsParser.parseGroupTag(tagData);\n                    for (var j = 0; j < groupTag.children.length; j++) {\n                        var tag = groupTag.children[j];\n                        if (cf_1.Tag.isTagValid(tag)) {\n                            var tagElement = cf_1.Tag.createTag(tag);\n                            // add ref for group creation\n                            if (!tagElement.name) {\n                                tagElement.name = \"tag-ref-\" + j.toString();\n                            }\n                            tags.push(tagElement);\n                        }\n                    }\n                }\n                else {\n                    var tag = tagData.tag === \"select\" ? cf_1.TagsParser.parseGroupTag(tagData) : cf_1.TagsParser.parseTag(tagData);\n                    if (cf_1.Tag.isTagValid(tag)) {\n                        var tagElement = cf_1.Tag.createTag(tag);\n                        tags.push(tagElement);\n                    }\n                }\n            }\n            // map free roaming checkbox and radio tags into groups\n            tags = this.setupTagGroups(tags);\n            // add new tags to the flow\n            this.tags = this.flowManager.addTags(tags, addAfterCurrentStep ? this.flowManager.getStep() + 1 : atIndex);\n            //this.flowManager.startFrom ?\n        };\n        /**\n        * @name remapTagsAndStartFrom\n        * index: number, what index to start from\n        * setCurrentTagValue: boolean, usually this method is called when wanting to loop or skip over questions, therefore it might be usefull to set the value of the current tag before changing index.\n        * ignoreExistingTags: boolean, possible to ignore existing tags, to allow for the flow to just \"happen\"\n        */\n        ConversationalForm.prototype.remapTagsAndStartFrom = function (index, setCurrentTagValue, ignoreExistingTags) {\n            if (index === void 0) { index = 0; }\n            if (setCurrentTagValue === void 0) { setCurrentTagValue = false; }\n            if (ignoreExistingTags === void 0) { ignoreExistingTags = false; }\n            if (setCurrentTagValue) {\n                this.chatList.setCurrentUserResponse(this.userInput.getFlowDTO());\n            }\n            // possibility to start the form flow over from {index}\n            for (var i = 0; i < this.tags.length; i++) {\n                var tag = this.tags[i];\n                tag.refresh();\n            }\n            this.flowManager.startFrom(index, ignoreExistingTags);\n        };\n        /**\n        * @name focus\n        * Sets focus on Conversational Form\n        */\n        ConversationalForm.prototype.focus = function () {\n            if (this.userInput)\n                this.userInput.setFocusOnInput();\n        };\n        ConversationalForm.prototype.doSubmitForm = function () {\n            this.el.classList.add(\"done\");\n            this.userInput.reset();\n            if (this.submitCallback) {\n                // remove should be called in the submitCallback\n                this.submitCallback(this);\n            }\n            else {\n                // this.formEl.submit();\n                // doing classic .submit wont trigger onsubmit if that is present on form element\n                // as described here: http://wayback.archive.org/web/20090323062817/http://blogs.vertigosoftware.com/snyholm/archive/2006/09/27/3788.aspx\n                // so we mimic a click.\n                var button = this.formEl.ownerDocument.createElement('button');\n                button.style.display = 'none';\n                button.type = 'submit';\n                this.formEl.appendChild(button);\n                button.click();\n                this.formEl.removeChild(button);\n                // remove conversational\n                this.remove();\n            }\n        };\n        ConversationalForm.prototype.remove = function () {\n            if (this.microphoneInputObj) {\n                this.microphoneInputObj = null;\n            }\n            if (this.onUserAnswerClickedCallback) {\n                this.eventTarget.removeEventListener(cf_1.ChatResponseEvents.USER_ANSWER_CLICKED, this.onUserAnswerClickedCallback, false);\n                this.onUserAnswerClickedCallback = null;\n            }\n            if (this.flowManager)\n                this.flowManager.dealloc();\n            if (this.userInput)\n                this.userInput.dealloc();\n            if (this.chatList)\n                this.chatList.dealloc();\n            this.dictionary = null;\n            this.flowManager = null;\n            this.userInput = null;\n            this.chatList = null;\n            this.context = null;\n            this.formEl = null;\n            this.tags = null;\n            this.submitCallback = null;\n            this.el.parentNode.removeChild(this.el);\n            this.el = null;\n            window.ConversationalForm[this.createId] = null;\n        };\n        // to illustrate the event flow of the app\n        ConversationalForm.illustrateFlow = function (classRef, type, eventType, detail) {\n            // ConversationalForm.illustrateFlow(this, \"dispatch\", FlowEvents.USER_INPUT_INVALID, event.detail);\n            // ConversationalForm.illustrateFlow(this, \"receive\", event.type, event.detail);\n            if (detail === void 0) { detail = null; }\n            if (ConversationalForm.illustrateAppFlow) {\n                var highlight = \"font-weight: 900; background: \" + (type == \"receive\" ? \"#e6f3fe\" : \"pink\") + \"; color: black; padding: 0px 5px;\";\n                if (!ConversationalForm.suppressLog)\n                    console.log(\"%c** event flow: %c\" + eventType + \"%c flow type: %c\" + type + \"%c from: %c\" + classRef.constructor.name, \"font-weight: 900;\", highlight, \"font-weight: 400;\", highlight, \"font-weight: 400;\", highlight);\n                if (detail)\n                    if (!ConversationalForm.suppressLog)\n                        console.log(\"** event flow detail:\", detail);\n            }\n        };\n        ConversationalForm.startTheConversation = function (data) {\n            var isFormless = !!data.formEl === false;\n            var formlessTags;\n            var constructorOptions;\n            if (isFormless) {\n                if (typeof data === \"string\") {\n                    // Formless init w. string\n                    isFormless = true;\n                    var json = JSON.parse(data);\n                    constructorOptions = json.options;\n                    formlessTags = json.tags;\n                }\n                else {\n                    // Formless init w. JSON object\n                    constructorOptions = data.options;\n                    formlessTags = data.tags;\n                }\n                // formless, so generate the pseudo tags\n                var formEl = cf.TagsParser.parseJSONIntoElements(formlessTags);\n                constructorOptions.formEl = formEl;\n            }\n            else {\n                // keep it standard\n                constructorOptions = data;\n            }\n            return new cf.ConversationalForm(constructorOptions);\n        };\n        ConversationalForm.autoStartTheConversation = function () {\n            if (cf.ConversationalForm.hasAutoInstantiated)\n                return;\n            // auto start the conversation\n            var formElements = document.querySelectorAll(\"form[cf-form]\");\n            // no form elements found, look for the old init attribute\n            if (formElements.length === 0) {\n                formElements = document.querySelectorAll(\"form[cf-form-element]\");\n            }\n            var formContexts = document.querySelectorAll(\"*[cf-context]\");\n            if (formElements && formElements.length > 0) {\n                for (var i = 0; i < formElements.length; i++) {\n                    var form = formElements[i];\n                    var context = formContexts[i];\n                    cf.ConversationalForm.startTheConversation({\n                        formEl: form,\n                        context: context\n                    });\n                }\n                cf.ConversationalForm.hasAutoInstantiated = true;\n            }\n        };\n        ConversationalForm.animationsEnabled = true;\n        ConversationalForm.illustrateAppFlow = true;\n        ConversationalForm.suppressLog = true;\n        ConversationalForm.showProgressBar = false;\n        ConversationalForm.preventSubmitOnEnter = false;\n        ConversationalForm.hasAutoInstantiated = false;\n        return ConversationalForm;\n    }());\n    cf_1.ConversationalForm = ConversationalForm;\n})(cf || (cf = {}));\nif (document.readyState == \"complete\") {\n    // if document alread instantiated, usually this happens if Conversational Form is injected through JS\n    setTimeout(function () { return cf.ConversationalForm.autoStartTheConversation(); }, 0);\n}\nelse {\n    // await for when document is ready\n    window.addEventListener(\"load\", function () {\n        cf.ConversationalForm.autoStartTheConversation();\n    }, false);\n}\n\n// jquery plugin\n(function (factory) {\n\ttry{\n\t\tfactory(jQuery);\n\t}catch(e){\n\t\t// whoops no jquery..\n\t}\n}(function ($) {\n\t$.fn.conversationalForm = function (options /* ConversationalFormOptions, see README */) {\n\t\toptions = options || {};\n\t\tif(!options.formEl){\n\t\t\toptions.formEl = this[0];\n\t\t}\n\n\t\tif(!options.context){\n\t\t\tvar formContexts = document.querySelectorAll(\"*[cf-context]\");\n\t\t\tif(formContexts[0]){\n\t\t\t\toptions.context = formContexts[0];\n\t\t\t}\n\t\t}\n\n\t\treturn new cf.ConversationalForm(options);\n\t};\n}));\n\n// requirejs/amd plugin\n(function (root, factory) {\n\t// from http://ifandelse.com/its-not-hard-making-your-library-support-amd-and-commonjs/#update\n\tif(typeof define === \"function\" && define.amd) {\n\t\tdefine([\"conversational-form\"], function(conversationalform){\n\t\t\treturn (root.conversationalform = factory(conversationalform));\n\t\t});\n\t} else if(typeof module === \"object\" && module.exports) {\n\t\tmodule.exports = (root.conversationalform = factory(require(\"conversational-form\")));\n\t} else {\n\t\troot.conversationalform = factory(cf.ConversationalForm);\n\t}\n\t}(window, function(conversationalform) {\n\t\t// module code here....\n\t\treturn cf;\n\t}\n));"]},"metadata":{},"sourceType":"script"}